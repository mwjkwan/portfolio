{"ast":null,"code":"import _regeneratorRuntime from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/melissa/datamatch/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/melissa/datamatch/src/pages/SchoolPortal/index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { firebaseConnect, firestoreConnect } from 'react-redux-firebase';\nimport { Route, Switch, Redirect } from 'react-router-dom';\nimport Sidebar from 'components/Sidebar';\nimport NavigationBar from './NavigationBar';\nimport Home from './Home';\nimport Profile from './Profile';\nimport Loading from 'components/Loading';\nimport PageLogin from 'components/Login';\n\nvar SchoolPortal =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(SchoolPortal, _Component);\n\n  function SchoolPortal(props) {\n    var _this;\n\n    _classCallCheck(this, SchoolPortal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SchoolPortal).call(this, props));\n    _this.state = {\n      loading: true,\n      school: props.profile.schoolAdmin\n    };\n    return _this;\n  }\n\n  _createClass(SchoolPortal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props, email, firebase, profile, school, snapshot, _snapshot$data, schoolAdmins;\n\n      return _regeneratorRuntime.async(function componentDidMount$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$props = this.props, email = _this$props.email, firebase = _this$props.firebase, profile = _this$props.profile;\n              school = profile.schoolAdmin; // if we aren't 100% sure this person is a schoolAdmin\n\n              if (profile.schoolAdmin) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(firebase.firestore().doc('/portals/school_admins').get());\n\n            case 5:\n              snapshot = _context.sent;\n              _snapshot$data = snapshot.data(), schoolAdmins = _snapshot$data.admins_to_school;\n              school = schoolAdmins[email];\n\n              if (!school) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 11;\n              return _regeneratorRuntime.awrap(firebase.functions().httpsCallable('user-makeSchoolAdmin')(school));\n\n            case 11:\n              this.setState({\n                loading: false,\n                school: school\n              });\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.loading) {\n        return React.createElement(\"div\", {\n          style: {\n            height: 200\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 51\n          },\n          __self: this\n        }, React.createElement(Loading, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52\n          },\n          __self: this\n        }));\n      }\n\n      var _this$props2 = this.props,\n          isLoggedIn = _this$props2.isLoggedIn,\n          loginUser = _this$props2.loginUser;\n      var school = this.state.school;\n\n      if (!isLoggedIn) {\n        return React.createElement(PageLogin, {\n          loginUser: loginUser,\n          title: \"University Portal\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 61\n          },\n          __self: this\n        });\n      }\n\n      if (!school) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 65\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"PageSchool\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69\n        },\n        __self: this\n      }, React.createElement(Sidebar, {\n        leftSidebar: React.createElement(NavigationBar, {\n          admin: this.props.admin,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 70\n          },\n          __self: this\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }, React.createElement(Switch, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/school_portal\",\n        component: Home,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72\n        },\n        __self: this\n      }), React.createElement(Route, {\n        exact: true,\n        path: \"/school_portal/school\",\n        render: function render() {\n          return React.createElement(Profile, {\n            school: school,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 76\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }), React.createElement(Route, {\n        exact: true,\n        path: \"/school_portal/survey\",\n        render: function render() {\n          return React.createElement(\"h1\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 81\n            },\n            __self: this\n          }, \"yelloooo\");\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }), React.createElement(Route, {\n        component: function component() {\n          return React.createElement(Redirect, {\n            to: \"/school_portal\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 83\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return SchoolPortal;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n  return {\n    email: state.firebase.auth.email,\n    isLoggedIn: state.firebase.auth.uid ? true : false,\n    loginUser: props.firebase.login,\n    profile: state.firebase.profile\n  };\n};\n\nexport default compose(firebaseConnect(), firestoreConnect(), connect(mapStateToProps))(SchoolPortal);","map":{"version":3,"sources":["/Users/melissa/datamatch/src/pages/SchoolPortal/index.js"],"names":["React","Component","connect","compose","firebaseConnect","firestoreConnect","Route","Switch","Redirect","Sidebar","NavigationBar","Home","Profile","Loading","PageLogin","SchoolPortal","props","state","loading","school","profile","schoolAdmin","email","firebase","firestore","doc","get","snapshot","data","schoolAdmins","admins_to_school","functions","httpsCallable","setState","height","isLoggedIn","loginUser","admin","mapStateToProps","auth","uid","login"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { firebaseConnect, firestoreConnect } from 'react-redux-firebase';\nimport { Route, Switch, Redirect } from 'react-router-dom';\n\nimport Sidebar from 'components/Sidebar';\nimport NavigationBar from './NavigationBar';\nimport Home from './Home';\nimport Profile from './Profile';\n\nimport Loading from 'components/Loading';\nimport PageLogin from 'components/Login';\n\nclass SchoolPortal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      school: props.profile.schoolAdmin,\n    };\n  }\n\n  async componentDidMount() {\n    const { email, firebase, profile } = this.props;\n    let school = profile.schoolAdmin;\n\n    // if we aren't 100% sure this person is a schoolAdmin\n    if (!profile.schoolAdmin) {\n      const snapshot = await firebase\n        .firestore()\n        .doc('/portals/school_admins')\n        .get();\n\n      const { admins_to_school: schoolAdmins } = snapshot.data();\n      school = schoolAdmins[email];\n\n      if (school) {\n        await firebase.functions().httpsCallable('user-makeSchoolAdmin')(\n          school,\n        );\n      }\n    }\n\n    this.setState({ loading: false, school });\n  }\n\n  render() {\n    if (this.state.loading) {\n      return (\n        <div style={{ height: 200 }}>\n          <Loading />\n        </div>\n      );\n    }\n\n    const { isLoggedIn, loginUser } = this.props;\n    const { school } = this.state;\n\n    if (!isLoggedIn) {\n      return <PageLogin loginUser={loginUser} title=\"University Portal\" />;\n    }\n\n    if (!school) {\n      return <Redirect to=\"/\" />;\n    }\n\n    return (\n      <div className=\"PageSchool\">\n        <Sidebar leftSidebar={<NavigationBar admin={this.props.admin} />}>\n          <Switch>\n            <Route exact path=\"/school_portal\" component={Home} />\n            <Route\n              exact\n              path=\"/school_portal/school\"\n              render={() => <Profile school={school} />}\n            />\n            <Route\n              exact\n              path=\"/school_portal/survey\"\n              render={() => <h1>yelloooo</h1>}\n            />\n            <Route component={() => <Redirect to=\"/school_portal\" />} />\n          </Switch>\n        </Sidebar>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state, props) => {\n  return {\n    email: state.firebase.auth.email,\n    isLoggedIn: state.firebase.auth.uid ? true : false,\n    loginUser: props.firebase.login,\n    profile: state.firebase.profile,\n  };\n};\n\nexport default compose(\n  firebaseConnect(),\n  firestoreConnect(),\n  connect(mapStateToProps),\n)(SchoolPortal);\n"]},"metadata":{},"sourceType":"module"}