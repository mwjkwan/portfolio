{"ast":null,"code":"'use strict';\n\nvar Config = {\n  DEBUG: false,\n  LIB_VERSION: '2.32.0'\n}; // since es6 imports are static and we run unit tests from the console, window won't be defined when importing this file\n\nvar window$1;\n\nif (typeof window === 'undefined') {\n  var loc = {\n    hostname: ''\n  };\n  window$1 = {\n    navigator: {\n      userAgent: ''\n    },\n    document: {\n      location: loc,\n      referrer: ''\n    },\n    screen: {\n      width: 0,\n      height: 0\n    },\n    location: loc\n  };\n} else {\n  window$1 = window;\n}\n/*\n * Saved references to long variable names, so that closure compiler can\n * minimize file size.\n */\n\n\nvar ArrayProto = Array.prototype;\nvar FuncProto = Function.prototype;\nvar ObjProto = Object.prototype;\nvar slice = ArrayProto.slice;\nvar toString = ObjProto.toString;\nvar hasOwnProperty = ObjProto.hasOwnProperty;\nvar windowConsole = window$1.console;\nvar navigator$1 = window$1.navigator;\nvar document$1 = window$1.document;\nvar windowOpera = window$1.opera;\nvar screen = window$1.screen;\nvar userAgent = navigator$1.userAgent;\nvar nativeBind = FuncProto.bind;\nvar nativeForEach = ArrayProto.forEach;\nvar nativeIndexOf = ArrayProto.indexOf;\nvar nativeIsArray = Array.isArray;\nvar breaker = {};\nvar DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z.]{2,6}$/i;\nvar _ = {\n  trim: function trim(str) {\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n  }\n}; // Console override\n\nvar console$1 = {\n  /** @type {function(...*)} */\n  log: function log() {\n    if (Config.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n      try {\n        windowConsole.log.apply(windowConsole, arguments);\n      } catch (err) {\n        _.each(arguments, function (arg) {\n          windowConsole.log(arg);\n        });\n      }\n    }\n  },\n\n  /** @type {function(...*)} */\n  error: function error() {\n    if (Config.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n      var args = ['Mixpanel error:'].concat(_.toArray(arguments));\n\n      try {\n        windowConsole.error.apply(windowConsole, args);\n      } catch (err) {\n        _.each(args, function (arg) {\n          windowConsole.error(arg);\n        });\n      }\n    }\n  },\n\n  /** @type {function(...*)} */\n  critical: function critical() {\n    if (!_.isUndefined(windowConsole) && windowConsole) {\n      var args = ['Mixpanel error:'].concat(_.toArray(arguments));\n\n      try {\n        windowConsole.error.apply(windowConsole, args);\n      } catch (err) {\n        _.each(args, function (arg) {\n          windowConsole.error(arg);\n        });\n      }\n    }\n  }\n}; // UNDERSCORE\n// Embed part of the Underscore Library\n\n_.bind = function (func, context) {\n  var args, _bound;\n\n  if (nativeBind && func.bind === nativeBind) {\n    return nativeBind.apply(func, slice.call(arguments, 1));\n  }\n\n  if (!_.isFunction(func)) {\n    throw new TypeError();\n  }\n\n  args = slice.call(arguments, 2);\n\n  _bound = function bound() {\n    if (!(this instanceof _bound)) {\n      return func.apply(context, args.concat(slice.call(arguments)));\n    }\n\n    var ctor = {};\n    ctor.prototype = func.prototype;\n    var self = new ctor();\n    ctor.prototype = null;\n    var result = func.apply(self, args.concat(slice.call(arguments)));\n\n    if (Object(result) === result) {\n      return result;\n    }\n\n    return self;\n  };\n\n  return _bound;\n};\n\n_.bind_instance_methods = function (obj) {\n  for (var func in obj) {\n    if (typeof obj[func] === 'function') {\n      obj[func] = _.bind(obj[func], obj);\n    }\n  }\n};\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} context\n */\n\n\n_.each = function (obj, iterator, context) {\n  if (obj === null || obj === undefined) {\n    return;\n  }\n\n  if (nativeForEach && obj.forEach === nativeForEach) {\n    obj.forEach(iterator, context);\n  } else if (obj.length === +obj.length) {\n    for (var i = 0, l = obj.length; i < l; i++) {\n      if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n        return;\n      }\n    }\n  } else {\n    for (var key in obj) {\n      if (hasOwnProperty.call(obj, key)) {\n        if (iterator.call(context, obj[key], key, obj) === breaker) {\n          return;\n        }\n      }\n    }\n  }\n};\n\n_.escapeHTML = function (s) {\n  var escaped = s;\n\n  if (escaped && _.isString(escaped)) {\n    escaped = escaped.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#039;');\n  }\n\n  return escaped;\n};\n\n_.extend = function (obj) {\n  _.each(slice.call(arguments, 1), function (source) {\n    for (var prop in source) {\n      if (source[prop] !== void 0) {\n        obj[prop] = source[prop];\n      }\n    }\n  });\n\n  return obj;\n};\n\n_.isArray = nativeIsArray || function (obj) {\n  return toString.call(obj) === '[object Array]';\n}; // from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// var bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\n\n\n_.isFunction = function (f) {\n  try {\n    return /^\\s*\\bfunction\\b/.test(f);\n  } catch (x) {\n    return false;\n  }\n};\n\n_.isArguments = function (obj) {\n  return !!(obj && hasOwnProperty.call(obj, 'callee'));\n};\n\n_.toArray = function (iterable) {\n  if (!iterable) {\n    return [];\n  }\n\n  if (iterable.toArray) {\n    return iterable.toArray();\n  }\n\n  if (_.isArray(iterable)) {\n    return slice.call(iterable);\n  }\n\n  if (_.isArguments(iterable)) {\n    return slice.call(iterable);\n  }\n\n  return _.values(iterable);\n};\n\n_.keys = function (obj) {\n  var results = [];\n\n  if (obj === null) {\n    return results;\n  }\n\n  _.each(obj, function (value, key) {\n    results[results.length] = key;\n  });\n\n  return results;\n};\n\n_.values = function (obj) {\n  var results = [];\n\n  if (obj === null) {\n    return results;\n  }\n\n  _.each(obj, function (value) {\n    results[results.length] = value;\n  });\n\n  return results;\n};\n\n_.identity = function (value) {\n  return value;\n};\n\n_.include = function (obj, target) {\n  var found = false;\n\n  if (obj === null) {\n    return found;\n  }\n\n  if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n    return obj.indexOf(target) != -1;\n  }\n\n  _.each(obj, function (value) {\n    if (found || (found = value === target)) {\n      return breaker;\n    }\n  });\n\n  return found;\n};\n\n_.includes = function (str, needle) {\n  return str.indexOf(needle) !== -1;\n}; // Underscore Addons\n\n\n_.inherit = function (subclass, superclass) {\n  subclass.prototype = new superclass();\n  subclass.prototype.constructor = subclass;\n  subclass.superclass = superclass.prototype;\n  return subclass;\n};\n\n_.isObject = function (obj) {\n  return obj === Object(obj) && !_.isArray(obj);\n};\n\n_.isEmptyObject = function (obj) {\n  if (_.isObject(obj)) {\n    for (var key in obj) {\n      if (hasOwnProperty.call(obj, key)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  return false;\n};\n\n_.isUndefined = function (obj) {\n  return obj === void 0;\n};\n\n_.isString = function (obj) {\n  return toString.call(obj) == '[object String]';\n};\n\n_.isDate = function (obj) {\n  return toString.call(obj) == '[object Date]';\n};\n\n_.isNumber = function (obj) {\n  return toString.call(obj) == '[object Number]';\n};\n\n_.isElement = function (obj) {\n  return !!(obj && obj.nodeType === 1);\n};\n\n_.encodeDates = function (obj) {\n  _.each(obj, function (v, k) {\n    if (_.isDate(v)) {\n      obj[k] = _.formatDate(v);\n    } else if (_.isObject(v)) {\n      obj[k] = _.encodeDates(v); // recurse\n    }\n  });\n\n  return obj;\n};\n\n_.timestamp = function () {\n  Date.now = Date.now || function () {\n    return +new Date();\n  };\n\n  return Date.now();\n};\n\n_.formatDate = function (d) {\n  // YYYY-MM-DDTHH:MM:SS in UTC\n  function pad(n) {\n    return n < 10 ? '0' + n : n;\n  }\n\n  return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds());\n};\n\n_.safewrap = function (f) {\n  return function () {\n    try {\n      return f.apply(this, arguments);\n    } catch (e) {\n      console$1.critical('Implementation error. Please turn on debug and contact support@mixpanel.com.');\n\n      if (Config.DEBUG) {\n        console$1.critical(e);\n      }\n    }\n  };\n};\n\n_.safewrap_class = function (klass, functions) {\n  for (var i = 0; i < functions.length; i++) {\n    klass.prototype[functions[i]] = _.safewrap(klass.prototype[functions[i]]);\n  }\n};\n\n_.safewrap_instance_methods = function (obj) {\n  for (var func in obj) {\n    if (typeof obj[func] === 'function') {\n      obj[func] = _.safewrap(obj[func]);\n    }\n  }\n};\n\n_.strip_empty_properties = function (p) {\n  var ret = {};\n\n  _.each(p, function (v, k) {\n    if (_.isString(v) && v.length > 0) {\n      ret[k] = v;\n    }\n  });\n\n  return ret;\n};\n/*\n * this function returns a copy of object after truncating it.  If\n * passed an Array or Object it will iterate through obj and\n * truncate all the values recursively.\n */\n\n\n_.truncate = function (obj, length) {\n  var ret;\n\n  if (typeof obj === 'string') {\n    ret = obj.slice(0, length);\n  } else if (_.isArray(obj)) {\n    ret = [];\n\n    _.each(obj, function (val) {\n      ret.push(_.truncate(val, length));\n    });\n  } else if (_.isObject(obj)) {\n    ret = {};\n\n    _.each(obj, function (val, key) {\n      ret[key] = _.truncate(val, length);\n    });\n  } else {\n    ret = obj;\n  }\n\n  return ret;\n};\n\n_.JSONEncode = function () {\n  return function (mixed_val) {\n    var value = mixed_val;\n\n    var quote = function quote(string) {\n      var escapable = /[\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g; // eslint-disable-line no-control-regex\n\n      var meta = {\n        // table of character substitutions\n        '\\b': '\\\\b',\n        '\\t': '\\\\t',\n        '\\n': '\\\\n',\n        '\\f': '\\\\f',\n        '\\r': '\\\\r',\n        '\"': '\\\\\"',\n        '\\\\': '\\\\\\\\'\n      };\n      escapable.lastIndex = 0;\n      return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n        var c = meta[a];\n        return typeof c === 'string' ? c : \"\\\\u\" + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n      }) + '\"' : '\"' + string + '\"';\n    };\n\n    var str = function str(key, holder) {\n      var gap = '';\n      var indent = '    ';\n      var i = 0; // The loop counter.\n\n      var k = ''; // The member key.\n\n      var v = ''; // The member value.\n\n      var length = 0;\n      var mind = gap;\n      var partial = [];\n      var value = holder[key]; // If the value has a toJSON method, call it to obtain a replacement value.\n\n      if (value && typeof value === 'object' && typeof value.toJSON === 'function') {\n        value = value.toJSON(key);\n      } // What happens next depends on the value's type.\n\n\n      switch (typeof value) {\n        case 'string':\n          return quote(value);\n\n        case 'number':\n          // JSON numbers must be finite. Encode non-finite numbers as null.\n          return isFinite(value) ? String(value) : 'null';\n\n        case 'boolean':\n        case 'null':\n          // If the value is a boolean or null, convert it to a string. Note:\n          // typeof null does not produce 'null'. The case is included here in\n          // the remote chance that this gets fixed someday.\n          return String(value);\n\n        case 'object':\n          // If the type is 'object', we might be dealing with an object or an array or\n          // null.\n          // Due to a specification blunder in ECMAScript, typeof null is 'object',\n          // so watch out for that case.\n          if (!value) {\n            return 'null';\n          } // Make an array to hold the partial results of stringifying this object value.\n\n\n          gap += indent;\n          partial = []; // Is the value an array?\n\n          if (toString.apply(value) === '[object Array]') {\n            // The value is an array. Stringify every element. Use null as a placeholder\n            // for non-JSON values.\n            length = value.length;\n\n            for (i = 0; i < length; i += 1) {\n              partial[i] = str(i, value) || 'null';\n            } // Join all of the elements together, separated with commas, and wrap them in\n            // brackets.\n\n\n            v = partial.length === 0 ? '[]' : gap ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']' : '[' + partial.join(',') + ']';\n            gap = mind;\n            return v;\n          } // Iterate through all of the keys in the object.\n\n\n          for (k in value) {\n            if (hasOwnProperty.call(value, k)) {\n              v = str(k, value);\n\n              if (v) {\n                partial.push(quote(k) + (gap ? ': ' : ':') + v);\n              }\n            }\n          } // Join all of the member texts together, separated with commas,\n          // and wrap them in braces.\n\n\n          v = partial.length === 0 ? '{}' : gap ? '{' + partial.join(',') + '' + mind + '}' : '{' + partial.join(',') + '}';\n          gap = mind;\n          return v;\n      }\n    }; // Make a fake root object containing our value under the key of ''.\n    // Return the result of stringifying the value.\n\n\n    return str('', {\n      '': value\n    });\n  };\n}();\n/**\n * From https://github.com/douglascrockford/JSON-js/blob/master/json_parse.js\n * Slightly modified to throw a real Error rather than a POJO\n */\n\n\n_.JSONDecode = function () {\n  var at,\n      // The index of the current character\n  ch,\n      // The current character\n  escapee = {\n    '\"': '\"',\n    '\\\\': '\\\\',\n    '/': '/',\n    'b': '\\b',\n    'f': '\\f',\n    'n': '\\n',\n    'r': '\\r',\n    't': '\\t'\n  },\n      text,\n      error = function error(m) {\n    var e = new SyntaxError(m);\n    e.at = at;\n    e.text = text;\n    throw e;\n  },\n      next = function next(c) {\n    // If a c parameter is provided, verify that it matches the current character.\n    if (c && c !== ch) {\n      error('Expected \\'' + c + '\\' instead of \\'' + ch + '\\'');\n    } // Get the next character. When there are no more characters,\n    // return the empty string.\n\n\n    ch = text.charAt(at);\n    at += 1;\n    return ch;\n  },\n      number = function number() {\n    // Parse a number value.\n    var number,\n        string = '';\n\n    if (ch === '-') {\n      string = '-';\n      next('-');\n    }\n\n    while (ch >= '0' && ch <= '9') {\n      string += ch;\n      next();\n    }\n\n    if (ch === '.') {\n      string += '.';\n\n      while (next() && ch >= '0' && ch <= '9') {\n        string += ch;\n      }\n    }\n\n    if (ch === 'e' || ch === 'E') {\n      string += ch;\n      next();\n\n      if (ch === '-' || ch === '+') {\n        string += ch;\n        next();\n      }\n\n      while (ch >= '0' && ch <= '9') {\n        string += ch;\n        next();\n      }\n    }\n\n    number = +string;\n\n    if (!isFinite(number)) {\n      error('Bad number');\n    } else {\n      return number;\n    }\n  },\n      string = function string() {\n    // Parse a string value.\n    var hex,\n        i,\n        string = '',\n        uffff; // When parsing for string values, we must look for \" and \\ characters.\n\n    if (ch === '\"') {\n      while (next()) {\n        if (ch === '\"') {\n          next();\n          return string;\n        }\n\n        if (ch === '\\\\') {\n          next();\n\n          if (ch === 'u') {\n            uffff = 0;\n\n            for (i = 0; i < 4; i += 1) {\n              hex = parseInt(next(), 16);\n\n              if (!isFinite(hex)) {\n                break;\n              }\n\n              uffff = uffff * 16 + hex;\n            }\n\n            string += String.fromCharCode(uffff);\n          } else if (typeof escapee[ch] === 'string') {\n            string += escapee[ch];\n          } else {\n            break;\n          }\n        } else {\n          string += ch;\n        }\n      }\n    }\n\n    error('Bad string');\n  },\n      white = function white() {\n    // Skip whitespace.\n    while (ch && ch <= ' ') {\n      next();\n    }\n  },\n      word = function word() {\n    // true, false, or null.\n    switch (ch) {\n      case 't':\n        next('t');\n        next('r');\n        next('u');\n        next('e');\n        return true;\n\n      case 'f':\n        next('f');\n        next('a');\n        next('l');\n        next('s');\n        next('e');\n        return false;\n\n      case 'n':\n        next('n');\n        next('u');\n        next('l');\n        next('l');\n        return null;\n    }\n\n    error('Unexpected \"' + ch + '\"');\n  },\n      value,\n      // Placeholder for the value function.\n  array = function array() {\n    // Parse an array value.\n    var array = [];\n\n    if (ch === '[') {\n      next('[');\n      white();\n\n      if (ch === ']') {\n        next(']');\n        return array; // empty array\n      }\n\n      while (ch) {\n        array.push(value());\n        white();\n\n        if (ch === ']') {\n          next(']');\n          return array;\n        }\n\n        next(',');\n        white();\n      }\n    }\n\n    error('Bad array');\n  },\n      object = function object() {\n    // Parse an object value.\n    var key,\n        object = {};\n\n    if (ch === '{') {\n      next('{');\n      white();\n\n      if (ch === '}') {\n        next('}');\n        return object; // empty object\n      }\n\n      while (ch) {\n        key = string();\n        white();\n        next(':');\n\n        if (Object.hasOwnProperty.call(object, key)) {\n          error('Duplicate key \"' + key + '\"');\n        }\n\n        object[key] = value();\n        white();\n\n        if (ch === '}') {\n          next('}');\n          return object;\n        }\n\n        next(',');\n        white();\n      }\n    }\n\n    error('Bad object');\n  };\n\n  value = function value() {\n    // Parse a JSON value. It could be an object, an array, a string,\n    // a number, or a word.\n    white();\n\n    switch (ch) {\n      case '{':\n        return object();\n\n      case '[':\n        return array();\n\n      case '\"':\n        return string();\n\n      case '-':\n        return number();\n\n      default:\n        return ch >= '0' && ch <= '9' ? number() : word();\n    }\n  }; // Return the json_parse function. It will have access to all of the\n  // above functions and variables.\n\n\n  return function (source) {\n    var result;\n    text = source;\n    at = 0;\n    ch = ' ';\n    result = value();\n    white();\n\n    if (ch) {\n      error('Syntax error');\n    }\n\n    return result;\n  };\n}();\n\n_.base64Encode = function (data) {\n  var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  var o1,\n      o2,\n      o3,\n      h1,\n      h2,\n      h3,\n      h4,\n      bits,\n      i = 0,\n      ac = 0,\n      enc = '',\n      tmp_arr = [];\n\n  if (!data) {\n    return data;\n  }\n\n  data = _.utf8Encode(data);\n\n  do {\n    // pack three octets into four hexets\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n    bits = o1 << 16 | o2 << 8 | o3;\n    h1 = bits >> 18 & 0x3f;\n    h2 = bits >> 12 & 0x3f;\n    h3 = bits >> 6 & 0x3f;\n    h4 = bits & 0x3f; // use hexets to index into b64, and append result to encoded string\n\n    tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  } while (i < data.length);\n\n  enc = tmp_arr.join('');\n\n  switch (data.length % 3) {\n    case 1:\n      enc = enc.slice(0, -2) + '==';\n      break;\n\n    case 2:\n      enc = enc.slice(0, -1) + '=';\n      break;\n  }\n\n  return enc;\n};\n\n_.utf8Encode = function (string) {\n  string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n  var utftext = '',\n      start,\n      end;\n  var stringl = 0,\n      n;\n  start = end = 0;\n  stringl = string.length;\n\n  for (n = 0; n < stringl; n++) {\n    var c1 = string.charCodeAt(n);\n    var enc = null;\n\n    if (c1 < 128) {\n      end++;\n    } else if (c1 > 127 && c1 < 2048) {\n      enc = String.fromCharCode(c1 >> 6 | 192, c1 & 63 | 128);\n    } else {\n      enc = String.fromCharCode(c1 >> 12 | 224, c1 >> 6 & 63 | 128, c1 & 63 | 128);\n    }\n\n    if (enc !== null) {\n      if (end > start) {\n        utftext += string.substring(start, end);\n      }\n\n      utftext += enc;\n      start = end = n + 1;\n    }\n  }\n\n  if (end > start) {\n    utftext += string.substring(start, string.length);\n  }\n\n  return utftext;\n};\n\n_.UUID = function () {\n  // Time/ticks information\n  // 1*new Date() is a cross browser version of Date.now()\n  var T = function T() {\n    var d = 1 * new Date(),\n        i = 0; // this while loop figures how many browser ticks go by\n    // before 1*new Date() returns a new number, ie the amount\n    // of ticks that go by per millisecond\n\n    while (d == 1 * new Date()) {\n      i++;\n    }\n\n    return d.toString(16) + i.toString(16);\n  }; // Math.Random entropy\n\n\n  var R = function R() {\n    return Math.random().toString(16).replace('.', '');\n  }; // User agent entropy\n  // This function takes the user agent string, and then xors\n  // together each sequence of 8 bytes.  This produces a final\n  // sequence of 8 bytes which it returns as hex.\n\n\n  var UA = function UA() {\n    var ua = userAgent,\n        i,\n        ch,\n        buffer = [],\n        ret = 0;\n\n    function xor(result, byte_array) {\n      var j,\n          tmp = 0;\n\n      for (j = 0; j < byte_array.length; j++) {\n        tmp |= buffer[j] << j * 8;\n      }\n\n      return result ^ tmp;\n    }\n\n    for (i = 0; i < ua.length; i++) {\n      ch = ua.charCodeAt(i);\n      buffer.unshift(ch & 0xFF);\n\n      if (buffer.length >= 4) {\n        ret = xor(ret, buffer);\n        buffer = [];\n      }\n    }\n\n    if (buffer.length > 0) {\n      ret = xor(ret, buffer);\n    }\n\n    return ret.toString(16);\n  };\n\n  return function () {\n    var se = (screen.height * screen.width).toString(16);\n    return T() + '-' + R() + '-' + UA() + '-' + se + '-' + T();\n  };\n}(); // _.isBlockedUA()\n// This is to block various web spiders from executing our JS and\n// sending false tracking data\n\n\n_.isBlockedUA = function (ua) {\n  if (/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(ua)) {\n    return true;\n  }\n\n  return false;\n};\n/**\n * @param {Object=} formdata\n * @param {string=} arg_separator\n */\n\n\n_.HTTPBuildQuery = function (formdata, arg_separator) {\n  var use_val,\n      use_key,\n      tmp_arr = [];\n\n  if (_.isUndefined(arg_separator)) {\n    arg_separator = '&';\n  }\n\n  _.each(formdata, function (val, key) {\n    use_val = encodeURIComponent(val.toString());\n    use_key = encodeURIComponent(key);\n    tmp_arr[tmp_arr.length] = use_key + '=' + use_val;\n  });\n\n  return tmp_arr.join(arg_separator);\n};\n\n_.getQueryParam = function (url, param) {\n  // Expects a raw URL\n  param = param.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n  var regexS = '[\\\\?&]' + param + '=([^&#]*)',\n      regex = new RegExp(regexS),\n      results = regex.exec(url);\n\n  if (results === null || results && typeof results[1] !== 'string' && results[1].length) {\n    return '';\n  } else {\n    var result = results[1];\n\n    try {\n      result = decodeURIComponent(result);\n    } catch (err) {\n      console$1.error('Skipping decoding for malformed query param: ' + result);\n    }\n\n    return result.replace(/\\+/g, ' ');\n  }\n};\n\n_.getHashParam = function (hash, param) {\n  var matches = hash.match(new RegExp(param + '=([^&]*)'));\n  return matches ? matches[1] : null;\n}; // _.cookie\n// Methods partially borrowed from quirksmode.org/js/cookies.html\n\n\n_.cookie = {\n  get: function get(name) {\n    var nameEQ = name + '=';\n    var ca = document$1.cookie.split(';');\n\n    for (var i = 0; i < ca.length; i++) {\n      var c = ca[i];\n\n      while (c.charAt(0) == ' ') {\n        c = c.substring(1, c.length);\n      }\n\n      if (c.indexOf(nameEQ) === 0) {\n        return decodeURIComponent(c.substring(nameEQ.length, c.length));\n      }\n    }\n\n    return null;\n  },\n  parse: function parse(name) {\n    var cookie;\n\n    try {\n      cookie = _.JSONDecode(_.cookie.get(name)) || {};\n    } catch (err) {// noop\n    }\n\n    return cookie;\n  },\n  set_seconds: function set_seconds(name, value, seconds, cross_subdomain, is_secure) {\n    var cdomain = '',\n        expires = '',\n        secure = '';\n\n    if (cross_subdomain) {\n      var matches = document$1.location.hostname.match(DOMAIN_MATCH_REGEX),\n          domain = matches ? matches[0] : '';\n      cdomain = domain ? '; domain=.' + domain : '';\n    }\n\n    if (seconds) {\n      var date = new Date();\n      date.setTime(date.getTime() + seconds * 1000);\n      expires = '; expires=' + date.toGMTString();\n    }\n\n    if (is_secure) {\n      secure = '; secure';\n    }\n\n    document$1.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\n  },\n  set: function set(name, value, days, cross_subdomain, is_secure) {\n    var cdomain = '',\n        expires = '',\n        secure = '';\n\n    if (cross_subdomain) {\n      var matches = document$1.location.hostname.match(DOMAIN_MATCH_REGEX),\n          domain = matches ? matches[0] : '';\n      cdomain = domain ? '; domain=.' + domain : '';\n    }\n\n    if (days) {\n      var date = new Date();\n      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);\n      expires = '; expires=' + date.toGMTString();\n    }\n\n    if (is_secure) {\n      secure = '; secure';\n    }\n\n    var new_cookie_val = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\n    document$1.cookie = new_cookie_val;\n    return new_cookie_val;\n  },\n  remove: function remove(name, cross_subdomain) {\n    _.cookie.set(name, '', -1, cross_subdomain);\n  }\n}; // _.localStorage\n\nvar _localStorage_supported = null;\n_.localStorage = {\n  is_supported: function is_supported() {\n    if (_localStorage_supported !== null) {\n      return _localStorage_supported;\n    }\n\n    var supported = true;\n\n    try {\n      var key = '__mplssupport__',\n          val = 'xyz';\n\n      _.localStorage.set(key, val);\n\n      if (_.localStorage.get(key) !== val) {\n        supported = false;\n      }\n\n      _.localStorage.remove(key);\n    } catch (err) {\n      supported = false;\n    }\n\n    if (!supported) {\n      console$1.error('localStorage unsupported; falling back to cookie store');\n    }\n\n    _localStorage_supported = supported;\n    return supported;\n  },\n  error: function error(msg) {\n    console$1.error('localStorage error: ' + msg);\n  },\n  get: function get(name) {\n    try {\n      return window.localStorage.getItem(name);\n    } catch (err) {\n      _.localStorage.error(err);\n    }\n\n    return null;\n  },\n  parse: function parse(name) {\n    try {\n      return _.JSONDecode(_.localStorage.get(name)) || {};\n    } catch (err) {// noop\n    }\n\n    return null;\n  },\n  set: function set(name, value) {\n    try {\n      window.localStorage.setItem(name, value);\n    } catch (err) {\n      _.localStorage.error(err);\n    }\n  },\n  remove: function remove(name) {\n    try {\n      window.localStorage.removeItem(name);\n    } catch (err) {\n      _.localStorage.error(err);\n    }\n  }\n};\n\n_.register_event = function () {\n  // written by Dean Edwards, 2005\n  // with input from Tino Zijdel - crisp@xs4all.nl\n  // with input from Carl Sverre - mail@carlsverre.com\n  // with input from Mixpanel\n  // http://dean.edwards.name/weblog/2005/10/add-event/\n  // https://gist.github.com/1930440\n\n  /**\n   * @param {Object} element\n   * @param {string} type\n   * @param {function(...*)} handler\n   * @param {boolean=} oldSchool\n   * @param {boolean=} useCapture\n   */\n  var register_event = function register_event(element, type, handler, oldSchool, useCapture) {\n    if (!element) {\n      console$1.error('No valid element provided to register_event');\n      return;\n    }\n\n    if (element.addEventListener && !oldSchool) {\n      element.addEventListener(type, handler, !!useCapture);\n    } else {\n      var ontype = 'on' + type;\n      var old_handler = element[ontype]; // can be undefined\n\n      element[ontype] = makeHandler(element, handler, old_handler);\n    }\n  };\n\n  function makeHandler(element, new_handler, old_handlers) {\n    var handler = function handler(event) {\n      event = event || fixEvent(window.event); // this basically happens in firefox whenever another script\n      // overwrites the onload callback and doesn't pass the event\n      // object to previously defined callbacks.  All the browsers\n      // that don't define window.event implement addEventListener\n      // so the dom_loaded handler will still be fired as usual.\n\n      if (!event) {\n        return undefined;\n      }\n\n      var ret = true;\n      var old_result, new_result;\n\n      if (_.isFunction(old_handlers)) {\n        old_result = old_handlers(event);\n      }\n\n      new_result = new_handler.call(element, event);\n\n      if (false === old_result || false === new_result) {\n        ret = false;\n      }\n\n      return ret;\n    };\n\n    return handler;\n  }\n\n  function fixEvent(event) {\n    if (event) {\n      event.preventDefault = fixEvent.preventDefault;\n      event.stopPropagation = fixEvent.stopPropagation;\n    }\n\n    return event;\n  }\n\n  fixEvent.preventDefault = function () {\n    this.returnValue = false;\n  };\n\n  fixEvent.stopPropagation = function () {\n    this.cancelBubble = true;\n  };\n\n  return register_event;\n}();\n\nvar TOKEN_MATCH_REGEX = new RegExp('^(\\\\w*)\\\\[(\\\\w+)([=~\\\\|\\\\^\\\\$\\\\*]?)=?\"?([^\\\\]\"]*)\"?\\\\]$');\n\n_.dom_query = function () {\n  /* document.getElementsBySelector(selector)\n  - returns an array of element objects from the current document\n  matching the CSS selector. Selectors can contain element names,\n  class names and ids and can be nested. For example:\n   elements = document.getElementsBySelector('div#main p a.external')\n   Will return an array of all 'a' elements with 'external' in their\n  class attribute that are contained inside 'p' elements that are\n  contained inside the 'div' element which has id=\"main\"\n   New in version 0.4: Support for CSS2 and CSS3 attribute selectors:\n  See http://www.w3.org/TR/css3-selectors/#attribute-selectors\n   Version 0.4 - Simon Willison, March 25th 2003\n  -- Works in Phoenix 0.5, Mozilla 1.3, Opera 7, Internet Explorer 6, Internet Explorer 5 on Windows\n  -- Opera 7 fails\n   Version 0.5 - Carl Sverre, Jan 7th 2013\n  -- Now uses jQuery-esque `hasClass` for testing class name\n  equality.  This fixes a bug related to '-' characters being\n  considered not part of a 'word' in regex.\n  */\n  function getAllChildren(e) {\n    // Returns all children of element. Workaround required for IE5/Windows. Ugh.\n    return e.all ? e.all : e.getElementsByTagName('*');\n  }\n\n  var bad_whitespace = /[\\t\\r\\n]/g;\n\n  function hasClass(elem, selector) {\n    var className = ' ' + selector + ' ';\n    return (' ' + elem.className + ' ').replace(bad_whitespace, ' ').indexOf(className) >= 0;\n  }\n\n  function getElementsBySelector(selector) {\n    // Attempt to fail gracefully in lesser browsers\n    if (!document$1.getElementsByTagName) {\n      return [];\n    } // Split selector in to tokens\n\n\n    var tokens = selector.split(' ');\n    var token, bits, tagName, found, foundCount, i, j, k, elements, currentContextIndex;\n    var currentContext = [document$1];\n\n    for (i = 0; i < tokens.length; i++) {\n      token = tokens[i].replace(/^\\s+/, '').replace(/\\s+$/, '');\n\n      if (token.indexOf('#') > -1) {\n        // Token is an ID selector\n        bits = token.split('#');\n        tagName = bits[0];\n        var id = bits[1];\n        var element = document$1.getElementById(id);\n\n        if (!element || tagName && element.nodeName.toLowerCase() != tagName) {\n          // element not found or tag with that ID not found, return false\n          return [];\n        } // Set currentContext to contain just this element\n\n\n        currentContext = [element];\n        continue; // Skip to next token\n      }\n\n      if (token.indexOf('.') > -1) {\n        // Token contains a class selector\n        bits = token.split('.');\n        tagName = bits[0];\n        var className = bits[1];\n\n        if (!tagName) {\n          tagName = '*';\n        } // Get elements matching tag, filter them for class selector\n\n\n        found = [];\n        foundCount = 0;\n\n        for (j = 0; j < currentContext.length; j++) {\n          if (tagName == '*') {\n            elements = getAllChildren(currentContext[j]);\n          } else {\n            elements = currentContext[j].getElementsByTagName(tagName);\n          }\n\n          for (k = 0; k < elements.length; k++) {\n            found[foundCount++] = elements[k];\n          }\n        }\n\n        currentContext = [];\n        currentContextIndex = 0;\n\n        for (j = 0; j < found.length; j++) {\n          if (found[j].className && _.isString(found[j].className) && // some SVG elements have classNames which are not strings\n          hasClass(found[j], className)) {\n            currentContext[currentContextIndex++] = found[j];\n          }\n        }\n\n        continue; // Skip to next token\n      } // Code to deal with attribute selectors\n\n\n      var token_match = token.match(TOKEN_MATCH_REGEX);\n\n      if (token_match) {\n        tagName = token_match[1];\n        var attrName = token_match[2];\n        var attrOperator = token_match[3];\n        var attrValue = token_match[4];\n\n        if (!tagName) {\n          tagName = '*';\n        } // Grab all of the tagName elements within current context\n\n\n        found = [];\n        foundCount = 0;\n\n        for (j = 0; j < currentContext.length; j++) {\n          if (tagName == '*') {\n            elements = getAllChildren(currentContext[j]);\n          } else {\n            elements = currentContext[j].getElementsByTagName(tagName);\n          }\n\n          for (k = 0; k < elements.length; k++) {\n            found[foundCount++] = elements[k];\n          }\n        }\n\n        currentContext = [];\n        currentContextIndex = 0;\n        var checkFunction; // This function will be used to filter the elements\n\n        switch (attrOperator) {\n          case '=':\n            // Equality\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName) == attrValue;\n            };\n\n            break;\n\n          case '~':\n            // Match one of space seperated words\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName).match(new RegExp('\\\\b' + attrValue + '\\\\b'));\n            };\n\n            break;\n\n          case '|':\n            // Match start with value followed by optional hyphen\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName).match(new RegExp('^' + attrValue + '-?'));\n            };\n\n            break;\n\n          case '^':\n            // Match starts with value\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName).indexOf(attrValue) === 0;\n            };\n\n            break;\n\n          case '$':\n            // Match ends with value - fails with \"Warning\" in Opera 7\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName).lastIndexOf(attrValue) == e.getAttribute(attrName).length - attrValue.length;\n            };\n\n            break;\n\n          case '*':\n            // Match ends with value\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName).indexOf(attrValue) > -1;\n            };\n\n            break;\n\n          default:\n            // Just test for existence of attribute\n            checkFunction = function checkFunction(e) {\n              return e.getAttribute(attrName);\n            };\n\n        }\n\n        currentContext = [];\n        currentContextIndex = 0;\n\n        for (j = 0; j < found.length; j++) {\n          if (checkFunction(found[j])) {\n            currentContext[currentContextIndex++] = found[j];\n          }\n        } // alert('Attribute Selector: '+tagName+' '+attrName+' '+attrOperator+' '+attrValue);\n\n\n        continue; // Skip to next token\n      } // If we get here, token is JUST an element (not a class or ID selector)\n\n\n      tagName = token;\n      found = [];\n      foundCount = 0;\n\n      for (j = 0; j < currentContext.length; j++) {\n        elements = currentContext[j].getElementsByTagName(tagName);\n\n        for (k = 0; k < elements.length; k++) {\n          found[foundCount++] = elements[k];\n        }\n      }\n\n      currentContext = found;\n    }\n\n    return currentContext;\n  }\n\n  return function (query) {\n    if (_.isElement(query)) {\n      return [query];\n    } else if (_.isObject(query) && !_.isUndefined(query.length)) {\n      return query;\n    } else {\n      return getElementsBySelector.call(this, query);\n    }\n  };\n}();\n\n_.info = {\n  campaignParams: function campaignParams() {\n    var campaign_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term'.split(' '),\n        kw = '',\n        params = {};\n\n    _.each(campaign_keywords, function (kwkey) {\n      kw = _.getQueryParam(document$1.URL, kwkey);\n\n      if (kw.length) {\n        params[kwkey] = kw;\n      }\n    });\n\n    return params;\n  },\n  searchEngine: function searchEngine(referrer) {\n    if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n      return 'google';\n    } else if (referrer.search('https?://(.*)bing.com') === 0) {\n      return 'bing';\n    } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n      return 'yahoo';\n    } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n      return 'duckduckgo';\n    } else {\n      return null;\n    }\n  },\n  searchInfo: function searchInfo(referrer) {\n    var search = _.info.searchEngine(referrer),\n        param = search != 'yahoo' ? 'q' : 'p',\n        ret = {};\n\n    if (search !== null) {\n      ret['$search_engine'] = search;\n\n      var keyword = _.getQueryParam(referrer, param);\n\n      if (keyword.length) {\n        ret['mp_keyword'] = keyword;\n      }\n    }\n\n    return ret;\n  },\n\n  /**\n   * This function detects which browser is running this script.\n   * The order of the checks are important since many user agents\n   * include key words used in later checks.\n   */\n  browser: function browser(user_agent, vendor, opera) {\n    vendor = vendor || ''; // vendor is undefined for at least IE9\n\n    if (opera || _.includes(user_agent, ' OPR/')) {\n      if (_.includes(user_agent, 'Mini')) {\n        return 'Opera Mini';\n      }\n\n      return 'Opera';\n    } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n      return 'BlackBerry';\n    } else if (_.includes(user_agent, 'IEMobile') || _.includes(user_agent, 'WPDesktop')) {\n      return 'Internet Explorer Mobile';\n    } else if (_.includes(user_agent, 'Edge')) {\n      return 'Microsoft Edge';\n    } else if (_.includes(user_agent, 'FBIOS')) {\n      return 'Facebook Mobile';\n    } else if (_.includes(user_agent, 'Chrome')) {\n      return 'Chrome';\n    } else if (_.includes(user_agent, 'CriOS')) {\n      return 'Chrome iOS';\n    } else if (_.includes(user_agent, 'UCWEB') || _.includes(user_agent, 'UCBrowser')) {\n      return 'UC Browser';\n    } else if (_.includes(user_agent, 'FxiOS')) {\n      return 'Firefox iOS';\n    } else if (_.includes(vendor, 'Apple')) {\n      if (_.includes(user_agent, 'Mobile')) {\n        return 'Mobile Safari';\n      }\n\n      return 'Safari';\n    } else if (_.includes(user_agent, 'Android')) {\n      return 'Android Mobile';\n    } else if (_.includes(user_agent, 'Konqueror')) {\n      return 'Konqueror';\n    } else if (_.includes(user_agent, 'Firefox')) {\n      return 'Firefox';\n    } else if (_.includes(user_agent, 'MSIE') || _.includes(user_agent, 'Trident/')) {\n      return 'Internet Explorer';\n    } else if (_.includes(user_agent, 'Gecko')) {\n      return 'Mozilla';\n    } else {\n      return '';\n    }\n  },\n\n  /**\n   * This function detects which browser version is running this script,\n   * parsing major and minor version (e.g., 42.1). User agent strings from:\n   * http://www.useragentstring.com/pages/useragentstring.php\n   */\n  browserVersion: function browserVersion(userAgent, vendor, opera) {\n    var browser = _.info.browser(userAgent, vendor, opera);\n\n    var versionRegexs = {\n      'Internet Explorer Mobile': /rv:(\\d+(\\.\\d+)?)/,\n      'Microsoft Edge': /Edge\\/(\\d+(\\.\\d+)?)/,\n      'Chrome': /Chrome\\/(\\d+(\\.\\d+)?)/,\n      'Chrome iOS': /CriOS\\/(\\d+(\\.\\d+)?)/,\n      'UC Browser': /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n      'Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n      'Mobile Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n      'Opera': /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n      'Firefox': /Firefox\\/(\\d+(\\.\\d+)?)/,\n      'Firefox iOS': /FxiOS\\/(\\d+(\\.\\d+)?)/,\n      'Konqueror': /Konqueror:(\\d+(\\.\\d+)?)/,\n      'BlackBerry': /BlackBerry (\\d+(\\.\\d+)?)/,\n      'Android Mobile': /android\\s(\\d+(\\.\\d+)?)/,\n      'Internet Explorer': /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n      'Mozilla': /rv:(\\d+(\\.\\d+)?)/\n    };\n    var regex = versionRegexs[browser];\n\n    if (regex === undefined) {\n      return null;\n    }\n\n    var matches = userAgent.match(regex);\n\n    if (!matches) {\n      return null;\n    }\n\n    return parseFloat(matches[matches.length - 2]);\n  },\n  os: function os() {\n    var a = userAgent;\n\n    if (/Windows/i.test(a)) {\n      if (/Phone/.test(a) || /WPDesktop/.test(a)) {\n        return 'Windows Phone';\n      }\n\n      return 'Windows';\n    } else if (/(iPhone|iPad|iPod)/.test(a)) {\n      return 'iOS';\n    } else if (/Android/.test(a)) {\n      return 'Android';\n    } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n      return 'BlackBerry';\n    } else if (/Mac/i.test(a)) {\n      return 'Mac OS X';\n    } else if (/Linux/.test(a)) {\n      return 'Linux';\n    } else if (/CrOS/.test(a)) {\n      return 'Chrome OS';\n    } else {\n      return '';\n    }\n  },\n  device: function device(user_agent) {\n    if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n      return 'Windows Phone';\n    } else if (/iPad/.test(user_agent)) {\n      return 'iPad';\n    } else if (/iPod/.test(user_agent)) {\n      return 'iPod Touch';\n    } else if (/iPhone/.test(user_agent)) {\n      return 'iPhone';\n    } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n      return 'BlackBerry';\n    } else if (/Android/.test(user_agent)) {\n      return 'Android';\n    } else {\n      return '';\n    }\n  },\n  referringDomain: function referringDomain(referrer) {\n    var split = referrer.split('/');\n\n    if (split.length >= 3) {\n      return split[2];\n    }\n\n    return '';\n  },\n  properties: function properties() {\n    return _.extend(_.strip_empty_properties({\n      '$os': _.info.os(),\n      '$browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera),\n      '$referrer': document$1.referrer,\n      '$referring_domain': _.info.referringDomain(document$1.referrer),\n      '$device': _.info.device(userAgent)\n    }), {\n      '$current_url': window$1.location.href,\n      '$browser_version': _.info.browserVersion(userAgent, navigator$1.vendor, windowOpera),\n      '$screen_height': screen.height,\n      '$screen_width': screen.width,\n      'mp_lib': 'web',\n      '$lib_version': Config.LIB_VERSION,\n      '$insert_id': Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n      'time': _.timestamp() / 1000 // epoch time in seconds\n\n    });\n  },\n  people_properties: function people_properties() {\n    return _.extend(_.strip_empty_properties({\n      '$os': _.info.os(),\n      '$browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera)\n    }), {\n      '$browser_version': _.info.browserVersion(userAgent, navigator$1.vendor, windowOpera)\n    });\n  },\n  pageviewInfo: function pageviewInfo(page) {\n    return _.strip_empty_properties({\n      'mp_page': page,\n      'mp_referrer': document$1.referrer,\n      'mp_browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera),\n      'mp_platform': _.info.os()\n    });\n  }\n}; // EXPORTS (for closure compiler)\n\n_['toArray'] = _.toArray;\n_['isObject'] = _.isObject;\n_['JSONEncode'] = _.JSONEncode;\n_['JSONDecode'] = _.JSONDecode;\n_['isBlockedUA'] = _.isBlockedUA;\n_['isEmptyObject'] = _.isEmptyObject;\n_['info'] = _.info;\n_['info']['device'] = _.info.device;\n_['info']['browser'] = _.info.browser;\n_['info']['properties'] = _.info.properties;\n/*\n * Get the className of an element, accounting for edge cases where element.className is an object\n * @param {Element} el - element to get the className of\n * @returns {string} the element's class\n */\n\nfunction getClassName(el) {\n  switch (typeof el.className) {\n    case 'string':\n      return el.className;\n\n    case 'object':\n      // handle cases where className might be SVGAnimatedString or some other type\n      return el.className.baseVal || el.getAttribute('class') || '';\n\n    default:\n      // future proof\n      return '';\n  }\n}\n/*\n * Get the direct text content of an element, protecting against sensitive data collection.\n * Concats textContent of each of the element's text node children; this avoids potential\n * collection of sensitive data that could happen if we used element.textContent and the\n * element had sensitive child elements, since element.textContent includes child content.\n * Scrubs values that look like they could be sensitive (i.e. cc or ssn number).\n * @param {Element} el - element to get the text of\n * @returns {string} the element's direct text content\n */\n\n\nfunction getSafeText(el) {\n  var elText = '';\n\n  if (shouldTrackElement(el) && el.childNodes && el.childNodes.length) {\n    _.each(el.childNodes, function (child) {\n      if (isTextNode(child) && child.textContent) {\n        elText += _.trim(child.textContent) // scrub potentially sensitive values\n        .split(/(\\s+)/).filter(shouldTrackValue).join('') // normalize whitespace\n        .replace(/[\\r\\n]/g, ' ').replace(/[ ]+/g, ' ') // truncate\n        .substring(0, 255);\n      }\n    });\n  }\n\n  return _.trim(elText);\n}\n/*\n * Check whether an element has nodeType Node.ELEMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\n\n\nfunction isElementNode(el) {\n  return el && el.nodeType === 1; // Node.ELEMENT_NODE - use integer constant for browser portability\n}\n/*\n * Check whether an element is of a given tag type.\n * Due to potential reference discrepancies (such as the webcomponents.js polyfill),\n * we want to match tagNames instead of specific references because something like\n * element === document.body won't always work because element might not be a native\n * element.\n * @param {Element} el - element to check\n * @param {string} tag - tag name (e.g., \"div\")\n * @returns {boolean} whether el is of the given tag type\n */\n\n\nfunction isTag(el, tag) {\n  return el && el.tagName && el.tagName.toLowerCase() === tag.toLowerCase();\n}\n/*\n * Check whether an element has nodeType Node.TEXT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\n\n\nfunction isTextNode(el) {\n  return el && el.nodeType === 3; // Node.TEXT_NODE - use integer constant for browser portability\n}\n/*\n * Check whether a DOM event should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @param {Event} event - event to check\n * @returns {boolean} whether the event should be tracked\n */\n\n\nfunction shouldTrackDomEvent(el, event) {\n  if (!el || isTag(el, 'html') || !isElementNode(el)) {\n    return false;\n  }\n\n  var tag = el.tagName.toLowerCase();\n\n  switch (tag) {\n    case 'html':\n      return false;\n\n    case 'form':\n      return event.type === 'submit';\n\n    case 'input':\n      if (['button', 'submit'].indexOf(el.getAttribute('type')) === -1) {\n        return event.type === 'change';\n      } else {\n        return event.type === 'click';\n      }\n\n    case 'select':\n    case 'textarea':\n      return event.type === 'change';\n\n    default:\n      return event.type === 'click';\n  }\n}\n/*\n * Check whether a DOM element should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be tracked\n */\n\n\nfunction shouldTrackElement(el) {\n  for (var curEl = el; curEl.parentNode && !isTag(curEl, 'body'); curEl = curEl.parentNode) {\n    var classes = getClassName(curEl).split(' ');\n\n    if (_.includes(classes, 'mp-sensitive') || _.includes(classes, 'mp-no-track')) {\n      return false;\n    }\n  }\n\n  if (_.includes(getClassName(el).split(' '), 'mp-include')) {\n    return true;\n  } // don't send data from inputs or similar elements since there will always be\n  // a risk of clientside javascript placing sensitive data in attributes\n\n\n  if (isTag(el, 'input') || isTag(el, 'select') || isTag(el, 'textarea') || el.getAttribute('contenteditable') === 'true') {\n    return false;\n  } // don't include hidden or password fields\n\n\n  var type = el.type || '';\n\n  if (typeof type === 'string') {\n    // it's possible for el.type to be a DOM element if el is a form with a child input[name=\"type\"]\n    switch (type.toLowerCase()) {\n      case 'hidden':\n        return false;\n\n      case 'password':\n        return false;\n    }\n  } // filter out data from fields that look like sensitive fields\n\n\n  var name = el.name || el.id || '';\n\n  if (typeof name === 'string') {\n    // it's possible for el.name or el.id to be a DOM element if el is a form with a child input[name=\"name\"]\n    var sensitiveNameRegex = /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i;\n\n    if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ''))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n/*\n * Check whether a string value should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {string} value - string value to check\n * @returns {boolean} whether the element should be tracked\n */\n\n\nfunction shouldTrackValue(value) {\n  if (value === null || _.isUndefined(value)) {\n    return false;\n  }\n\n  if (typeof value === 'string') {\n    value = _.trim(value); // check to see if input value looks like a credit card number\n    // see: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s20.html\n\n    var ccRegex = /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/;\n\n    if (ccRegex.test((value || '').replace(/[- ]/g, ''))) {\n      return false;\n    } // check to see if input value looks like a social security number\n\n\n    var ssnRegex = /(^\\d{3}-?\\d{2}-?\\d{4}$)/;\n\n    if (ssnRegex.test(value)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nvar autotrack = {\n  _initializedTokens: [],\n  _previousElementSibling: function _previousElementSibling(el) {\n    if (el.previousElementSibling) {\n      return el.previousElementSibling;\n    } else {\n      do {\n        el = el.previousSibling;\n      } while (el && !isElementNode(el));\n\n      return el;\n    }\n  },\n  _loadScript: function _loadScript(scriptUrlToLoad, callback) {\n    var scriptTag = document.createElement('script');\n    scriptTag.type = 'text/javascript';\n    scriptTag.src = scriptUrlToLoad;\n    scriptTag.onload = callback;\n    var scripts = document.getElementsByTagName('script');\n\n    if (scripts.length > 0) {\n      scripts[0].parentNode.insertBefore(scriptTag, scripts[0]);\n    } else {\n      document.body.appendChild(scriptTag);\n    }\n  },\n  _getPropertiesFromElement: function _getPropertiesFromElement(elem) {\n    var props = {\n      'classes': getClassName(elem).split(' '),\n      'tag_name': elem.tagName.toLowerCase()\n    };\n\n    if (shouldTrackElement(elem)) {\n      _.each(elem.attributes, function (attr) {\n        if (shouldTrackValue(attr.value)) {\n          props['attr__' + attr.name] = attr.value;\n        }\n      });\n    }\n\n    var nthChild = 1;\n    var nthOfType = 1;\n    var currentElem = elem;\n\n    while (currentElem = this._previousElementSibling(currentElem)) {\n      // eslint-disable-line no-cond-assign\n      nthChild++;\n\n      if (currentElem.tagName === elem.tagName) {\n        nthOfType++;\n      }\n    }\n\n    props['nth_child'] = nthChild;\n    props['nth_of_type'] = nthOfType;\n    return props;\n  },\n  _getDefaultProperties: function _getDefaultProperties(eventType) {\n    return {\n      '$event_type': eventType,\n      '$ce_version': 1,\n      '$host': window.location.host,\n      '$pathname': window.location.pathname\n    };\n  },\n  _extractCustomPropertyValue: function _extractCustomPropertyValue(customProperty) {\n    var propValues = [];\n\n    _.each(document.querySelectorAll(customProperty['css_selector']), function (matchedElem) {\n      var value;\n\n      if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n        value = matchedElem['value'];\n      } else if (matchedElem['textContent']) {\n        value = matchedElem['textContent'];\n      }\n\n      if (shouldTrackValue(value)) {\n        propValues.push(value);\n      }\n    });\n\n    return propValues.join(', ');\n  },\n  _getCustomProperties: function _getCustomProperties(targetElementList) {\n    var props = {};\n\n    _.each(this._customProperties, function (customProperty) {\n      _.each(customProperty['event_selectors'], function (eventSelector) {\n        var eventElements = document.querySelectorAll(eventSelector);\n\n        _.each(eventElements, function (eventElement) {\n          if (_.includes(targetElementList, eventElement) && shouldTrackElement(eventElement)) {\n            props[customProperty['name']] = this._extractCustomPropertyValue(customProperty);\n          }\n        }, this);\n      }, this);\n    }, this);\n\n    return props;\n  },\n  _getEventTarget: function _getEventTarget(e) {\n    // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n    if (typeof e.target === 'undefined') {\n      return e.srcElement;\n    } else {\n      return e.target;\n    }\n  },\n  _trackEvent: function _trackEvent(e, instance) {\n    /*** Don't mess with this code without running IE8 tests on it ***/\n    var target = this._getEventTarget(e);\n\n    if (isTextNode(target)) {\n      // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n      target = target.parentNode;\n    }\n\n    if (shouldTrackDomEvent(target, e)) {\n      var targetElementList = [target];\n      var curEl = target;\n\n      while (curEl.parentNode && !isTag(curEl, 'body')) {\n        targetElementList.push(curEl.parentNode);\n        curEl = curEl.parentNode;\n      }\n\n      var elementsJson = [];\n      var href,\n          explicitNoTrack = false;\n\n      _.each(targetElementList, function (el) {\n        var shouldTrackEl = shouldTrackElement(el); // if the element or a parent element is an anchor tag\n        // include the href as a property\n\n        if (el.tagName.toLowerCase() === 'a') {\n          href = el.getAttribute('href');\n          href = shouldTrackEl && shouldTrackValue(href) && href;\n        } // allow users to programatically prevent tracking of elements by adding class 'mp-no-track'\n\n\n        var classes = getClassName(el).split(' ');\n\n        if (_.includes(classes, 'mp-no-track')) {\n          explicitNoTrack = true;\n        }\n\n        elementsJson.push(this._getPropertiesFromElement(el));\n      }, this);\n\n      if (explicitNoTrack) {\n        return false;\n      } // only populate text content from target element (not parents)\n      // to prevent text within a sensitive element from being collected\n      // as part of a parent's el.textContent\n\n\n      var elementText;\n      var safeElementText = getSafeText(target);\n\n      if (safeElementText && safeElementText.length) {\n        elementText = safeElementText;\n      }\n\n      var props = _.extend(this._getDefaultProperties(e.type), {\n        '$elements': elementsJson,\n        '$el_attr__href': href,\n        '$el_text': elementText\n      }, this._getCustomProperties(targetElementList));\n\n      instance.track('$web_event', props);\n      return true;\n    }\n  },\n  // only reason is to stub for unit tests\n  // since you can't override window.location props\n  _navigate: function _navigate(href) {\n    window.location.href = href;\n  },\n  _addDomEventHandlers: function _addDomEventHandlers(instance) {\n    var handler = _.bind(function (e) {\n      e = e || window.event;\n\n      this._trackEvent(e, instance);\n    }, this);\n\n    _.register_event(document, 'submit', handler, false, true);\n\n    _.register_event(document, 'change', handler, false, true);\n\n    _.register_event(document, 'click', handler, false, true);\n  },\n  _customProperties: {},\n  init: function init(instance) {\n    if (!(document && document.body)) {\n      console.log('document not ready yet, trying again in 500 milliseconds...');\n      var that = this;\n      setTimeout(function () {\n        that.init(instance);\n      }, 500);\n      return;\n    }\n\n    var token = instance.get_config('token');\n\n    if (this._initializedTokens.indexOf(token) > -1) {\n      console.log('autotrack already initialized for token \"' + token + '\"');\n      return;\n    }\n\n    this._initializedTokens.push(token);\n\n    if (!this._maybeLoadEditor(instance)) {\n      // don't autotrack actions when the editor is enabled\n      var parseDecideResponse = _.bind(function (response) {\n        if (response && response['config'] && response['config']['enable_collect_everything'] === true) {\n          if (response['custom_properties']) {\n            this._customProperties = response['custom_properties'];\n          }\n\n          instance.track('$web_event', _.extend({\n            '$title': document.title\n          }, this._getDefaultProperties('pageview')));\n\n          this._addDomEventHandlers(instance);\n        } else {\n          instance['__autotrack_enabled'] = false;\n        }\n      }, this);\n\n      instance._send_request(instance.get_config('api_host') + '/decide/', {\n        'verbose': true,\n        'version': '1',\n        'lib': 'web',\n        'token': token\n      }, {\n        method: 'GET'\n      }, instance._prepare_callback(parseDecideResponse));\n    }\n  },\n  _editorParamsFromHash: function _editorParamsFromHash(instance, hash) {\n    var editorParams;\n\n    try {\n      var state = _.getHashParam(hash, 'state');\n\n      state = JSON.parse(decodeURIComponent(state));\n\n      var expiresInSeconds = _.getHashParam(hash, 'expires_in');\n\n      editorParams = {\n        'accessToken': _.getHashParam(hash, 'access_token'),\n        'accessTokenExpiresAt': new Date().getTime() + Number(expiresInSeconds) * 1000,\n        'bookmarkletMode': !!state['bookmarkletMode'],\n        'projectId': state['projectId'],\n        'projectOwnerId': state['projectOwnerId'],\n        'projectToken': state['token'],\n        'readOnly': state['readOnly'],\n        'userFlags': state['userFlags'],\n        'userId': state['userId']\n      };\n      window.sessionStorage.setItem('editorParams', JSON.stringify(editorParams));\n\n      if (state['desiredHash']) {\n        window.location.hash = state['desiredHash'];\n      } else if (window.history) {\n        history.replaceState('', document.title, window.location.pathname + window.location.search); // completely remove hash\n      } else {\n        window.location.hash = ''; // clear hash (but leaves # unfortunately)\n      }\n    } catch (e) {\n      console.error('Unable to parse data from hash', e);\n    }\n\n    return editorParams;\n  },\n\n  /**\n   * To load the visual editor, we need an access token and other state. That state comes from one of three places:\n   * 1. In the URL hash params if the customer is using an old snippet\n   * 2. From session storage under the key `_mpcehash` if the snippet already parsed the hash\n   * 3. From session storage under the key `editorParams` if the editor was initialized on a previous page\n   */\n  _maybeLoadEditor: function _maybeLoadEditor(instance) {\n    try {\n      var parseFromUrl = false;\n\n      if (_.getHashParam(window.location.hash, 'state')) {\n        var state = _.getHashParam(window.location.hash, 'state');\n\n        state = JSON.parse(decodeURIComponent(state));\n        parseFromUrl = state['action'] === 'mpeditor';\n      }\n\n      var parseFromStorage = !!window.sessionStorage.getItem('_mpcehash');\n      var editorParams;\n\n      if (parseFromUrl) {\n        // happens if they are initializing the editor using an old snippet\n        editorParams = this._editorParamsFromHash(instance, window.location.hash);\n      } else if (parseFromStorage) {\n        // happens if they are initialized the editor and using the new snippet\n        editorParams = this._editorParamsFromHash(instance, window.sessionStorage.getItem('_mpcehash'));\n        window.sessionStorage.removeItem('_mpcehash');\n      } else {\n        // get credentials from sessionStorage from a previous initialzation\n        editorParams = JSON.parse(window.sessionStorage.getItem('editorParams') || '{}');\n      }\n\n      if (editorParams['projectToken'] && instance.get_config('token') === editorParams['projectToken']) {\n        this._loadEditor(instance, editorParams);\n\n        return true;\n      } else {\n        return false;\n      }\n    } catch (e) {\n      return false;\n    }\n  },\n  _loadEditor: function _loadEditor(instance, editorParams) {\n    if (!window['_mpEditorLoaded']) {\n      // only load the codeless event editor once, even if there are multiple instances of MixpanelLib\n      window['_mpEditorLoaded'] = true;\n      var editorUrl = instance.get_config('app_host') + '/js-bundle/reports/collect-everything/editor.js?_ts=' + new Date().getTime();\n\n      this._loadScript(editorUrl, function () {\n        window['mp_load_editor'](editorParams);\n      });\n\n      return true;\n    }\n\n    return false;\n  },\n  // this is a mechanism to ramp up CE with no server-side interaction.\n  // when CE is active, every page load results in a decide request. we\n  // need to gently ramp this up so we don't overload decide. this decides\n  // deterministically if CE is enabled for this project by modding the char\n  // value of the project token.\n  enabledForProject: function enabledForProject(token, numBuckets, numEnabledBuckets) {\n    numBuckets = !_.isUndefined(numBuckets) ? numBuckets : 10;\n    numEnabledBuckets = !_.isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10;\n    var charCodeSum = 0;\n\n    for (var i = 0; i < token.length; i++) {\n      charCodeSum += token.charCodeAt(i);\n    }\n\n    return charCodeSum % numBuckets < numEnabledBuckets;\n  },\n  isBrowserSupported: function isBrowserSupported() {\n    return _.isFunction(document.querySelectorAll);\n  }\n};\n\n_.bind_instance_methods(autotrack);\n\n_.safewrap_instance_methods(autotrack);\n/**\n * DomTracker Object\n * @constructor\n */\n\n\nvar DomTracker = function DomTracker() {}; // interface\n\n\nDomTracker.prototype.create_properties = function () {};\n\nDomTracker.prototype.event_handler = function () {};\n\nDomTracker.prototype.after_track_handler = function () {};\n\nDomTracker.prototype.init = function (mixpanel_instance) {\n  this.mp = mixpanel_instance;\n  return this;\n};\n/**\n * @param {Object|string} query\n * @param {string} event_name\n * @param {Object=} properties\n * @param {function=} user_callback\n */\n\n\nDomTracker.prototype.track = function (query, event_name, properties, user_callback) {\n  var that = this;\n\n  var elements = _.dom_query(query);\n\n  if (elements.length === 0) {\n    console$1.error('The DOM query (' + query + ') returned 0 elements');\n    return;\n  }\n\n  _.each(elements, function (element) {\n    _.register_event(element, this.override_event, function (e) {\n      var options = {};\n      var props = that.create_properties(properties, this);\n      var timeout = that.mp.get_config('track_links_timeout');\n      that.event_handler(e, this, options); // in case the mixpanel servers don't get back to us in time\n\n      window.setTimeout(that.track_callback(user_callback, props, options, true), timeout); // fire the tracking event\n\n      that.mp.track(event_name, props, that.track_callback(user_callback, props, options));\n    });\n  }, this);\n\n  return true;\n};\n/**\n * @param {function} user_callback\n * @param {Object} props\n * @param {boolean=} timeout_occured\n */\n\n\nDomTracker.prototype.track_callback = function (user_callback, props, options, timeout_occured) {\n  timeout_occured = timeout_occured || false;\n  var that = this;\n  return function () {\n    // options is referenced from both callbacks, so we can have\n    // a 'lock' of sorts to ensure only one fires\n    if (options.callback_fired) {\n      return;\n    }\n\n    options.callback_fired = true;\n\n    if (user_callback && user_callback(timeout_occured, props) === false) {\n      // user can prevent the default functionality by\n      // returning false from their callback\n      return;\n    }\n\n    that.after_track_handler(props, options, timeout_occured);\n  };\n};\n\nDomTracker.prototype.create_properties = function (properties, element) {\n  var props;\n\n  if (typeof properties === 'function') {\n    props = properties(element);\n  } else {\n    props = _.extend({}, properties);\n  }\n\n  return props;\n};\n/**\n * LinkTracker Object\n * @constructor\n * @extends DomTracker\n */\n\n\nvar LinkTracker = function LinkTracker() {\n  this.override_event = 'click';\n};\n\n_.inherit(LinkTracker, DomTracker);\n\nLinkTracker.prototype.create_properties = function (properties, element) {\n  var props = LinkTracker.superclass.create_properties.apply(this, arguments);\n\n  if (element.href) {\n    props['url'] = element.href;\n  }\n\n  return props;\n};\n\nLinkTracker.prototype.event_handler = function (evt, element, options) {\n  options.new_tab = evt.which === 2 || evt.metaKey || evt.ctrlKey || element.target === '_blank';\n  options.href = element.href;\n\n  if (!options.new_tab) {\n    evt.preventDefault();\n  }\n};\n\nLinkTracker.prototype.after_track_handler = function (props, options) {\n  if (options.new_tab) {\n    return;\n  }\n\n  setTimeout(function () {\n    window.location = options.href;\n  }, 0);\n};\n/**\n * FormTracker Object\n * @constructor\n * @extends DomTracker\n */\n\n\nvar FormTracker = function FormTracker() {\n  this.override_event = 'submit';\n};\n\n_.inherit(FormTracker, DomTracker);\n\nFormTracker.prototype.event_handler = function (evt, element, options) {\n  options.element = element;\n  evt.preventDefault();\n};\n\nFormTracker.prototype.after_track_handler = function (props, options) {\n  setTimeout(function () {\n    options.element.submit();\n  }, 0);\n};\n/**\n * A function used to track a Mixpanel event (e.g. MixpanelLib.track)\n * @callback trackFunction\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after tracking the event.\n */\n\n/** Public **/\n\n\nvar GDPR_DEFAULT_PERSISTENCE_PREFIX = '__mp_opt_in_out_';\n/**\n * Opt the user in to data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {trackFunction} [options.track] - function used for tracking a Mixpanel event to record the opt-in action\n * @param {string} [options.trackEventName] - event name to be used for tracking the opt-in action\n * @param {Object} [options.trackProperties] - set of properties to be tracked along with the opt-in action\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\n\nfunction optIn(token, options) {\n  _optInOut(true, token, options);\n}\n/**\n * Opt the user out of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-out cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-out cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-out cookie is set as secure or not\n */\n\n\nfunction optOut(token, options) {\n  _optInOut(false, token, options);\n}\n/**\n * Check whether the user has opted in to data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted in to the given opt type\n */\n\n\nfunction hasOptedIn(token, options) {\n  return _getStorageValue(token, options) === '1';\n}\n/**\n * Check whether the user has opted out of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted out of the given opt type\n */\n\n\nfunction hasOptedOut(token, options) {\n  if (_hasDoNotTrackFlagOn(options)) {\n    return true;\n  }\n\n  return _getStorageValue(token, options) === '0';\n}\n/**\n * Wrap a MixpanelLib method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\n\n\nfunction addOptOutCheckMixpanelLib(method) {\n  return _addOptOutCheck(method, function (name) {\n    return this.get_config(name);\n  });\n}\n/**\n * Wrap a MixpanelPeople method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\n\n\nfunction addOptOutCheckMixpanelPeople(method) {\n  return _addOptOutCheck(method, function (name) {\n    return this._get_config(name);\n  });\n}\n/**\n * Wrap a MixpanelGroup method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\n\n\nfunction addOptOutCheckMixpanelGroup(method) {\n  return _addOptOutCheck(method, function (name) {\n    return this._get_config(name);\n  });\n}\n/**\n * Clear the user's opt in/out status of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\n\n\nfunction clearOptInOut(token, options) {\n  options = options || {};\n\n  _getStorage(options).remove(_getStorageKey(token, options), !!options.crossSubdomainCookie);\n}\n/** Private **/\n\n/**\n * Get storage util\n * @param {Object} [options]\n * @param {string} [options.persistenceType]\n * @returns {object} either _.cookie or _.localstorage\n */\n\n\nfunction _getStorage(options) {\n  options = options || {};\n  return options.persistenceType === 'localStorage' ? _.localStorage : _.cookie;\n}\n/**\n * Get the name of the cookie that is used for the given opt type (tracking, cookie, etc.)\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the name of the cookie for the given opt type\n */\n\n\nfunction _getStorageKey(token, options) {\n  options = options || {};\n  return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token;\n}\n/**\n * Get the value of the cookie that is used for the given opt type (tracking, cookie, etc.)\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the value of the cookie for the given opt type\n */\n\n\nfunction _getStorageValue(token, options) {\n  return _getStorage(options).get(_getStorageKey(token, options));\n}\n/**\n * Check whether the user has set the DNT/doNotTrack setting to true in their browser\n * @param {Object} [options]\n * @param {string} [options.window] - alternate window object to check; used to force various DNT settings in browser tests\n * @returns {boolean} whether the DNT setting is true\n */\n\n\nfunction _hasDoNotTrackFlagOn(options) {\n  var win = options && options.window || window$1;\n  var nav = win['navigator'] || {};\n  var hasDntOn = false;\n\n  _.each([nav['doNotTrack'], // standard\n  nav['msDoNotTrack'], win['doNotTrack']], function (dntValue) {\n    if (_.includes([true, 1, '1', 'yes'], dntValue)) {\n      hasDntOn = true;\n    }\n  });\n\n  return hasDntOn;\n}\n/**\n * Set cookie/localstorage for the user indicating that they are opted in or out for the given opt type\n * @param {boolean} optValue - whether to opt the user in or out for the given opt type\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {trackFunction} [options.track] - function used for tracking a Mixpanel event to record the opt-in action\n * @param {string} [options.trackEventName] - event name to be used for tracking the opt-in action\n * @param {Object} [options.trackProperties] - set of properties to be tracked along with the opt-in action\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\n\n\nfunction _optInOut(optValue, token, options) {\n  if (!_.isString(token) || !token.length) {\n    console.error('gdpr.' + (optValue ? 'optIn' : 'optOut') + ' called with an invalid token');\n    return;\n  }\n\n  options = options || {};\n\n  _getStorage(options).set(_getStorageKey(token, options), optValue ? 1 : 0, _.isNumber(options.cookieExpiration) ? options.cookieExpiration : null, !!options.crossSubdomainCookie, !!options.secureCookie);\n\n  if (options.track && optValue) {\n    // only track event if opting in (optValue=true)\n    options.track(options.trackEventName || '$opt_in', options.trackProperties);\n  }\n}\n/**\n * Wrap a method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @param {function} getConfigValue - getter function for the Mixpanel API token and other options to be used with opt-out check\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\n\n\nfunction _addOptOutCheck(method, getConfigValue) {\n  return function () {\n    var optedOut = false;\n\n    try {\n      var token = getConfigValue.call(this, 'token');\n      var persistenceType = getConfigValue.call(this, 'opt_out_tracking_persistence_type');\n      var persistencePrefix = getConfigValue.call(this, 'opt_out_tracking_cookie_prefix');\n      var win = getConfigValue.call(this, 'window'); // used to override window during browser tests\n\n      if (token) {\n        // if there was an issue getting the token, continue method execution as normal\n        optedOut = hasOptedOut(token, {\n          persistenceType: persistenceType,\n          persistencePrefix: persistencePrefix,\n          window: win\n        });\n      }\n    } catch (err) {\n      console.error('Unexpected error when checking tracking opt-out status: ' + err);\n    }\n\n    if (!optedOut) {\n      return method.apply(this, arguments);\n    }\n\n    var callback = arguments[arguments.length - 1];\n\n    if (typeof callback === 'function') {\n      callback(0);\n    }\n\n    return;\n  };\n}\n/** @const */\n\n\nvar SET_ACTION = '$set';\n/** @const */\n\nvar SET_ONCE_ACTION = '$set_once';\n/** @const */\n\nvar UNSET_ACTION = '$unset';\n/** @const */\n\nvar ADD_ACTION = '$add';\n/** @const */\n\nvar APPEND_ACTION = '$append';\n/** @const */\n\nvar UNION_ACTION = '$union';\n/** @const */\n\nvar REMOVE_ACTION = '$remove';\n/** @const */\n\nvar DELETE_ACTION = '$delete'; // Common internal methods for mixpanel.people and mixpanel.group APIs.\n// These methods shouldn't involve network I/O.\n\nvar apiActions = {\n  set_action: function set_action(prop, to) {\n    var data = {};\n    var $set = {};\n\n    if (_.isObject(prop)) {\n      _.each(prop, function (v, k) {\n        if (!this._is_reserved_property(k)) {\n          $set[k] = v;\n        }\n      }, this);\n    } else {\n      $set[prop] = to;\n    }\n\n    data[SET_ACTION] = $set;\n    return data;\n  },\n  unset_action: function unset_action(prop) {\n    var data = {};\n    var $unset = [];\n\n    if (!_.isArray(prop)) {\n      prop = [prop];\n    }\n\n    _.each(prop, function (k) {\n      if (!this._is_reserved_property(k)) {\n        $unset.push(k);\n      }\n    }, this);\n\n    data[UNSET_ACTION] = $unset;\n    return data;\n  },\n  set_once_action: function set_once_action(prop, to) {\n    var data = {};\n    var $set_once = {};\n\n    if (_.isObject(prop)) {\n      _.each(prop, function (v, k) {\n        if (!this._is_reserved_property(k)) {\n          $set_once[k] = v;\n        }\n      }, this);\n    } else {\n      $set_once[prop] = to;\n    }\n\n    data[SET_ONCE_ACTION] = $set_once;\n    return data;\n  },\n  union_action: function union_action(list_name, values) {\n    var data = {};\n    var $union = {};\n\n    if (_.isObject(list_name)) {\n      _.each(list_name, function (v, k) {\n        if (!this._is_reserved_property(k)) {\n          $union[k] = _.isArray(v) ? v : [v];\n        }\n      }, this);\n    } else {\n      $union[list_name] = _.isArray(values) ? values : [values];\n    }\n\n    data[UNION_ACTION] = $union;\n    return data;\n  },\n  append_action: function append_action(list_name, value) {\n    var data = {};\n    var $append = {};\n\n    if (_.isObject(list_name)) {\n      _.each(list_name, function (v, k) {\n        if (!this._is_reserved_property(k)) {\n          $append[k] = v;\n        }\n      }, this);\n    } else {\n      $append[list_name] = value;\n    }\n\n    data[APPEND_ACTION] = $append;\n    return data;\n  },\n  remove_action: function remove_action(list_name, value) {\n    var data = {};\n    var $remove = {};\n\n    if (_.isObject(list_name)) {\n      _.each(list_name, function (v, k) {\n        if (!this._is_reserved_property(k)) {\n          $remove[k] = v;\n        }\n      }, this);\n    } else {\n      $remove[list_name] = value;\n    }\n\n    data[REMOVE_ACTION] = $remove;\n    return data;\n  },\n  delete_action: function delete_action() {\n    var data = {};\n    data[DELETE_ACTION] = '';\n    return data;\n  }\n};\n/**\n * Mixpanel Group Object\n * @constructor\n */\n\nvar MixpanelGroup = function MixpanelGroup() {};\n\n_.extend(MixpanelGroup.prototype, apiActions);\n\nMixpanelGroup.prototype._init = function (mixpanel_instance, group_key, group_id) {\n  this._mixpanel = mixpanel_instance;\n  this._group_key = group_key;\n  this._group_id = group_id;\n};\n/**\n * Set properties on a group.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').set('Location', '405 Howard');\n *\n *     // or set multiple properties at once\n *     mixpanel.get_group('company', 'mixpanel').set({\n *          'Location': '405 Howard',\n *          'Founded' : 2009,\n *     });\n *     // properties can be strings, integers, dates, or lists\n *\n * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n * @param {*} [to] A value to set on the given property name\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\n\n\nMixpanelGroup.prototype.set = addOptOutCheckMixpanelGroup(function (prop, to, callback) {\n  var data = this.set_action(prop, to);\n\n  if (_.isObject(prop)) {\n    callback = to;\n  }\n\n  return this._send_request(data, callback);\n});\n/**\n * Set properties on a group, only if they do not yet exist.\n * This will not overwrite previous group property values, unlike\n * group.set().\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').set_once('Location', '405 Howard');\n *\n *     // or set multiple properties at once\n *     mixpanel.get_group('company', 'mixpanel').set_once({\n *          'Location': '405 Howard',\n *          'Founded' : 2009,\n *     });\n *     // properties can be strings, integers, lists or dates\n *\n * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n * @param {*} [to] A value to set on the given property name\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\n\nMixpanelGroup.prototype.set_once = addOptOutCheckMixpanelGroup(function (prop, to, callback) {\n  var data = this.set_once_action(prop, to);\n\n  if (_.isObject(prop)) {\n    callback = to;\n  }\n\n  return this._send_request(data, callback);\n});\n/**\n * Unset properties on a group permanently.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').unset('Founded');\n *\n * @param {String} prop The name of the property.\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\n\nMixpanelGroup.prototype.unset = addOptOutCheckMixpanelGroup(function (prop, callback) {\n  var data = this.unset_action(prop);\n  return this._send_request(data, callback);\n});\n/**\n * Merge a given list with a list-valued group property, excluding duplicate values.\n *\n * ### Usage:\n *\n *     // merge a value to a list, creating it if needed\n *     mixpanel.get_group('company', 'mixpanel').union('Location', ['San Francisco', 'London']);\n *\n * @param {String} list_name Name of the property.\n * @param {Array} values Values to merge with the given property\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\n\nMixpanelGroup.prototype.union = addOptOutCheckMixpanelGroup(function (list_name, values, callback) {\n  if (_.isObject(list_name)) {\n    callback = values;\n  }\n\n  var data = this.union_action(list_name, values);\n  return this._send_request(data, callback);\n});\n/**\n * Permanently delete a group.\n *\n * ### Usage:\n *     mixpanel.get_group('company', 'mixpanel').delete();\n */\n\nMixpanelGroup.prototype['delete'] = addOptOutCheckMixpanelGroup(function (callback) {\n  var data = this.delete_action();\n  return this._send_request(data, callback);\n});\n/**\n * Remove a property from a group. The value will be ignored if doesn't exist.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').remove('Location', 'London');\n *\n * @param {String} list_name Name of the property.\n * @param {Object} value Value to remove from the given group property\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\n\nMixpanelGroup.prototype.remove = addOptOutCheckMixpanelGroup(function (list_name, value, callback) {\n  var data = this.remove_action(list_name, value);\n  return this._send_request(data, callback);\n});\n\nMixpanelGroup.prototype._send_request = function (data, callback) {\n  data['$group_key'] = this._group_key;\n  data['$group_id'] = this._group_id;\n  data['$token'] = this._get_config('token');\n\n  var date_encoded_data = _.encodeDates(data);\n\n  var truncated_data = _.truncate(date_encoded_data, 255);\n\n  var json_data = _.JSONEncode(date_encoded_data);\n\n  var encoded_data = _.base64Encode(json_data);\n\n  console$1.log(data);\n\n  this._mixpanel._send_request(this._mixpanel.get_config('api_host') + '/groups/', {\n    'data': encoded_data\n  }, this._mixpanel._prepare_callback(callback, truncated_data));\n\n  return truncated_data;\n};\n\nMixpanelGroup.prototype._is_reserved_property = function (prop) {\n  return prop === '$group_key' || prop === '$group_id';\n};\n\nMixpanelGroup.prototype._get_config = function (conf) {\n  return this._mixpanel.get_config(conf);\n};\n\nMixpanelGroup.prototype.toString = function () {\n  return this._mixpanel.toString() + '.group.' + this._group_key + '.' + this._group_id;\n}; // MixpanelGroup Exports\n\n\nMixpanelGroup.prototype['remove'] = MixpanelGroup.prototype.remove;\nMixpanelGroup.prototype['set'] = MixpanelGroup.prototype.set;\nMixpanelGroup.prototype['set_once'] = MixpanelGroup.prototype.set_once;\nMixpanelGroup.prototype['union'] = MixpanelGroup.prototype.union;\nMixpanelGroup.prototype['unset'] = MixpanelGroup.prototype.unset;\nMixpanelGroup.prototype['toString'] = MixpanelGroup.prototype.toString;\n/*\n * Constants\n */\n\n/** @const */\n\nvar SET_QUEUE_KEY = '__mps';\n/** @const */\n\nvar SET_ONCE_QUEUE_KEY = '__mpso';\n/** @const */\n\nvar UNSET_QUEUE_KEY = '__mpus';\n/** @const */\n\nvar ADD_QUEUE_KEY = '__mpa';\n/** @const */\n\nvar APPEND_QUEUE_KEY = '__mpap';\n/** @const */\n\nvar REMOVE_QUEUE_KEY = '__mpr';\n/** @const */\n\nvar UNION_QUEUE_KEY = '__mpu'; // This key is deprecated, but we want to check for it to see whether aliasing is allowed.\n\n/** @const */\n\nvar PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id';\n/** @const */\n\nvar ALIAS_ID_KEY = '__alias';\n/** @const */\n\nvar CAMPAIGN_IDS_KEY = '__cmpns';\n/** @const */\n\nvar EVENT_TIMERS_KEY = '__timers';\n/** @const */\n\nvar RESERVED_PROPERTIES = [SET_QUEUE_KEY, SET_ONCE_QUEUE_KEY, UNSET_QUEUE_KEY, ADD_QUEUE_KEY, APPEND_QUEUE_KEY, REMOVE_QUEUE_KEY, UNION_QUEUE_KEY, PEOPLE_DISTINCT_ID_KEY, ALIAS_ID_KEY, CAMPAIGN_IDS_KEY, EVENT_TIMERS_KEY];\n/**\n * Mixpanel Persistence Object\n * @constructor\n */\n\nvar MixpanelPersistence = function MixpanelPersistence(config) {\n  this['props'] = {};\n  this.campaign_params_saved = false;\n\n  if (config['persistence_name']) {\n    this.name = 'mp_' + config['persistence_name'];\n  } else {\n    this.name = 'mp_' + config['token'] + '_mixpanel';\n  }\n\n  var storage_type = config['persistence'];\n\n  if (storage_type !== 'cookie' && storage_type !== 'localStorage') {\n    console$1.critical('Unknown persistence type ' + storage_type + '; falling back to cookie');\n    storage_type = config['persistence'] = 'cookie';\n  }\n\n  if (storage_type === 'localStorage' && _.localStorage.is_supported()) {\n    this.storage = _.localStorage;\n  } else {\n    this.storage = _.cookie;\n  }\n\n  this.load();\n  this.update_config(config);\n  this.upgrade(config);\n  this.save();\n};\n\nMixpanelPersistence.prototype.properties = function () {\n  var p = {}; // Filter out reserved properties\n\n  _.each(this['props'], function (v, k) {\n    if (!_.include(RESERVED_PROPERTIES, k)) {\n      p[k] = v;\n    }\n  });\n\n  return p;\n};\n\nMixpanelPersistence.prototype.load = function () {\n  if (this.disabled) {\n    return;\n  }\n\n  var entry = this.storage.parse(this.name);\n\n  if (entry) {\n    this['props'] = _.extend({}, entry);\n  }\n};\n\nMixpanelPersistence.prototype.upgrade = function (config) {\n  var upgrade_from_old_lib = config['upgrade'],\n      old_cookie_name,\n      old_cookie;\n\n  if (upgrade_from_old_lib) {\n    old_cookie_name = 'mp_super_properties'; // Case where they had a custom cookie name before.\n\n    if (typeof upgrade_from_old_lib === 'string') {\n      old_cookie_name = upgrade_from_old_lib;\n    }\n\n    old_cookie = this.storage.parse(old_cookie_name); // remove the cookie\n\n    this.storage.remove(old_cookie_name);\n    this.storage.remove(old_cookie_name, true);\n\n    if (old_cookie) {\n      this['props'] = _.extend(this['props'], old_cookie['all'], old_cookie['events']);\n    }\n  }\n\n  if (!config['cookie_name'] && config['name'] !== 'mixpanel') {\n    // special case to handle people with cookies of the form\n    // mp_TOKEN_INSTANCENAME from the first release of this library\n    old_cookie_name = 'mp_' + config['token'] + '_' + config['name'];\n    old_cookie = this.storage.parse(old_cookie_name);\n\n    if (old_cookie) {\n      this.storage.remove(old_cookie_name);\n      this.storage.remove(old_cookie_name, true); // Save the prop values that were in the cookie from before -\n      // this should only happen once as we delete the old one.\n\n      this.register_once(old_cookie);\n    }\n  }\n\n  if (this.storage === _.localStorage) {\n    old_cookie = _.cookie.parse(this.name);\n\n    _.cookie.remove(this.name);\n\n    _.cookie.remove(this.name, true);\n\n    if (old_cookie) {\n      this.register_once(old_cookie);\n    }\n  }\n};\n\nMixpanelPersistence.prototype.save = function () {\n  if (this.disabled) {\n    return;\n  }\n\n  this._expire_notification_campaigns();\n\n  this.storage.set(this.name, _.JSONEncode(this['props']), this.expire_days, this.cross_subdomain, this.secure);\n};\n\nMixpanelPersistence.prototype.remove = function () {\n  // remove both domain and subdomain cookies\n  this.storage.remove(this.name, false);\n  this.storage.remove(this.name, true);\n}; // removes the storage entry and deletes all loaded data\n// forced name for tests\n\n\nMixpanelPersistence.prototype.clear = function () {\n  this.remove();\n  this['props'] = {};\n};\n/**\n* @param {Object} props\n* @param {*=} default_value\n* @param {number=} days\n*/\n\n\nMixpanelPersistence.prototype.register_once = function (props, default_value, days) {\n  if (_.isObject(props)) {\n    if (typeof default_value === 'undefined') {\n      default_value = 'None';\n    }\n\n    this.expire_days = typeof days === 'undefined' ? this.default_expiry : days;\n\n    _.each(props, function (val, prop) {\n      if (!this['props'].hasOwnProperty(prop) || this['props'][prop] === default_value) {\n        this['props'][prop] = val;\n      }\n    }, this);\n\n    this.save();\n    return true;\n  }\n\n  return false;\n};\n/**\n* @param {Object} props\n* @param {number=} days\n*/\n\n\nMixpanelPersistence.prototype.register = function (props, days) {\n  if (_.isObject(props)) {\n    this.expire_days = typeof days === 'undefined' ? this.default_expiry : days;\n\n    _.extend(this['props'], props);\n\n    this.save();\n    return true;\n  }\n\n  return false;\n};\n\nMixpanelPersistence.prototype.unregister = function (prop) {\n  if (prop in this['props']) {\n    delete this['props'][prop];\n    this.save();\n  }\n};\n\nMixpanelPersistence.prototype._expire_notification_campaigns = _.safewrap(function () {\n  var campaigns_shown = this['props'][CAMPAIGN_IDS_KEY],\n      EXPIRY_TIME = Config.DEBUG ? 60 * 1000 : 60 * 60 * 1000; // 1 minute (Config.DEBUG) / 1 hour (PDXN)\n\n  if (!campaigns_shown) {\n    return;\n  }\n\n  for (var campaign_id in campaigns_shown) {\n    if (1 * new Date() - campaigns_shown[campaign_id] > EXPIRY_TIME) {\n      delete campaigns_shown[campaign_id];\n    }\n  }\n\n  if (_.isEmptyObject(campaigns_shown)) {\n    delete this['props'][CAMPAIGN_IDS_KEY];\n  }\n});\n\nMixpanelPersistence.prototype.update_campaign_params = function () {\n  if (!this.campaign_params_saved) {\n    this.register_once(_.info.campaignParams());\n    this.campaign_params_saved = true;\n  }\n};\n\nMixpanelPersistence.prototype.update_search_keyword = function (referrer) {\n  this.register(_.info.searchInfo(referrer));\n}; // EXPORTED METHOD, we test this directly.\n\n\nMixpanelPersistence.prototype.update_referrer_info = function (referrer) {\n  // If referrer doesn't exist, we want to note the fact that it was type-in traffic.\n  this.register_once({\n    '$initial_referrer': referrer || '$direct',\n    '$initial_referring_domain': _.info.referringDomain(referrer) || '$direct'\n  }, '');\n};\n\nMixpanelPersistence.prototype.get_referrer_info = function () {\n  return _.strip_empty_properties({\n    '$initial_referrer': this['props']['$initial_referrer'],\n    '$initial_referring_domain': this['props']['$initial_referring_domain']\n  });\n}; // safely fills the passed in object with stored properties,\n// does not override any properties defined in both\n// returns the passed in object\n\n\nMixpanelPersistence.prototype.safe_merge = function (props) {\n  _.each(this['props'], function (val, prop) {\n    if (!(prop in props)) {\n      props[prop] = val;\n    }\n  });\n\n  return props;\n};\n\nMixpanelPersistence.prototype.update_config = function (config) {\n  this.default_expiry = this.expire_days = config['cookie_expiration'];\n  this.set_disabled(config['disable_persistence']);\n  this.set_cross_subdomain(config['cross_subdomain_cookie']);\n  this.set_secure(config['secure_cookie']);\n};\n\nMixpanelPersistence.prototype.set_disabled = function (disabled) {\n  this.disabled = disabled;\n\n  if (this.disabled) {\n    this.remove();\n  } else {\n    this.save();\n  }\n};\n\nMixpanelPersistence.prototype.set_cross_subdomain = function (cross_subdomain) {\n  if (cross_subdomain !== this.cross_subdomain) {\n    this.cross_subdomain = cross_subdomain;\n    this.remove();\n    this.save();\n  }\n};\n\nMixpanelPersistence.prototype.get_cross_subdomain = function () {\n  return this.cross_subdomain;\n};\n\nMixpanelPersistence.prototype.set_secure = function (secure) {\n  if (secure !== this.secure) {\n    this.secure = secure ? true : false;\n    this.remove();\n    this.save();\n  }\n};\n\nMixpanelPersistence.prototype._add_to_people_queue = function (queue, data) {\n  var q_key = this._get_queue_key(queue),\n      q_data = data[queue],\n      set_q = this._get_or_create_queue(SET_ACTION),\n      set_once_q = this._get_or_create_queue(SET_ONCE_ACTION),\n      unset_q = this._get_or_create_queue(UNSET_ACTION),\n      add_q = this._get_or_create_queue(ADD_ACTION),\n      union_q = this._get_or_create_queue(UNION_ACTION),\n      remove_q = this._get_or_create_queue(REMOVE_ACTION, []),\n      append_q = this._get_or_create_queue(APPEND_ACTION, []);\n\n  if (q_key === SET_QUEUE_KEY) {\n    // Update the set queue - we can override any existing values\n    _.extend(set_q, q_data); // if there was a pending increment, override it\n    // with the set.\n\n\n    this._pop_from_people_queue(ADD_ACTION, q_data); // if there was a pending union, override it\n    // with the set.\n\n\n    this._pop_from_people_queue(UNION_ACTION, q_data);\n\n    this._pop_from_people_queue(UNSET_ACTION, q_data);\n  } else if (q_key === SET_ONCE_QUEUE_KEY) {\n    // only queue the data if there is not already a set_once call for it.\n    _.each(q_data, function (v, k) {\n      if (!(k in set_once_q)) {\n        set_once_q[k] = v;\n      }\n    });\n\n    this._pop_from_people_queue(UNSET_ACTION, q_data);\n  } else if (q_key === UNSET_QUEUE_KEY) {\n    _.each(q_data, function (prop) {\n      // undo previously-queued actions on this key\n      _.each([set_q, set_once_q, add_q, union_q], function (enqueued_obj) {\n        if (prop in enqueued_obj) {\n          delete enqueued_obj[prop];\n        }\n      });\n\n      _.each(append_q, function (append_obj) {\n        if (prop in append_obj) {\n          delete append_obj[prop];\n        }\n      });\n\n      unset_q[prop] = true;\n    });\n  } else if (q_key === ADD_QUEUE_KEY) {\n    _.each(q_data, function (v, k) {\n      // If it exists in the set queue, increment\n      // the value\n      if (k in set_q) {\n        set_q[k] += v;\n      } else {\n        // If it doesn't exist, update the add\n        // queue\n        if (!(k in add_q)) {\n          add_q[k] = 0;\n        }\n\n        add_q[k] += v;\n      }\n    }, this);\n\n    this._pop_from_people_queue(UNSET_ACTION, q_data);\n  } else if (q_key === UNION_QUEUE_KEY) {\n    _.each(q_data, function (v, k) {\n      if (_.isArray(v)) {\n        if (!(k in union_q)) {\n          union_q[k] = [];\n        } // We may send duplicates, the server will dedup them.\n\n\n        union_q[k] = union_q[k].concat(v);\n      }\n    });\n\n    this._pop_from_people_queue(UNSET_ACTION, q_data);\n  } else if (q_key === REMOVE_QUEUE_KEY) {\n    remove_q.push(q_data);\n\n    this._pop_from_people_queue(APPEND_ACTION, q_data);\n  } else if (q_key === APPEND_QUEUE_KEY) {\n    append_q.push(q_data);\n\n    this._pop_from_people_queue(UNSET_ACTION, q_data);\n  }\n\n  console$1.log('MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):');\n  console$1.log(data);\n  this.save();\n};\n\nMixpanelPersistence.prototype._pop_from_people_queue = function (queue, data) {\n  var q = this._get_queue(queue);\n\n  if (!_.isUndefined(q)) {\n    _.each(data, function (v, k) {\n      if (queue === APPEND_ACTION || queue === REMOVE_ACTION) {\n        // list actions: only remove if both k+v match\n        // e.g. remove should not override append in a case like\n        // append({foo: 'bar'}); remove({foo: 'qux'})\n        _.each(q, function (queued_action) {\n          if (queued_action[k] === v) {\n            delete queued_action[k];\n          }\n        });\n      } else {\n        delete q[k];\n      }\n    }, this);\n\n    this.save();\n  }\n};\n\nMixpanelPersistence.prototype._get_queue_key = function (queue) {\n  if (queue === SET_ACTION) {\n    return SET_QUEUE_KEY;\n  } else if (queue === SET_ONCE_ACTION) {\n    return SET_ONCE_QUEUE_KEY;\n  } else if (queue === UNSET_ACTION) {\n    return UNSET_QUEUE_KEY;\n  } else if (queue === ADD_ACTION) {\n    return ADD_QUEUE_KEY;\n  } else if (queue === APPEND_ACTION) {\n    return APPEND_QUEUE_KEY;\n  } else if (queue === REMOVE_ACTION) {\n    return REMOVE_QUEUE_KEY;\n  } else if (queue === UNION_ACTION) {\n    return UNION_QUEUE_KEY;\n  } else {\n    console$1.error('Invalid queue:', queue);\n  }\n};\n\nMixpanelPersistence.prototype._get_queue = function (queue) {\n  return this['props'][this._get_queue_key(queue)];\n};\n\nMixpanelPersistence.prototype._get_or_create_queue = function (queue, default_val) {\n  var key = this._get_queue_key(queue);\n\n  default_val = _.isUndefined(default_val) ? {} : default_val;\n  return this['props'][key] || (this['props'][key] = default_val);\n};\n\nMixpanelPersistence.prototype.set_event_timer = function (event_name, timestamp) {\n  var timers = this['props'][EVENT_TIMERS_KEY] || {};\n  timers[event_name] = timestamp;\n  this['props'][EVENT_TIMERS_KEY] = timers;\n  this.save();\n};\n\nMixpanelPersistence.prototype.remove_event_timer = function (event_name) {\n  var timers = this['props'][EVENT_TIMERS_KEY] || {};\n  var timestamp = timers[event_name];\n\n  if (!_.isUndefined(timestamp)) {\n    delete this['props'][EVENT_TIMERS_KEY][event_name];\n    this.save();\n  }\n\n  return timestamp;\n};\n/*\n * This file is a js implementation for a subset in eval_node.c\n */\n\n/*\n * Constants\n */\n// Metadata keys\n\n/** @const */\n\n\nvar OPERATOR_KEY = 'operator';\n/** @const */\n\nvar PROPERTY_KEY = 'property';\n/** @const */\n\nvar WINDOW_KEY = 'window';\n/** @const */\n\nvar UNIT_KEY = 'unit';\n/** @const */\n\nvar VALUE_KEY = 'value';\n/** @const */\n\nvar HOUR_KEY = 'hour';\n/** @const */\n\nvar DAY_KEY = 'day';\n/** @const */\n\nvar WEEK_KEY = 'week';\n/** @const */\n\nvar MONTH_KEY = 'month'; // Operands\n\n/** @const */\n\nvar EVENT_PROPERTY = 'event';\n/** @const */\n\nvar LITERAL_PROPERTY = 'literal'; // Binary Operators\n\n/** @const */\n\nvar AND_OPERATOR = 'and';\n/** @const */\n\nvar OR_OPERATOR = 'or';\n/** @const */\n\nvar IN_OPERATOR = 'in';\n/** @const */\n\nvar NOT_IN_OPERATOR = 'not in';\n/** @const */\n\nvar PLUS_OPERATOR = '+';\n/** @const */\n\nvar MINUS_OPERATOR = '-';\n/** @const */\n\nvar MUL_OPERATOR = '*';\n/** @const */\n\nvar DIV_OPERATOR = '/';\n/** @const */\n\nvar MOD_OPERATOR = '%';\n/** @const */\n\nvar EQUALS_OPERATOR = '==';\n/** @const */\n\nvar NOT_EQUALS_OPERATOR = '!=';\n/** @const */\n\nvar GREATER_OPERATOR = '>';\n/** @const */\n\nvar LESS_OPERATOR = '<';\n/** @const */\n\nvar GREATER_EQUAL_OPERATOR = '>=';\n/** @const */\n\nvar LESS_EQUAL_OPERATOR = '<='; // Typecast Operators\n\n/** @const */\n\nvar BOOLEAN_OPERATOR = 'boolean';\n/** @const */\n\nvar DATETIME_OPERATOR = 'datetime';\n/** @const */\n\nvar LIST_OPERATOR = 'list';\n/** @const */\n\nvar NUMBER_OPERATOR = 'number';\n/** @const */\n\nvar STRING_OPERATOR = 'string'; // Unary Operators\n\n/** @const */\n\nvar NOT_OPERATOR = 'not';\n/** @const */\n\nvar DEFINED_OPERATOR = 'defined';\n/** @const */\n\nvar NOT_DEFINED_OPERATOR = 'not defined'; // Special literals\n\n/** @const */\n\nvar NOW_LITERAL = 'now'; // Type cast functions\n\nfunction toNumber(value) {\n  if (value === null) {\n    return null;\n  }\n\n  switch (typeof value) {\n    case 'object':\n      if (_.isDate(value) && value.getTime() >= 0) {\n        return value.getTime();\n      }\n\n      return null;\n\n    case 'boolean':\n      return Number(value);\n\n    case 'number':\n      return value;\n\n    case 'string':\n      value = Number(value);\n\n      if (!isNaN(value)) {\n        return value;\n      }\n\n      return 0;\n  }\n\n  return null;\n}\n\nfunction evaluateNumber(op, properties) {\n  if (!op['operator'] || op['operator'] !== NUMBER_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid cast operator: number ' + op;\n  }\n\n  return toNumber(evaluateSelector(op['children'][0], properties));\n}\n\nfunction toBoolean(value) {\n  if (value === null) {\n    return false;\n  }\n\n  switch (typeof value) {\n    case 'boolean':\n      return value;\n\n    case 'number':\n      return value !== 0.0;\n\n    case 'string':\n      return value.length > 0;\n\n    case 'object':\n      if (_.isArray(value) && value.length > 0) {\n        return true;\n      }\n\n      if (_.isDate(value) && value.getTime() > 0) {\n        return true;\n      }\n\n      if (_.isObject(value) && !_.isEmptyObject(value)) {\n        return true;\n      }\n\n      return false;\n  }\n\n  return false;\n}\n\nfunction evaluateBoolean(op, properties) {\n  if (!op['operator'] || op['operator'] !== BOOLEAN_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid cast operator: boolean ' + op;\n  }\n\n  return toBoolean(evaluateSelector(op['children'][0], properties));\n}\n\nfunction evaluateDateTime(op, properties) {\n  if (!op['operator'] || op['operator'] !== DATETIME_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid cast operator: datetime ' + op;\n  }\n\n  var v = evaluateSelector(op['children'][0], properties);\n\n  if (v === null) {\n    return null;\n  }\n\n  switch (typeof v) {\n    case 'number':\n    case 'string':\n      var d = new Date(v);\n\n      if (isNaN(d.getTime())) {\n        return null;\n      }\n\n      return d;\n\n    case 'object':\n      if (_.isDate(v)) {\n        return v;\n      }\n\n  }\n\n  return null;\n}\n\nfunction evaluateList(op, properties) {\n  if (!op['operator'] || op['operator'] !== LIST_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid cast operator: list ' + op;\n  }\n\n  var v = evaluateSelector(op['children'][0], properties);\n\n  if (v === null) {\n    return null;\n  }\n\n  if (_.isArray(v)) {\n    return v;\n  }\n\n  return null;\n}\n\nfunction evaluateString(op, properties) {\n  if (!op['operator'] || op['operator'] !== STRING_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid cast operator: string ' + op;\n  }\n\n  var v = evaluateSelector(op['children'][0], properties);\n\n  switch (typeof v) {\n    case 'object':\n      if (_.isDate(v)) {\n        return v.toJSON();\n      }\n\n      return JSON.stringify(v);\n  }\n\n  return String(v);\n} // Operators\n\n\nfunction evaluateAnd(op, properties) {\n  if (!op['operator'] || op['operator'] !== AND_OPERATOR || !op['children'] || op['children'].length !== 2) {\n    throw 'Invalid operator: AND ' + op;\n  }\n\n  return toBoolean(evaluateSelector(op['children'][0], properties)) && toBoolean(evaluateSelector(op['children'][1], properties));\n}\n\nfunction evaluateOr(op, properties) {\n  if (!op['operator'] || op['operator'] !== OR_OPERATOR || !op['children'] || op['children'].length !== 2) {\n    throw 'Invalid operator: OR ' + op;\n  }\n\n  return toBoolean(evaluateSelector(op['children'][0], properties)) || toBoolean(evaluateSelector(op['children'][1], properties));\n}\n\nfunction evaluateIn(op, properties) {\n  if (!op['operator'] || [IN_OPERATOR, NOT_IN_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 2) {\n    throw 'Invalid operator: IN/NOT IN ' + op;\n  }\n\n  var leftValue = evaluateSelector(op['children'][0], properties);\n  var rightValue = evaluateSelector(op['children'][1], properties);\n\n  if (!_.isArray(rightValue) && !_.isString(rightValue)) {\n    throw 'Invalid operand for operator IN: invalid type' + rightValue;\n  }\n\n  var v = rightValue.indexOf(leftValue) > -1;\n\n  if (op['operator'] === NOT_IN_OPERATOR) {\n    return !v;\n  }\n\n  return v;\n}\n\nfunction evaluatePlus(op, properties) {\n  if (!op['operator'] || op['operator'] !== PLUS_OPERATOR || !op['children'] || op['children'].length < 2) {\n    throw 'Invalid operator: PLUS ' + op;\n  }\n\n  var l = evaluateSelector(op['children'][0], properties);\n  var r = evaluateSelector(op['children'][1], properties);\n\n  if (typeof l === 'number' && typeof r === 'number') {\n    return l + r;\n  }\n\n  if (typeof l === 'string' && typeof r === 'string') {\n    return l + r;\n  }\n\n  return null;\n}\n\nfunction evaluateArithmetic(op, properties) {\n  if (!op['operator'] || [MINUS_OPERATOR, MUL_OPERATOR, DIV_OPERATOR, MOD_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length < 2) {\n    throw 'Invalid arithmetic operator ' + op;\n  }\n\n  var l = evaluateSelector(op['children'][0], properties);\n  var r = evaluateSelector(op['children'][1], properties);\n\n  if (typeof l === 'number' && typeof r === 'number') {\n    switch (op['operator']) {\n      case MINUS_OPERATOR:\n        return l - r;\n\n      case MUL_OPERATOR:\n        return l * r;\n\n      case DIV_OPERATOR:\n        if (r !== 0) {\n          return l / r;\n        }\n\n        return null;\n\n      case MOD_OPERATOR:\n        if (r === 0) {\n          return null;\n        }\n\n        if (l === 0) {\n          return 0;\n        }\n\n        if (l < 0 && r > 0 || l > 0 && r < 0) {\n          /* Mimic python modulo - result takes sign of the divisor\n           * if one operand is negative. */\n          return -(Math.floor(l / r) * r - l);\n        }\n\n        return l % r;\n\n      default:\n        throw 'Unknown operator: ' + op['operator'];\n    }\n  }\n\n  return null;\n}\n\nfunction _isArrayEqual(l, r) {\n  if (l === r) return true;\n  if (l === null || r === null) return false;\n  if (l.length !== r.length) return false;\n\n  for (var i = 0; i < l.length; i++) {\n    if (l[i] !== r[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction _isEqual(l, r) {\n  if (l === null && l === r) {\n    return true;\n  }\n\n  if (typeof l === typeof r) {\n    switch (typeof l) {\n      case 'number':\n      case 'string':\n      case 'boolean':\n        return l === r;\n\n      case 'object':\n        if (_.isArray(l) && _.isArray(r)) {\n          return _isArrayEqual(l, r);\n        }\n\n        if (_.isDate(l) && _.isDate(r)) {\n          return l.getTime() === r.getTime();\n        }\n\n        if (_.isObject(l) && _.isObject(r)) {\n          return JSON.stringify(l) === JSON.stringify(r);\n        }\n\n    }\n  }\n\n  return false;\n}\n\nfunction evaluateEquality(op, properties) {\n  if (!op['operator'] || [EQUALS_OPERATOR, NOT_EQUALS_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 2) {\n    throw 'Invalid equality operator ' + op;\n  }\n\n  var v = _isEqual(evaluateSelector(op['children'][0], properties), evaluateSelector(op['children'][1], properties));\n\n  switch (op['operator']) {\n    case EQUALS_OPERATOR:\n      return v;\n\n    case NOT_EQUALS_OPERATOR:\n      return !v;\n  }\n}\n\nfunction evaluateComparison(op, properties) {\n  if (!op['operator'] || [GREATER_OPERATOR, GREATER_EQUAL_OPERATOR, LESS_OPERATOR, LESS_EQUAL_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 2) {\n    throw 'Invalid comparison operator ' + op;\n  }\n\n  var l = evaluateSelector(op['children'][0], properties);\n  var r = evaluateSelector(op['children'][1], properties);\n\n  if (typeof l === typeof r) {\n    if (typeof r === 'number' || _.isDate(r)) {\n      l = toNumber(l);\n      r = toNumber(r);\n\n      switch (op['operator']) {\n        case GREATER_OPERATOR:\n          return l > r;\n\n        case GREATER_EQUAL_OPERATOR:\n          return l >= r;\n\n        case LESS_OPERATOR:\n          return l < r;\n\n        case LESS_EQUAL_OPERATOR:\n          return l <= r;\n      }\n    } else if (typeof r === 'string') {\n      var compare = l.localeCompare(r);\n\n      switch (op['operator']) {\n        case GREATER_OPERATOR:\n          return compare > 0;\n\n        case GREATER_EQUAL_OPERATOR:\n          return compare >= 0;\n\n        case LESS_OPERATOR:\n          return compare < 0;\n\n        case LESS_EQUAL_OPERATOR:\n          return compare <= 0;\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction evaluateDefined(op, properties) {\n  if (!op['operator'] || [DEFINED_OPERATOR, NOT_DEFINED_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid defined/not defined operator: ' + op;\n  }\n\n  var b = evaluateSelector(op['children'][0], properties) !== null;\n\n  if (op['operator'] === NOT_DEFINED_OPERATOR) {\n    return !b;\n  }\n\n  return b;\n}\n\nfunction evaluateNot(op, properties) {\n  if (!op['operator'] || op['operator'] !== NOT_OPERATOR || !op['children'] || op['children'].length !== 1) {\n    throw 'Invalid not operator: ' + op;\n  }\n\n  var v = evaluateSelector(op['children'][0], properties);\n\n  if (v === null) {\n    return true;\n  }\n\n  if (typeof v === 'boolean') {\n    return !v;\n  }\n\n  return null;\n}\n\nfunction evaluateOperator(op, properties) {\n  if (!op['operator']) {\n    throw 'Invalid operator: operator key missing ' + op;\n  }\n\n  switch (op['operator']) {\n    case AND_OPERATOR:\n      return evaluateAnd(op, properties);\n\n    case OR_OPERATOR:\n      return evaluateOr(op, properties);\n\n    case IN_OPERATOR:\n    case NOT_IN_OPERATOR:\n      return evaluateIn(op, properties);\n\n    case PLUS_OPERATOR:\n      return evaluatePlus(op, properties);\n\n    case MINUS_OPERATOR:\n    case MUL_OPERATOR:\n    case DIV_OPERATOR:\n    case MOD_OPERATOR:\n      return evaluateArithmetic(op, properties);\n\n    case EQUALS_OPERATOR:\n    case NOT_EQUALS_OPERATOR:\n      return evaluateEquality(op, properties);\n\n    case GREATER_OPERATOR:\n    case LESS_OPERATOR:\n    case GREATER_EQUAL_OPERATOR:\n    case LESS_EQUAL_OPERATOR:\n      return evaluateComparison(op, properties);\n\n    case BOOLEAN_OPERATOR:\n      return evaluateBoolean(op, properties);\n\n    case DATETIME_OPERATOR:\n      return evaluateDateTime(op, properties);\n\n    case LIST_OPERATOR:\n      return evaluateList(op, properties);\n\n    case NUMBER_OPERATOR:\n      return evaluateNumber(op, properties);\n\n    case STRING_OPERATOR:\n      return evaluateString(op, properties);\n\n    case DEFINED_OPERATOR:\n    case NOT_DEFINED_OPERATOR:\n      return evaluateDefined(op, properties);\n\n    case NOT_OPERATOR:\n      return evaluateNot(op, properties);\n  }\n}\n\nfunction evaluateWindow(value) {\n  var win = value[WINDOW_KEY];\n\n  if (!win || !win[UNIT_KEY] || !win[VALUE_KEY]) {\n    throw 'Invalid window: missing required keys ' + JSON.stringify(value);\n  }\n\n  var out = new Date();\n\n  switch (win[UNIT_KEY]) {\n    case HOUR_KEY:\n      out.setTime(out.getTime() + win[VALUE_KEY] * -1 * 60 * 60 * 1000);\n      break;\n\n    case DAY_KEY:\n      out.setTime(out.getTime() + win[VALUE_KEY] * -1 * 24 * 60 * 60 * 1000);\n      break;\n\n    case WEEK_KEY:\n      out.setTime(out.getTime() + win[VALUE_KEY] * -1 * 7 * 24 * 60 * 60 * 1000);\n      break;\n\n    case MONTH_KEY:\n      out.setTime(out.getTime() + win[VALUE_KEY] * -1 * 30 * 24 * 60 * 60 * 1000);\n      break;\n\n    default:\n      throw 'Invalid unit: ' + win[UNIT_KEY];\n  }\n\n  return out;\n}\n\nfunction evaluateOperand(op, properties) {\n  if (!op['property'] || !op['value']) {\n    throw 'Invalid operand: missing required keys ' + op;\n  }\n\n  switch (op['property']) {\n    case EVENT_PROPERTY:\n      if (properties[op['value']] !== undefined) {\n        return properties[op['value']];\n      }\n\n      return null;\n\n    case LITERAL_PROPERTY:\n      if (op['value'] === NOW_LITERAL) {\n        return new Date();\n      }\n\n      if (typeof op['value'] === 'object') {\n        return evaluateWindow(op['value']);\n      }\n\n      return op['value'];\n\n    default:\n      throw 'Invalid operand: Invalid property type ' + op['property'];\n  }\n}\n\nfunction evaluateSelector(filters, properties) {\n  if (filters[PROPERTY_KEY]) {\n    return evaluateOperand(filters, properties);\n  }\n\n  if (filters[OPERATOR_KEY]) {\n    return evaluateOperator(filters, properties);\n  }\n} // Internal class for notification display\n\n\nvar MixpanelNotification = function MixpanelNotification(notif_data, mixpanel_instance) {\n  _.bind_instance_methods(this);\n\n  this.mixpanel = mixpanel_instance;\n  this.persistence = this.mixpanel['persistence'];\n  this.resource_protocol = this.mixpanel.get_config('inapp_protocol');\n  this.cdn_host = this.mixpanel.get_config('cdn');\n  this.campaign_id = _.escapeHTML(notif_data['id']);\n  this.message_id = _.escapeHTML(notif_data['message_id']);\n  this.body = (_.escapeHTML(notif_data['body']) || '').replace(/\\n/g, '<br/>');\n  this.cta = _.escapeHTML(notif_data['cta']) || 'Close';\n  this.notif_type = _.escapeHTML(notif_data['type']) || 'takeover';\n  this.style = _.escapeHTML(notif_data['style']) || 'light';\n  this.title = _.escapeHTML(notif_data['title']) || '';\n  this.video_width = MixpanelNotification.VIDEO_WIDTH;\n  this.video_height = MixpanelNotification.VIDEO_HEIGHT;\n  this.display_triggers = notif_data['display_triggers'] || []; // These fields are url-sanitized in the backend already.\n\n  this.dest_url = notif_data['cta_url'] || null;\n  this.image_url = notif_data['image_url'] || null;\n  this.thumb_image_url = notif_data['thumb_image_url'] || null;\n  this.video_url = notif_data['video_url'] || null;\n\n  if (this.thumb_image_url && this.thumb_image_url.indexOf('//') === 0) {\n    this.thumb_image_url = this.thumb_image_url.replace('//', this.resource_protocol);\n  }\n\n  this.clickthrough = true;\n\n  if (!this.dest_url) {\n    this.dest_url = '#dismiss';\n    this.clickthrough = false;\n  }\n\n  this.mini = this.notif_type === 'mini';\n\n  if (!this.mini) {\n    this.notif_type = 'takeover';\n  }\n\n  this.notif_width = !this.mini ? MixpanelNotification.NOTIF_WIDTH : MixpanelNotification.NOTIF_WIDTH_MINI;\n\n  this._set_client_config();\n\n  this.imgs_to_preload = this._init_image_html();\n\n  this._init_video();\n};\n\nMixpanelNotification.ANIM_TIME = 200;\nMixpanelNotification.MARKUP_PREFIX = 'mixpanel-notification';\nMixpanelNotification.BG_OPACITY = 0.6;\nMixpanelNotification.NOTIF_TOP = 25;\nMixpanelNotification.NOTIF_START_TOP = 200;\nMixpanelNotification.NOTIF_WIDTH = 388;\nMixpanelNotification.NOTIF_WIDTH_MINI = 420;\nMixpanelNotification.NOTIF_HEIGHT_MINI = 85;\nMixpanelNotification.THUMB_BORDER_SIZE = 5;\nMixpanelNotification.THUMB_IMG_SIZE = 60;\nMixpanelNotification.THUMB_OFFSET = Math.round(MixpanelNotification.THUMB_IMG_SIZE / 2);\nMixpanelNotification.VIDEO_WIDTH = 595;\nMixpanelNotification.VIDEO_HEIGHT = 334;\n\nMixpanelNotification.prototype.show = function () {\n  var self = this;\n\n  this._set_client_config(); // don't display until HTML body exists\n\n\n  if (!this.body_el) {\n    setTimeout(function () {\n      self.show();\n    }, 300);\n    return;\n  }\n\n  this._init_styles();\n\n  this._init_notification_el(); // wait for any images to load before showing notification\n\n\n  this._preload_images(this._attach_and_animate);\n};\n\nMixpanelNotification.prototype.dismiss = _.safewrap(function () {\n  if (!this.marked_as_shown) {\n    // unexpected condition: user interacted with notif even though we didn't consider it\n    // visible (see _mark_as_shown()); send tracking signals to mark delivery\n    this._mark_delivery({\n      'invisible': true\n    });\n  }\n\n  var exiting_el = this.showing_video ? this._get_el('video') : this._get_notification_display_el();\n\n  if (this.use_transitions) {\n    this._remove_class('bg', 'visible');\n\n    this._add_class(exiting_el, 'exiting');\n\n    setTimeout(this._remove_notification_el, MixpanelNotification.ANIM_TIME);\n  } else {\n    var notif_attr, notif_start, notif_goal;\n\n    if (this.mini) {\n      notif_attr = 'right';\n      notif_start = 20;\n      notif_goal = -100;\n    } else {\n      notif_attr = 'top';\n      notif_start = MixpanelNotification.NOTIF_TOP;\n      notif_goal = MixpanelNotification.NOTIF_START_TOP + MixpanelNotification.NOTIF_TOP;\n    }\n\n    this._animate_els([{\n      el: this._get_el('bg'),\n      attr: 'opacity',\n      start: MixpanelNotification.BG_OPACITY,\n      goal: 0.0\n    }, {\n      el: exiting_el,\n      attr: 'opacity',\n      start: 1.0,\n      goal: 0.0\n    }, {\n      el: exiting_el,\n      attr: notif_attr,\n      start: notif_start,\n      goal: notif_goal\n    }], MixpanelNotification.ANIM_TIME, this._remove_notification_el);\n  }\n});\nMixpanelNotification.prototype._add_class = _.safewrap(function (el, class_name) {\n  class_name = MixpanelNotification.MARKUP_PREFIX + '-' + class_name;\n\n  if (typeof el === 'string') {\n    el = this._get_el(el);\n  }\n\n  if (!el.className) {\n    el.className = class_name;\n  } else if (!~(' ' + el.className + ' ').indexOf(' ' + class_name + ' ')) {\n    el.className += ' ' + class_name;\n  }\n});\nMixpanelNotification.prototype._remove_class = _.safewrap(function (el, class_name) {\n  class_name = MixpanelNotification.MARKUP_PREFIX + '-' + class_name;\n\n  if (typeof el === 'string') {\n    el = this._get_el(el);\n  }\n\n  if (el.className) {\n    el.className = (' ' + el.className + ' ').replace(' ' + class_name + ' ', '').replace(/^[\\s\\xA0]+/, '').replace(/[\\s\\xA0]+$/, '');\n  }\n});\nMixpanelNotification.prototype._animate_els = _.safewrap(function (anims, mss, done_cb, start_time) {\n  var self = this,\n      in_progress = false,\n      ai,\n      anim,\n      cur_time = 1 * new Date(),\n      time_diff;\n  start_time = start_time || cur_time;\n  time_diff = cur_time - start_time;\n\n  for (ai = 0; ai < anims.length; ai++) {\n    anim = anims[ai];\n\n    if (typeof anim.val === 'undefined') {\n      anim.val = anim.start;\n    }\n\n    if (anim.val !== anim.goal) {\n      in_progress = true;\n      var anim_diff = anim.goal - anim.start,\n          anim_dir = anim.goal >= anim.start ? 1 : -1;\n      anim.val = anim.start + anim_diff * time_diff / mss;\n\n      if (anim.attr !== 'opacity') {\n        anim.val = Math.round(anim.val);\n      }\n\n      if (anim_dir > 0 && anim.val >= anim.goal || anim_dir < 0 && anim.val <= anim.goal) {\n        anim.val = anim.goal;\n      }\n    }\n  }\n\n  if (!in_progress) {\n    if (done_cb) {\n      done_cb();\n    }\n\n    return;\n  }\n\n  for (ai = 0; ai < anims.length; ai++) {\n    anim = anims[ai];\n\n    if (anim.el) {\n      var suffix = anim.attr === 'opacity' ? '' : 'px';\n      anim.el.style[anim.attr] = String(anim.val) + suffix;\n    }\n  }\n\n  setTimeout(function () {\n    self._animate_els(anims, mss, done_cb, start_time);\n  }, 10);\n});\nMixpanelNotification.prototype._attach_and_animate = _.safewrap(function () {\n  var self = this; // no possibility to double-display\n\n  if (this.shown || this._get_shown_campaigns()[this.campaign_id]) {\n    return;\n  }\n\n  this.shown = true;\n  this.body_el.appendChild(this.notification_el);\n  setTimeout(function () {\n    var notif_el = self._get_notification_display_el();\n\n    if (self.use_transitions) {\n      if (!self.mini) {\n        self._add_class('bg', 'visible');\n      }\n\n      self._add_class(notif_el, 'visible');\n\n      self._mark_as_shown();\n    } else {\n      var notif_attr, notif_start, notif_goal;\n\n      if (self.mini) {\n        notif_attr = 'right';\n        notif_start = -100;\n        notif_goal = 20;\n      } else {\n        notif_attr = 'top';\n        notif_start = MixpanelNotification.NOTIF_START_TOP + MixpanelNotification.NOTIF_TOP;\n        notif_goal = MixpanelNotification.NOTIF_TOP;\n      }\n\n      self._animate_els([{\n        el: self._get_el('bg'),\n        attr: 'opacity',\n        start: 0.0,\n        goal: MixpanelNotification.BG_OPACITY\n      }, {\n        el: notif_el,\n        attr: 'opacity',\n        start: 0.0,\n        goal: 1.0\n      }, {\n        el: notif_el,\n        attr: notif_attr,\n        start: notif_start,\n        goal: notif_goal\n      }], MixpanelNotification.ANIM_TIME, self._mark_as_shown);\n    }\n  }, 100);\n\n  _.register_event(self._get_el('cancel'), 'click', function (e) {\n    e.preventDefault();\n    self.dismiss();\n  });\n\n  var click_el = self._get_el('button') || self._get_el('mini-content');\n\n  _.register_event(click_el, 'click', function (e) {\n    e.preventDefault();\n\n    if (self.show_video) {\n      self._track_event('$campaign_open', {\n        '$resource_type': 'video'\n      });\n\n      self._switch_to_video();\n    } else {\n      self.dismiss();\n\n      if (self.clickthrough) {\n        var tracking_cb = null;\n\n        if (self.mixpanel.get_config('inapp_link_new_window')) {\n          window.open(self.dest_url);\n        } else {\n          tracking_cb = function tracking_cb() {\n            window.location.href = self.dest_url;\n          };\n        }\n\n        self._track_event('$campaign_open', {\n          '$resource_type': 'link'\n        }, tracking_cb);\n      }\n    }\n  });\n});\n\nMixpanelNotification.prototype._get_el = function (id) {\n  return document.getElementById(MixpanelNotification.MARKUP_PREFIX + '-' + id);\n};\n\nMixpanelNotification.prototype._get_notification_display_el = function () {\n  return this._get_el(this.notif_type);\n};\n\nMixpanelNotification.prototype._get_shown_campaigns = function () {\n  return this.persistence['props'][CAMPAIGN_IDS_KEY] || (this.persistence['props'][CAMPAIGN_IDS_KEY] = {});\n};\n\nMixpanelNotification.prototype._matches_event_data = _.safewrap(function (event_data) {\n  var event_name = event_data['event'] || '';\n\n  for (var i = 0; i < this.display_triggers.length; i++) {\n    var display_trigger = this.display_triggers[i];\n    var match_event = display_trigger['event'] || '';\n\n    if (match_event === '$any_event' || event_name === display_trigger['event']) {\n      if (display_trigger['selector'] && !_.isEmptyObject(display_trigger['selector'])) {\n        if (evaluateSelector(display_trigger['selector'], event_data['properties'])) {\n          return true;\n        }\n      } else {\n        return true;\n      }\n    }\n  }\n\n  return false;\n});\n\nMixpanelNotification.prototype._browser_lte = function (browser, version) {\n  return this.browser_versions[browser] && this.browser_versions[browser] <= version;\n};\n\nMixpanelNotification.prototype._init_image_html = function () {\n  var imgs_to_preload = [];\n\n  if (!this.mini) {\n    if (this.image_url) {\n      imgs_to_preload.push(this.image_url);\n      this.img_html = '<img id=\"img\" src=\"' + this.image_url + '\"/>';\n    } else {\n      this.img_html = '';\n    }\n\n    if (this.thumb_image_url) {\n      imgs_to_preload.push(this.thumb_image_url);\n      this.thumb_img_html = '<div id=\"thumbborder-wrapper\"><div id=\"thumbborder\"></div></div>' + '<img id=\"thumbnail\"' + ' src=\"' + this.thumb_image_url + '\"' + ' width=\"' + MixpanelNotification.THUMB_IMG_SIZE + '\"' + ' height=\"' + MixpanelNotification.THUMB_IMG_SIZE + '\"' + '/>' + '<div id=\"thumbspacer\"></div>';\n    } else {\n      this.thumb_img_html = '';\n    }\n  } else {\n    this.thumb_image_url = this.thumb_image_url || this.cdn_host + '/site_media/images/icons/notifications/mini-news-dark.png';\n    imgs_to_preload.push(this.thumb_image_url);\n  }\n\n  return imgs_to_preload;\n};\n\nMixpanelNotification.prototype._init_notification_el = function () {\n  var notification_html = '';\n  var video_src = '';\n  var video_html = '';\n  var cancel_html = '<div id=\"cancel\">' + '<div id=\"cancel-icon\"></div>' + '</div>';\n  this.notification_el = document.createElement('div');\n  this.notification_el.id = MixpanelNotification.MARKUP_PREFIX + '-wrapper';\n\n  if (!this.mini) {\n    // TAKEOVER notification\n    var close_html = this.clickthrough || this.show_video ? '' : '<div id=\"button-close\"></div>',\n        play_html = this.show_video ? '<div id=\"button-play\"></div>' : '';\n\n    if (this._browser_lte('ie', 7)) {\n      close_html = '';\n      play_html = '';\n    }\n\n    notification_html = '<div id=\"takeover\">' + this.thumb_img_html + '<div id=\"mainbox\">' + cancel_html + '<div id=\"content\">' + this.img_html + '<div id=\"title\">' + this.title + '</div>' + '<div id=\"body\">' + this.body + '</div>' + '<div id=\"tagline\">' + '<a href=\"http://mixpanel.com?from=inapp\" target=\"_blank\">POWERED BY MIXPANEL</a>' + '</div>' + '</div>' + '<div id=\"button\">' + close_html + '<a id=\"button-link\" href=\"' + this.dest_url + '\">' + this.cta + '</a>' + play_html + '</div>' + '</div>' + '</div>';\n  } else {\n    // MINI notification\n    notification_html = '<div id=\"mini\">' + '<div id=\"mainbox\">' + cancel_html + '<div id=\"mini-content\">' + '<div id=\"mini-icon\">' + '<div id=\"mini-icon-img\"></div>' + '</div>' + '<div id=\"body\">' + '<div id=\"body-text\"><div>' + this.body + '</div></div>' + '</div>' + '</div>' + '</div>' + '<div id=\"mini-border\"></div>' + '</div>';\n  }\n\n  if (this.youtube_video) {\n    video_src = this.resource_protocol + 'www.youtube.com/embed/' + this.youtube_video + '?wmode=transparent&showinfo=0&modestbranding=0&rel=0&autoplay=1&loop=0&vq=hd1080';\n\n    if (this.yt_custom) {\n      video_src += '&enablejsapi=1&html5=1&controls=0';\n      video_html = '<div id=\"video-controls\">' + '<div id=\"video-progress\" class=\"video-progress-el\">' + '<div id=\"video-progress-total\" class=\"video-progress-el\"></div>' + '<div id=\"video-elapsed\" class=\"video-progress-el\"></div>' + '</div>' + '<div id=\"video-time\" class=\"video-progress-el\"></div>' + '</div>';\n    }\n  } else if (this.vimeo_video) {\n    video_src = this.resource_protocol + 'player.vimeo.com/video/' + this.vimeo_video + '?autoplay=1&title=0&byline=0&portrait=0';\n  }\n\n  if (this.show_video) {\n    this.video_iframe = '<iframe id=\"' + MixpanelNotification.MARKUP_PREFIX + '-video-frame\" ' + 'width=\"' + this.video_width + '\" height=\"' + this.video_height + '\" ' + ' src=\"' + video_src + '\"' + ' frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen=\"1\" scrolling=\"no\"' + '></iframe>';\n    video_html = '<div id=\"video-' + (this.flip_animate ? '' : 'no') + 'flip\">' + '<div id=\"video\">' + '<div id=\"video-holder\"></div>' + video_html + '</div>' + '</div>';\n  }\n\n  var main_html = video_html + notification_html;\n\n  if (this.flip_animate) {\n    main_html = (this.mini ? notification_html : '') + '<div id=\"flipcontainer\"><div id=\"flipper\">' + (this.mini ? video_html : main_html) + '</div></div>';\n  }\n\n  this.notification_el.innerHTML = ('<div id=\"overlay\" class=\"' + this.notif_type + '\">' + '<div id=\"campaignid-' + this.campaign_id + '\">' + '<div id=\"bgwrapper\">' + '<div id=\"bg\"></div>' + main_html + '</div>' + '</div>' + '</div>').replace(/class=\"/g, 'class=\"' + MixpanelNotification.MARKUP_PREFIX + '-').replace(/id=\"/g, 'id=\"' + MixpanelNotification.MARKUP_PREFIX + '-');\n};\n\nMixpanelNotification.prototype._init_styles = function () {\n  if (this.style === 'dark') {\n    this.style_vals = {\n      bg: '#1d1f25',\n      bg_actions: '#282b32',\n      bg_hover: '#3a4147',\n      bg_light: '#4a5157',\n      border_gray: '#32353c',\n      cancel_opacity: '0.4',\n      mini_hover: '#2a3137',\n      text_title: '#fff',\n      text_main: '#9498a3',\n      text_tagline: '#464851',\n      text_hover: '#ddd'\n    };\n  } else {\n    this.style_vals = {\n      bg: '#fff',\n      bg_actions: '#e7eaee',\n      bg_hover: '#eceff3',\n      bg_light: '#f5f5f5',\n      border_gray: '#e4ecf2',\n      cancel_opacity: '1.0',\n      mini_hover: '#fafafa',\n      text_title: '#5c6578',\n      text_main: '#8b949b',\n      text_tagline: '#ced9e6',\n      text_hover: '#7c8598'\n    };\n  }\n\n  var shadow = '0px 0px 35px 0px rgba(45, 49, 56, 0.7)',\n      video_shadow = shadow,\n      mini_shadow = shadow,\n      thumb_total_size = MixpanelNotification.THUMB_IMG_SIZE + MixpanelNotification.THUMB_BORDER_SIZE * 2,\n      anim_seconds = MixpanelNotification.ANIM_TIME / 1000 + 's';\n\n  if (this.mini) {\n    shadow = 'none';\n  } // don't display on small viewports\n\n\n  var notif_media_queries = {},\n      min_width = MixpanelNotification.NOTIF_WIDTH_MINI + 20;\n  notif_media_queries['@media only screen and (max-width: ' + (min_width - 1) + 'px)'] = {\n    '#overlay': {\n      'display': 'none'\n    }\n  };\n  var notif_styles = {\n    '.flipped': {\n      'transform': 'rotateY(180deg)'\n    },\n    '#overlay': {\n      'position': 'fixed',\n      'top': '0',\n      'left': '0',\n      'width': '100%',\n      'height': '100%',\n      'overflow': 'auto',\n      'text-align': 'center',\n      'z-index': '10000',\n      'font-family': '\"Helvetica\", \"Arial\", sans-serif',\n      '-webkit-font-smoothing': 'antialiased',\n      '-moz-osx-font-smoothing': 'grayscale'\n    },\n    '#overlay.mini': {\n      'height': '0',\n      'overflow': 'visible'\n    },\n    '#overlay a': {\n      'width': 'initial',\n      'padding': '0',\n      'text-decoration': 'none',\n      'text-transform': 'none',\n      'color': 'inherit'\n    },\n    '#bgwrapper': {\n      'position': 'relative',\n      'width': '100%',\n      'height': '100%'\n    },\n    '#bg': {\n      'position': 'fixed',\n      'top': '0',\n      'left': '0',\n      'width': '100%',\n      'height': '100%',\n      'min-width': this.doc_width * 4 + 'px',\n      'min-height': this.doc_height * 4 + 'px',\n      'background-color': 'black',\n      'opacity': '0.0',\n      '-ms-filter': 'progid:DXImageTransform.Microsoft.Alpha(Opacity=60)',\n      // IE8\n      'filter': 'alpha(opacity=60)',\n      // IE5-7\n      'transition': 'opacity ' + anim_seconds\n    },\n    '#bg.visible': {\n      'opacity': MixpanelNotification.BG_OPACITY\n    },\n    '.mini #bg': {\n      'width': '0',\n      'height': '0',\n      'min-width': '0'\n    },\n    '#flipcontainer': {\n      'perspective': '1000px',\n      'position': 'absolute',\n      'width': '100%'\n    },\n    '#flipper': {\n      'position': 'relative',\n      'transform-style': 'preserve-3d',\n      'transition': '0.3s'\n    },\n    '#takeover': {\n      'position': 'absolute',\n      'left': '50%',\n      'width': MixpanelNotification.NOTIF_WIDTH + 'px',\n      'margin-left': Math.round(-MixpanelNotification.NOTIF_WIDTH / 2) + 'px',\n      'backface-visibility': 'hidden',\n      'transform': 'rotateY(0deg)',\n      'opacity': '0.0',\n      'top': MixpanelNotification.NOTIF_START_TOP + 'px',\n      'transition': 'opacity ' + anim_seconds + ', top ' + anim_seconds\n    },\n    '#takeover.visible': {\n      'opacity': '1.0',\n      'top': MixpanelNotification.NOTIF_TOP + 'px'\n    },\n    '#takeover.exiting': {\n      'opacity': '0.0',\n      'top': MixpanelNotification.NOTIF_START_TOP + 'px'\n    },\n    '#thumbspacer': {\n      'height': MixpanelNotification.THUMB_OFFSET + 'px'\n    },\n    '#thumbborder-wrapper': {\n      'position': 'absolute',\n      'top': -MixpanelNotification.THUMB_BORDER_SIZE + 'px',\n      'left': MixpanelNotification.NOTIF_WIDTH / 2 - MixpanelNotification.THUMB_OFFSET - MixpanelNotification.THUMB_BORDER_SIZE + 'px',\n      'width': thumb_total_size + 'px',\n      'height': thumb_total_size / 2 + 'px',\n      'overflow': 'hidden'\n    },\n    '#thumbborder': {\n      'position': 'absolute',\n      'width': thumb_total_size + 'px',\n      'height': thumb_total_size + 'px',\n      'border-radius': thumb_total_size + 'px',\n      'background-color': this.style_vals.bg_actions,\n      'opacity': '0.5'\n    },\n    '#thumbnail': {\n      'position': 'absolute',\n      'top': '0px',\n      'left': MixpanelNotification.NOTIF_WIDTH / 2 - MixpanelNotification.THUMB_OFFSET + 'px',\n      'width': MixpanelNotification.THUMB_IMG_SIZE + 'px',\n      'height': MixpanelNotification.THUMB_IMG_SIZE + 'px',\n      'overflow': 'hidden',\n      'z-index': '100',\n      'border-radius': MixpanelNotification.THUMB_IMG_SIZE + 'px'\n    },\n    '#mini': {\n      'position': 'absolute',\n      'right': '20px',\n      'top': MixpanelNotification.NOTIF_TOP + 'px',\n      'width': this.notif_width + 'px',\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI * 2 + 'px',\n      'margin-top': 20 - MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'backface-visibility': 'hidden',\n      'opacity': '0.0',\n      'transform': 'rotateX(90deg)',\n      'transition': 'opacity 0.3s, transform 0.3s, right 0.3s'\n    },\n    '#mini.visible': {\n      'opacity': '1.0',\n      'transform': 'rotateX(0deg)'\n    },\n    '#mini.exiting': {\n      'opacity': '0.0',\n      'right': '-150px'\n    },\n    '#mainbox': {\n      'border-radius': '4px',\n      'box-shadow': shadow,\n      'text-align': 'center',\n      'background-color': this.style_vals.bg,\n      'font-size': '14px',\n      'color': this.style_vals.text_main\n    },\n    '#mini #mainbox': {\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'margin-top': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'border-radius': '3px',\n      'transition': 'background-color ' + anim_seconds\n    },\n    '#mini-border': {\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 6 + 'px',\n      'width': MixpanelNotification.NOTIF_WIDTH_MINI + 6 + 'px',\n      'position': 'absolute',\n      'top': '-3px',\n      'left': '-3px',\n      'margin-top': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'border-radius': '6px',\n      'opacity': '0.25',\n      'background-color': '#fff',\n      'z-index': '-1',\n      'box-shadow': mini_shadow\n    },\n    '#mini-icon': {\n      'position': 'relative',\n      'display': 'inline-block',\n      'width': '75px',\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'border-radius': '3px 0 0 3px',\n      'background-color': this.style_vals.bg_actions,\n      'background': 'linear-gradient(135deg, ' + this.style_vals.bg_light + ' 0%, ' + this.style_vals.bg_actions + ' 100%)',\n      'transition': 'background-color ' + anim_seconds\n    },\n    '#mini:hover #mini-icon': {\n      'background-color': this.style_vals.mini_hover\n    },\n    '#mini:hover #mainbox': {\n      'background-color': this.style_vals.mini_hover\n    },\n    '#mini-icon-img': {\n      'position': 'absolute',\n      'background-image': 'url(' + this.thumb_image_url + ')',\n      'width': '48px',\n      'height': '48px',\n      'top': '20px',\n      'left': '12px'\n    },\n    '#content': {\n      'padding': '30px 20px 0px 20px'\n    },\n    '#mini-content': {\n      'text-align': 'left',\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'cursor': 'pointer'\n    },\n    '#img': {\n      'width': '328px',\n      'margin-top': '30px',\n      'border-radius': '5px'\n    },\n    '#title': {\n      'max-height': '600px',\n      'overflow': 'hidden',\n      'word-wrap': 'break-word',\n      'padding': '25px 0px 20px 0px',\n      'font-size': '19px',\n      'font-weight': 'bold',\n      'color': this.style_vals.text_title\n    },\n    '#body': {\n      'max-height': '600px',\n      'margin-bottom': '25px',\n      'overflow': 'hidden',\n      'word-wrap': 'break-word',\n      'line-height': '21px',\n      'font-size': '15px',\n      'font-weight': 'normal',\n      'text-align': 'left'\n    },\n    '#mini #body': {\n      'display': 'inline-block',\n      'max-width': '250px',\n      'margin': '0 0 0 30px',\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n      'font-size': '16px',\n      'letter-spacing': '0.8px',\n      'color': this.style_vals.text_title\n    },\n    '#mini #body-text': {\n      'display': 'table',\n      'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px'\n    },\n    '#mini #body-text div': {\n      'display': 'table-cell',\n      'vertical-align': 'middle'\n    },\n    '#tagline': {\n      'margin-bottom': '15px',\n      'font-size': '10px',\n      'font-weight': '600',\n      'letter-spacing': '0.8px',\n      'color': '#ccd7e0',\n      'text-align': 'left'\n    },\n    '#tagline a': {\n      'color': this.style_vals.text_tagline,\n      'transition': 'color ' + anim_seconds\n    },\n    '#tagline a:hover': {\n      'color': this.style_vals.text_hover\n    },\n    '#cancel': {\n      'position': 'absolute',\n      'right': '0',\n      'width': '8px',\n      'height': '8px',\n      'padding': '10px',\n      'border-radius': '20px',\n      'margin': '12px 12px 0 0',\n      'box-sizing': 'content-box',\n      'cursor': 'pointer',\n      'transition': 'background-color ' + anim_seconds\n    },\n    '#mini #cancel': {\n      'margin': '7px 7px 0 0'\n    },\n    '#cancel-icon': {\n      'width': '8px',\n      'height': '8px',\n      'overflow': 'hidden',\n      'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/cancel-x.png)',\n      'opacity': this.style_vals.cancel_opacity\n    },\n    '#cancel:hover': {\n      'background-color': this.style_vals.bg_hover\n    },\n    '#button': {\n      'display': 'block',\n      'height': '60px',\n      'line-height': '60px',\n      'text-align': 'center',\n      'background-color': this.style_vals.bg_actions,\n      'border-radius': '0 0 4px 4px',\n      'overflow': 'hidden',\n      'cursor': 'pointer',\n      'transition': 'background-color ' + anim_seconds\n    },\n    '#button-close': {\n      'display': 'inline-block',\n      'width': '9px',\n      'height': '60px',\n      'margin-right': '8px',\n      'vertical-align': 'top',\n      'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/close-x-' + this.style + '.png)',\n      'background-repeat': 'no-repeat',\n      'background-position': '0px 25px'\n    },\n    '#button-play': {\n      'display': 'inline-block',\n      'width': '30px',\n      'height': '60px',\n      'margin-left': '15px',\n      'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/play-' + this.style + '-small.png)',\n      'background-repeat': 'no-repeat',\n      'background-position': '0px 15px'\n    },\n    'a#button-link': {\n      'display': 'inline-block',\n      'vertical-align': 'top',\n      'text-align': 'center',\n      'font-size': '17px',\n      'font-weight': 'bold',\n      'overflow': 'hidden',\n      'word-wrap': 'break-word',\n      'color': this.style_vals.text_title,\n      'transition': 'color ' + anim_seconds\n    },\n    '#button:hover': {\n      'background-color': this.style_vals.bg_hover,\n      'color': this.style_vals.text_hover\n    },\n    '#button:hover a': {\n      'color': this.style_vals.text_hover\n    },\n    '#video-noflip': {\n      'position': 'relative',\n      'top': -this.video_height * 2 + 'px'\n    },\n    '#video-flip': {\n      'backface-visibility': 'hidden',\n      'transform': 'rotateY(180deg)'\n    },\n    '#video': {\n      'position': 'absolute',\n      'width': this.video_width - 1 + 'px',\n      'height': this.video_height + 'px',\n      'top': MixpanelNotification.NOTIF_TOP + 'px',\n      'margin-top': '100px',\n      'left': '50%',\n      'margin-left': Math.round(-this.video_width / 2) + 'px',\n      'overflow': 'hidden',\n      'border-radius': '5px',\n      'box-shadow': video_shadow,\n      'transform': 'translateZ(1px)',\n      // webkit rendering bug http://stackoverflow.com/questions/18167981/clickable-link-area-unexpectedly-smaller-after-css-transform\n      'transition': 'opacity ' + anim_seconds + ', top ' + anim_seconds\n    },\n    '#video.exiting': {\n      'opacity': '0.0',\n      'top': this.video_height + 'px'\n    },\n    '#video-holder': {\n      'position': 'absolute',\n      'width': this.video_width - 1 + 'px',\n      'height': this.video_height + 'px',\n      'overflow': 'hidden',\n      'border-radius': '5px'\n    },\n    '#video-frame': {\n      'margin-left': '-1px',\n      'width': this.video_width + 'px'\n    },\n    '#video-controls': {\n      'opacity': '0',\n      'transition': 'opacity 0.5s'\n    },\n    '#video:hover #video-controls': {\n      'opacity': '1.0'\n    },\n    '#video .video-progress-el': {\n      'position': 'absolute',\n      'bottom': '0',\n      'height': '25px',\n      'border-radius': '0 0 0 5px'\n    },\n    '#video-progress': {\n      'width': '90%'\n    },\n    '#video-progress-total': {\n      'width': '100%',\n      'background-color': this.style_vals.bg,\n      'opacity': '0.7'\n    },\n    '#video-elapsed': {\n      'width': '0',\n      'background-color': '#6cb6f5',\n      'opacity': '0.9'\n    },\n    '#video #video-time': {\n      'width': '10%',\n      'right': '0',\n      'font-size': '11px',\n      'line-height': '25px',\n      'color': this.style_vals.text_main,\n      'background-color': '#666',\n      'border-radius': '0 0 5px 0'\n    }\n  }; // IE hacks\n\n  if (this._browser_lte('ie', 8)) {\n    _.extend(notif_styles, {\n      '* html #overlay': {\n        'position': 'absolute'\n      },\n      '* html #bg': {\n        'position': 'absolute'\n      },\n      'html, body': {\n        'height': '100%'\n      }\n    });\n  }\n\n  if (this._browser_lte('ie', 7)) {\n    _.extend(notif_styles, {\n      '#mini #body': {\n        'display': 'inline',\n        'zoom': '1',\n        'border': '1px solid ' + this.style_vals.bg_hover\n      },\n      '#mini #body-text': {\n        'padding': '20px'\n      },\n      '#mini #mini-icon': {\n        'display': 'none'\n      }\n    });\n  } // add vendor-prefixed style rules\n\n\n  var VENDOR_STYLES = ['backface-visibility', 'border-radius', 'box-shadow', 'opacity', 'perspective', 'transform', 'transform-style', 'transition'],\n      VENDOR_PREFIXES = ['khtml', 'moz', 'ms', 'o', 'webkit'];\n\n  for (var selector in notif_styles) {\n    for (var si = 0; si < VENDOR_STYLES.length; si++) {\n      var prop = VENDOR_STYLES[si];\n\n      if (prop in notif_styles[selector]) {\n        var val = notif_styles[selector][prop];\n\n        for (var pi = 0; pi < VENDOR_PREFIXES.length; pi++) {\n          notif_styles[selector]['-' + VENDOR_PREFIXES[pi] + '-' + prop] = val;\n        }\n      }\n    }\n  }\n\n  var inject_styles = function inject_styles(styles, media_queries) {\n    var create_style_text = function create_style_text(style_defs) {\n      var st = '';\n\n      for (var selector in style_defs) {\n        var mp_selector = selector.replace(/#/g, '#' + MixpanelNotification.MARKUP_PREFIX + '-').replace(/\\./g, '.' + MixpanelNotification.MARKUP_PREFIX + '-');\n        st += '\\n' + mp_selector + ' {';\n        var props = style_defs[selector];\n\n        for (var k in props) {\n          st += k + ':' + props[k] + ';';\n        }\n\n        st += '}';\n      }\n\n      return st;\n    };\n\n    var create_media_query_text = function create_media_query_text(mq_defs) {\n      var mqt = '';\n\n      for (var mq in mq_defs) {\n        mqt += '\\n' + mq + ' {' + create_style_text(mq_defs[mq]) + '\\n}';\n      }\n\n      return mqt;\n    };\n\n    var style_text = create_style_text(styles) + create_media_query_text(media_queries),\n        head_el = document.head || document.getElementsByTagName('head')[0] || document.documentElement,\n        style_el = document.createElement('style');\n    head_el.appendChild(style_el);\n    style_el.setAttribute('type', 'text/css');\n\n    if (style_el.styleSheet) {\n      // IE\n      style_el.styleSheet.cssText = style_text;\n    } else {\n      style_el.textContent = style_text;\n    }\n  };\n\n  inject_styles(notif_styles, notif_media_queries);\n};\n\nMixpanelNotification.prototype._init_video = _.safewrap(function () {\n  if (!this.video_url) {\n    return;\n  }\n\n  var self = this; // Youtube iframe API compatibility\n\n  self.yt_custom = 'postMessage' in window;\n  self.dest_url = self.video_url;\n  var youtube_match = self.video_url.match( // http://stackoverflow.com/questions/2936467/parse-youtube-video-id-using-preg-match\n  /(?:youtube(?:-nocookie)?\\.com\\/(?:[^/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?/ ]{11})/i),\n      vimeo_match = self.video_url.match(/vimeo\\.com\\/.*?(\\d+)/i);\n\n  if (youtube_match) {\n    self.show_video = true;\n    self.youtube_video = youtube_match[1];\n\n    if (self.yt_custom) {\n      window['onYouTubeIframeAPIReady'] = function () {\n        if (self._get_el('video-frame')) {\n          self._yt_video_ready();\n        }\n      }; // load Youtube iframe API; see https://developers.google.com/youtube/iframe_api_reference\n\n\n      var tag = document.createElement('script');\n      tag.src = self.resource_protocol + 'www.youtube.com/iframe_api';\n      var firstScriptTag = document.getElementsByTagName('script')[0];\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    }\n  } else if (vimeo_match) {\n    self.show_video = true;\n    self.vimeo_video = vimeo_match[1];\n  } // IE <= 7, FF <= 3: fall through to video link rather than embedded player\n\n\n  if (self._browser_lte('ie', 7) || self._browser_lte('firefox', 3)) {\n    self.show_video = false;\n    self.clickthrough = true;\n  }\n});\nMixpanelNotification.prototype._mark_as_shown = _.safewrap(function () {\n  // click on background to dismiss\n  var self = this;\n\n  _.register_event(self._get_el('bg'), 'click', function () {\n    self.dismiss();\n  });\n\n  var get_style = function get_style(el, style_name) {\n    var styles = {};\n\n    if (document.defaultView && document.defaultView.getComputedStyle) {\n      styles = document.defaultView.getComputedStyle(el, null); // FF3 requires both args\n    } else if (el.currentStyle) {\n      // IE\n      styles = el.currentStyle;\n    }\n\n    return styles[style_name];\n  };\n\n  if (this.campaign_id) {\n    var notif_el = this._get_el('overlay');\n\n    if (notif_el && get_style(notif_el, 'visibility') !== 'hidden' && get_style(notif_el, 'display') !== 'none') {\n      this._mark_delivery();\n    }\n  }\n});\nMixpanelNotification.prototype._mark_delivery = _.safewrap(function (extra_props) {\n  if (!this.marked_as_shown) {\n    this.marked_as_shown = true;\n\n    if (this.campaign_id) {\n      // mark notification shown (local cache)\n      this._get_shown_campaigns()[this.campaign_id] = 1 * new Date();\n      this.persistence.save();\n    } // track delivery\n\n\n    this._track_event('$campaign_delivery', extra_props); // mark notification shown (mixpanel property)\n\n\n    this.mixpanel['people']['append']({\n      '$campaigns': this.campaign_id,\n      '$notifications': {\n        'campaign_id': this.campaign_id,\n        'message_id': this.message_id,\n        'type': 'web',\n        'time': new Date()\n      }\n    });\n  }\n});\n\nMixpanelNotification.prototype._preload_images = function (all_loaded_cb) {\n  var self = this;\n\n  if (this.imgs_to_preload.length === 0) {\n    all_loaded_cb();\n    return;\n  }\n\n  var preloaded_imgs = 0;\n  var img_objs = [];\n\n  var onload = function onload() {\n    preloaded_imgs++;\n\n    if (preloaded_imgs === self.imgs_to_preload.length && all_loaded_cb) {\n      all_loaded_cb();\n      all_loaded_cb = null;\n    }\n  };\n\n  for (var i = 0; i < this.imgs_to_preload.length; i++) {\n    var img = new Image();\n    img.onload = onload;\n    img.src = this.imgs_to_preload[i];\n\n    if (img.complete) {\n      onload();\n    }\n\n    img_objs.push(img);\n  } // IE6/7 doesn't fire onload reliably\n\n\n  if (this._browser_lte('ie', 7)) {\n    setTimeout(function () {\n      var imgs_loaded = true;\n\n      for (i = 0; i < img_objs.length; i++) {\n        if (!img_objs[i].complete) {\n          imgs_loaded = false;\n        }\n      }\n\n      if (imgs_loaded && all_loaded_cb) {\n        all_loaded_cb();\n        all_loaded_cb = null;\n      }\n    }, 500);\n  }\n};\n\nMixpanelNotification.prototype._remove_notification_el = _.safewrap(function () {\n  window.clearInterval(this._video_progress_checker);\n  this.notification_el.style.visibility = 'hidden';\n  this.body_el.removeChild(this.notification_el);\n});\n\nMixpanelNotification.prototype._set_client_config = function () {\n  var get_browser_version = function get_browser_version(browser_ex) {\n    var match = navigator.userAgent.match(browser_ex);\n    return match && match[1];\n  };\n\n  this.browser_versions = {};\n  this.browser_versions['chrome'] = get_browser_version(/Chrome\\/(\\d+)/);\n  this.browser_versions['firefox'] = get_browser_version(/Firefox\\/(\\d+)/);\n  this.browser_versions['ie'] = get_browser_version(/MSIE (\\d+).+/);\n\n  if (!this.browser_versions['ie'] && !window.ActiveXObject && 'ActiveXObject' in window) {\n    this.browser_versions['ie'] = 11;\n  }\n\n  this.body_el = document.body || document.getElementsByTagName('body')[0];\n\n  if (this.body_el) {\n    this.doc_width = Math.max(this.body_el.scrollWidth, document.documentElement.scrollWidth, this.body_el.offsetWidth, document.documentElement.offsetWidth, this.body_el.clientWidth, document.documentElement.clientWidth);\n    this.doc_height = Math.max(this.body_el.scrollHeight, document.documentElement.scrollHeight, this.body_el.offsetHeight, document.documentElement.offsetHeight, this.body_el.clientHeight, document.documentElement.clientHeight);\n  } // detect CSS compatibility\n\n\n  var ie_ver = this.browser_versions['ie'];\n\n  var sample_styles = document.createElement('div').style,\n      is_css_compatible = function is_css_compatible(rule) {\n    if (rule in sample_styles) {\n      return true;\n    }\n\n    if (!ie_ver) {\n      rule = rule[0].toUpperCase() + rule.slice(1);\n      var props = ['O' + rule, 'Webkit' + rule, 'Moz' + rule];\n\n      for (var i = 0; i < props.length; i++) {\n        if (props[i] in sample_styles) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  this.use_transitions = this.body_el && is_css_compatible('transition') && is_css_compatible('transform');\n  this.flip_animate = (this.browser_versions['chrome'] >= 33 || this.browser_versions['firefox'] >= 15) && this.body_el && is_css_compatible('backfaceVisibility') && is_css_compatible('perspective') && is_css_compatible('transform');\n};\n\nMixpanelNotification.prototype._switch_to_video = _.safewrap(function () {\n  var self = this,\n      anims = [{\n    el: self._get_notification_display_el(),\n    attr: 'opacity',\n    start: 1.0,\n    goal: 0.0\n  }, {\n    el: self._get_notification_display_el(),\n    attr: 'top',\n    start: MixpanelNotification.NOTIF_TOP,\n    goal: -500\n  }, {\n    el: self._get_el('video-noflip'),\n    attr: 'opacity',\n    start: 0.0,\n    goal: 1.0\n  }, {\n    el: self._get_el('video-noflip'),\n    attr: 'top',\n    start: -self.video_height * 2,\n    goal: 0\n  }];\n\n  if (self.mini) {\n    var bg = self._get_el('bg'),\n        overlay = self._get_el('overlay');\n\n    bg.style.width = '100%';\n    bg.style.height = '100%';\n    overlay.style.width = '100%';\n\n    self._add_class(self._get_notification_display_el(), 'exiting');\n\n    self._add_class(bg, 'visible');\n\n    anims.push({\n      el: self._get_el('bg'),\n      attr: 'opacity',\n      start: 0.0,\n      goal: MixpanelNotification.BG_OPACITY\n    });\n  }\n\n  var video_el = self._get_el('video-holder');\n\n  video_el.innerHTML = self.video_iframe;\n\n  var video_ready = function video_ready() {\n    if (window['YT'] && window['YT']['loaded']) {\n      self._yt_video_ready();\n    }\n\n    self.showing_video = true;\n    self._get_notification_display_el().style.visibility = 'hidden';\n  };\n\n  if (self.flip_animate) {\n    self._add_class('flipper', 'flipped');\n\n    setTimeout(video_ready, MixpanelNotification.ANIM_TIME);\n  } else {\n    self._animate_els(anims, MixpanelNotification.ANIM_TIME, video_ready);\n  }\n});\n\nMixpanelNotification.prototype._track_event = function (event_name, properties, cb) {\n  if (this.campaign_id) {\n    properties = properties || {};\n    properties = _.extend(properties, {\n      'campaign_id': this.campaign_id,\n      'message_id': this.message_id,\n      'message_type': 'web_inapp',\n      'message_subtype': this.notif_type\n    });\n    this.mixpanel['track'](event_name, properties, cb);\n  } else if (cb) {\n    cb.call();\n  }\n};\n\nMixpanelNotification.prototype._yt_video_ready = _.safewrap(function () {\n  var self = this;\n\n  if (self.video_inited) {\n    return;\n  }\n\n  self.video_inited = true;\n\n  var progress_bar = self._get_el('video-elapsed'),\n      progress_time = self._get_el('video-time'),\n      progress_el = self._get_el('video-progress');\n\n  new window['YT']['Player'](MixpanelNotification.MARKUP_PREFIX + '-video-frame', {\n    'events': {\n      'onReady': function onReady(event) {\n        var ytplayer = event['target'],\n            video_duration = ytplayer['getDuration'](),\n            pad = function pad(i) {\n          return ('00' + i).slice(-2);\n        },\n            update_video_time = function update_video_time(current_time) {\n          var secs = Math.round(video_duration - current_time),\n              mins = Math.floor(secs / 60),\n              hours = Math.floor(mins / 60);\n          secs -= mins * 60;\n          mins -= hours * 60;\n          progress_time.innerHTML = '-' + (hours ? hours + ':' : '') + pad(mins) + ':' + pad(secs);\n        };\n\n        update_video_time(0);\n        self._video_progress_checker = window.setInterval(function () {\n          var current_time = ytplayer['getCurrentTime']();\n          progress_bar.style.width = current_time / video_duration * 100 + '%';\n          update_video_time(current_time);\n        }, 250);\n\n        _.register_event(progress_el, 'click', function (e) {\n          var clickx = Math.max(0, e.pageX - progress_el.getBoundingClientRect().left);\n          ytplayer['seekTo'](video_duration * clickx / progress_el.clientWidth, true);\n        });\n      }\n    }\n  });\n});\n/**\n * Mixpanel People Object\n * @constructor\n */\n\nvar MixpanelPeople = function MixpanelPeople() {};\n\n_.extend(MixpanelPeople.prototype, apiActions);\n\nMixpanelPeople.prototype._init = function (mixpanel_instance) {\n  this._mixpanel = mixpanel_instance;\n};\n/*\n* Set properties on a user record.\n*\n* ### Usage:\n*\n*     mixpanel.people.set('gender', 'm');\n*\n*     // or set multiple properties at once\n*     mixpanel.people.set({\n*         'Company': 'Acme',\n*         'Plan': 'Premium',\n*         'Upgrade date': new Date()\n*     });\n*     // properties can be strings, integers, dates, or lists\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [to] A value to set on the given property name\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\n\nMixpanelPeople.prototype.set = addOptOutCheckMixpanelPeople(function (prop, to, callback) {\n  var data = this.set_action(prop, to);\n\n  if (_.isObject(prop)) {\n    callback = to;\n  } // make sure that the referrer info has been updated and saved\n\n\n  if (this._get_config('save_referrer')) {\n    this._mixpanel['persistence'].update_referrer_info(document.referrer);\n  } // update $set object with default people properties\n\n\n  data[SET_ACTION] = _.extend({}, _.info.people_properties(), this._mixpanel['persistence'].get_referrer_info(), data[SET_ACTION]);\n  return this._send_request(data, callback);\n});\n/*\n* Set properties on a user record, only if they do not yet exist.\n* This will not overwrite previous people property values, unlike\n* people.set().\n*\n* ### Usage:\n*\n*     mixpanel.people.set_once('First Login Date', new Date());\n*\n*     // or set multiple properties at once\n*     mixpanel.people.set_once({\n*         'First Login Date': new Date(),\n*         'Starting Plan': 'Premium'\n*     });\n*\n*     // properties can be strings, integers or dates\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [to] A value to set on the given property name\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.set_once = addOptOutCheckMixpanelPeople(function (prop, to, callback) {\n  var data = this.set_once_action(prop, to);\n\n  if (_.isObject(prop)) {\n    callback = to;\n  }\n\n  return this._send_request(data, callback);\n});\n/*\n* Unset properties on a user record (permanently removes the properties and their values from a profile).\n*\n* ### Usage:\n*\n*     mixpanel.people.unset('gender');\n*\n*     // or unset multiple properties at once\n*     mixpanel.people.unset(['gender', 'Company']);\n*\n* @param {Array|String} prop If a string, this is the name of the property. If an array, this is a list of property names.\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.unset = addOptOutCheckMixpanelPeople(function (prop, callback) {\n  var data = this.unset_action(prop);\n  return this._send_request(data, callback);\n});\n/*\n* Increment/decrement numeric people analytics properties.\n*\n* ### Usage:\n*\n*     mixpanel.people.increment('page_views', 1);\n*\n*     // or, for convenience, if you're just incrementing a counter by\n*     // 1, you can simply do\n*     mixpanel.people.increment('page_views');\n*\n*     // to decrement a counter, pass a negative number\n*     mixpanel.people.increment('credits_left', -1);\n*\n*     // like mixpanel.people.set(), you can increment multiple\n*     // properties at once:\n*     mixpanel.people.increment({\n*         counter1: 1,\n*         counter2: 6\n*     });\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and numeric values.\n* @param {Number} [by] An amount to increment the given property\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.increment = addOptOutCheckMixpanelPeople(function (prop, by, callback) {\n  var data = {};\n  var $add = {};\n\n  if (_.isObject(prop)) {\n    _.each(prop, function (v, k) {\n      if (!this._is_reserved_property(k)) {\n        if (isNaN(parseFloat(v))) {\n          console$1.error('Invalid increment value passed to mixpanel.people.increment - must be a number');\n          return;\n        } else {\n          $add[k] = v;\n        }\n      }\n    }, this);\n\n    callback = by;\n  } else {\n    // convenience: mixpanel.people.increment('property'); will\n    // increment 'property' by 1\n    if (_.isUndefined(by)) {\n      by = 1;\n    }\n\n    $add[prop] = by;\n  }\n\n  data[ADD_ACTION] = $add;\n  return this._send_request(data, callback);\n});\n/*\n* Append a value to a list-valued people analytics property.\n*\n* ### Usage:\n*\n*     // append a value to a list, creating it if needed\n*     mixpanel.people.append('pages_visited', 'homepage');\n*\n*     // like mixpanel.people.set(), you can append multiple\n*     // properties at once:\n*     mixpanel.people.append({\n*         list1: 'bob',\n*         list2: 123\n*     });\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] value An item to append to the list\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.append = addOptOutCheckMixpanelPeople(function (list_name, value, callback) {\n  if (_.isObject(list_name)) {\n    callback = value;\n  }\n\n  var data = this.append_action(list_name, value);\n  return this._send_request(data, callback);\n});\n/*\n* Remove a value from a list-valued people analytics property.\n*\n* ### Usage:\n*\n*     mixpanel.people.remove('School', 'UCB');\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] value Item to remove from the list\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.remove = addOptOutCheckMixpanelPeople(function (list_name, value, callback) {\n  if (_.isObject(list_name)) {\n    callback = value;\n  }\n\n  var data = this.remove_action(list_name, value);\n  return this._send_request(data, callback);\n});\n/*\n* Merge a given list with a list-valued people analytics property,\n* excluding duplicate values.\n*\n* ### Usage:\n*\n*     // merge a value to a list, creating it if needed\n*     mixpanel.people.union('pages_visited', 'homepage');\n*\n*     // like mixpanel.people.set(), you can append multiple\n*     // properties at once:\n*     mixpanel.people.union({\n*         list1: 'bob',\n*         list2: 123\n*     });\n*\n*     // like mixpanel.people.append(), you can append multiple\n*     // values to the same list:\n*     mixpanel.people.union({\n*         list1: ['bob', 'billy']\n*     });\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] Value / values to merge with the given property\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.union = addOptOutCheckMixpanelPeople(function (list_name, values, callback) {\n  if (_.isObject(list_name)) {\n    callback = values;\n  }\n\n  var data = this.union_action(list_name, values);\n  return this._send_request(data, callback);\n});\n/*\n* Record that you have charged the current user a certain amount\n* of money. Charges recorded with track_charge() will appear in the\n* Mixpanel revenue report.\n*\n* ### Usage:\n*\n*     // charge a user $50\n*     mixpanel.people.track_charge(50);\n*\n*     // charge a user $30.50 on the 2nd of january\n*     mixpanel.people.track_charge(30.50, {\n*         '$time': new Date('jan 1 2012')\n*     });\n*\n* @param {Number} amount The amount of money charged to the current user\n* @param {Object} [properties] An associative array of properties associated with the charge\n* @param {Function} [callback] If provided, the callback will be called when the server responds\n*/\n\nMixpanelPeople.prototype.track_charge = addOptOutCheckMixpanelPeople(function (amount, properties, callback) {\n  if (!_.isNumber(amount)) {\n    amount = parseFloat(amount);\n\n    if (isNaN(amount)) {\n      console$1.error('Invalid value passed to mixpanel.people.track_charge - must be a number');\n      return;\n    }\n  }\n\n  return this.append('$transactions', _.extend({\n    '$amount': amount\n  }, properties), callback);\n});\n/*\n* Permanently clear all revenue report transactions from the\n* current user's people analytics profile.\n*\n* ### Usage:\n*\n*     mixpanel.people.clear_charges();\n*\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\n\nMixpanelPeople.prototype.clear_charges = function (callback) {\n  return this.set('$transactions', [], callback);\n};\n/*\n* Permanently deletes the current people analytics profile from\n* Mixpanel (using the current distinct_id).\n*\n* ### Usage:\n*\n*     // remove the all data you have stored about the current user\n*     mixpanel.people.delete_user();\n*\n*/\n\n\nMixpanelPeople.prototype.delete_user = function () {\n  if (!this._identify_called()) {\n    console$1.error('mixpanel.people.delete_user() requires you to call identify() first');\n    return;\n  }\n\n  var data = {\n    '$delete': this._mixpanel.get_distinct_id()\n  };\n  return this._send_request(data);\n};\n\nMixpanelPeople.prototype.toString = function () {\n  return this._mixpanel.toString() + '.people';\n};\n\nMixpanelPeople.prototype._send_request = function (data, callback) {\n  data['$token'] = this._get_config('token');\n  data['$distinct_id'] = this._mixpanel.get_distinct_id();\n\n  var device_id = this._mixpanel.get_property('$device_id');\n\n  var user_id = this._mixpanel.get_property('$user_id');\n\n  var had_persisted_distinct_id = this._mixpanel.get_property('$had_persisted_distinct_id');\n\n  if (device_id) {\n    data['$device_id'] = device_id;\n  }\n\n  if (user_id) {\n    data['$user_id'] = user_id;\n  }\n\n  if (had_persisted_distinct_id) {\n    data['$had_persisted_distinct_id'] = had_persisted_distinct_id;\n  }\n\n  var date_encoded_data = _.encodeDates(data);\n\n  var truncated_data = _.truncate(date_encoded_data, 255);\n\n  var json_data = _.JSONEncode(date_encoded_data);\n\n  var encoded_data = _.base64Encode(json_data);\n\n  if (!this._identify_called()) {\n    this._enqueue(data);\n\n    if (!_.isUndefined(callback)) {\n      if (this._get_config('verbose')) {\n        callback({\n          status: -1,\n          error: null\n        });\n      } else {\n        callback(-1);\n      }\n    }\n\n    return truncated_data;\n  }\n\n  console$1.log('MIXPANEL PEOPLE REQUEST:');\n  console$1.log(truncated_data);\n\n  this._mixpanel._send_request(this._get_config('api_host') + '/engage/', {\n    'data': encoded_data\n  }, this._mixpanel._prepare_callback(callback, truncated_data));\n\n  return truncated_data;\n};\n\nMixpanelPeople.prototype._get_config = function (conf_var) {\n  return this._mixpanel.get_config(conf_var);\n};\n\nMixpanelPeople.prototype._identify_called = function () {\n  return this._mixpanel._flags.identify_called === true;\n}; // Queue up engage operations if identify hasn't been called yet.\n\n\nMixpanelPeople.prototype._enqueue = function (data) {\n  if (SET_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(SET_ACTION, data);\n  } else if (SET_ONCE_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(SET_ONCE_ACTION, data);\n  } else if (UNSET_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(UNSET_ACTION, data);\n  } else if (ADD_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(ADD_ACTION, data);\n  } else if (APPEND_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(APPEND_ACTION, data);\n  } else if (REMOVE_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(REMOVE_ACTION, data);\n  } else if (UNION_ACTION in data) {\n    this._mixpanel['persistence']._add_to_people_queue(UNION_ACTION, data);\n  } else {\n    console$1.error('Invalid call to _enqueue():', data);\n  }\n};\n\nMixpanelPeople.prototype._flush_one_queue = function (action, action_method, callback, queue_to_params_fn) {\n  var _this = this;\n\n  var queued_data = _.extend({}, this._mixpanel['persistence']._get_queue(action));\n\n  var action_params = queued_data;\n\n  if (!_.isUndefined(queued_data) && _.isObject(queued_data) && !_.isEmptyObject(queued_data)) {\n    _this._mixpanel['persistence']._pop_from_people_queue(action, queued_data);\n\n    if (queue_to_params_fn) {\n      action_params = queue_to_params_fn(queued_data);\n    }\n\n    action_method.call(_this, action_params, function (response, data) {\n      // on bad response, we want to add it back to the queue\n      if (response === 0) {\n        _this._mixpanel['persistence']._add_to_people_queue(action, queued_data);\n      }\n\n      if (!_.isUndefined(callback)) {\n        callback(response, data);\n      }\n    });\n  }\n}; // Flush queued engage operations - order does not matter,\n// and there are network level race conditions anyway\n\n\nMixpanelPeople.prototype._flush = function (_set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback) {\n  var _this = this;\n\n  var $append_queue = this._mixpanel['persistence']._get_queue(APPEND_ACTION);\n\n  var $remove_queue = this._mixpanel['persistence']._get_queue(REMOVE_ACTION);\n\n  this._flush_one_queue(SET_ACTION, this.set, _set_callback);\n\n  this._flush_one_queue(SET_ONCE_ACTION, this.set_once, _set_once_callback);\n\n  this._flush_one_queue(UNSET_ACTION, this.unset, _unset_callback, function (queue) {\n    return _.keys(queue);\n  });\n\n  this._flush_one_queue(ADD_ACTION, this.increment, _add_callback);\n\n  this._flush_one_queue(UNION_ACTION, this.union, _union_callback); // we have to fire off each $append individually since there is\n  // no concat method server side\n\n\n  if (!_.isUndefined($append_queue) && _.isArray($append_queue) && $append_queue.length) {\n    var $append_item;\n\n    var append_callback = function append_callback(response, data) {\n      if (response === 0) {\n        _this._mixpanel['persistence']._add_to_people_queue(APPEND_ACTION, $append_item);\n      }\n\n      if (!_.isUndefined(_append_callback)) {\n        _append_callback(response, data);\n      }\n    };\n\n    for (var i = $append_queue.length - 1; i >= 0; i--) {\n      $append_item = $append_queue.pop();\n\n      if (!_.isEmptyObject($append_item)) {\n        _this.append($append_item, append_callback);\n      }\n    } // Save the shortened append queue\n\n\n    _this._mixpanel['persistence'].save();\n  } // same for $remove\n\n\n  if (!_.isUndefined($remove_queue) && _.isArray($remove_queue) && $remove_queue.length) {\n    var $remove_item;\n\n    var remove_callback = function remove_callback(response, data) {\n      if (response === 0) {\n        _this._mixpanel['persistence']._add_to_people_queue(REMOVE_ACTION, $remove_item);\n      }\n\n      if (!_.isUndefined(_remove_callback)) {\n        _remove_callback(response, data);\n      }\n    };\n\n    for (var j = $remove_queue.length - 1; j >= 0; j--) {\n      $remove_item = $remove_queue.pop();\n\n      if (!_.isEmptyObject($remove_item)) {\n        _this.remove($remove_item, remove_callback);\n      }\n    }\n\n    _this._mixpanel['persistence'].save();\n  }\n};\n\nMixpanelPeople.prototype._is_reserved_property = function (prop) {\n  return prop === '$distinct_id' || prop === '$token' || prop === '$device_id' || prop === '$user_id' || prop === '$had_persisted_distinct_id';\n}; // MixpanelPeople Exports\n\n\nMixpanelPeople.prototype['set'] = MixpanelPeople.prototype.set;\nMixpanelPeople.prototype['set_once'] = MixpanelPeople.prototype.set_once;\nMixpanelPeople.prototype['unset'] = MixpanelPeople.prototype.unset;\nMixpanelPeople.prototype['increment'] = MixpanelPeople.prototype.increment;\nMixpanelPeople.prototype['append'] = MixpanelPeople.prototype.append;\nMixpanelPeople.prototype['remove'] = MixpanelPeople.prototype.remove;\nMixpanelPeople.prototype['union'] = MixpanelPeople.prototype.union;\nMixpanelPeople.prototype['track_charge'] = MixpanelPeople.prototype.track_charge;\nMixpanelPeople.prototype['clear_charges'] = MixpanelPeople.prototype.clear_charges;\nMixpanelPeople.prototype['delete_user'] = MixpanelPeople.prototype.delete_user;\nMixpanelPeople.prototype['toString'] = MixpanelPeople.prototype.toString;\n/*\n * Mixpanel JS Library\n *\n * Copyright 2012, Mixpanel, Inc. All Rights Reserved\n * http://mixpanel.com/\n *\n * Includes portions of Underscore.js\n * http://documentcloud.github.com/underscore/\n * (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n * Released under the MIT License.\n */\n// ==ClosureCompiler==\n// @compilation_level ADVANCED_OPTIMIZATIONS\n// @output_file_name mixpanel-2.8.min.js\n// ==/ClosureCompiler==\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x === public function\nthis._x === internal - only use within this file\nthis.__x === private - only use within the class\n\nGlobals should be all caps\n*/\n\nvar init_type; // MODULE or SNIPPET loader\n\nvar mixpanel_master; // main mixpanel instance / object\n\nvar INIT_MODULE = 0;\nvar INIT_SNIPPET = 1;\n/** @const */\n\nvar PRIMARY_INSTANCE_NAME = 'mixpanel';\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n// http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n// https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\n\nvar USE_XHR = window$1.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest(); // IE<10 does not support cross-origin XHR's but script tags\n// with defer won't block window.onload; ENQUEUE_REQUESTS\n// should only be true for Opera<12\n\nvar ENQUEUE_REQUESTS = !USE_XHR && userAgent.indexOf('MSIE') === -1 && userAgent.indexOf('Mozilla') === -1;\n/*\n * Module-level globals\n */\n\nvar DEFAULT_CONFIG = {\n  'api_host': 'https://api-js.mixpanel.com',\n  'api_method': 'POST',\n  'app_host': 'https://mixpanel.com',\n  'autotrack': true,\n  'cdn': 'https://cdn.mxpnl.com',\n  'cross_subdomain_cookie': true,\n  'persistence': 'cookie',\n  'persistence_name': '',\n  'cookie_name': '',\n  'loaded': function loaded() {},\n  'store_google': true,\n  'save_referrer': true,\n  'test': false,\n  'verbose': false,\n  'img': false,\n  'track_pageview': true,\n  'debug': false,\n  'track_links_timeout': 300,\n  'cookie_expiration': 365,\n  'upgrade': false,\n  'disable_persistence': false,\n  'disable_cookie': false,\n  'secure_cookie': false,\n  'ip': true,\n  'opt_out_tracking_by_default': false,\n  'opt_out_persistence_by_default': false,\n  'opt_out_tracking_persistence_type': 'localStorage',\n  'opt_out_tracking_cookie_prefix': null,\n  'property_blacklist': [],\n  'xhr_headers': {},\n  // { header: value, header2: value }\n  'inapp_protocol': '//',\n  'inapp_link_new_window': false\n};\nvar DOM_LOADED = false;\n/**\n * Mixpanel Library Object\n * @constructor\n */\n\nvar MixpanelLib = function MixpanelLib() {};\n/**\n * create_mplib(token:string, config:object, name:string)\n *\n * This function is used by the init method of MixpanelLib objects\n * as well as the main initializer at the end of the JSLib (that\n * initializes document.mixpanel as well as any additional instances\n * declared before this file has loaded).\n */\n\n\nvar create_mplib = function create_mplib(token, config, name) {\n  var instance,\n      target = name === PRIMARY_INSTANCE_NAME ? mixpanel_master : mixpanel_master[name];\n\n  if (target && init_type === INIT_MODULE) {\n    instance = target;\n  } else {\n    if (target && !_.isArray(target)) {\n      console$1.error('You have already initialized ' + name);\n      return;\n    }\n\n    instance = new MixpanelLib();\n  }\n\n  instance._cached_groups = {}; // cache groups in a pool\n\n  instance._user_decide_check_complete = false;\n  instance._events_tracked_before_user_decide_check_complete = [];\n\n  instance._init(token, config, name);\n\n  instance['people'] = new MixpanelPeople();\n\n  instance['people']._init(instance); // if any instance on the page has debug = true, we set the\n  // global debug to be true\n\n\n  Config.DEBUG = Config.DEBUG || instance.get_config('debug');\n  instance['__autotrack_enabled'] = instance.get_config('autotrack');\n\n  if (instance.get_config('autotrack')) {\n    var num_buckets = 100;\n    var num_enabled_buckets = 100;\n\n    if (!autotrack.enabledForProject(instance.get_config('token'), num_buckets, num_enabled_buckets)) {\n      instance['__autotrack_enabled'] = false;\n      console$1.log('Not in active bucket: disabling Automatic Event Collection.');\n    } else if (!autotrack.isBrowserSupported()) {\n      instance['__autotrack_enabled'] = false;\n      console$1.log('Disabling Automatic Event Collection because this browser is not supported');\n    } else {\n      autotrack.init(instance);\n    }\n  } // if target is not defined, we called init after the lib already\n  // loaded, so there won't be an array of things to execute\n\n\n  if (!_.isUndefined(target) && _.isArray(target)) {\n    // Crunch through the people queue first - we queue this data up &\n    // flush on identify, so it's better to do all these operations first\n    instance._execute_array.call(instance['people'], target['people']);\n\n    instance._execute_array(target);\n  }\n\n  return instance;\n}; // Initialization methods\n\n/**\n * This function initializes a new instance of the Mixpanel tracking object.\n * All new instances are added to the main mixpanel object as sub properties (such as\n * mixpanel.library_name) and also returned by this function. To define a\n * second instance on the page, you would call:\n *\n *     mixpanel.init('new token', { your: 'config' }, 'library_name');\n *\n * and use it like so:\n *\n *     mixpanel.library_name.track(...);\n *\n * @param {String} token   Your Mixpanel API token\n * @param {Object} [config]  A dictionary of config options to override. <a href=\"https://github.com/mixpanel/mixpanel-js/blob/8b2e1f7b/src/mixpanel-core.js#L87-L110\">See a list of default config options</a>.\n * @param {String} [name]    The name for the new mixpanel instance that you want created\n */\n\n\nMixpanelLib.prototype.init = function (token, config, name) {\n  if (_.isUndefined(name)) {\n    console$1.error('You must name your new library: init(token, config, name)');\n    return;\n  }\n\n  if (name === PRIMARY_INSTANCE_NAME) {\n    console$1.error('You must initialize the main mixpanel object right after you include the Mixpanel js snippet');\n    return;\n  }\n\n  var instance = create_mplib(token, config, name);\n  mixpanel_master[name] = instance;\n\n  instance._loaded();\n\n  return instance;\n}; // mixpanel._init(token:string, config:object, name:string)\n//\n// This function sets up the current instance of the mixpanel\n// library.  The difference between this method and the init(...)\n// method is this one initializes the actual instance, whereas the\n// init(...) method sets up a new library and calls _init on it.\n//\n\n\nMixpanelLib.prototype._init = function (token, config, name) {\n  this['__loaded'] = true;\n  this['config'] = {};\n  this['_triggered_notifs'] = [];\n  this.set_config(_.extend({}, DEFAULT_CONFIG, config, {\n    'name': name,\n    'token': token,\n    'callback_fn': (name === PRIMARY_INSTANCE_NAME ? name : PRIMARY_INSTANCE_NAME + '.' + name) + '._jsc'\n  }));\n\n  this['_jsc'] = function () {};\n\n  this.__dom_loaded_queue = [];\n  this.__request_queue = [];\n  this.__disabled_events = [];\n  this._flags = {\n    'disable_all_events': false,\n    'identify_called': false\n  };\n  this['persistence'] = this['cookie'] = new MixpanelPersistence(this['config']);\n\n  this._gdpr_init();\n\n  var uuid = _.UUID();\n\n  if (!this.get_distinct_id()) {\n    // There is no need to set the distinct id\n    // or the device id if something was already stored\n    // in the persitence\n    this.register_once({\n      'distinct_id': uuid,\n      '$device_id': uuid\n    }, '');\n  }\n}; // Private methods\n\n\nMixpanelLib.prototype._loaded = function () {\n  this.get_config('loaded')(this); // this happens after so a user can call identify/name_tag in\n  // the loaded callback\n\n  if (this.get_config('track_pageview')) {\n    this.track_pageview();\n  }\n};\n\nMixpanelLib.prototype._dom_loaded = function () {\n  _.each(this.__dom_loaded_queue, function (item) {\n    this._track_dom.apply(this, item);\n  }, this);\n\n  if (!this.has_opted_out_tracking()) {\n    _.each(this.__request_queue, function (item) {\n      this._send_request.apply(this, item);\n    }, this);\n  }\n\n  delete this.__dom_loaded_queue;\n  delete this.__request_queue;\n};\n\nMixpanelLib.prototype._track_dom = function (DomClass, args) {\n  if (this.get_config('img')) {\n    console$1.error('You can\\'t use DOM tracking functions with img = true.');\n    return false;\n  }\n\n  if (!DOM_LOADED) {\n    this.__dom_loaded_queue.push([DomClass, args]);\n\n    return false;\n  }\n\n  var dt = new DomClass().init(this);\n  return dt.track.apply(dt, args);\n};\n/**\n * _prepare_callback() should be called by callers of _send_request for use\n * as the callback argument.\n *\n * If there is no callback, this returns null.\n * If we are going to make XHR/XDR requests, this returns a function.\n * If we are going to use script tags, this returns a string to use as the\n * callback GET param.\n */\n\n\nMixpanelLib.prototype._prepare_callback = function (callback, data) {\n  if (_.isUndefined(callback)) {\n    return null;\n  }\n\n  if (USE_XHR) {\n    var callback_function = function callback_function(response) {\n      callback(response, data);\n    };\n\n    return callback_function;\n  } else {\n    // if the user gives us a callback, we store as a random\n    // property on this instances jsc function and update our\n    // callback string to reflect that.\n    var jsc = this['_jsc'];\n    var randomized_cb = '' + Math.floor(Math.random() * 100000000);\n    var callback_string = this.get_config('callback_fn') + '[' + randomized_cb + ']';\n\n    jsc[randomized_cb] = function (response) {\n      delete jsc[randomized_cb];\n      callback(response, data);\n    };\n\n    return callback_string;\n  }\n};\n\nMixpanelLib.prototype._send_request = function (url, data, options, callback) {\n  if (ENQUEUE_REQUESTS) {\n    this.__request_queue.push(arguments);\n\n    return;\n  }\n\n  var DEFAULT_OPTIONS = {\n    method: this.get_config('api_method')\n  };\n  var body_data = null;\n\n  if (!callback && (_.isFunction(options) || typeof options === 'string')) {\n    callback = options;\n    options = null;\n  }\n\n  options = _.extend(DEFAULT_OPTIONS, options || {});\n\n  if (!USE_XHR) {\n    options.method = 'GET';\n  }\n\n  var use_post = options.method === 'POST'; // needed to correctly format responses\n\n  var verbose_mode = this.get_config('verbose');\n\n  if (data['verbose']) {\n    verbose_mode = true;\n  }\n\n  if (this.get_config('test')) {\n    data['test'] = 1;\n  }\n\n  if (verbose_mode) {\n    data['verbose'] = 1;\n  }\n\n  if (this.get_config('img')) {\n    data['img'] = 1;\n  }\n\n  if (!USE_XHR) {\n    if (callback) {\n      data['callback'] = callback;\n    } else if (verbose_mode || this.get_config('test')) {\n      // Verbose output (from verbose mode, or an error in test mode) is a json blob,\n      // which by itself is not valid javascript. Without a callback, this verbose output will\n      // cause an error when returned via jsonp, so we force a no-op callback param.\n      // See the ECMA script spec: http://www.ecma-international.org/ecma-262/5.1/#sec-12.4\n      data['callback'] = '(function(){})';\n    }\n  }\n\n  data['ip'] = this.get_config('ip') ? 1 : 0;\n  data['_'] = new Date().getTime().toString();\n\n  if (use_post) {\n    body_data = 'data=' + data['data'];\n    delete data['data'];\n  }\n\n  url += '?' + _.HTTPBuildQuery(data);\n\n  if ('img' in data) {\n    var img = document$1.createElement('img');\n    img.src = url;\n    document$1.body.appendChild(img);\n  } else if (USE_XHR) {\n    try {\n      var req = new XMLHttpRequest();\n      req.open(options.method, url, true);\n      var headers = this.get_config('xhr_headers');\n\n      if (use_post) {\n        headers['Content-Type'] = 'application/x-www-form-urlencoded';\n      }\n\n      _.each(headers, function (headerValue, headerName) {\n        req.setRequestHeader(headerName, headerValue);\n      }); // send the mp_optout cookie\n      // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n\n\n      req.withCredentials = true;\n\n      req.onreadystatechange = function () {\n        if (req.readyState === 4) {\n          // XMLHttpRequest.DONE == 4, except in safari 4\n          if (req.status === 200) {\n            if (callback) {\n              if (verbose_mode) {\n                var response;\n\n                try {\n                  response = _.JSONDecode(req.responseText);\n                } catch (e) {\n                  console$1.error(e);\n                  return;\n                }\n\n                callback(response);\n              } else {\n                callback(Number(req.responseText));\n              }\n            }\n          } else {\n            var error = 'Bad HTTP status: ' + req.status + ' ' + req.statusText;\n            console$1.error(error);\n\n            if (callback) {\n              if (verbose_mode) {\n                callback({\n                  status: 0,\n                  error: error\n                });\n              } else {\n                callback(0);\n              }\n            }\n          }\n        }\n      };\n\n      req.send(body_data);\n    } catch (e) {\n      console$1.error(e);\n    }\n  } else {\n    var script = document$1.createElement('script');\n    script.type = 'text/javascript';\n    script.async = true;\n    script.defer = true;\n    script.src = url;\n    var s = document$1.getElementsByTagName('script')[0];\n    s.parentNode.insertBefore(script, s);\n  }\n};\n/**\n * _execute_array() deals with processing any mixpanel function\n * calls that were called before the Mixpanel library were loaded\n * (and are thus stored in an array so they can be called later)\n *\n * Note: we fire off all the mixpanel function calls && user defined\n * functions BEFORE we fire off mixpanel tracking calls. This is so\n * identify/register/set_config calls can properly modify early\n * tracking calls.\n *\n * @param {Array} array\n */\n\n\nMixpanelLib.prototype._execute_array = function (array) {\n  var fn_name,\n      alias_calls = [],\n      other_calls = [],\n      tracking_calls = [];\n\n  _.each(array, function (item) {\n    if (item) {\n      fn_name = item[0];\n\n      if (_.isArray(fn_name)) {\n        tracking_calls.push(item); // chained call e.g. mixpanel.get_group().set()\n      } else if (typeof item === 'function') {\n        item.call(this);\n      } else if (_.isArray(item) && fn_name === 'alias') {\n        alias_calls.push(item);\n      } else if (_.isArray(item) && fn_name.indexOf('track') !== -1 && typeof this[fn_name] === 'function') {\n        tracking_calls.push(item);\n      } else {\n        other_calls.push(item);\n      }\n    }\n  }, this);\n\n  var execute = function execute(calls, context) {\n    _.each(calls, function (item) {\n      if (_.isArray(item[0])) {\n        // chained call\n        var caller = context;\n\n        _.each(item, function (call) {\n          caller = caller[call[0]].apply(caller, call.slice(1));\n        });\n      } else {\n        this[item[0]].apply(this, item.slice(1));\n      }\n    }, context);\n  };\n\n  execute(alias_calls, this);\n  execute(other_calls, this);\n  execute(tracking_calls, this);\n};\n/**\n * push() keeps the standard async-array-push\n * behavior around after the lib is loaded.\n * This is only useful for external integrations that\n * do not wish to rely on our convenience methods\n * (created in the snippet).\n *\n * ### Usage:\n *     mixpanel.push(['register', { a: 'b' }]);\n *\n * @param {Array} item A [function_name, args...] array to be executed\n */\n\n\nMixpanelLib.prototype.push = function (item) {\n  this._execute_array([item]);\n};\n/**\n * Disable events on the Mixpanel object. If passed no arguments,\n * this function disables tracking of any event. If passed an\n * array of event names, those events will be disabled, but other\n * events will continue to be tracked.\n *\n * Note: this function does not stop other mixpanel functions from\n * firing, such as register() or people.set().\n *\n * @param {Array} [events] An array of event names to disable\n */\n\n\nMixpanelLib.prototype.disable = function (events) {\n  if (typeof events === 'undefined') {\n    this._flags.disable_all_events = true;\n  } else {\n    this.__disabled_events = this.__disabled_events.concat(events);\n  }\n};\n/**\n * Track an event. This is the most important and\n * frequently used Mixpanel function.\n *\n * ### Usage:\n *\n *     // track an event named 'Registered'\n *     mixpanel.track('Registered', {'Gender': 'Male', 'Age': 21});\n *\n * To track link clicks or form submissions, see track_links() or track_forms().\n *\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after tracking the event.\n */\n\n\nMixpanelLib.prototype.track = addOptOutCheckMixpanelLib(function (event_name, properties, callback) {\n  if (typeof callback !== 'function') {\n    callback = function callback() {};\n  }\n\n  if (_.isUndefined(event_name)) {\n    console$1.error('No event name provided to mixpanel.track');\n    return;\n  }\n\n  if (this._event_is_disabled(event_name)) {\n    callback(0);\n    return;\n  } // set defaults\n\n\n  properties = properties || {};\n  properties['token'] = this.get_config('token'); // set $duration if time_event was previously called for this event\n\n  var start_timestamp = this['persistence'].remove_event_timer(event_name);\n\n  if (!_.isUndefined(start_timestamp)) {\n    var duration_in_ms = new Date().getTime() - start_timestamp;\n    properties['$duration'] = parseFloat((duration_in_ms / 1000).toFixed(3));\n  } // update persistence\n\n\n  this['persistence'].update_search_keyword(document$1.referrer);\n\n  if (this.get_config('store_google')) {\n    this['persistence'].update_campaign_params();\n  }\n\n  if (this.get_config('save_referrer')) {\n    this['persistence'].update_referrer_info(document$1.referrer);\n  } // note: extend writes to the first object, so lets make sure we\n  // don't write to the persistence properties object and info\n  // properties object by passing in a new object\n  // update properties with pageview info and super-properties\n\n\n  properties = _.extend({}, _.info.properties(), this['persistence'].properties(), properties);\n  var property_blacklist = this.get_config('property_blacklist');\n\n  if (_.isArray(property_blacklist)) {\n    _.each(property_blacklist, function (blacklisted_prop) {\n      delete properties[blacklisted_prop];\n    });\n  } else {\n    console$1.error('Invalid value for property_blacklist config: ' + property_blacklist);\n  }\n\n  var data = {\n    'event': event_name,\n    'properties': properties\n  };\n\n  var truncated_data = _.truncate(data, 255);\n\n  var json_data = _.JSONEncode(truncated_data);\n\n  var encoded_data = _.base64Encode(json_data);\n\n  console$1.log('MIXPANEL REQUEST:');\n  console$1.log(truncated_data);\n\n  this._send_request(this.get_config('api_host') + '/track/', {\n    'data': encoded_data\n  }, this._prepare_callback(callback, truncated_data));\n\n  this._check_and_handle_triggered_notifications(data);\n\n  return truncated_data;\n});\n/**\n * Register the current user into one/many groups.\n *\n * ### Usage:\n *\n *      mixpanel.set_group('company', ['mixpanel', 'google']) // an array of IDs\n *      mixpanel.set_group('company', 'mixpanel')\n *      mixpanel.set_group('company', 128746312)\n *\n * @param {String} group_key Group key\n * @param {Array|String|Number} group_ids An array of group IDs, or a singular group ID\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n *\n */\n\nMixpanelLib.prototype.set_group = addOptOutCheckMixpanelLib(function (group_key, group_ids, callback) {\n  if (!_.isArray(group_ids)) {\n    group_ids = [group_ids];\n  }\n\n  var prop = {};\n  prop[group_key] = group_ids;\n  this.register(prop);\n  return this['people'].set(group_key, group_ids, callback);\n});\n/**\n * Add a new group for this user.\n *\n * ### Usage:\n *\n *      mixpanel.add_group('company', 'mixpanel')\n *\n * @param {String} group_key Group key\n * @param {*} group_id A valid Mixpanel property type\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\n\nMixpanelLib.prototype.add_group = addOptOutCheckMixpanelLib(function (group_key, group_id, callback) {\n  var old_values = this.get_property(group_key);\n\n  if (old_values === undefined) {\n    var prop = {};\n    prop[group_key] = [group_id];\n    this.register(prop);\n  } else {\n    if (old_values.indexOf(group_id) === -1) {\n      old_values.push(group_id);\n      this.register(prop);\n    }\n  }\n\n  return this['people'].union(group_key, group_id, callback);\n});\n/**\n * Remove a group from this user.\n *\n * ### Usage:\n *\n *      mixpanel.remove_group('company', 'mixpanel')\n *\n * @param {String} group_key Group key\n * @param {*} group_id A valid Mixpanel property type\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\n\nMixpanelLib.prototype.remove_group = addOptOutCheckMixpanelLib(function (group_key, group_id, callback) {\n  var old_value = this.get_property(group_key); // if the value doesn't exist, the persistent store is unchanged\n\n  if (old_value !== undefined) {\n    var idx = old_value.indexOf(group_id);\n\n    if (idx > -1) {\n      old_value.splice(idx, 1);\n      this.register({\n        group_key: old_value\n      });\n    }\n\n    if (old_value.length === 0) {\n      this.unregister(group_key);\n    }\n  }\n\n  return this['people'].remove(group_key, group_id, callback);\n});\n/**\n * Track an event with specific groups.\n *\n * ### Usage:\n *\n *      mixpanel.track_with_groups('purchase', {'product': 'iphone'}, {'University': ['UCB', 'UCLA']})\n *\n * @param {String} event_name The name of the event (see `mixpanel.track()`)\n * @param {Object=} properties A set of properties to include with the event you're sending (see `mixpanel.track()`)\n * @param {Object=} groups An object mapping group name keys to one or more values\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\n\nMixpanelLib.prototype.track_with_groups = addOptOutCheckMixpanelLib(function (event_name, properties, groups, callback) {\n  var tracking_props = _.extend({}, properties || {});\n\n  _.each(groups, function (v, k) {\n    if (v !== null && v !== undefined) {\n      tracking_props[k] = v;\n    }\n  });\n\n  return this.track(event_name, tracking_props, callback);\n});\n\nMixpanelLib.prototype._create_map_key = function (group_key, group_id) {\n  return group_key + '_' + JSON.stringify(group_id);\n};\n\nMixpanelLib.prototype._remove_group_from_cache = function (group_key, group_id) {\n  delete this._cached_groups[this._create_map_key(group_key, group_id)];\n};\n/**\n * Look up reference to a Mixpanel group\n *\n * ### Usage:\n *\n *       mixpanel.get_group(group_key, group_id)\n *\n * @param {String} group_key Group key\n * @param {Object} group_id A valid Mixpanel property type\n * @returns {Object} A MixpanelGroup identifier\n */\n\n\nMixpanelLib.prototype.get_group = function (group_key, group_id) {\n  var map_key = this._create_map_key(group_key, group_id);\n\n  var group = this._cached_groups[map_key];\n\n  if (group === undefined || group._group_key !== group_key || group._group_id !== group_id) {\n    group = new MixpanelGroup();\n\n    group._init(this, group_key, group_id);\n\n    this._cached_groups[map_key] = group;\n  }\n\n  return group;\n};\n/**\n * Track a page view event, which is currently ignored by the server.\n * This function is called by default on page load unless the\n * track_pageview configuration variable is false.\n *\n * @param {String} [page] The url of the page to record. If you don't include this, it defaults to the current url.\n * @api private\n */\n\n\nMixpanelLib.prototype.track_pageview = function (page) {\n  if (_.isUndefined(page)) {\n    page = document$1.location.href;\n  }\n\n  this.track('mp_page_view', _.info.pageviewInfo(page));\n};\n/**\n * Track clicks on a set of document elements. Selector must be a\n * valid query. Elements must exist on the page at the time track_links is called.\n *\n * ### Usage:\n *\n *     // track click for link id #nav\n *     mixpanel.track_links('#nav', 'Clicked Nav Link');\n *\n * ### Notes:\n *\n * This function will wait up to 300 ms for the Mixpanel\n * servers to respond. If they have not responded by that time\n * it will head to the link without ensuring that your event\n * has been tracked.  To configure this timeout please see the\n * set_config() documentation below.\n *\n * If you pass a function in as the properties argument, the\n * function will receive the DOMElement that triggered the\n * event as an argument.  You are expected to return an object\n * from the function; any properties defined on this object\n * will be sent to mixpanel as event properties.\n *\n * @type {Function}\n * @param {Object|String} query A valid DOM query, element or jQuery-esque list\n * @param {String} event_name The name of the event to track\n * @param {Object|Function} [properties] A properties object or function that returns a dictionary of properties when passed a DOMElement\n */\n\n\nMixpanelLib.prototype.track_links = function () {\n  return this._track_dom.call(this, LinkTracker, arguments);\n};\n/**\n * Track form submissions. Selector must be a valid query.\n *\n * ### Usage:\n *\n *     // track submission for form id 'register'\n *     mixpanel.track_forms('#register', 'Created Account');\n *\n * ### Notes:\n *\n * This function will wait up to 300 ms for the mixpanel\n * servers to respond, if they have not responded by that time\n * it will head to the link without ensuring that your event\n * has been tracked.  To configure this timeout please see the\n * set_config() documentation below.\n *\n * If you pass a function in as the properties argument, the\n * function will receive the DOMElement that triggered the\n * event as an argument.  You are expected to return an object\n * from the function; any properties defined on this object\n * will be sent to mixpanel as event properties.\n *\n * @type {Function}\n * @param {Object|String} query A valid DOM query, element or jQuery-esque list\n * @param {String} event_name The name of the event to track\n * @param {Object|Function} [properties] This can be a set of properties, or a function that returns a set of properties after being passed a DOMElement\n */\n\n\nMixpanelLib.prototype.track_forms = function () {\n  return this._track_dom.call(this, FormTracker, arguments);\n};\n/**\n * Time an event by including the time between this call and a\n * later 'track' call for the same event in the properties sent\n * with the event.\n *\n * ### Usage:\n *\n *     // time an event named 'Registered'\n *     mixpanel.time_event('Registered');\n *     mixpanel.track('Registered', {'Gender': 'Male', 'Age': 21});\n *\n * When called for a particular event name, the next track call for that event\n * name will include the elapsed time between the 'time_event' and 'track'\n * calls. This value is stored as seconds in the '$duration' property.\n *\n * @param {String} event_name The name of the event.\n */\n\n\nMixpanelLib.prototype.time_event = function (event_name) {\n  if (_.isUndefined(event_name)) {\n    console$1.error('No event name provided to mixpanel.time_event');\n    return;\n  }\n\n  if (this._event_is_disabled(event_name)) {\n    return;\n  }\n\n  this['persistence'].set_event_timer(event_name, new Date().getTime());\n};\n/**\n * Register a set of super properties, which are included with all\n * events. This will overwrite previous super property values.\n *\n * ### Usage:\n *\n *     // register 'Gender' as a super property\n *     mixpanel.register({'Gender': 'Female'});\n *\n *     // register several super properties when a user signs up\n *     mixpanel.register({\n *         'Email': 'jdoe@example.com',\n *         'Account Type': 'Free'\n *     });\n *\n * @param {Object} properties An associative array of properties to store about the user\n * @param {Number} [days] How many days since the user's last visit to store the super properties\n */\n\n\nMixpanelLib.prototype.register = function (props, days) {\n  this['persistence'].register(props, days);\n};\n/**\n * Register a set of super properties only once. This will not\n * overwrite previous super property values, unlike register().\n *\n * ### Usage:\n *\n *     // register a super property for the first time only\n *     mixpanel.register_once({\n *         'First Login Date': new Date().toISOString()\n *     });\n *\n * ### Notes:\n *\n * If default_value is specified, current super properties\n * with that value will be overwritten.\n *\n * @param {Object} properties An associative array of properties to store about the user\n * @param {*} [default_value] Value to override if already set in super properties (ex: 'False') Default: 'None'\n * @param {Number} [days] How many days since the users last visit to store the super properties\n */\n\n\nMixpanelLib.prototype.register_once = function (props, default_value, days) {\n  this['persistence'].register_once(props, default_value, days);\n};\n/**\n * Delete a super property stored with the current user.\n *\n * @param {String} property The name of the super property to remove\n */\n\n\nMixpanelLib.prototype.unregister = function (property) {\n  this['persistence'].unregister(property);\n};\n\nMixpanelLib.prototype._register_single = function (prop, value) {\n  var props = {};\n  props[prop] = value;\n  this.register(props);\n};\n/**\n * Identify a user with a unique ID instead of a Mixpanel\n * randomly generated distinct_id. If the method is never called,\n * then unique visitors will be identified by a UUID generated\n * the first time they visit the site.\n *\n * ### Notes:\n *\n * You can call this function to overwrite a previously set\n * unique ID for the current user. Mixpanel cannot translate\n * between IDs at this time, so when you change a user's ID\n * they will appear to be a new user.\n *\n * When used alone, mixpanel.identify will change the user's\n * distinct_id to the unique ID provided. When used in tandem\n * with mixpanel.alias, it will allow you to identify based on\n * unique ID and map that back to the original, anonymous\n * distinct_id given to the user upon her first arrival to your\n * site (thus connecting anonymous pre-signup activity to\n * post-signup activity). Though the two work together, do not\n * call identify() at the same time as alias(). Calling the two\n * at the same time can cause a race condition, so it is best\n * practice to call identify on the original, anonymous ID\n * right after you've aliased it.\n * <a href=\"https://mixpanel.com/help/questions/articles/how-should-i-handle-my-user-identity-with-the-mixpanel-javascript-library\">Learn more about how mixpanel.identify and mixpanel.alias can be used</a>.\n *\n * @param {String} [unique_id] A string that uniquely identifies a user. If not provided, the distinct_id currently in the persistent store (cookie or localStorage) will be used.\n */\n\n\nMixpanelLib.prototype.identify = function (new_distinct_id, _set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback) {\n  // Optional Parameters\n  //  _set_callback:function  A callback to be run if and when the People set queue is flushed\n  //  _add_callback:function  A callback to be run if and when the People add queue is flushed\n  //  _append_callback:function  A callback to be run if and when the People append queue is flushed\n  //  _set_once_callback:function  A callback to be run if and when the People set_once queue is flushed\n  //  _union_callback:function  A callback to be run if and when the People union queue is flushed\n  //  _unset_callback:function  A callback to be run if and when the People unset queue is flushed\n  var previous_distinct_id = this.get_distinct_id();\n  this.register({\n    '$user_id': new_distinct_id\n  });\n\n  if (!this.get_property('$device_id')) {\n    // The persisted distinct id might not actually be a device id at all\n    // it might be a distinct id of the user from before\n    var device_id = previous_distinct_id;\n    this.register_once({\n      '$had_persisted_distinct_id': true,\n      '$device_id': device_id\n    }, '');\n  } // identify only changes the distinct id if it doesn't match either the existing or the alias;\n  // if it's new, blow away the alias as well.\n\n\n  if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {\n    this.unregister(ALIAS_ID_KEY);\n    this.register({\n      'distinct_id': new_distinct_id\n    });\n  }\n\n  this._check_and_handle_notifications(this.get_distinct_id());\n\n  this._flags.identify_called = true; // Flush any queued up people requests\n\n  this['people']._flush(_set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback); // send an $identify event any time the distinct_id is changing - logic on the server\n  // will determine whether or not to do anything with it.\n\n\n  if (new_distinct_id !== previous_distinct_id) {\n    this.track('$identify', {\n      'distinct_id': new_distinct_id,\n      '$anon_distinct_id': previous_distinct_id\n    });\n  }\n};\n/**\n * Clears super properties and generates a new random distinct_id for this instance.\n * Useful for clearing data when a user logs out.\n */\n\n\nMixpanelLib.prototype.reset = function () {\n  this['persistence'].clear();\n  this._flags.identify_called = false;\n\n  var uuid = _.UUID();\n\n  this.register_once({\n    'distinct_id': uuid,\n    '$device_id': uuid\n  }, '');\n};\n/**\n * Returns the current distinct id of the user. This is either the id automatically\n * generated by the library or the id that has been passed by a call to identify().\n *\n * ### Notes:\n *\n * get_distinct_id() can only be called after the Mixpanel library has finished loading.\n * init() has a loaded function available to handle this automatically. For example:\n *\n *     // set distinct_id after the mixpanel library has loaded\n *     mixpanel.init('YOUR PROJECT TOKEN', {\n *         loaded: function(mixpanel) {\n *             distinct_id = mixpanel.get_distinct_id();\n *         }\n *     });\n */\n\n\nMixpanelLib.prototype.get_distinct_id = function () {\n  return this.get_property('distinct_id');\n};\n/**\n * Create an alias, which Mixpanel will use to link two distinct_ids going forward (not retroactively).\n * Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n * following is a valid scenario:\n *\n *     mixpanel.alias('new_id', 'existing_id');\n *     ...\n *     mixpanel.alias('newer_id', 'new_id');\n *\n * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n *\n * ### Notes:\n *\n * The best practice is to call alias() when a unique ID is first created for a user\n * (e.g., when a user first registers for an account and provides an email address).\n * alias() should never be called more than once for a given user, except to\n * chain a newer ID to a previously new ID, as described above.\n *\n * @param {String} alias A unique identifier that you want to use for this user in the future.\n * @param {String} [original] The current identifier being used for this user.\n */\n\n\nMixpanelLib.prototype.alias = function (alias, original) {\n  // If the $people_distinct_id key exists in persistence, there has been a previous\n  // mixpanel.people.identify() call made for this user. It is VERY BAD to make an alias with\n  // this ID, as it will duplicate users.\n  if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n    console$1.critical('Attempting to create alias for existing People user - aborting.');\n    return -2;\n  }\n\n  var _this = this;\n\n  if (_.isUndefined(original)) {\n    original = this.get_distinct_id();\n  }\n\n  if (alias !== original) {\n    this._register_single(ALIAS_ID_KEY, alias);\n\n    return this.track('$create_alias', {\n      'alias': alias,\n      'distinct_id': original\n    }, function () {\n      // Flush the people queue\n      _this.identify(alias);\n    });\n  } else {\n    console$1.error('alias matches current distinct_id - skipping api call.');\n    this.identify(alias);\n    return -1;\n  }\n};\n/**\n * Provide a string to recognize the user by. The string passed to\n * this method will appear in the Mixpanel Streams product rather\n * than an automatically generated name. Name tags do not have to\n * be unique.\n *\n * This value will only be included in Streams data.\n *\n * @param {String} name_tag A human readable name for the user\n * @api private\n */\n\n\nMixpanelLib.prototype.name_tag = function (name_tag) {\n  this._register_single('mp_name_tag', name_tag);\n};\n/**\n * Update the configuration of a mixpanel library instance.\n *\n * The default config is:\n *\n *     {\n *       // super properties cookie expiration (in days)\n *       cookie_expiration: 365\n *\n *       // super properties span subdomains\n *       cross_subdomain_cookie: true\n *\n *       // debug mode\n *       debug: false\n *\n *       // if this is true, the mixpanel cookie or localStorage entry\n *       // will be deleted, and no user persistence will take place\n *       disable_persistence: false\n *\n *       // if this is true, Mixpanel will automatically determine\n *       // City, Region and Country data using the IP address of\n *       //the client\n *       ip: true\n *\n *       // opt users out of tracking by this Mixpanel instance by default\n *       opt_out_tracking_by_default: false\n *\n *       // opt users out of browser data storage by this Mixpanel instance by default\n *       opt_out_persistence_by_default: false\n *\n *       // persistence mechanism used by opt-in/opt-out methods - cookie\n *       // or localStorage - falls back to cookie if localStorage is unavailable\n *       opt_out_tracking_persistence_type: 'localStorage'\n *\n *       // customize the name of cookie/localStorage set by opt-in/opt-out methods\n *       opt_out_tracking_cookie_prefix: null\n *\n *       // type of persistent store for super properties (cookie/\n *       // localStorage) if set to 'localStorage', any existing\n *       // mixpanel cookie value with the same persistence_name\n *       // will be transferred to localStorage and deleted\n *       persistence: 'cookie'\n *\n *       // name for super properties persistent store\n *       persistence_name: ''\n *\n *       // names of properties/superproperties which should never\n *       // be sent with track() calls\n *       property_blacklist: []\n *\n *       // if this is true, mixpanel cookies will be marked as\n *       // secure, meaning they will only be transmitted over https\n *       secure_cookie: false\n *\n *       // the amount of time track_links will\n *       // wait for Mixpanel's servers to respond\n *       track_links_timeout: 300\n *\n *       // should we track a page view on page load\n *       track_pageview: true\n *\n *       // if you set upgrade to be true, the library will check for\n *       // a cookie from our old js library and import super\n *       // properties from it, then the old cookie is deleted\n *       // The upgrade config option only works in the initialization,\n *       // so make sure you set it when you create the library.\n *       upgrade: false\n *\n *       // extra HTTP request headers to set for each API request, in\n *       // the format {'Header-Name': value}\n *       xhr_headers: {}\n *\n *       // protocol for fetching in-app message resources, e.g.\n *       // 'https://' or 'http://'; defaults to '//' (which defers to the\n *       // current page's protocol)\n *       inapp_protocol: '//'\n *\n *       // whether to open in-app message link in new tab/window\n *       inapp_link_new_window: false\n *     }\n *\n *\n * @param {Object} config A dictionary of new configuration values to update\n */\n\n\nMixpanelLib.prototype.set_config = function (config) {\n  if (_.isObject(config)) {\n    _.extend(this['config'], config);\n\n    if (!this.get_config('persistence_name')) {\n      this['config']['persistence_name'] = this['config']['cookie_name'];\n    }\n\n    if (!this.get_config('disable_persistence')) {\n      this['config']['disable_persistence'] = this['config']['disable_cookie'];\n    }\n\n    if (this['persistence']) {\n      this['persistence'].update_config(this['config']);\n    }\n\n    Config.DEBUG = Config.DEBUG || this.get_config('debug');\n  }\n};\n/**\n * returns the current config object for the library.\n */\n\n\nMixpanelLib.prototype.get_config = function (prop_name) {\n  return this['config'][prop_name];\n};\n/**\n * Returns the value of the super property named property_name. If no such\n * property is set, get_property() will return the undefined value.\n *\n * ### Notes:\n *\n * get_property() can only be called after the Mixpanel library has finished loading.\n * init() has a loaded function available to handle this automatically. For example:\n *\n *     // grab value for 'user_id' after the mixpanel library has loaded\n *     mixpanel.init('YOUR PROJECT TOKEN', {\n *         loaded: function(mixpanel) {\n *             user_id = mixpanel.get_property('user_id');\n *         }\n *     });\n *\n * @param {String} property_name The name of the super property you want to retrieve\n */\n\n\nMixpanelLib.prototype.get_property = function (property_name) {\n  return this['persistence']['props'][property_name];\n};\n\nMixpanelLib.prototype.toString = function () {\n  var name = this.get_config('name');\n\n  if (name !== PRIMARY_INSTANCE_NAME) {\n    name = PRIMARY_INSTANCE_NAME + '.' + name;\n  }\n\n  return name;\n};\n\nMixpanelLib.prototype._event_is_disabled = function (event_name) {\n  return _.isBlockedUA(userAgent) || this._flags.disable_all_events || _.include(this.__disabled_events, event_name);\n};\n\nMixpanelLib.prototype._check_and_handle_triggered_notifications = addOptOutCheckMixpanelLib(function (event_data) {\n  if (!this._user_decide_check_complete) {\n    this._events_tracked_before_user_decide_check_complete.push(event_data);\n  } else {\n    var arr = this['_triggered_notifs'];\n\n    for (var i = 0; i < arr.length; i++) {\n      var notif = new MixpanelNotification(arr[i], this);\n\n      if (notif._matches_event_data(event_data)) {\n        this._show_notification(arr[i]);\n\n        return;\n      }\n    }\n  }\n});\nMixpanelLib.prototype._check_and_handle_notifications = addOptOutCheckMixpanelLib(function (distinct_id) {\n  if (!distinct_id || this._flags.identify_called || this.get_config('disable_notifications')) {\n    return;\n  }\n\n  console$1.log('MIXPANEL NOTIFICATION CHECK');\n  var data = {\n    'verbose': true,\n    'version': '3',\n    'lib': 'web',\n    'token': this.get_config('token'),\n    'distinct_id': distinct_id\n  };\n\n  this._send_request(this.get_config('api_host') + '/decide/', data, {\n    method: 'GET'\n  }, this._prepare_callback(_.bind(function (result) {\n    if (result['notifications'] && result['notifications'].length > 0) {\n      this['_triggered_notifs'] = [];\n      var notifications = [];\n\n      _.each(result['notifications'], function (notif) {\n        (notif['display_triggers'] && notif['display_triggers'].length > 0 ? this['_triggered_notifs'] : notifications).push(notif);\n      }, this);\n\n      if (notifications.length > 0) {\n        this._show_notification.call(this, notifications[0]);\n      }\n    }\n\n    this._handle_user_decide_check_complete();\n  }, this)));\n});\n\nMixpanelLib.prototype._handle_user_decide_check_complete = function () {\n  this._user_decide_check_complete = true; // check notifications against events that were tracked before decide call completed\n\n  var events = this._events_tracked_before_user_decide_check_complete;\n\n  while (events.length > 0) {\n    var data = events.shift(); // replay in the same order they came in\n\n    this._check_and_handle_triggered_notifications(data);\n  }\n};\n\nMixpanelLib.prototype._show_notification = function (notif_data) {\n  var notification = new MixpanelNotification(notif_data, this);\n  notification.show();\n}; // perform some housekeeping around GDPR opt-in/out state\n\n\nMixpanelLib.prototype._gdpr_init = function () {\n  var is_localStorage_requested = this.get_config('opt_out_tracking_persistence_type') === 'localStorage'; // try to convert opt-in/out cookies to localStorage if possible\n\n  if (is_localStorage_requested && _.localStorage.is_supported()) {\n    if (!this.has_opted_in_tracking() && this.has_opted_in_tracking({\n      'persistence_type': 'cookie'\n    })) {\n      this.opt_in_tracking({\n        'enable_persistence': false\n      });\n    }\n\n    if (!this.has_opted_out_tracking() && this.has_opted_out_tracking({\n      'persistence_type': 'cookie'\n    })) {\n      this.opt_out_tracking({\n        'clear_persistence': false\n      });\n    }\n\n    this.clear_opt_in_out_tracking({\n      'persistence_type': 'cookie',\n      'enable_persistence': false\n    });\n  } // check whether the user has already opted out - if so, clear & disable persistence\n\n\n  if (this.has_opted_out_tracking()) {\n    this._gdpr_update_persistence({\n      'clear_persistence': true\n    }); // check whether we should opt out by default\n    // note: we don't clear persistence here by default since opt-out default state is often\n    //       used as an initial state while GDPR information is being collected\n\n  } else if (!this.has_opted_in_tracking() && (this.get_config('opt_out_tracking_by_default') || _.cookie.get('mp_optout'))) {\n    _.cookie.remove('mp_optout');\n\n    this.opt_out_tracking({\n      'clear_persistence': this.get_config('opt_out_persistence_by_default')\n    });\n  }\n};\n/**\n * Enable or disable persistence based on options\n * only enable/disable if persistence is not already in this state\n * @param {boolean} [options.clear_persistence] If true, will delete all data stored by the sdk in persistence and disable it\n * @param {boolean} [options.enable_persistence] If true, will re-enable sdk persistence\n */\n\n\nMixpanelLib.prototype._gdpr_update_persistence = function (options) {\n  var disabled;\n\n  if (options && options['clear_persistence']) {\n    disabled = true;\n  } else if (options && options['enable_persistence']) {\n    disabled = false;\n  } else {\n    return;\n  }\n\n  if (!this.get_config('disable_persistence') && this['persistence'].disabled !== disabled) {\n    this['persistence'].set_disabled(disabled);\n  }\n}; // call a base gdpr function after constructing the appropriate token and options args\n\n\nMixpanelLib.prototype._gdpr_call_func = function (func, options) {\n  options = _.extend({\n    'track': _.bind(this.track, this),\n    'persistence_type': this.get_config('opt_out_tracking_persistence_type'),\n    'cookie_prefix': this.get_config('opt_out_tracking_cookie_prefix'),\n    'cookie_expiration': this.get_config('cookie_expiration'),\n    'cross_subdomain_cookie': this.get_config('cross_subdomain_cookie'),\n    'secure_cookie': this.get_config('secure_cookie')\n  }, options); // check if localStorage can be used for recording opt out status, fall back to cookie if not\n\n  if (!_.localStorage.is_supported()) {\n    options['persistence_type'] = 'cookie';\n  }\n\n  return func(this.get_config('token'), {\n    track: options['track'],\n    trackEventName: options['track_event_name'],\n    trackProperties: options['track_properties'],\n    persistenceType: options['persistence_type'],\n    persistencePrefix: options['cookie_prefix'],\n    cookieExpiration: options['cookie_expiration'],\n    crossSubdomainCookie: options['cross_subdomain_cookie'],\n    secureCookie: options['secure_cookie']\n  });\n};\n/**\n * Opt the user in to data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // opt user in\n *     mixpanel.opt_in_tracking();\n *\n *     // opt user in with specific event name, properties, cookie configuration\n *     mixpanel.opt_in_tracking({\n *         track_event_name: 'User opted in',\n *         track_event_properties: {\n *             'Email': 'jdoe@example.com'\n *         },\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {function} [options.track] Function used for tracking a Mixpanel event to record the opt-in action (default is this Mixpanel instance's track method)\n * @param {string} [options.track_event_name=$opt_in] Event name to be used for tracking the opt-in action\n * @param {Object} [options.track_properties] Set of properties to be tracked along with the opt-in action\n * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\n\n\nMixpanelLib.prototype.opt_in_tracking = function (options) {\n  options = _.extend({\n    'enable_persistence': true\n  }, options);\n\n  this._gdpr_call_func(optIn, options);\n\n  this._gdpr_update_persistence(options);\n};\n/**\n * Opt the user out of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // opt user out\n *     mixpanel.opt_out_tracking();\n *\n *     // opt user out with different cookie configuration from Mixpanel instance\n *     mixpanel.opt_out_tracking({\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {boolean} [options.delete_user=true] If true, will delete the currently identified user's profile and clear all charges after opting the user out\n * @param {boolean} [options.clear_persistence=true] If true, will delete all data stored by the sdk in persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\n\n\nMixpanelLib.prototype.opt_out_tracking = function (options) {\n  options = _.extend({\n    'clear_persistence': true,\n    'delete_user': true\n  }, options); // delete use and clear charges since these methods may be disabled by opt-out\n\n  if (options['delete_user'] && this['people'] && this['people']._identify_called()) {\n    this['people'].delete_user();\n    this['people'].clear_charges();\n  }\n\n  this._gdpr_call_func(optOut, options);\n\n  this._gdpr_update_persistence(options);\n};\n/**\n * Check whether the user has opted in to data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     var has_opted_in = mixpanel.has_opted_in_tracking();\n *     // use has_opted_in value\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} current opt-in status\n */\n\n\nMixpanelLib.prototype.has_opted_in_tracking = function (options) {\n  return this._gdpr_call_func(hasOptedIn, options);\n};\n/**\n * Check whether the user has opted out of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     var has_opted_out = mixpanel.has_opted_out_tracking();\n *     // use has_opted_out value\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} current opt-out status\n */\n\n\nMixpanelLib.prototype.has_opted_out_tracking = function (options) {\n  return this._gdpr_call_func(hasOptedOut, options);\n};\n/**\n * Clear the user's opt in/out status of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // clear user's opt-in/out status\n *     mixpanel.clear_opt_in_out_tracking();\n *\n *     // clear user's opt-in/out status with specific cookie configuration - should match\n *     // configuration used when opt_in_tracking/opt_out_tracking methods were called.\n *     mixpanel.clear_opt_in_out_tracking({\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\n\n\nMixpanelLib.prototype.clear_opt_in_out_tracking = function (options) {\n  options = _.extend({\n    'enable_persistence': true\n  }, options);\n\n  this._gdpr_call_func(clearOptInOut, options);\n\n  this._gdpr_update_persistence(options);\n}; // EXPORTS (for closure compiler)\n// MixpanelLib Exports\n\n\nMixpanelLib.prototype['init'] = MixpanelLib.prototype.init;\nMixpanelLib.prototype['reset'] = MixpanelLib.prototype.reset;\nMixpanelLib.prototype['disable'] = MixpanelLib.prototype.disable;\nMixpanelLib.prototype['time_event'] = MixpanelLib.prototype.time_event;\nMixpanelLib.prototype['track'] = MixpanelLib.prototype.track;\nMixpanelLib.prototype['track_links'] = MixpanelLib.prototype.track_links;\nMixpanelLib.prototype['track_forms'] = MixpanelLib.prototype.track_forms;\nMixpanelLib.prototype['track_pageview'] = MixpanelLib.prototype.track_pageview;\nMixpanelLib.prototype['register'] = MixpanelLib.prototype.register;\nMixpanelLib.prototype['register_once'] = MixpanelLib.prototype.register_once;\nMixpanelLib.prototype['unregister'] = MixpanelLib.prototype.unregister;\nMixpanelLib.prototype['identify'] = MixpanelLib.prototype.identify;\nMixpanelLib.prototype['alias'] = MixpanelLib.prototype.alias;\nMixpanelLib.prototype['name_tag'] = MixpanelLib.prototype.name_tag;\nMixpanelLib.prototype['set_config'] = MixpanelLib.prototype.set_config;\nMixpanelLib.prototype['get_config'] = MixpanelLib.prototype.get_config;\nMixpanelLib.prototype['get_property'] = MixpanelLib.prototype.get_property;\nMixpanelLib.prototype['get_distinct_id'] = MixpanelLib.prototype.get_distinct_id;\nMixpanelLib.prototype['toString'] = MixpanelLib.prototype.toString;\nMixpanelLib.prototype['_check_and_handle_notifications'] = MixpanelLib.prototype._check_and_handle_notifications;\nMixpanelLib.prototype['_handle_user_decide_check_complete'] = MixpanelLib.prototype._handle_user_decide_check_complete;\nMixpanelLib.prototype['_show_notification'] = MixpanelLib.prototype._show_notification;\nMixpanelLib.prototype['opt_out_tracking'] = MixpanelLib.prototype.opt_out_tracking;\nMixpanelLib.prototype['opt_in_tracking'] = MixpanelLib.prototype.opt_in_tracking;\nMixpanelLib.prototype['has_opted_out_tracking'] = MixpanelLib.prototype.has_opted_out_tracking;\nMixpanelLib.prototype['has_opted_in_tracking'] = MixpanelLib.prototype.has_opted_in_tracking;\nMixpanelLib.prototype['clear_opt_in_out_tracking'] = MixpanelLib.prototype.clear_opt_in_out_tracking;\nMixpanelLib.prototype['get_group'] = MixpanelLib.prototype.get_group;\nMixpanelLib.prototype['set_group'] = MixpanelLib.prototype.set_group;\nMixpanelLib.prototype['add_group'] = MixpanelLib.prototype.add_group;\nMixpanelLib.prototype['remove_group'] = MixpanelLib.prototype.remove_group;\nMixpanelLib.prototype['track_with_groups'] = MixpanelLib.prototype.track_with_groups; // MixpanelPersistence Exports\n\nMixpanelPersistence.prototype['properties'] = MixpanelPersistence.prototype.properties;\nMixpanelPersistence.prototype['update_search_keyword'] = MixpanelPersistence.prototype.update_search_keyword;\nMixpanelPersistence.prototype['update_referrer_info'] = MixpanelPersistence.prototype.update_referrer_info;\nMixpanelPersistence.prototype['get_cross_subdomain'] = MixpanelPersistence.prototype.get_cross_subdomain;\nMixpanelPersistence.prototype['clear'] = MixpanelPersistence.prototype.clear;\n\n_.safewrap_class(MixpanelLib, ['identify', '_check_and_handle_notifications', '_show_notification']);\n\nvar instances = {};\n\nvar extend_mp = function extend_mp() {\n  // add all the sub mixpanel instances\n  _.each(instances, function (instance, name) {\n    if (name !== PRIMARY_INSTANCE_NAME) {\n      mixpanel_master[name] = instance;\n    }\n  }); // add private functions as _\n\n\n  mixpanel_master['_'] = _;\n};\n\nvar override_mp_init_func = function override_mp_init_func() {\n  // we override the snippets init function to handle the case where a\n  // user initializes the mixpanel library after the script loads & runs\n  mixpanel_master['init'] = function (token, config, name) {\n    if (name) {\n      // initialize a sub library\n      if (!mixpanel_master[name]) {\n        mixpanel_master[name] = instances[name] = create_mplib(token, config, name);\n\n        mixpanel_master[name]._loaded();\n      }\n\n      return mixpanel_master[name];\n    } else {\n      var instance = mixpanel_master;\n\n      if (instances[PRIMARY_INSTANCE_NAME]) {\n        // main mixpanel lib already initialized\n        instance = instances[PRIMARY_INSTANCE_NAME];\n      } else if (token) {\n        // intialize the main mixpanel lib\n        instance = create_mplib(token, config, PRIMARY_INSTANCE_NAME);\n\n        instance._loaded();\n\n        instances[PRIMARY_INSTANCE_NAME] = instance;\n      }\n\n      mixpanel_master = instance;\n\n      if (init_type === INIT_SNIPPET) {\n        window$1[PRIMARY_INSTANCE_NAME] = mixpanel_master;\n      }\n\n      extend_mp();\n    }\n  };\n};\n\nvar add_dom_loaded_handler = function add_dom_loaded_handler() {\n  // Cross browser DOM Loaded support\n  function dom_loaded_handler() {\n    // function flag since we only want to execute this once\n    if (dom_loaded_handler.done) {\n      return;\n    }\n\n    dom_loaded_handler.done = true;\n    DOM_LOADED = true;\n    ENQUEUE_REQUESTS = false;\n\n    _.each(instances, function (inst) {\n      inst._dom_loaded();\n    });\n  }\n\n  function do_scroll_check() {\n    try {\n      document$1.documentElement.doScroll('left');\n    } catch (e) {\n      setTimeout(do_scroll_check, 1);\n      return;\n    }\n\n    dom_loaded_handler();\n  }\n\n  if (document$1.addEventListener) {\n    if (document$1.readyState === 'complete') {\n      // safari 4 can fire the DOMContentLoaded event before loading all\n      // external JS (including this file). you will see some copypasta\n      // on the internet that checks for 'complete' and 'loaded', but\n      // 'loaded' is an IE thing\n      dom_loaded_handler();\n    } else {\n      document$1.addEventListener('DOMContentLoaded', dom_loaded_handler, false);\n    }\n  } else if (document$1.attachEvent) {\n    // IE\n    document$1.attachEvent('onreadystatechange', dom_loaded_handler); // check to make sure we arn't in a frame\n\n    var toplevel = false;\n\n    try {\n      toplevel = window$1.frameElement === null;\n    } catch (e) {// noop\n    }\n\n    if (document$1.documentElement.doScroll && toplevel) {\n      do_scroll_check();\n    }\n  } // fallback handler, always will work\n\n\n  _.register_event(window$1, 'load', dom_loaded_handler, true);\n};\n\nfunction init_as_module() {\n  init_type = INIT_MODULE;\n  mixpanel_master = new MixpanelLib();\n  override_mp_init_func();\n  mixpanel_master['init']();\n  add_dom_loaded_handler();\n  return mixpanel_master;\n}\n\nvar mixpanel = init_as_module();\nmodule.exports = mixpanel;","map":{"version":3,"sources":["/Users/melissa/datamatch/node_modules/mixpanel-browser/dist/mixpanel.cjs.js"],"names":["Config","DEBUG","LIB_VERSION","window$1","window","loc","hostname","navigator","userAgent","document","location","referrer","screen","width","height","ArrayProto","Array","prototype","FuncProto","Function","ObjProto","Object","slice","toString","hasOwnProperty","windowConsole","console","navigator$1","document$1","windowOpera","opera","nativeBind","bind","nativeForEach","forEach","nativeIndexOf","indexOf","nativeIsArray","isArray","breaker","DOMAIN_MATCH_REGEX","_","trim","str","replace","console$1","log","isUndefined","apply","arguments","err","each","arg","error","args","concat","toArray","critical","func","context","bound","call","isFunction","TypeError","ctor","self","result","bind_instance_methods","obj","iterator","undefined","length","i","l","key","escapeHTML","s","escaped","isString","extend","source","prop","f","test","x","isArguments","iterable","values","keys","results","value","identity","include","target","found","includes","needle","inherit","subclass","superclass","constructor","isObject","isEmptyObject","isDate","isNumber","isElement","nodeType","encodeDates","v","k","formatDate","timestamp","Date","now","d","pad","n","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","safewrap","e","safewrap_class","klass","functions","safewrap_instance_methods","strip_empty_properties","p","ret","truncate","val","push","JSONEncode","mixed_val","quote","string","escapable","meta","lastIndex","a","c","charCodeAt","holder","gap","indent","mind","partial","toJSON","isFinite","String","join","JSONDecode","at","ch","escapee","text","m","SyntaxError","next","charAt","number","hex","uffff","parseInt","fromCharCode","white","word","array","object","base64Encode","data","b64","o1","o2","o3","h1","h2","h3","h4","bits","ac","enc","tmp_arr","utf8Encode","utftext","start","end","stringl","c1","substring","UUID","T","R","Math","random","UA","ua","buffer","xor","byte_array","j","tmp","unshift","se","isBlockedUA","HTTPBuildQuery","formdata","arg_separator","use_val","use_key","encodeURIComponent","getQueryParam","url","param","regexS","regex","RegExp","exec","decodeURIComponent","getHashParam","hash","matches","match","cookie","get","name","nameEQ","ca","split","parse","set_seconds","seconds","cross_subdomain","is_secure","cdomain","expires","secure","domain","date","setTime","getTime","toGMTString","set","days","new_cookie_val","remove","_localStorage_supported","localStorage","is_supported","supported","msg","getItem","setItem","removeItem","register_event","element","type","handler","oldSchool","useCapture","addEventListener","ontype","old_handler","makeHandler","new_handler","old_handlers","event","fixEvent","old_result","new_result","preventDefault","stopPropagation","returnValue","cancelBubble","TOKEN_MATCH_REGEX","dom_query","getAllChildren","all","getElementsByTagName","bad_whitespace","hasClass","elem","selector","className","getElementsBySelector","tokens","token","tagName","foundCount","elements","currentContextIndex","currentContext","id","getElementById","nodeName","toLowerCase","token_match","attrName","attrOperator","attrValue","checkFunction","getAttribute","lastIndexOf","query","info","campaignParams","campaign_keywords","kw","params","kwkey","URL","searchEngine","search","searchInfo","keyword","browser","user_agent","vendor","browserVersion","versionRegexs","parseFloat","os","device","referringDomain","properties","href","people_properties","pageviewInfo","page","getClassName","el","baseVal","getSafeText","elText","shouldTrackElement","childNodes","child","isTextNode","textContent","filter","shouldTrackValue","isElementNode","isTag","tag","shouldTrackDomEvent","curEl","parentNode","classes","sensitiveNameRegex","ccRegex","ssnRegex","autotrack","_initializedTokens","_previousElementSibling","previousElementSibling","previousSibling","_loadScript","scriptUrlToLoad","callback","scriptTag","createElement","src","onload","scripts","insertBefore","body","appendChild","_getPropertiesFromElement","props","attributes","attr","nthChild","nthOfType","currentElem","_getDefaultProperties","eventType","host","pathname","_extractCustomPropertyValue","customProperty","propValues","querySelectorAll","matchedElem","_getCustomProperties","targetElementList","_customProperties","eventSelector","eventElements","eventElement","_getEventTarget","srcElement","_trackEvent","instance","elementsJson","explicitNoTrack","shouldTrackEl","elementText","safeElementText","track","_navigate","_addDomEventHandlers","init","that","setTimeout","get_config","_maybeLoadEditor","parseDecideResponse","response","title","_send_request","method","_prepare_callback","_editorParamsFromHash","editorParams","state","JSON","expiresInSeconds","Number","sessionStorage","stringify","history","replaceState","parseFromUrl","parseFromStorage","_loadEditor","editorUrl","enabledForProject","numBuckets","numEnabledBuckets","charCodeSum","isBrowserSupported","DomTracker","create_properties","event_handler","after_track_handler","mixpanel_instance","mp","event_name","user_callback","override_event","options","timeout","track_callback","timeout_occured","callback_fired","LinkTracker","evt","new_tab","which","metaKey","ctrlKey","FormTracker","submit","GDPR_DEFAULT_PERSISTENCE_PREFIX","optIn","_optInOut","optOut","hasOptedIn","_getStorageValue","hasOptedOut","_hasDoNotTrackFlagOn","addOptOutCheckMixpanelLib","_addOptOutCheck","addOptOutCheckMixpanelPeople","_get_config","addOptOutCheckMixpanelGroup","clearOptInOut","_getStorage","_getStorageKey","crossSubdomainCookie","persistenceType","persistencePrefix","win","nav","hasDntOn","dntValue","optValue","cookieExpiration","secureCookie","trackEventName","trackProperties","getConfigValue","optedOut","SET_ACTION","SET_ONCE_ACTION","UNSET_ACTION","ADD_ACTION","APPEND_ACTION","UNION_ACTION","REMOVE_ACTION","DELETE_ACTION","apiActions","set_action","to","$set","_is_reserved_property","unset_action","$unset","set_once_action","$set_once","union_action","list_name","$union","append_action","$append","remove_action","$remove","delete_action","MixpanelGroup","_init","group_key","group_id","_mixpanel","_group_key","_group_id","set_once","unset","union","date_encoded_data","truncated_data","json_data","encoded_data","conf","SET_QUEUE_KEY","SET_ONCE_QUEUE_KEY","UNSET_QUEUE_KEY","ADD_QUEUE_KEY","APPEND_QUEUE_KEY","REMOVE_QUEUE_KEY","UNION_QUEUE_KEY","PEOPLE_DISTINCT_ID_KEY","ALIAS_ID_KEY","CAMPAIGN_IDS_KEY","EVENT_TIMERS_KEY","RESERVED_PROPERTIES","MixpanelPersistence","config","campaign_params_saved","storage_type","storage","load","update_config","upgrade","save","disabled","entry","upgrade_from_old_lib","old_cookie_name","old_cookie","register_once","_expire_notification_campaigns","expire_days","clear","default_value","default_expiry","register","unregister","campaigns_shown","EXPIRY_TIME","campaign_id","update_campaign_params","update_search_keyword","update_referrer_info","get_referrer_info","safe_merge","set_disabled","set_cross_subdomain","set_secure","get_cross_subdomain","_add_to_people_queue","queue","q_key","_get_queue_key","q_data","set_q","_get_or_create_queue","set_once_q","unset_q","add_q","union_q","remove_q","append_q","_pop_from_people_queue","enqueued_obj","append_obj","q","_get_queue","queued_action","default_val","set_event_timer","timers","remove_event_timer","OPERATOR_KEY","PROPERTY_KEY","WINDOW_KEY","UNIT_KEY","VALUE_KEY","HOUR_KEY","DAY_KEY","WEEK_KEY","MONTH_KEY","EVENT_PROPERTY","LITERAL_PROPERTY","AND_OPERATOR","OR_OPERATOR","IN_OPERATOR","NOT_IN_OPERATOR","PLUS_OPERATOR","MINUS_OPERATOR","MUL_OPERATOR","DIV_OPERATOR","MOD_OPERATOR","EQUALS_OPERATOR","NOT_EQUALS_OPERATOR","GREATER_OPERATOR","LESS_OPERATOR","GREATER_EQUAL_OPERATOR","LESS_EQUAL_OPERATOR","BOOLEAN_OPERATOR","DATETIME_OPERATOR","LIST_OPERATOR","NUMBER_OPERATOR","STRING_OPERATOR","NOT_OPERATOR","DEFINED_OPERATOR","NOT_DEFINED_OPERATOR","NOW_LITERAL","toNumber","isNaN","evaluateNumber","op","evaluateSelector","toBoolean","evaluateBoolean","evaluateDateTime","evaluateList","evaluateString","evaluateAnd","evaluateOr","evaluateIn","leftValue","rightValue","evaluatePlus","r","evaluateArithmetic","floor","_isArrayEqual","_isEqual","evaluateEquality","evaluateComparison","compare","localeCompare","evaluateDefined","b","evaluateNot","evaluateOperator","evaluateWindow","out","evaluateOperand","filters","MixpanelNotification","notif_data","mixpanel","persistence","resource_protocol","cdn_host","message_id","cta","notif_type","style","video_width","VIDEO_WIDTH","video_height","VIDEO_HEIGHT","display_triggers","dest_url","image_url","thumb_image_url","video_url","clickthrough","mini","notif_width","NOTIF_WIDTH","NOTIF_WIDTH_MINI","_set_client_config","imgs_to_preload","_init_image_html","_init_video","ANIM_TIME","MARKUP_PREFIX","BG_OPACITY","NOTIF_TOP","NOTIF_START_TOP","NOTIF_HEIGHT_MINI","THUMB_BORDER_SIZE","THUMB_IMG_SIZE","THUMB_OFFSET","round","show","body_el","_init_styles","_init_notification_el","_preload_images","_attach_and_animate","dismiss","marked_as_shown","_mark_delivery","exiting_el","showing_video","_get_el","_get_notification_display_el","use_transitions","_remove_class","_add_class","_remove_notification_el","notif_attr","notif_start","notif_goal","_animate_els","goal","class_name","anims","mss","done_cb","start_time","in_progress","ai","anim","cur_time","time_diff","anim_diff","anim_dir","suffix","shown","_get_shown_campaigns","notification_el","notif_el","_mark_as_shown","click_el","show_video","_track_event","_switch_to_video","tracking_cb","open","_matches_event_data","event_data","display_trigger","match_event","_browser_lte","version","browser_versions","img_html","thumb_img_html","notification_html","video_src","video_html","cancel_html","close_html","play_html","youtube_video","yt_custom","vimeo_video","video_iframe","flip_animate","main_html","innerHTML","style_vals","bg","bg_actions","bg_hover","bg_light","border_gray","cancel_opacity","mini_hover","text_title","text_main","text_tagline","text_hover","shadow","video_shadow","mini_shadow","thumb_total_size","anim_seconds","notif_media_queries","min_width","notif_styles","doc_width","doc_height","VENDOR_STYLES","VENDOR_PREFIXES","si","pi","inject_styles","styles","media_queries","create_style_text","style_defs","st","mp_selector","create_media_query_text","mq_defs","mqt","mq","style_text","head_el","head","documentElement","style_el","setAttribute","styleSheet","cssText","youtube_match","vimeo_match","_yt_video_ready","firstScriptTag","get_style","style_name","defaultView","getComputedStyle","currentStyle","extra_props","all_loaded_cb","preloaded_imgs","img_objs","img","Image","complete","imgs_loaded","clearInterval","_video_progress_checker","visibility","removeChild","get_browser_version","browser_ex","ActiveXObject","max","scrollWidth","offsetWidth","clientWidth","scrollHeight","offsetHeight","clientHeight","ie_ver","sample_styles","is_css_compatible","rule","toUpperCase","overlay","video_el","video_ready","cb","video_inited","progress_bar","progress_time","progress_el","ytplayer","video_duration","update_video_time","current_time","secs","mins","hours","setInterval","clickx","pageX","getBoundingClientRect","left","MixpanelPeople","increment","by","$add","append","track_charge","amount","clear_charges","delete_user","_identify_called","get_distinct_id","device_id","get_property","user_id","had_persisted_distinct_id","_enqueue","status","conf_var","_flags","identify_called","_flush_one_queue","action","action_method","queue_to_params_fn","_this","queued_data","action_params","_flush","_set_callback","_add_callback","_append_callback","_set_once_callback","_union_callback","_unset_callback","_remove_callback","$append_queue","$remove_queue","$append_item","append_callback","pop","$remove_item","remove_callback","init_type","mixpanel_master","INIT_MODULE","INIT_SNIPPET","PRIMARY_INSTANCE_NAME","USE_XHR","XMLHttpRequest","ENQUEUE_REQUESTS","DEFAULT_CONFIG","DOM_LOADED","MixpanelLib","create_mplib","_cached_groups","_user_decide_check_complete","_events_tracked_before_user_decide_check_complete","num_buckets","num_enabled_buckets","_execute_array","_loaded","set_config","__dom_loaded_queue","__request_queue","__disabled_events","_gdpr_init","uuid","track_pageview","_dom_loaded","item","_track_dom","has_opted_out_tracking","DomClass","dt","callback_function","jsc","randomized_cb","callback_string","DEFAULT_OPTIONS","body_data","use_post","verbose_mode","req","headers","headerValue","headerName","setRequestHeader","withCredentials","onreadystatechange","readyState","responseText","statusText","send","script","async","defer","fn_name","alias_calls","other_calls","tracking_calls","execute","calls","caller","disable","events","disable_all_events","_event_is_disabled","start_timestamp","duration_in_ms","toFixed","property_blacklist","blacklisted_prop","_check_and_handle_triggered_notifications","set_group","group_ids","add_group","old_values","remove_group","old_value","idx","splice","track_with_groups","groups","tracking_props","_create_map_key","_remove_group_from_cache","get_group","map_key","group","track_links","track_forms","time_event","property","_register_single","identify","new_distinct_id","previous_distinct_id","_check_and_handle_notifications","reset","alias","original","name_tag","prop_name","property_name","arr","notif","_show_notification","distinct_id","notifications","_handle_user_decide_check_complete","shift","notification","is_localStorage_requested","has_opted_in_tracking","opt_in_tracking","opt_out_tracking","clear_opt_in_out_tracking","_gdpr_update_persistence","_gdpr_call_func","instances","extend_mp","override_mp_init_func","add_dom_loaded_handler","dom_loaded_handler","done","inst","do_scroll_check","doScroll","attachEvent","toplevel","frameElement","init_as_module","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Config = {\n    DEBUG: false,\n    LIB_VERSION: '2.32.0'\n};\n\n// since es6 imports are static and we run unit tests from the console, window won't be defined when importing this file\nvar window$1;\nif (typeof(window) === 'undefined') {\n    var loc = {\n        hostname: ''\n    };\n    window$1 = {\n        navigator: { userAgent: '' },\n        document: {\n            location: loc,\n            referrer: ''\n        },\n        screen: { width: 0, height: 0 },\n        location: loc\n    };\n} else {\n    window$1 = window;\n}\n\n/*\n * Saved references to long variable names, so that closure compiler can\n * minimize file size.\n */\n\nvar ArrayProto = Array.prototype;\nvar FuncProto = Function.prototype;\nvar ObjProto = Object.prototype;\nvar slice = ArrayProto.slice;\nvar toString = ObjProto.toString;\nvar hasOwnProperty = ObjProto.hasOwnProperty;\nvar windowConsole = window$1.console;\nvar navigator$1 = window$1.navigator;\nvar document$1 = window$1.document;\nvar windowOpera = window$1.opera;\nvar screen = window$1.screen;\nvar userAgent = navigator$1.userAgent;\nvar nativeBind = FuncProto.bind;\nvar nativeForEach = ArrayProto.forEach;\nvar nativeIndexOf = ArrayProto.indexOf;\nvar nativeIsArray = Array.isArray;\nvar breaker = {};\nvar DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z.]{2,6}$/i;\n\nvar _ = {\n    trim: function(str) {\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill\n        return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n    }\n};\n\n// Console override\nvar console$1 = {\n    /** @type {function(...*)} */\n    log: function() {\n        if (Config.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n            try {\n                windowConsole.log.apply(windowConsole, arguments);\n            } catch (err) {\n                _.each(arguments, function(arg) {\n                    windowConsole.log(arg);\n                });\n            }\n        }\n    },\n    /** @type {function(...*)} */\n    error: function() {\n        if (Config.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n            var args = ['Mixpanel error:'].concat(_.toArray(arguments));\n            try {\n                windowConsole.error.apply(windowConsole, args);\n            } catch (err) {\n                _.each(args, function(arg) {\n                    windowConsole.error(arg);\n                });\n            }\n        }\n    },\n    /** @type {function(...*)} */\n    critical: function() {\n        if (!_.isUndefined(windowConsole) && windowConsole) {\n            var args = ['Mixpanel error:'].concat(_.toArray(arguments));\n            try {\n                windowConsole.error.apply(windowConsole, args);\n            } catch (err) {\n                _.each(args, function(arg) {\n                    windowConsole.error(arg);\n                });\n            }\n        }\n    }\n};\n\n\n// UNDERSCORE\n// Embed part of the Underscore Library\n_.bind = function(func, context) {\n    var args, bound;\n    if (nativeBind && func.bind === nativeBind) {\n        return nativeBind.apply(func, slice.call(arguments, 1));\n    }\n    if (!_.isFunction(func)) {\n        throw new TypeError();\n    }\n    args = slice.call(arguments, 2);\n    bound = function() {\n        if (!(this instanceof bound)) {\n            return func.apply(context, args.concat(slice.call(arguments)));\n        }\n        var ctor = {};\n        ctor.prototype = func.prototype;\n        var self = new ctor();\n        ctor.prototype = null;\n        var result = func.apply(self, args.concat(slice.call(arguments)));\n        if (Object(result) === result) {\n            return result;\n        }\n        return self;\n    };\n    return bound;\n};\n\n_.bind_instance_methods = function(obj) {\n    for (var func in obj) {\n        if (typeof(obj[func]) === 'function') {\n            obj[func] = _.bind(obj[func], obj);\n        }\n    }\n};\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} context\n */\n_.each = function(obj, iterator, context) {\n    if (obj === null || obj === undefined) {\n        return;\n    }\n    if (nativeForEach && obj.forEach === nativeForEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n        for (var i = 0, l = obj.length; i < l; i++) {\n            if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n                return;\n            }\n        }\n    } else {\n        for (var key in obj) {\n            if (hasOwnProperty.call(obj, key)) {\n                if (iterator.call(context, obj[key], key, obj) === breaker) {\n                    return;\n                }\n            }\n        }\n    }\n};\n\n_.escapeHTML = function(s) {\n    var escaped = s;\n    if (escaped && _.isString(escaped)) {\n        escaped = escaped\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n    return escaped;\n};\n\n_.extend = function(obj) {\n    _.each(slice.call(arguments, 1), function(source) {\n        for (var prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop];\n            }\n        }\n    });\n    return obj;\n};\n\n_.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) === '[object Array]';\n};\n\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// var bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\n_.isFunction = function(f) {\n    try {\n        return /^\\s*\\bfunction\\b/.test(f);\n    } catch (x) {\n        return false;\n    }\n};\n\n_.isArguments = function(obj) {\n    return !!(obj && hasOwnProperty.call(obj, 'callee'));\n};\n\n_.toArray = function(iterable) {\n    if (!iterable) {\n        return [];\n    }\n    if (iterable.toArray) {\n        return iterable.toArray();\n    }\n    if (_.isArray(iterable)) {\n        return slice.call(iterable);\n    }\n    if (_.isArguments(iterable)) {\n        return slice.call(iterable);\n    }\n    return _.values(iterable);\n};\n\n_.keys = function(obj) {\n    var results = [];\n    if (obj === null) {\n        return results;\n    }\n    _.each(obj, function(value, key) {\n        results[results.length] = key;\n    });\n    return results;\n};\n\n_.values = function(obj) {\n    var results = [];\n    if (obj === null) {\n        return results;\n    }\n    _.each(obj, function(value) {\n        results[results.length] = value;\n    });\n    return results;\n};\n\n_.identity = function(value) {\n    return value;\n};\n\n_.include = function(obj, target) {\n    var found = false;\n    if (obj === null) {\n        return found;\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1;\n    }\n    _.each(obj, function(value) {\n        if (found || (found = (value === target))) {\n            return breaker;\n        }\n    });\n    return found;\n};\n\n_.includes = function(str, needle) {\n    return str.indexOf(needle) !== -1;\n};\n\n// Underscore Addons\n_.inherit = function(subclass, superclass) {\n    subclass.prototype = new superclass();\n    subclass.prototype.constructor = subclass;\n    subclass.superclass = superclass.prototype;\n    return subclass;\n};\n\n_.isObject = function(obj) {\n    return (obj === Object(obj) && !_.isArray(obj));\n};\n\n_.isEmptyObject = function(obj) {\n    if (_.isObject(obj)) {\n        for (var key in obj) {\n            if (hasOwnProperty.call(obj, key)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n};\n\n_.isUndefined = function(obj) {\n    return obj === void 0;\n};\n\n_.isString = function(obj) {\n    return toString.call(obj) == '[object String]';\n};\n\n_.isDate = function(obj) {\n    return toString.call(obj) == '[object Date]';\n};\n\n_.isNumber = function(obj) {\n    return toString.call(obj) == '[object Number]';\n};\n\n_.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n};\n\n_.encodeDates = function(obj) {\n    _.each(obj, function(v, k) {\n        if (_.isDate(v)) {\n            obj[k] = _.formatDate(v);\n        } else if (_.isObject(v)) {\n            obj[k] = _.encodeDates(v); // recurse\n        }\n    });\n    return obj;\n};\n\n_.timestamp = function() {\n    Date.now = Date.now || function() {\n        return +new Date;\n    };\n    return Date.now();\n};\n\n_.formatDate = function(d) {\n    // YYYY-MM-DDTHH:MM:SS in UTC\n    function pad(n) {\n        return n < 10 ? '0' + n : n;\n    }\n    return d.getUTCFullYear() + '-' +\n        pad(d.getUTCMonth() + 1) + '-' +\n        pad(d.getUTCDate()) + 'T' +\n        pad(d.getUTCHours()) + ':' +\n        pad(d.getUTCMinutes()) + ':' +\n        pad(d.getUTCSeconds());\n};\n\n_.safewrap = function(f) {\n    return function() {\n        try {\n            return f.apply(this, arguments);\n        } catch (e) {\n            console$1.critical('Implementation error. Please turn on debug and contact support@mixpanel.com.');\n            if (Config.DEBUG){\n                console$1.critical(e);\n            }\n        }\n    };\n};\n\n_.safewrap_class = function(klass, functions) {\n    for (var i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = _.safewrap(klass.prototype[functions[i]]);\n    }\n};\n\n_.safewrap_instance_methods = function(obj) {\n    for (var func in obj) {\n        if (typeof(obj[func]) === 'function') {\n            obj[func] = _.safewrap(obj[func]);\n        }\n    }\n};\n\n_.strip_empty_properties = function(p) {\n    var ret = {};\n    _.each(p, function(v, k) {\n        if (_.isString(v) && v.length > 0) {\n            ret[k] = v;\n        }\n    });\n    return ret;\n};\n\n/*\n * this function returns a copy of object after truncating it.  If\n * passed an Array or Object it will iterate through obj and\n * truncate all the values recursively.\n */\n_.truncate = function(obj, length) {\n    var ret;\n\n    if (typeof(obj) === 'string') {\n        ret = obj.slice(0, length);\n    } else if (_.isArray(obj)) {\n        ret = [];\n        _.each(obj, function(val) {\n            ret.push(_.truncate(val, length));\n        });\n    } else if (_.isObject(obj)) {\n        ret = {};\n        _.each(obj, function(val, key) {\n            ret[key] = _.truncate(val, length);\n        });\n    } else {\n        ret = obj;\n    }\n\n    return ret;\n};\n\n_.JSONEncode = (function() {\n    return function(mixed_val) {\n        var value = mixed_val;\n        var quote = function(string) {\n            var escapable = /[\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g; // eslint-disable-line no-control-regex\n            var meta = { // table of character substitutions\n                '\\b': '\\\\b',\n                '\\t': '\\\\t',\n                '\\n': '\\\\n',\n                '\\f': '\\\\f',\n                '\\r': '\\\\r',\n                '\"': '\\\\\"',\n                '\\\\': '\\\\\\\\'\n            };\n\n            escapable.lastIndex = 0;\n            return escapable.test(string) ?\n                '\"' + string.replace(escapable, function(a) {\n                    var c = meta[a];\n                    return typeof c === 'string' ? c :\n                        '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                }) + '\"' :\n                '\"' + string + '\"';\n        };\n\n        var str = function(key, holder) {\n            var gap = '';\n            var indent = '    ';\n            var i = 0; // The loop counter.\n            var k = ''; // The member key.\n            var v = ''; // The member value.\n            var length = 0;\n            var mind = gap;\n            var partial = [];\n            var value = holder[key];\n\n            // If the value has a toJSON method, call it to obtain a replacement value.\n            if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n\n            // What happens next depends on the value's type.\n            switch (typeof value) {\n                case 'string':\n                    return quote(value);\n\n                case 'number':\n                    // JSON numbers must be finite. Encode non-finite numbers as null.\n                    return isFinite(value) ? String(value) : 'null';\n\n                case 'boolean':\n                case 'null':\n                    // If the value is a boolean or null, convert it to a string. Note:\n                    // typeof null does not produce 'null'. The case is included here in\n                    // the remote chance that this gets fixed someday.\n\n                    return String(value);\n\n                case 'object':\n                    // If the type is 'object', we might be dealing with an object or an array or\n                    // null.\n                    // Due to a specification blunder in ECMAScript, typeof null is 'object',\n                    // so watch out for that case.\n                    if (!value) {\n                        return 'null';\n                    }\n\n                    // Make an array to hold the partial results of stringifying this object value.\n                    gap += indent;\n                    partial = [];\n\n                    // Is the value an array?\n                    if (toString.apply(value) === '[object Array]') {\n                        // The value is an array. Stringify every element. Use null as a placeholder\n                        // for non-JSON values.\n\n                        length = value.length;\n                        for (i = 0; i < length; i += 1) {\n                            partial[i] = str(i, value) || 'null';\n                        }\n\n                        // Join all of the elements together, separated with commas, and wrap them in\n                        // brackets.\n                        v = partial.length === 0 ? '[]' :\n                            gap ? '[\\n' + gap +\n                            partial.join(',\\n' + gap) + '\\n' +\n                            mind + ']' :\n                                '[' + partial.join(',') + ']';\n                        gap = mind;\n                        return v;\n                    }\n\n                    // Iterate through all of the keys in the object.\n                    for (k in value) {\n                        if (hasOwnProperty.call(value, k)) {\n                            v = str(k, value);\n                            if (v) {\n                                partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                            }\n                        }\n                    }\n\n                    // Join all of the member texts together, separated with commas,\n                    // and wrap them in braces.\n                    v = partial.length === 0 ? '{}' :\n                        gap ? '{' + partial.join(',') + '' +\n                        mind + '}' : '{' + partial.join(',') + '}';\n                    gap = mind;\n                    return v;\n            }\n        };\n\n        // Make a fake root object containing our value under the key of ''.\n        // Return the result of stringifying the value.\n        return str('', {\n            '': value\n        });\n    };\n})();\n\n/**\n * From https://github.com/douglascrockford/JSON-js/blob/master/json_parse.js\n * Slightly modified to throw a real Error rather than a POJO\n */\n_.JSONDecode = (function() {\n    var at, // The index of the current character\n        ch, // The current character\n        escapee = {\n            '\"': '\"',\n            '\\\\': '\\\\',\n            '/': '/',\n            'b': '\\b',\n            'f': '\\f',\n            'n': '\\n',\n            'r': '\\r',\n            't': '\\t'\n        },\n        text,\n        error = function(m) {\n            var e = new SyntaxError(m);\n            e.at = at;\n            e.text = text;\n            throw e;\n        },\n        next = function(c) {\n            // If a c parameter is provided, verify that it matches the current character.\n            if (c && c !== ch) {\n                error('Expected \\'' + c + '\\' instead of \\'' + ch + '\\'');\n            }\n            // Get the next character. When there are no more characters,\n            // return the empty string.\n            ch = text.charAt(at);\n            at += 1;\n            return ch;\n        },\n        number = function() {\n            // Parse a number value.\n            var number,\n                string = '';\n\n            if (ch === '-') {\n                string = '-';\n                next('-');\n            }\n            while (ch >= '0' && ch <= '9') {\n                string += ch;\n                next();\n            }\n            if (ch === '.') {\n                string += '.';\n                while (next() && ch >= '0' && ch <= '9') {\n                    string += ch;\n                }\n            }\n            if (ch === 'e' || ch === 'E') {\n                string += ch;\n                next();\n                if (ch === '-' || ch === '+') {\n                    string += ch;\n                    next();\n                }\n                while (ch >= '0' && ch <= '9') {\n                    string += ch;\n                    next();\n                }\n            }\n            number = +string;\n            if (!isFinite(number)) {\n                error('Bad number');\n            } else {\n                return number;\n            }\n        },\n\n        string = function() {\n            // Parse a string value.\n            var hex,\n                i,\n                string = '',\n                uffff;\n            // When parsing for string values, we must look for \" and \\ characters.\n            if (ch === '\"') {\n                while (next()) {\n                    if (ch === '\"') {\n                        next();\n                        return string;\n                    }\n                    if (ch === '\\\\') {\n                        next();\n                        if (ch === 'u') {\n                            uffff = 0;\n                            for (i = 0; i < 4; i += 1) {\n                                hex = parseInt(next(), 16);\n                                if (!isFinite(hex)) {\n                                    break;\n                                }\n                                uffff = uffff * 16 + hex;\n                            }\n                            string += String.fromCharCode(uffff);\n                        } else if (typeof escapee[ch] === 'string') {\n                            string += escapee[ch];\n                        } else {\n                            break;\n                        }\n                    } else {\n                        string += ch;\n                    }\n                }\n            }\n            error('Bad string');\n        },\n        white = function() {\n            // Skip whitespace.\n            while (ch && ch <= ' ') {\n                next();\n            }\n        },\n        word = function() {\n            // true, false, or null.\n            switch (ch) {\n                case 't':\n                    next('t');\n                    next('r');\n                    next('u');\n                    next('e');\n                    return true;\n                case 'f':\n                    next('f');\n                    next('a');\n                    next('l');\n                    next('s');\n                    next('e');\n                    return false;\n                case 'n':\n                    next('n');\n                    next('u');\n                    next('l');\n                    next('l');\n                    return null;\n            }\n            error('Unexpected \"' + ch + '\"');\n        },\n        value, // Placeholder for the value function.\n        array = function() {\n            // Parse an array value.\n            var array = [];\n\n            if (ch === '[') {\n                next('[');\n                white();\n                if (ch === ']') {\n                    next(']');\n                    return array; // empty array\n                }\n                while (ch) {\n                    array.push(value());\n                    white();\n                    if (ch === ']') {\n                        next(']');\n                        return array;\n                    }\n                    next(',');\n                    white();\n                }\n            }\n            error('Bad array');\n        },\n        object = function() {\n            // Parse an object value.\n            var key,\n                object = {};\n\n            if (ch === '{') {\n                next('{');\n                white();\n                if (ch === '}') {\n                    next('}');\n                    return object; // empty object\n                }\n                while (ch) {\n                    key = string();\n                    white();\n                    next(':');\n                    if (Object.hasOwnProperty.call(object, key)) {\n                        error('Duplicate key \"' + key + '\"');\n                    }\n                    object[key] = value();\n                    white();\n                    if (ch === '}') {\n                        next('}');\n                        return object;\n                    }\n                    next(',');\n                    white();\n                }\n            }\n            error('Bad object');\n        };\n\n    value = function() {\n        // Parse a JSON value. It could be an object, an array, a string,\n        // a number, or a word.\n        white();\n        switch (ch) {\n            case '{':\n                return object();\n            case '[':\n                return array();\n            case '\"':\n                return string();\n            case '-':\n                return number();\n            default:\n                return ch >= '0' && ch <= '9' ? number() : word();\n        }\n    };\n\n    // Return the json_parse function. It will have access to all of the\n    // above functions and variables.\n    return function(source) {\n        var result;\n\n        text = source;\n        at = 0;\n        ch = ' ';\n        result = value();\n        white();\n        if (ch) {\n            error('Syntax error');\n        }\n\n        return result;\n    };\n})();\n\n_.base64Encode = function(data) {\n    var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,\n        ac = 0,\n        enc = '',\n        tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    data = _.utf8Encode(data);\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1 << 16 | o2 << 8 | o3;\n\n        h1 = bits >> 18 & 0x3f;\n        h2 = bits >> 12 & 0x3f;\n        h3 = bits >> 6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n            break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n            break;\n    }\n\n    return enc;\n};\n\n_.utf8Encode = function(string) {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n    var utftext = '',\n        start,\n        end;\n    var stringl = 0,\n        n;\n\n    start = end = 0;\n    stringl = string.length;\n\n    for (n = 0; n < stringl; n++) {\n        var c1 = string.charCodeAt(n);\n        var enc = null;\n\n        if (c1 < 128) {\n            end++;\n        } else if ((c1 > 127) && (c1 < 2048)) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.substring(start, end);\n            }\n            utftext += enc;\n            start = end = n + 1;\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length);\n    }\n\n    return utftext;\n};\n\n_.UUID = (function() {\n\n    // Time/ticks information\n    // 1*new Date() is a cross browser version of Date.now()\n    var T = function() {\n        var d = 1 * new Date(),\n            i = 0;\n\n        // this while loop figures how many browser ticks go by\n        // before 1*new Date() returns a new number, ie the amount\n        // of ticks that go by per millisecond\n        while (d == 1 * new Date()) {\n            i++;\n        }\n\n        return d.toString(16) + i.toString(16);\n    };\n\n    // Math.Random entropy\n    var R = function() {\n        return Math.random().toString(16).replace('.', '');\n    };\n\n    // User agent entropy\n    // This function takes the user agent string, and then xors\n    // together each sequence of 8 bytes.  This produces a final\n    // sequence of 8 bytes which it returns as hex.\n    var UA = function() {\n        var ua = userAgent,\n            i, ch, buffer = [],\n            ret = 0;\n\n        function xor(result, byte_array) {\n            var j, tmp = 0;\n            for (j = 0; j < byte_array.length; j++) {\n                tmp |= (buffer[j] << j * 8);\n            }\n            return result ^ tmp;\n        }\n\n        for (i = 0; i < ua.length; i++) {\n            ch = ua.charCodeAt(i);\n            buffer.unshift(ch & 0xFF);\n            if (buffer.length >= 4) {\n                ret = xor(ret, buffer);\n                buffer = [];\n            }\n        }\n\n        if (buffer.length > 0) {\n            ret = xor(ret, buffer);\n        }\n\n        return ret.toString(16);\n    };\n\n    return function() {\n        var se = (screen.height * screen.width).toString(16);\n        return (T() + '-' + R() + '-' + UA() + '-' + se + '-' + T());\n    };\n})();\n\n// _.isBlockedUA()\n// This is to block various web spiders from executing our JS and\n// sending false tracking data\n_.isBlockedUA = function(ua) {\n    if (/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(ua)) {\n        return true;\n    }\n    return false;\n};\n\n/**\n * @param {Object=} formdata\n * @param {string=} arg_separator\n */\n_.HTTPBuildQuery = function(formdata, arg_separator) {\n    var use_val, use_key, tmp_arr = [];\n\n    if (_.isUndefined(arg_separator)) {\n        arg_separator = '&';\n    }\n\n    _.each(formdata, function(val, key) {\n        use_val = encodeURIComponent(val.toString());\n        use_key = encodeURIComponent(key);\n        tmp_arr[tmp_arr.length] = use_key + '=' + use_val;\n    });\n\n    return tmp_arr.join(arg_separator);\n};\n\n_.getQueryParam = function(url, param) {\n    // Expects a raw URL\n\n    param = param.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regexS = '[\\\\?&]' + param + '=([^&#]*)',\n        regex = new RegExp(regexS),\n        results = regex.exec(url);\n    if (results === null || (results && typeof(results[1]) !== 'string' && results[1].length)) {\n        return '';\n    } else {\n        var result = results[1];\n        try {\n            result = decodeURIComponent(result);\n        } catch(err) {\n            console$1.error('Skipping decoding for malformed query param: ' + result);\n        }\n        return result.replace(/\\+/g, ' ');\n    }\n};\n\n_.getHashParam = function(hash, param) {\n    var matches = hash.match(new RegExp(param + '=([^&]*)'));\n    return matches ? matches[1] : null;\n};\n\n// _.cookie\n// Methods partially borrowed from quirksmode.org/js/cookies.html\n_.cookie = {\n    get: function(name) {\n        var nameEQ = name + '=';\n        var ca = document$1.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) == ' ') {\n                c = c.substring(1, c.length);\n            }\n            if (c.indexOf(nameEQ) === 0) {\n                return decodeURIComponent(c.substring(nameEQ.length, c.length));\n            }\n        }\n        return null;\n    },\n\n    parse: function(name) {\n        var cookie;\n        try {\n            cookie = _.JSONDecode(_.cookie.get(name)) || {};\n        } catch (err) {\n            // noop\n        }\n        return cookie;\n    },\n\n    set_seconds: function(name, value, seconds, cross_subdomain, is_secure) {\n        var cdomain = '',\n            expires = '',\n            secure = '';\n\n        if (cross_subdomain) {\n            var matches = document$1.location.hostname.match(DOMAIN_MATCH_REGEX),\n                domain = matches ? matches[0] : '';\n\n            cdomain = ((domain) ? '; domain=.' + domain : '');\n        }\n\n        if (seconds) {\n            var date = new Date();\n            date.setTime(date.getTime() + (seconds * 1000));\n            expires = '; expires=' + date.toGMTString();\n        }\n\n        if (is_secure) {\n            secure = '; secure';\n        }\n\n        document$1.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\n    },\n\n    set: function(name, value, days, cross_subdomain, is_secure) {\n        var cdomain = '', expires = '', secure = '';\n\n        if (cross_subdomain) {\n            var matches = document$1.location.hostname.match(DOMAIN_MATCH_REGEX),\n                domain = matches ? matches[0] : '';\n\n            cdomain   = ((domain) ? '; domain=.' + domain : '');\n        }\n\n        if (days) {\n            var date = new Date();\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            expires = '; expires=' + date.toGMTString();\n        }\n\n        if (is_secure) {\n            secure = '; secure';\n        }\n\n        var new_cookie_val = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\n        document$1.cookie = new_cookie_val;\n        return new_cookie_val;\n    },\n\n    remove: function(name, cross_subdomain) {\n        _.cookie.set(name, '', -1, cross_subdomain);\n    }\n};\n\n// _.localStorage\nvar _localStorage_supported = null;\n_.localStorage = {\n    is_supported: function() {\n        if (_localStorage_supported !== null) {\n            return _localStorage_supported;\n        }\n\n        var supported = true;\n        try {\n            var key = '__mplssupport__',\n                val = 'xyz';\n            _.localStorage.set(key, val);\n            if (_.localStorage.get(key) !== val) {\n                supported = false;\n            }\n            _.localStorage.remove(key);\n        } catch (err) {\n            supported = false;\n        }\n        if (!supported) {\n            console$1.error('localStorage unsupported; falling back to cookie store');\n        }\n\n        _localStorage_supported = supported;\n        return supported;\n    },\n\n    error: function(msg) {\n        console$1.error('localStorage error: ' + msg);\n    },\n\n    get: function(name) {\n        try {\n            return window.localStorage.getItem(name);\n        } catch (err) {\n            _.localStorage.error(err);\n        }\n        return null;\n    },\n\n    parse: function(name) {\n        try {\n            return _.JSONDecode(_.localStorage.get(name)) || {};\n        } catch (err) {\n            // noop\n        }\n        return null;\n    },\n\n    set: function(name, value) {\n        try {\n            window.localStorage.setItem(name, value);\n        } catch (err) {\n            _.localStorage.error(err);\n        }\n    },\n\n    remove: function(name) {\n        try {\n            window.localStorage.removeItem(name);\n        } catch (err) {\n            _.localStorage.error(err);\n        }\n    }\n};\n\n_.register_event = (function() {\n    // written by Dean Edwards, 2005\n    // with input from Tino Zijdel - crisp@xs4all.nl\n    // with input from Carl Sverre - mail@carlsverre.com\n    // with input from Mixpanel\n    // http://dean.edwards.name/weblog/2005/10/add-event/\n    // https://gist.github.com/1930440\n\n    /**\n     * @param {Object} element\n     * @param {string} type\n     * @param {function(...*)} handler\n     * @param {boolean=} oldSchool\n     * @param {boolean=} useCapture\n     */\n    var register_event = function(element, type, handler, oldSchool, useCapture) {\n        if (!element) {\n            console$1.error('No valid element provided to register_event');\n            return;\n        }\n\n        if (element.addEventListener && !oldSchool) {\n            element.addEventListener(type, handler, !!useCapture);\n        } else {\n            var ontype = 'on' + type;\n            var old_handler = element[ontype]; // can be undefined\n            element[ontype] = makeHandler(element, handler, old_handler);\n        }\n    };\n\n    function makeHandler(element, new_handler, old_handlers) {\n        var handler = function(event) {\n            event = event || fixEvent(window.event);\n\n            // this basically happens in firefox whenever another script\n            // overwrites the onload callback and doesn't pass the event\n            // object to previously defined callbacks.  All the browsers\n            // that don't define window.event implement addEventListener\n            // so the dom_loaded handler will still be fired as usual.\n            if (!event) {\n                return undefined;\n            }\n\n            var ret = true;\n            var old_result, new_result;\n\n            if (_.isFunction(old_handlers)) {\n                old_result = old_handlers(event);\n            }\n            new_result = new_handler.call(element, event);\n\n            if ((false === old_result) || (false === new_result)) {\n                ret = false;\n            }\n\n            return ret;\n        };\n\n        return handler;\n    }\n\n    function fixEvent(event) {\n        if (event) {\n            event.preventDefault = fixEvent.preventDefault;\n            event.stopPropagation = fixEvent.stopPropagation;\n        }\n        return event;\n    }\n    fixEvent.preventDefault = function() {\n        this.returnValue = false;\n    };\n    fixEvent.stopPropagation = function() {\n        this.cancelBubble = true;\n    };\n\n    return register_event;\n})();\n\n\nvar TOKEN_MATCH_REGEX = new RegExp('^(\\\\w*)\\\\[(\\\\w+)([=~\\\\|\\\\^\\\\$\\\\*]?)=?\"?([^\\\\]\"]*)\"?\\\\]$');\n\n_.dom_query = (function() {\n    /* document.getElementsBySelector(selector)\n    - returns an array of element objects from the current document\n    matching the CSS selector. Selectors can contain element names,\n    class names and ids and can be nested. For example:\n\n    elements = document.getElementsBySelector('div#main p a.external')\n\n    Will return an array of all 'a' elements with 'external' in their\n    class attribute that are contained inside 'p' elements that are\n    contained inside the 'div' element which has id=\"main\"\n\n    New in version 0.4: Support for CSS2 and CSS3 attribute selectors:\n    See http://www.w3.org/TR/css3-selectors/#attribute-selectors\n\n    Version 0.4 - Simon Willison, March 25th 2003\n    -- Works in Phoenix 0.5, Mozilla 1.3, Opera 7, Internet Explorer 6, Internet Explorer 5 on Windows\n    -- Opera 7 fails\n\n    Version 0.5 - Carl Sverre, Jan 7th 2013\n    -- Now uses jQuery-esque `hasClass` for testing class name\n    equality.  This fixes a bug related to '-' characters being\n    considered not part of a 'word' in regex.\n    */\n\n    function getAllChildren(e) {\n        // Returns all children of element. Workaround required for IE5/Windows. Ugh.\n        return e.all ? e.all : e.getElementsByTagName('*');\n    }\n\n    var bad_whitespace = /[\\t\\r\\n]/g;\n\n    function hasClass(elem, selector) {\n        var className = ' ' + selector + ' ';\n        return ((' ' + elem.className + ' ').replace(bad_whitespace, ' ').indexOf(className) >= 0);\n    }\n\n    function getElementsBySelector(selector) {\n        // Attempt to fail gracefully in lesser browsers\n        if (!document$1.getElementsByTagName) {\n            return [];\n        }\n        // Split selector in to tokens\n        var tokens = selector.split(' ');\n        var token, bits, tagName, found, foundCount, i, j, k, elements, currentContextIndex;\n        var currentContext = [document$1];\n        for (i = 0; i < tokens.length; i++) {\n            token = tokens[i].replace(/^\\s+/, '').replace(/\\s+$/, '');\n            if (token.indexOf('#') > -1) {\n                // Token is an ID selector\n                bits = token.split('#');\n                tagName = bits[0];\n                var id = bits[1];\n                var element = document$1.getElementById(id);\n                if (!element || (tagName && element.nodeName.toLowerCase() != tagName)) {\n                    // element not found or tag with that ID not found, return false\n                    return [];\n                }\n                // Set currentContext to contain just this element\n                currentContext = [element];\n                continue; // Skip to next token\n            }\n            if (token.indexOf('.') > -1) {\n                // Token contains a class selector\n                bits = token.split('.');\n                tagName = bits[0];\n                var className = bits[1];\n                if (!tagName) {\n                    tagName = '*';\n                }\n                // Get elements matching tag, filter them for class selector\n                found = [];\n                foundCount = 0;\n                for (j = 0; j < currentContext.length; j++) {\n                    if (tagName == '*') {\n                        elements = getAllChildren(currentContext[j]);\n                    } else {\n                        elements = currentContext[j].getElementsByTagName(tagName);\n                    }\n                    for (k = 0; k < elements.length; k++) {\n                        found[foundCount++] = elements[k];\n                    }\n                }\n                currentContext = [];\n                currentContextIndex = 0;\n                for (j = 0; j < found.length; j++) {\n                    if (found[j].className &&\n                        _.isString(found[j].className) && // some SVG elements have classNames which are not strings\n                        hasClass(found[j], className)\n                    ) {\n                        currentContext[currentContextIndex++] = found[j];\n                    }\n                }\n                continue; // Skip to next token\n            }\n            // Code to deal with attribute selectors\n            var token_match = token.match(TOKEN_MATCH_REGEX);\n            if (token_match) {\n                tagName = token_match[1];\n                var attrName = token_match[2];\n                var attrOperator = token_match[3];\n                var attrValue = token_match[4];\n                if (!tagName) {\n                    tagName = '*';\n                }\n                // Grab all of the tagName elements within current context\n                found = [];\n                foundCount = 0;\n                for (j = 0; j < currentContext.length; j++) {\n                    if (tagName == '*') {\n                        elements = getAllChildren(currentContext[j]);\n                    } else {\n                        elements = currentContext[j].getElementsByTagName(tagName);\n                    }\n                    for (k = 0; k < elements.length; k++) {\n                        found[foundCount++] = elements[k];\n                    }\n                }\n                currentContext = [];\n                currentContextIndex = 0;\n                var checkFunction; // This function will be used to filter the elements\n                switch (attrOperator) {\n                    case '=': // Equality\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName) == attrValue);\n                        };\n                        break;\n                    case '~': // Match one of space seperated words\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName).match(new RegExp('\\\\b' + attrValue + '\\\\b')));\n                        };\n                        break;\n                    case '|': // Match start with value followed by optional hyphen\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName).match(new RegExp('^' + attrValue + '-?')));\n                        };\n                        break;\n                    case '^': // Match starts with value\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName).indexOf(attrValue) === 0);\n                        };\n                        break;\n                    case '$': // Match ends with value - fails with \"Warning\" in Opera 7\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName).lastIndexOf(attrValue) == e.getAttribute(attrName).length - attrValue.length);\n                        };\n                        break;\n                    case '*': // Match ends with value\n                        checkFunction = function(e) {\n                            return (e.getAttribute(attrName).indexOf(attrValue) > -1);\n                        };\n                        break;\n                    default:\n                        // Just test for existence of attribute\n                        checkFunction = function(e) {\n                            return e.getAttribute(attrName);\n                        };\n                }\n                currentContext = [];\n                currentContextIndex = 0;\n                for (j = 0; j < found.length; j++) {\n                    if (checkFunction(found[j])) {\n                        currentContext[currentContextIndex++] = found[j];\n                    }\n                }\n                // alert('Attribute Selector: '+tagName+' '+attrName+' '+attrOperator+' '+attrValue);\n                continue; // Skip to next token\n            }\n            // If we get here, token is JUST an element (not a class or ID selector)\n            tagName = token;\n            found = [];\n            foundCount = 0;\n            for (j = 0; j < currentContext.length; j++) {\n                elements = currentContext[j].getElementsByTagName(tagName);\n                for (k = 0; k < elements.length; k++) {\n                    found[foundCount++] = elements[k];\n                }\n            }\n            currentContext = found;\n        }\n        return currentContext;\n    }\n\n    return function(query) {\n        if (_.isElement(query)) {\n            return [query];\n        } else if (_.isObject(query) && !_.isUndefined(query.length)) {\n            return query;\n        } else {\n            return getElementsBySelector.call(this, query);\n        }\n    };\n})();\n\n_.info = {\n    campaignParams: function() {\n        var campaign_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term'.split(' '),\n            kw = '',\n            params = {};\n        _.each(campaign_keywords, function(kwkey) {\n            kw = _.getQueryParam(document$1.URL, kwkey);\n            if (kw.length) {\n                params[kwkey] = kw;\n            }\n        });\n\n        return params;\n    },\n\n    searchEngine: function(referrer) {\n        if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n            return 'google';\n        } else if (referrer.search('https?://(.*)bing.com') === 0) {\n            return 'bing';\n        } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n            return 'yahoo';\n        } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n            return 'duckduckgo';\n        } else {\n            return null;\n        }\n    },\n\n    searchInfo: function(referrer) {\n        var search = _.info.searchEngine(referrer),\n            param = (search != 'yahoo') ? 'q' : 'p',\n            ret = {};\n\n        if (search !== null) {\n            ret['$search_engine'] = search;\n\n            var keyword = _.getQueryParam(referrer, param);\n            if (keyword.length) {\n                ret['mp_keyword'] = keyword;\n            }\n        }\n\n        return ret;\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include key words used in later checks.\n     */\n    browser: function(user_agent, vendor, opera) {\n        vendor = vendor || ''; // vendor is undefined for at least IE9\n        if (opera || _.includes(user_agent, ' OPR/')) {\n            if (_.includes(user_agent, 'Mini')) {\n                return 'Opera Mini';\n            }\n            return 'Opera';\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry';\n        } else if (_.includes(user_agent, 'IEMobile') || _.includes(user_agent, 'WPDesktop')) {\n            return 'Internet Explorer Mobile';\n        } else if (_.includes(user_agent, 'Edge')) {\n            return 'Microsoft Edge';\n        } else if (_.includes(user_agent, 'FBIOS')) {\n            return 'Facebook Mobile';\n        } else if (_.includes(user_agent, 'Chrome')) {\n            return 'Chrome';\n        } else if (_.includes(user_agent, 'CriOS')) {\n            return 'Chrome iOS';\n        } else if (_.includes(user_agent, 'UCWEB') || _.includes(user_agent, 'UCBrowser')) {\n            return 'UC Browser';\n        } else if (_.includes(user_agent, 'FxiOS')) {\n            return 'Firefox iOS';\n        } else if (_.includes(vendor, 'Apple')) {\n            if (_.includes(user_agent, 'Mobile')) {\n                return 'Mobile Safari';\n            }\n            return 'Safari';\n        } else if (_.includes(user_agent, 'Android')) {\n            return 'Android Mobile';\n        } else if (_.includes(user_agent, 'Konqueror')) {\n            return 'Konqueror';\n        } else if (_.includes(user_agent, 'Firefox')) {\n            return 'Firefox';\n        } else if (_.includes(user_agent, 'MSIE') || _.includes(user_agent, 'Trident/')) {\n            return 'Internet Explorer';\n        } else if (_.includes(user_agent, 'Gecko')) {\n            return 'Mozilla';\n        } else {\n            return '';\n        }\n    },\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     */\n    browserVersion: function(userAgent, vendor, opera) {\n        var browser = _.info.browser(userAgent, vendor, opera);\n        var versionRegexs = {\n            'Internet Explorer Mobile': /rv:(\\d+(\\.\\d+)?)/,\n            'Microsoft Edge': /Edge\\/(\\d+(\\.\\d+)?)/,\n            'Chrome': /Chrome\\/(\\d+(\\.\\d+)?)/,\n            'Chrome iOS': /CriOS\\/(\\d+(\\.\\d+)?)/,\n            'UC Browser' : /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n            'Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n            'Mobile Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n            'Opera': /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n            'Firefox': /Firefox\\/(\\d+(\\.\\d+)?)/,\n            'Firefox iOS': /FxiOS\\/(\\d+(\\.\\d+)?)/,\n            'Konqueror': /Konqueror:(\\d+(\\.\\d+)?)/,\n            'BlackBerry': /BlackBerry (\\d+(\\.\\d+)?)/,\n            'Android Mobile': /android\\s(\\d+(\\.\\d+)?)/,\n            'Internet Explorer': /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n            'Mozilla': /rv:(\\d+(\\.\\d+)?)/\n        };\n        var regex = versionRegexs[browser];\n        if (regex === undefined) {\n            return null;\n        }\n        var matches = userAgent.match(regex);\n        if (!matches) {\n            return null;\n        }\n        return parseFloat(matches[matches.length - 2]);\n    },\n\n    os: function() {\n        var a = userAgent;\n        if (/Windows/i.test(a)) {\n            if (/Phone/.test(a) || /WPDesktop/.test(a)) {\n                return 'Windows Phone';\n            }\n            return 'Windows';\n        } else if (/(iPhone|iPad|iPod)/.test(a)) {\n            return 'iOS';\n        } else if (/Android/.test(a)) {\n            return 'Android';\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n            return 'BlackBerry';\n        } else if (/Mac/i.test(a)) {\n            return 'Mac OS X';\n        } else if (/Linux/.test(a)) {\n            return 'Linux';\n        } else if (/CrOS/.test(a)) {\n            return 'Chrome OS';\n        } else {\n            return '';\n        }\n    },\n\n    device: function(user_agent) {\n        if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n            return 'Windows Phone';\n        } else if (/iPad/.test(user_agent)) {\n            return 'iPad';\n        } else if (/iPod/.test(user_agent)) {\n            return 'iPod Touch';\n        } else if (/iPhone/.test(user_agent)) {\n            return 'iPhone';\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry';\n        } else if (/Android/.test(user_agent)) {\n            return 'Android';\n        } else {\n            return '';\n        }\n    },\n\n    referringDomain: function(referrer) {\n        var split = referrer.split('/');\n        if (split.length >= 3) {\n            return split[2];\n        }\n        return '';\n    },\n\n    properties: function() {\n        return _.extend(_.strip_empty_properties({\n            '$os': _.info.os(),\n            '$browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera),\n            '$referrer': document$1.referrer,\n            '$referring_domain': _.info.referringDomain(document$1.referrer),\n            '$device': _.info.device(userAgent)\n        }), {\n            '$current_url': window$1.location.href,\n            '$browser_version': _.info.browserVersion(userAgent, navigator$1.vendor, windowOpera),\n            '$screen_height': screen.height,\n            '$screen_width': screen.width,\n            'mp_lib': 'web',\n            '$lib_version': Config.LIB_VERSION,\n            '$insert_id': Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n            'time': _.timestamp() / 1000 // epoch time in seconds\n        });\n    },\n\n    people_properties: function() {\n        return _.extend(_.strip_empty_properties({\n            '$os': _.info.os(),\n            '$browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera)\n        }), {\n            '$browser_version': _.info.browserVersion(userAgent, navigator$1.vendor, windowOpera)\n        });\n    },\n\n    pageviewInfo: function(page) {\n        return _.strip_empty_properties({\n            'mp_page': page,\n            'mp_referrer': document$1.referrer,\n            'mp_browser': _.info.browser(userAgent, navigator$1.vendor, windowOpera),\n            'mp_platform': _.info.os()\n        });\n    }\n};\n\n// EXPORTS (for closure compiler)\n_['toArray']            = _.toArray;\n_['isObject']           = _.isObject;\n_['JSONEncode']         = _.JSONEncode;\n_['JSONDecode']         = _.JSONDecode;\n_['isBlockedUA']        = _.isBlockedUA;\n_['isEmptyObject']      = _.isEmptyObject;\n_['info']               = _.info;\n_['info']['device']     = _.info.device;\n_['info']['browser']    = _.info.browser;\n_['info']['properties'] = _.info.properties;\n\n/*\n * Get the className of an element, accounting for edge cases where element.className is an object\n * @param {Element} el - element to get the className of\n * @returns {string} the element's class\n */\nfunction getClassName(el) {\n    switch(typeof el.className) {\n        case 'string':\n            return el.className;\n        case 'object': // handle cases where className might be SVGAnimatedString or some other type\n            return el.className.baseVal || el.getAttribute('class') || '';\n        default: // future proof\n            return '';\n    }\n}\n\n/*\n * Get the direct text content of an element, protecting against sensitive data collection.\n * Concats textContent of each of the element's text node children; this avoids potential\n * collection of sensitive data that could happen if we used element.textContent and the\n * element had sensitive child elements, since element.textContent includes child content.\n * Scrubs values that look like they could be sensitive (i.e. cc or ssn number).\n * @param {Element} el - element to get the text of\n * @returns {string} the element's direct text content\n */\nfunction getSafeText(el) {\n    var elText = '';\n\n    if (shouldTrackElement(el) && el.childNodes && el.childNodes.length) {\n        _.each(el.childNodes, function(child) {\n            if (isTextNode(child) && child.textContent) {\n                elText += _.trim(child.textContent)\n                    // scrub potentially sensitive values\n                    .split(/(\\s+)/).filter(shouldTrackValue).join('')\n                    // normalize whitespace\n                    .replace(/[\\r\\n]/g, ' ').replace(/[ ]+/g, ' ')\n                    // truncate\n                    .substring(0, 255);\n            }\n        });\n    }\n\n    return _.trim(elText);\n}\n\n/*\n * Check whether an element has nodeType Node.ELEMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nfunction isElementNode(el) {\n    return el && el.nodeType === 1; // Node.ELEMENT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element is of a given tag type.\n * Due to potential reference discrepancies (such as the webcomponents.js polyfill),\n * we want to match tagNames instead of specific references because something like\n * element === document.body won't always work because element might not be a native\n * element.\n * @param {Element} el - element to check\n * @param {string} tag - tag name (e.g., \"div\")\n * @returns {boolean} whether el is of the given tag type\n */\nfunction isTag(el, tag) {\n    return el && el.tagName && el.tagName.toLowerCase() === tag.toLowerCase();\n}\n\n/*\n * Check whether an element has nodeType Node.TEXT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nfunction isTextNode(el) {\n    return el && el.nodeType === 3; // Node.TEXT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether a DOM event should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @param {Event} event - event to check\n * @returns {boolean} whether the event should be tracked\n */\nfunction shouldTrackDomEvent(el, event) {\n    if (!el || isTag(el, 'html') || !isElementNode(el)) {\n        return false;\n    }\n    var tag = el.tagName.toLowerCase();\n    switch (tag) {\n        case 'html':\n            return false;\n        case 'form':\n            return event.type === 'submit';\n        case 'input':\n            if (['button', 'submit'].indexOf(el.getAttribute('type')) === -1) {\n                return event.type === 'change';\n            } else {\n                return event.type === 'click';\n            }\n        case 'select':\n        case 'textarea':\n            return event.type === 'change';\n        default:\n            return event.type === 'click';\n    }\n}\n\n/*\n * Check whether a DOM element should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be tracked\n */\nfunction shouldTrackElement(el) {\n    for (var curEl = el; curEl.parentNode && !isTag(curEl, 'body'); curEl = curEl.parentNode) {\n        var classes = getClassName(curEl).split(' ');\n        if (_.includes(classes, 'mp-sensitive') || _.includes(classes, 'mp-no-track')) {\n            return false;\n        }\n    }\n\n    if (_.includes(getClassName(el).split(' '), 'mp-include')) {\n        return true;\n    }\n\n    // don't send data from inputs or similar elements since there will always be\n    // a risk of clientside javascript placing sensitive data in attributes\n    if (\n        isTag(el, 'input') ||\n        isTag(el, 'select') ||\n        isTag(el, 'textarea') ||\n        el.getAttribute('contenteditable') === 'true'\n    ) {\n        return false;\n    }\n\n    // don't include hidden or password fields\n    var type = el.type || '';\n    if (typeof type === 'string') { // it's possible for el.type to be a DOM element if el is a form with a child input[name=\"type\"]\n        switch(type.toLowerCase()) {\n            case 'hidden':\n                return false;\n            case 'password':\n                return false;\n        }\n    }\n\n    // filter out data from fields that look like sensitive fields\n    var name = el.name || el.id || '';\n    if (typeof name === 'string') { // it's possible for el.name or el.id to be a DOM element if el is a form with a child input[name=\"name\"]\n        var sensitiveNameRegex = /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i;\n        if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ''))) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\n/*\n * Check whether a string value should be \"tracked\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {string} value - string value to check\n * @returns {boolean} whether the element should be tracked\n */\nfunction shouldTrackValue(value) {\n    if (value === null || _.isUndefined(value)) {\n        return false;\n    }\n\n    if (typeof value === 'string') {\n        value = _.trim(value);\n\n        // check to see if input value looks like a credit card number\n        // see: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s20.html\n        var ccRegex = /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/;\n        if (ccRegex.test((value || '').replace(/[- ]/g, ''))) {\n            return false;\n        }\n\n        // check to see if input value looks like a social security number\n        var ssnRegex = /(^\\d{3}-?\\d{2}-?\\d{4}$)/;\n        if (ssnRegex.test(value)) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nvar autotrack = {\n    _initializedTokens: [],\n\n    _previousElementSibling: function(el) {\n        if (el.previousElementSibling) {\n            return el.previousElementSibling;\n        } else {\n            do {\n                el = el.previousSibling;\n            } while (el && !isElementNode(el));\n            return el;\n        }\n    },\n\n    _loadScript: function(scriptUrlToLoad, callback) {\n        var scriptTag = document.createElement('script');\n        scriptTag.type = 'text/javascript';\n        scriptTag.src = scriptUrlToLoad;\n        scriptTag.onload = callback;\n\n        var scripts = document.getElementsByTagName('script');\n        if (scripts.length > 0) {\n            scripts[0].parentNode.insertBefore(scriptTag, scripts[0]);\n        } else {\n            document.body.appendChild(scriptTag);\n        }\n    },\n\n    _getPropertiesFromElement: function(elem) {\n        var props = {\n            'classes': getClassName(elem).split(' '),\n            'tag_name': elem.tagName.toLowerCase()\n        };\n\n        if (shouldTrackElement(elem)) {\n            _.each(elem.attributes, function(attr) {\n                if (shouldTrackValue(attr.value)) {\n                    props['attr__' + attr.name] = attr.value;\n                }\n            });\n        }\n\n        var nthChild = 1;\n        var nthOfType = 1;\n        var currentElem = elem;\n        while (currentElem = this._previousElementSibling(currentElem)) { // eslint-disable-line no-cond-assign\n            nthChild++;\n            if (currentElem.tagName === elem.tagName) {\n                nthOfType++;\n            }\n        }\n        props['nth_child'] = nthChild;\n        props['nth_of_type'] = nthOfType;\n\n        return props;\n    },\n\n    _getDefaultProperties: function(eventType) {\n        return {\n            '$event_type': eventType,\n            '$ce_version': 1,\n            '$host': window.location.host,\n            '$pathname': window.location.pathname\n        };\n    },\n\n    _extractCustomPropertyValue: function(customProperty) {\n        var propValues = [];\n        _.each(document.querySelectorAll(customProperty['css_selector']), function(matchedElem) {\n            var value;\n\n            if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n                value = matchedElem['value'];\n            } else if (matchedElem['textContent']) {\n                value = matchedElem['textContent'];\n            }\n\n            if (shouldTrackValue(value)) {\n                propValues.push(value);\n            }\n        });\n        return propValues.join(', ');\n    },\n\n    _getCustomProperties: function(targetElementList) {\n        var props = {};\n        _.each(this._customProperties, function(customProperty) {\n            _.each(customProperty['event_selectors'], function(eventSelector) {\n                var eventElements = document.querySelectorAll(eventSelector);\n                _.each(eventElements, function(eventElement) {\n                    if (_.includes(targetElementList, eventElement) && shouldTrackElement(eventElement)) {\n                        props[customProperty['name']] = this._extractCustomPropertyValue(customProperty);\n                    }\n                }, this);\n            }, this);\n        }, this);\n        return props;\n    },\n\n    _getEventTarget: function(e) {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n        if (typeof e.target === 'undefined') {\n            return e.srcElement;\n        } else {\n            return e.target;\n        }\n    },\n\n    _trackEvent: function(e, instance) {\n        /*** Don't mess with this code without running IE8 tests on it ***/\n        var target = this._getEventTarget(e);\n        if (isTextNode(target)) { // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n            target = target.parentNode;\n        }\n\n        if (shouldTrackDomEvent(target, e)) {\n            var targetElementList = [target];\n            var curEl = target;\n            while (curEl.parentNode && !isTag(curEl, 'body')) {\n                targetElementList.push(curEl.parentNode);\n                curEl = curEl.parentNode;\n            }\n\n            var elementsJson = [];\n            var href, explicitNoTrack = false;\n            _.each(targetElementList, function(el) {\n                var shouldTrackEl = shouldTrackElement(el);\n\n                // if the element or a parent element is an anchor tag\n                // include the href as a property\n                if (el.tagName.toLowerCase() === 'a') {\n                    href = el.getAttribute('href');\n                    href = shouldTrackEl && shouldTrackValue(href) && href;\n                }\n\n                // allow users to programatically prevent tracking of elements by adding class 'mp-no-track'\n                var classes = getClassName(el).split(' ');\n                if (_.includes(classes, 'mp-no-track')) {\n                    explicitNoTrack = true;\n                }\n\n                elementsJson.push(this._getPropertiesFromElement(el));\n            }, this);\n\n            if (explicitNoTrack) {\n                return false;\n            }\n\n            // only populate text content from target element (not parents)\n            // to prevent text within a sensitive element from being collected\n            // as part of a parent's el.textContent\n            var elementText;\n            var safeElementText = getSafeText(target);\n            if (safeElementText && safeElementText.length) {\n                elementText = safeElementText;\n            }\n\n            var props = _.extend(\n                this._getDefaultProperties(e.type),\n                {\n                    '$elements':  elementsJson,\n                    '$el_attr__href': href,\n                    '$el_text': elementText\n                },\n                this._getCustomProperties(targetElementList)\n            );\n\n            instance.track('$web_event', props);\n            return true;\n        }\n    },\n\n    // only reason is to stub for unit tests\n    // since you can't override window.location props\n    _navigate: function(href) {\n        window.location.href = href;\n    },\n\n    _addDomEventHandlers: function(instance) {\n        var handler = _.bind(function(e) {\n            e = e || window.event;\n            this._trackEvent(e, instance);\n        }, this);\n        _.register_event(document, 'submit', handler, false, true);\n        _.register_event(document, 'change', handler, false, true);\n        _.register_event(document, 'click', handler, false, true);\n    },\n\n    _customProperties: {},\n    init: function(instance) {\n        if (!(document && document.body)) {\n            console.log('document not ready yet, trying again in 500 milliseconds...');\n            var that = this;\n            setTimeout(function() { that.init(instance); }, 500);\n            return;\n        }\n\n        var token = instance.get_config('token');\n        if (this._initializedTokens.indexOf(token) > -1) {\n            console.log('autotrack already initialized for token \"' + token + '\"');\n            return;\n        }\n        this._initializedTokens.push(token);\n\n        if (!this._maybeLoadEditor(instance)) { // don't autotrack actions when the editor is enabled\n            var parseDecideResponse = _.bind(function(response) {\n                if (response && response['config'] && response['config']['enable_collect_everything'] === true) {\n\n                    if (response['custom_properties']) {\n                        this._customProperties = response['custom_properties'];\n                    }\n\n                    instance.track('$web_event', _.extend({\n                        '$title': document.title\n                    }, this._getDefaultProperties('pageview')));\n\n                    this._addDomEventHandlers(instance);\n\n                } else {\n                    instance['__autotrack_enabled'] = false;\n                }\n            }, this);\n\n            instance._send_request(\n                instance.get_config('api_host') + '/decide/', {\n                    'verbose': true,\n                    'version': '1',\n                    'lib': 'web',\n                    'token': token\n                },\n                {method: 'GET'},\n                instance._prepare_callback(parseDecideResponse)\n            );\n        }\n    },\n\n    _editorParamsFromHash: function(instance, hash) {\n        var editorParams;\n        try {\n            var state = _.getHashParam(hash, 'state');\n            state = JSON.parse(decodeURIComponent(state));\n            var expiresInSeconds = _.getHashParam(hash, 'expires_in');\n            editorParams = {\n                'accessToken': _.getHashParam(hash, 'access_token'),\n                'accessTokenExpiresAt': (new Date()).getTime() + (Number(expiresInSeconds) * 1000),\n                'bookmarkletMode': !!state['bookmarkletMode'],\n                'projectId': state['projectId'],\n                'projectOwnerId': state['projectOwnerId'],\n                'projectToken': state['token'],\n                'readOnly': state['readOnly'],\n                'userFlags': state['userFlags'],\n                'userId': state['userId']\n            };\n            window.sessionStorage.setItem('editorParams', JSON.stringify(editorParams));\n\n            if (state['desiredHash']) {\n                window.location.hash = state['desiredHash'];\n            } else if (window.history) {\n                history.replaceState('', document.title, window.location.pathname + window.location.search); // completely remove hash\n            } else {\n                window.location.hash = ''; // clear hash (but leaves # unfortunately)\n            }\n        } catch (e) {\n            console.error('Unable to parse data from hash', e);\n        }\n        return editorParams;\n    },\n\n    /**\n     * To load the visual editor, we need an access token and other state. That state comes from one of three places:\n     * 1. In the URL hash params if the customer is using an old snippet\n     * 2. From session storage under the key `_mpcehash` if the snippet already parsed the hash\n     * 3. From session storage under the key `editorParams` if the editor was initialized on a previous page\n     */\n    _maybeLoadEditor: function(instance) {\n        try {\n            var parseFromUrl = false;\n            if (_.getHashParam(window.location.hash, 'state')) {\n                var state = _.getHashParam(window.location.hash, 'state');\n                state = JSON.parse(decodeURIComponent(state));\n                parseFromUrl = state['action'] === 'mpeditor';\n            }\n            var parseFromStorage = !!window.sessionStorage.getItem('_mpcehash');\n            var editorParams;\n\n            if (parseFromUrl) { // happens if they are initializing the editor using an old snippet\n                editorParams = this._editorParamsFromHash(instance, window.location.hash);\n            } else if (parseFromStorage) { // happens if they are initialized the editor and using the new snippet\n                editorParams = this._editorParamsFromHash(instance, window.sessionStorage.getItem('_mpcehash'));\n                window.sessionStorage.removeItem('_mpcehash');\n            } else { // get credentials from sessionStorage from a previous initialzation\n                editorParams = JSON.parse(window.sessionStorage.getItem('editorParams') || '{}');\n            }\n\n            if (editorParams['projectToken'] && instance.get_config('token') === editorParams['projectToken']) {\n                this._loadEditor(instance, editorParams);\n                return true;\n            } else {\n                return false;\n            }\n        } catch (e) {\n            return false;\n        }\n    },\n\n    _loadEditor: function(instance, editorParams) {\n        if (!window['_mpEditorLoaded']) { // only load the codeless event editor once, even if there are multiple instances of MixpanelLib\n            window['_mpEditorLoaded'] = true;\n            var editorUrl = instance.get_config('app_host')\n              + '/js-bundle/reports/collect-everything/editor.js?_ts='\n              + (new Date()).getTime();\n            this._loadScript(editorUrl, function() {\n                window['mp_load_editor'](editorParams);\n            });\n            return true;\n        }\n        return false;\n    },\n\n    // this is a mechanism to ramp up CE with no server-side interaction.\n    // when CE is active, every page load results in a decide request. we\n    // need to gently ramp this up so we don't overload decide. this decides\n    // deterministically if CE is enabled for this project by modding the char\n    // value of the project token.\n    enabledForProject: function(token, numBuckets, numEnabledBuckets) {\n        numBuckets = !_.isUndefined(numBuckets) ? numBuckets : 10;\n        numEnabledBuckets = !_.isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10;\n        var charCodeSum = 0;\n        for (var i = 0; i < token.length; i++) {\n            charCodeSum += token.charCodeAt(i);\n        }\n        return (charCodeSum % numBuckets) < numEnabledBuckets;\n    },\n\n    isBrowserSupported: function() {\n        return _.isFunction(document.querySelectorAll);\n    }\n};\n\n_.bind_instance_methods(autotrack);\n_.safewrap_instance_methods(autotrack);\n\n/**\n * DomTracker Object\n * @constructor\n */\nvar DomTracker = function() {};\n\n\n// interface\nDomTracker.prototype.create_properties = function() {};\nDomTracker.prototype.event_handler = function() {};\nDomTracker.prototype.after_track_handler = function() {};\n\nDomTracker.prototype.init = function(mixpanel_instance) {\n    this.mp = mixpanel_instance;\n    return this;\n};\n\n/**\n * @param {Object|string} query\n * @param {string} event_name\n * @param {Object=} properties\n * @param {function=} user_callback\n */\nDomTracker.prototype.track = function(query, event_name, properties, user_callback) {\n    var that = this;\n    var elements = _.dom_query(query);\n\n    if (elements.length === 0) {\n        console$1.error('The DOM query (' + query + ') returned 0 elements');\n        return;\n    }\n\n    _.each(elements, function(element) {\n        _.register_event(element, this.override_event, function(e) {\n            var options = {};\n            var props = that.create_properties(properties, this);\n            var timeout = that.mp.get_config('track_links_timeout');\n\n            that.event_handler(e, this, options);\n\n            // in case the mixpanel servers don't get back to us in time\n            window.setTimeout(that.track_callback(user_callback, props, options, true), timeout);\n\n            // fire the tracking event\n            that.mp.track(event_name, props, that.track_callback(user_callback, props, options));\n        });\n    }, this);\n\n    return true;\n};\n\n/**\n * @param {function} user_callback\n * @param {Object} props\n * @param {boolean=} timeout_occured\n */\nDomTracker.prototype.track_callback = function(user_callback, props, options, timeout_occured) {\n    timeout_occured = timeout_occured || false;\n    var that = this;\n\n    return function() {\n        // options is referenced from both callbacks, so we can have\n        // a 'lock' of sorts to ensure only one fires\n        if (options.callback_fired) { return; }\n        options.callback_fired = true;\n\n        if (user_callback && user_callback(timeout_occured, props) === false) {\n            // user can prevent the default functionality by\n            // returning false from their callback\n            return;\n        }\n\n        that.after_track_handler(props, options, timeout_occured);\n    };\n};\n\nDomTracker.prototype.create_properties = function(properties, element) {\n    var props;\n\n    if (typeof(properties) === 'function') {\n        props = properties(element);\n    } else {\n        props = _.extend({}, properties);\n    }\n\n    return props;\n};\n\n/**\n * LinkTracker Object\n * @constructor\n * @extends DomTracker\n */\nvar LinkTracker = function() {\n    this.override_event = 'click';\n};\n_.inherit(LinkTracker, DomTracker);\n\nLinkTracker.prototype.create_properties = function(properties, element) {\n    var props = LinkTracker.superclass.create_properties.apply(this, arguments);\n\n    if (element.href) { props['url'] = element.href; }\n\n    return props;\n};\n\nLinkTracker.prototype.event_handler = function(evt, element, options) {\n    options.new_tab = (\n        evt.which === 2 ||\n        evt.metaKey ||\n        evt.ctrlKey ||\n        element.target === '_blank'\n    );\n    options.href = element.href;\n\n    if (!options.new_tab) {\n        evt.preventDefault();\n    }\n};\n\nLinkTracker.prototype.after_track_handler = function(props, options) {\n    if (options.new_tab) { return; }\n\n    setTimeout(function() {\n        window.location = options.href;\n    }, 0);\n};\n\n/**\n * FormTracker Object\n * @constructor\n * @extends DomTracker\n */\nvar FormTracker = function() {\n    this.override_event = 'submit';\n};\n_.inherit(FormTracker, DomTracker);\n\nFormTracker.prototype.event_handler = function(evt, element, options) {\n    options.element = element;\n    evt.preventDefault();\n};\n\nFormTracker.prototype.after_track_handler = function(props, options) {\n    setTimeout(function() {\n        options.element.submit();\n    }, 0);\n};\n\n/**\n * A function used to track a Mixpanel event (e.g. MixpanelLib.track)\n * @callback trackFunction\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after tracking the event.\n */\n\n/** Public **/\n\nvar GDPR_DEFAULT_PERSISTENCE_PREFIX = '__mp_opt_in_out_';\n\n/**\n * Opt the user in to data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {trackFunction} [options.track] - function used for tracking a Mixpanel event to record the opt-in action\n * @param {string} [options.trackEventName] - event name to be used for tracking the opt-in action\n * @param {Object} [options.trackProperties] - set of properties to be tracked along with the opt-in action\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction optIn(token, options) {\n    _optInOut(true, token, options);\n}\n\n/**\n * Opt the user out of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-out cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-out cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-out cookie is set as secure or not\n */\nfunction optOut(token, options) {\n    _optInOut(false, token, options);\n}\n\n/**\n * Check whether the user has opted in to data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted in to the given opt type\n */\nfunction hasOptedIn(token, options) {\n    return _getStorageValue(token, options) === '1';\n}\n\n/**\n * Check whether the user has opted out of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted out of the given opt type\n */\nfunction hasOptedOut(token, options) {\n    if (_hasDoNotTrackFlagOn(options)) {\n        return true;\n    }\n    return _getStorageValue(token, options) === '0';\n}\n\n/**\n * Wrap a MixpanelLib method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\nfunction addOptOutCheckMixpanelLib(method) {\n    return _addOptOutCheck(method, function(name) {\n        return this.get_config(name);\n    });\n}\n\n/**\n * Wrap a MixpanelPeople method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\nfunction addOptOutCheckMixpanelPeople(method) {\n    return _addOptOutCheck(method, function(name) {\n        return this._get_config(name);\n    });\n}\n\n/**\n * Wrap a MixpanelGroup method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\nfunction addOptOutCheckMixpanelGroup(method) {\n    return _addOptOutCheck(method, function(name) {\n        return this._get_config(name);\n    });\n}\n\n/**\n * Clear the user's opt in/out status of data tracking and cookies/localstorage for the given token\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction clearOptInOut(token, options) {\n    options = options || {};\n    _getStorage(options).remove(_getStorageKey(token, options), !!options.crossSubdomainCookie);\n}\n\n/** Private **/\n\n/**\n * Get storage util\n * @param {Object} [options]\n * @param {string} [options.persistenceType]\n * @returns {object} either _.cookie or _.localstorage\n */\nfunction _getStorage(options) {\n    options = options || {};\n    return options.persistenceType === 'localStorage' ? _.localStorage : _.cookie;\n}\n\n/**\n * Get the name of the cookie that is used for the given opt type (tracking, cookie, etc.)\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the name of the cookie for the given opt type\n */\nfunction _getStorageKey(token, options) {\n    options = options || {};\n    return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token;\n}\n\n/**\n * Get the value of the cookie that is used for the given opt type (tracking, cookie, etc.)\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the value of the cookie for the given opt type\n */\nfunction _getStorageValue(token, options) {\n    return _getStorage(options).get(_getStorageKey(token, options));\n}\n\n/**\n * Check whether the user has set the DNT/doNotTrack setting to true in their browser\n * @param {Object} [options]\n * @param {string} [options.window] - alternate window object to check; used to force various DNT settings in browser tests\n * @returns {boolean} whether the DNT setting is true\n */\nfunction _hasDoNotTrackFlagOn(options) {\n    var win = (options && options.window) || window$1;\n    var nav = win['navigator'] || {};\n    var hasDntOn = false;\n\n    _.each([\n        nav['doNotTrack'], // standard\n        nav['msDoNotTrack'],\n        win['doNotTrack']\n    ], function(dntValue) {\n        if (_.includes([true, 1, '1', 'yes'], dntValue)) {\n            hasDntOn = true;\n        }\n    });\n\n    return hasDntOn;\n}\n\n/**\n * Set cookie/localstorage for the user indicating that they are opted in or out for the given opt type\n * @param {boolean} optValue - whether to opt the user in or out for the given opt type\n * @param {string} token - Mixpanel project tracking token\n * @param {Object} [options]\n * @param {trackFunction} [options.track] - function used for tracking a Mixpanel event to record the opt-in action\n * @param {string} [options.trackEventName] - event name to be used for tracking the opt-in action\n * @param {Object} [options.trackProperties] - set of properties to be tracked along with the opt-in action\n * @param {string} [options.persistencePrefix=__mp_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction _optInOut(optValue, token, options) {\n    if (!_.isString(token) || !token.length) {\n        console.error('gdpr.' + (optValue ? 'optIn' : 'optOut') + ' called with an invalid token');\n        return;\n    }\n\n    options = options || {};\n\n    _getStorage(options).set(\n        _getStorageKey(token, options),\n        optValue ? 1 : 0,\n        _.isNumber(options.cookieExpiration) ? options.cookieExpiration : null,\n        !!options.crossSubdomainCookie,\n        !!options.secureCookie\n    );\n\n    if (options.track && optValue) { // only track event if opting in (optValue=true)\n        options.track(options.trackEventName || '$opt_in', options.trackProperties);\n    }\n}\n\n/**\n * Wrap a method with a check for whether the user is opted out of data tracking and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @param {function} getConfigValue - getter function for the Mixpanel API token and other options to be used with opt-out check\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\nfunction _addOptOutCheck(method, getConfigValue) {\n    return function() {\n        var optedOut = false;\n\n        try {\n            var token = getConfigValue.call(this, 'token');\n            var persistenceType = getConfigValue.call(this, 'opt_out_tracking_persistence_type');\n            var persistencePrefix = getConfigValue.call(this, 'opt_out_tracking_cookie_prefix');\n            var win = getConfigValue.call(this, 'window'); // used to override window during browser tests\n\n            if (token) { // if there was an issue getting the token, continue method execution as normal\n                optedOut = hasOptedOut(token, {\n                    persistenceType: persistenceType,\n                    persistencePrefix: persistencePrefix,\n                    window: win\n                });\n            }\n        } catch(err) {\n            console.error('Unexpected error when checking tracking opt-out status: ' + err);\n        }\n\n        if (!optedOut) {\n            return method.apply(this, arguments);\n        }\n\n        var callback = arguments[arguments.length - 1];\n        if (typeof(callback) === 'function') {\n            callback(0);\n        }\n\n        return;\n    };\n}\n\n/** @const */ var SET_ACTION      = '$set';\n/** @const */ var SET_ONCE_ACTION = '$set_once';\n/** @const */ var UNSET_ACTION    = '$unset';\n/** @const */ var ADD_ACTION      = '$add';\n/** @const */ var APPEND_ACTION   = '$append';\n/** @const */ var UNION_ACTION    = '$union';\n/** @const */ var REMOVE_ACTION   = '$remove';\n/** @const */ var DELETE_ACTION   = '$delete';\n\n// Common internal methods for mixpanel.people and mixpanel.group APIs.\n// These methods shouldn't involve network I/O.\nvar apiActions = {\n    set_action: function(prop, to) {\n        var data = {};\n        var $set = {};\n        if (_.isObject(prop)) {\n            _.each(prop, function(v, k) {\n                if (!this._is_reserved_property(k)) {\n                    $set[k] = v;\n                }\n            }, this);\n        } else {\n            $set[prop] = to;\n        }\n\n        data[SET_ACTION] = $set;\n        return data;\n    },\n\n    unset_action: function(prop) {\n        var data = {};\n        var $unset = [];\n        if (!_.isArray(prop)) {\n            prop = [prop];\n        }\n\n        _.each(prop, function(k) {\n            if (!this._is_reserved_property(k)) {\n                $unset.push(k);\n            }\n        }, this);\n\n        data[UNSET_ACTION] = $unset;\n        return data;\n    },\n\n    set_once_action: function(prop, to) {\n        var data = {};\n        var $set_once = {};\n        if (_.isObject(prop)) {\n            _.each(prop, function(v, k) {\n                if (!this._is_reserved_property(k)) {\n                    $set_once[k] = v;\n                }\n            }, this);\n        } else {\n            $set_once[prop] = to;\n        }\n        data[SET_ONCE_ACTION] = $set_once;\n        return data;\n    },\n\n    union_action: function(list_name, values) {\n        var data = {};\n        var $union = {};\n        if (_.isObject(list_name)) {\n            _.each(list_name, function(v, k) {\n                if (!this._is_reserved_property(k)) {\n                    $union[k] = _.isArray(v) ? v : [v];\n                }\n            }, this);\n        } else {\n            $union[list_name] = _.isArray(values) ? values : [values];\n        }\n        data[UNION_ACTION] = $union;\n        return data;\n    },\n\n    append_action: function(list_name, value) {\n        var data = {};\n        var $append = {};\n        if (_.isObject(list_name)) {\n            _.each(list_name, function(v, k) {\n                if (!this._is_reserved_property(k)) {\n                    $append[k] = v;\n                }\n            }, this);\n        } else {\n            $append[list_name] = value;\n        }\n        data[APPEND_ACTION] = $append;\n        return data;\n    },\n\n    remove_action: function(list_name, value) {\n        var data = {};\n        var $remove = {};\n        if (_.isObject(list_name)) {\n            _.each(list_name, function(v, k) {\n                if (!this._is_reserved_property(k)) {\n                    $remove[k] = v;\n                }\n            }, this);\n        } else {\n            $remove[list_name] = value;\n        }\n        data[REMOVE_ACTION] = $remove;\n        return data;\n    },\n\n    delete_action: function() {\n        var data = {};\n        data[DELETE_ACTION] = '';\n        return data;\n    }\n};\n\n/**\n * Mixpanel Group Object\n * @constructor\n */\nvar MixpanelGroup = function() {};\n\n_.extend(MixpanelGroup.prototype, apiActions);\n\nMixpanelGroup.prototype._init = function(mixpanel_instance, group_key, group_id) {\n    this._mixpanel = mixpanel_instance;\n    this._group_key = group_key;\n    this._group_id = group_id;\n};\n\n/**\n * Set properties on a group.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').set('Location', '405 Howard');\n *\n *     // or set multiple properties at once\n *     mixpanel.get_group('company', 'mixpanel').set({\n *          'Location': '405 Howard',\n *          'Founded' : 2009,\n *     });\n *     // properties can be strings, integers, dates, or lists\n *\n * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n * @param {*} [to] A value to set on the given property name\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\nMixpanelGroup.prototype.set = addOptOutCheckMixpanelGroup(function(prop, to, callback) {\n    var data = this.set_action(prop, to);\n    if (_.isObject(prop)) {\n        callback = to;\n    }\n    return this._send_request(data, callback);\n});\n\n/**\n * Set properties on a group, only if they do not yet exist.\n * This will not overwrite previous group property values, unlike\n * group.set().\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').set_once('Location', '405 Howard');\n *\n *     // or set multiple properties at once\n *     mixpanel.get_group('company', 'mixpanel').set_once({\n *          'Location': '405 Howard',\n *          'Founded' : 2009,\n *     });\n *     // properties can be strings, integers, lists or dates\n *\n * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n * @param {*} [to] A value to set on the given property name\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\nMixpanelGroup.prototype.set_once = addOptOutCheckMixpanelGroup(function(prop, to, callback) {\n    var data = this.set_once_action(prop, to);\n    if (_.isObject(prop)) {\n        callback = to;\n    }\n    return this._send_request(data, callback);\n});\n\n/**\n * Unset properties on a group permanently.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').unset('Founded');\n *\n * @param {String} prop The name of the property.\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\nMixpanelGroup.prototype.unset = addOptOutCheckMixpanelGroup(function(prop, callback) {\n    var data = this.unset_action(prop);\n    return this._send_request(data, callback);\n});\n\n/**\n * Merge a given list with a list-valued group property, excluding duplicate values.\n *\n * ### Usage:\n *\n *     // merge a value to a list, creating it if needed\n *     mixpanel.get_group('company', 'mixpanel').union('Location', ['San Francisco', 'London']);\n *\n * @param {String} list_name Name of the property.\n * @param {Array} values Values to merge with the given property\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\nMixpanelGroup.prototype.union = addOptOutCheckMixpanelGroup(function(list_name, values, callback) {\n    if (_.isObject(list_name)) {\n        callback = values;\n    }\n    var data = this.union_action(list_name, values);\n    return this._send_request(data, callback);\n});\n\n/**\n * Permanently delete a group.\n *\n * ### Usage:\n *     mixpanel.get_group('company', 'mixpanel').delete();\n */\nMixpanelGroup.prototype['delete'] = addOptOutCheckMixpanelGroup(function(callback) {\n    var data = this.delete_action();\n    return this._send_request(data, callback);\n});\n\n/**\n * Remove a property from a group. The value will be ignored if doesn't exist.\n *\n * ### Usage:\n *\n *     mixpanel.get_group('company', 'mixpanel').remove('Location', 'London');\n *\n * @param {String} list_name Name of the property.\n * @param {Object} value Value to remove from the given group property\n * @param {Function} [callback] If provided, the callback will be called after the tracking event\n */\nMixpanelGroup.prototype.remove = addOptOutCheckMixpanelGroup(function(list_name, value, callback) {\n    var data = this.remove_action(list_name, value);\n    return this._send_request(data, callback);\n});\n\nMixpanelGroup.prototype._send_request = function(data, callback) {\n    data['$group_key'] = this._group_key;\n    data['$group_id'] = this._group_id;\n    data['$token'] = this._get_config('token');\n\n    var date_encoded_data = _.encodeDates(data);\n    var truncated_data    = _.truncate(date_encoded_data, 255);\n    var json_data         = _.JSONEncode(date_encoded_data);\n    var encoded_data      = _.base64Encode(json_data);\n\n    console$1.log(data);\n    this._mixpanel._send_request(\n        this._mixpanel.get_config('api_host') + '/groups/',\n        {'data': encoded_data},\n        this._mixpanel._prepare_callback(callback, truncated_data)\n    );\n\n    return truncated_data;\n};\n\nMixpanelGroup.prototype._is_reserved_property = function(prop) {\n    return prop === '$group_key' || prop === '$group_id';\n};\n\nMixpanelGroup.prototype._get_config = function(conf) {\n    return this._mixpanel.get_config(conf);\n};\n\nMixpanelGroup.prototype.toString = function() {\n    return this._mixpanel.toString() + '.group.' + this._group_key + '.' + this._group_id;\n};\n\n// MixpanelGroup Exports\nMixpanelGroup.prototype['remove']   = MixpanelGroup.prototype.remove;\nMixpanelGroup.prototype['set']      = MixpanelGroup.prototype.set;\nMixpanelGroup.prototype['set_once'] = MixpanelGroup.prototype.set_once;\nMixpanelGroup.prototype['union']    = MixpanelGroup.prototype.union;\nMixpanelGroup.prototype['unset']    = MixpanelGroup.prototype.unset;\nMixpanelGroup.prototype['toString'] = MixpanelGroup.prototype.toString;\n\n/*\n * Constants\n */\n/** @const */ var SET_QUEUE_KEY          = '__mps';\n/** @const */ var SET_ONCE_QUEUE_KEY     = '__mpso';\n/** @const */ var UNSET_QUEUE_KEY        = '__mpus';\n/** @const */ var ADD_QUEUE_KEY          = '__mpa';\n/** @const */ var APPEND_QUEUE_KEY       = '__mpap';\n/** @const */ var REMOVE_QUEUE_KEY       = '__mpr';\n/** @const */ var UNION_QUEUE_KEY        = '__mpu';\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\n/** @const */ var PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id';\n/** @const */ var ALIAS_ID_KEY           = '__alias';\n/** @const */ var CAMPAIGN_IDS_KEY       = '__cmpns';\n/** @const */ var EVENT_TIMERS_KEY       = '__timers';\n/** @const */ var RESERVED_PROPERTIES = [\n    SET_QUEUE_KEY,\n    SET_ONCE_QUEUE_KEY,\n    UNSET_QUEUE_KEY,\n    ADD_QUEUE_KEY,\n    APPEND_QUEUE_KEY,\n    REMOVE_QUEUE_KEY,\n    UNION_QUEUE_KEY,\n    PEOPLE_DISTINCT_ID_KEY,\n    ALIAS_ID_KEY,\n    CAMPAIGN_IDS_KEY,\n    EVENT_TIMERS_KEY\n];\n\n/**\n * Mixpanel Persistence Object\n * @constructor\n */\nvar MixpanelPersistence = function(config) {\n    this['props'] = {};\n    this.campaign_params_saved = false;\n\n    if (config['persistence_name']) {\n        this.name = 'mp_' + config['persistence_name'];\n    } else {\n        this.name = 'mp_' + config['token'] + '_mixpanel';\n    }\n\n    var storage_type = config['persistence'];\n    if (storage_type !== 'cookie' && storage_type !== 'localStorage') {\n        console$1.critical('Unknown persistence type ' + storage_type + '; falling back to cookie');\n        storage_type = config['persistence'] = 'cookie';\n    }\n\n    if (storage_type === 'localStorage' && _.localStorage.is_supported()) {\n        this.storage = _.localStorage;\n    } else {\n        this.storage = _.cookie;\n    }\n\n    this.load();\n    this.update_config(config);\n    this.upgrade(config);\n    this.save();\n};\n\nMixpanelPersistence.prototype.properties = function() {\n    var p = {};\n    // Filter out reserved properties\n    _.each(this['props'], function(v, k) {\n        if (!_.include(RESERVED_PROPERTIES, k)) {\n            p[k] = v;\n        }\n    });\n    return p;\n};\n\nMixpanelPersistence.prototype.load = function() {\n    if (this.disabled) { return; }\n\n    var entry = this.storage.parse(this.name);\n\n    if (entry) {\n        this['props'] = _.extend({}, entry);\n    }\n};\n\nMixpanelPersistence.prototype.upgrade = function(config) {\n    var upgrade_from_old_lib = config['upgrade'],\n        old_cookie_name,\n        old_cookie;\n\n    if (upgrade_from_old_lib) {\n        old_cookie_name = 'mp_super_properties';\n        // Case where they had a custom cookie name before.\n        if (typeof(upgrade_from_old_lib) === 'string') {\n            old_cookie_name = upgrade_from_old_lib;\n        }\n\n        old_cookie = this.storage.parse(old_cookie_name);\n\n        // remove the cookie\n        this.storage.remove(old_cookie_name);\n        this.storage.remove(old_cookie_name, true);\n\n        if (old_cookie) {\n            this['props'] = _.extend(\n                this['props'],\n                old_cookie['all'],\n                old_cookie['events']\n            );\n        }\n    }\n\n    if (!config['cookie_name'] && config['name'] !== 'mixpanel') {\n        // special case to handle people with cookies of the form\n        // mp_TOKEN_INSTANCENAME from the first release of this library\n        old_cookie_name = 'mp_' + config['token'] + '_' + config['name'];\n        old_cookie = this.storage.parse(old_cookie_name);\n\n        if (old_cookie) {\n            this.storage.remove(old_cookie_name);\n            this.storage.remove(old_cookie_name, true);\n\n            // Save the prop values that were in the cookie from before -\n            // this should only happen once as we delete the old one.\n            this.register_once(old_cookie);\n        }\n    }\n\n    if (this.storage === _.localStorage) {\n        old_cookie = _.cookie.parse(this.name);\n\n        _.cookie.remove(this.name);\n        _.cookie.remove(this.name, true);\n\n        if (old_cookie) {\n            this.register_once(old_cookie);\n        }\n    }\n};\n\nMixpanelPersistence.prototype.save = function() {\n    if (this.disabled) { return; }\n    this._expire_notification_campaigns();\n    this.storage.set(\n        this.name,\n        _.JSONEncode(this['props']),\n        this.expire_days,\n        this.cross_subdomain,\n        this.secure\n    );\n};\n\nMixpanelPersistence.prototype.remove = function() {\n    // remove both domain and subdomain cookies\n    this.storage.remove(this.name, false);\n    this.storage.remove(this.name, true);\n};\n\n// removes the storage entry and deletes all loaded data\n// forced name for tests\nMixpanelPersistence.prototype.clear = function() {\n    this.remove();\n    this['props'] = {};\n};\n\n/**\n* @param {Object} props\n* @param {*=} default_value\n* @param {number=} days\n*/\nMixpanelPersistence.prototype.register_once = function(props, default_value, days) {\n    if (_.isObject(props)) {\n        if (typeof(default_value) === 'undefined') { default_value = 'None'; }\n        this.expire_days = (typeof(days) === 'undefined') ? this.default_expiry : days;\n\n        _.each(props, function(val, prop) {\n            if (!this['props'].hasOwnProperty(prop) || this['props'][prop] === default_value) {\n                this['props'][prop] = val;\n            }\n        }, this);\n\n        this.save();\n\n        return true;\n    }\n    return false;\n};\n\n/**\n* @param {Object} props\n* @param {number=} days\n*/\nMixpanelPersistence.prototype.register = function(props, days) {\n    if (_.isObject(props)) {\n        this.expire_days = (typeof(days) === 'undefined') ? this.default_expiry : days;\n\n        _.extend(this['props'], props);\n\n        this.save();\n\n        return true;\n    }\n    return false;\n};\n\nMixpanelPersistence.prototype.unregister = function(prop) {\n    if (prop in this['props']) {\n        delete this['props'][prop];\n        this.save();\n    }\n};\n\nMixpanelPersistence.prototype._expire_notification_campaigns = _.safewrap(function() {\n    var campaigns_shown = this['props'][CAMPAIGN_IDS_KEY],\n        EXPIRY_TIME = Config.DEBUG ? 60 * 1000 : 60 * 60 * 1000; // 1 minute (Config.DEBUG) / 1 hour (PDXN)\n    if (!campaigns_shown) {\n        return;\n    }\n    for (var campaign_id in campaigns_shown) {\n        if (1 * new Date() - campaigns_shown[campaign_id] > EXPIRY_TIME) {\n            delete campaigns_shown[campaign_id];\n        }\n    }\n    if (_.isEmptyObject(campaigns_shown)) {\n        delete this['props'][CAMPAIGN_IDS_KEY];\n    }\n});\n\nMixpanelPersistence.prototype.update_campaign_params = function() {\n    if (!this.campaign_params_saved) {\n        this.register_once(_.info.campaignParams());\n        this.campaign_params_saved = true;\n    }\n};\n\nMixpanelPersistence.prototype.update_search_keyword = function(referrer) {\n    this.register(_.info.searchInfo(referrer));\n};\n\n// EXPORTED METHOD, we test this directly.\nMixpanelPersistence.prototype.update_referrer_info = function(referrer) {\n    // If referrer doesn't exist, we want to note the fact that it was type-in traffic.\n    this.register_once({\n        '$initial_referrer': referrer || '$direct',\n        '$initial_referring_domain': _.info.referringDomain(referrer) || '$direct'\n    }, '');\n};\n\nMixpanelPersistence.prototype.get_referrer_info = function() {\n    return _.strip_empty_properties({\n        '$initial_referrer': this['props']['$initial_referrer'],\n        '$initial_referring_domain': this['props']['$initial_referring_domain']\n    });\n};\n\n// safely fills the passed in object with stored properties,\n// does not override any properties defined in both\n// returns the passed in object\nMixpanelPersistence.prototype.safe_merge = function(props) {\n    _.each(this['props'], function(val, prop) {\n        if (!(prop in props)) {\n            props[prop] = val;\n        }\n    });\n\n    return props;\n};\n\nMixpanelPersistence.prototype.update_config = function(config) {\n    this.default_expiry = this.expire_days = config['cookie_expiration'];\n    this.set_disabled(config['disable_persistence']);\n    this.set_cross_subdomain(config['cross_subdomain_cookie']);\n    this.set_secure(config['secure_cookie']);\n};\n\nMixpanelPersistence.prototype.set_disabled = function(disabled) {\n    this.disabled = disabled;\n    if (this.disabled) {\n        this.remove();\n    } else {\n        this.save();\n    }\n};\n\nMixpanelPersistence.prototype.set_cross_subdomain = function(cross_subdomain) {\n    if (cross_subdomain !== this.cross_subdomain) {\n        this.cross_subdomain = cross_subdomain;\n        this.remove();\n        this.save();\n    }\n};\n\nMixpanelPersistence.prototype.get_cross_subdomain = function() {\n    return this.cross_subdomain;\n};\n\nMixpanelPersistence.prototype.set_secure = function(secure) {\n    if (secure !== this.secure) {\n        this.secure = secure ? true : false;\n        this.remove();\n        this.save();\n    }\n};\n\nMixpanelPersistence.prototype._add_to_people_queue = function(queue, data) {\n    var q_key = this._get_queue_key(queue),\n        q_data = data[queue],\n        set_q = this._get_or_create_queue(SET_ACTION),\n        set_once_q = this._get_or_create_queue(SET_ONCE_ACTION),\n        unset_q = this._get_or_create_queue(UNSET_ACTION),\n        add_q = this._get_or_create_queue(ADD_ACTION),\n        union_q = this._get_or_create_queue(UNION_ACTION),\n        remove_q = this._get_or_create_queue(REMOVE_ACTION, []),\n        append_q = this._get_or_create_queue(APPEND_ACTION, []);\n\n    if (q_key === SET_QUEUE_KEY) {\n        // Update the set queue - we can override any existing values\n        _.extend(set_q, q_data);\n        // if there was a pending increment, override it\n        // with the set.\n        this._pop_from_people_queue(ADD_ACTION, q_data);\n        // if there was a pending union, override it\n        // with the set.\n        this._pop_from_people_queue(UNION_ACTION, q_data);\n        this._pop_from_people_queue(UNSET_ACTION, q_data);\n    } else if (q_key === SET_ONCE_QUEUE_KEY) {\n        // only queue the data if there is not already a set_once call for it.\n        _.each(q_data, function(v, k) {\n            if (!(k in set_once_q)) {\n                set_once_q[k] = v;\n            }\n        });\n        this._pop_from_people_queue(UNSET_ACTION, q_data);\n    } else if (q_key === UNSET_QUEUE_KEY) {\n        _.each(q_data, function(prop) {\n\n            // undo previously-queued actions on this key\n            _.each([set_q, set_once_q, add_q, union_q], function(enqueued_obj) {\n                if (prop in enqueued_obj) {\n                    delete enqueued_obj[prop];\n                }\n            });\n            _.each(append_q, function(append_obj) {\n                if (prop in append_obj) {\n                    delete append_obj[prop];\n                }\n            });\n\n            unset_q[prop] = true;\n\n        });\n    } else if (q_key === ADD_QUEUE_KEY) {\n        _.each(q_data, function(v, k) {\n            // If it exists in the set queue, increment\n            // the value\n            if (k in set_q) {\n                set_q[k] += v;\n            } else {\n                // If it doesn't exist, update the add\n                // queue\n                if (!(k in add_q)) {\n                    add_q[k] = 0;\n                }\n                add_q[k] += v;\n            }\n        }, this);\n        this._pop_from_people_queue(UNSET_ACTION, q_data);\n    } else if (q_key === UNION_QUEUE_KEY) {\n        _.each(q_data, function(v, k) {\n            if (_.isArray(v)) {\n                if (!(k in union_q)) {\n                    union_q[k] = [];\n                }\n                // We may send duplicates, the server will dedup them.\n                union_q[k] = union_q[k].concat(v);\n            }\n        });\n        this._pop_from_people_queue(UNSET_ACTION, q_data);\n    } else if (q_key === REMOVE_QUEUE_KEY) {\n        remove_q.push(q_data);\n        this._pop_from_people_queue(APPEND_ACTION, q_data);\n    } else if (q_key === APPEND_QUEUE_KEY) {\n        append_q.push(q_data);\n        this._pop_from_people_queue(UNSET_ACTION, q_data);\n    }\n\n    console$1.log('MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):');\n    console$1.log(data);\n\n    this.save();\n};\n\nMixpanelPersistence.prototype._pop_from_people_queue = function(queue, data) {\n    var q = this._get_queue(queue);\n    if (!_.isUndefined(q)) {\n        _.each(data, function(v, k) {\n            if (queue === APPEND_ACTION || queue === REMOVE_ACTION) {\n                // list actions: only remove if both k+v match\n                // e.g. remove should not override append in a case like\n                // append({foo: 'bar'}); remove({foo: 'qux'})\n                _.each(q, function(queued_action) {\n                    if (queued_action[k] === v) {\n                        delete queued_action[k];\n                    }\n                });\n            } else {\n                delete q[k];\n            }\n        }, this);\n\n        this.save();\n    }\n};\n\nMixpanelPersistence.prototype._get_queue_key = function(queue) {\n    if (queue === SET_ACTION) {\n        return SET_QUEUE_KEY;\n    } else if (queue === SET_ONCE_ACTION) {\n        return SET_ONCE_QUEUE_KEY;\n    } else if (queue === UNSET_ACTION) {\n        return UNSET_QUEUE_KEY;\n    } else if (queue === ADD_ACTION) {\n        return ADD_QUEUE_KEY;\n    } else if (queue === APPEND_ACTION) {\n        return APPEND_QUEUE_KEY;\n    } else if (queue === REMOVE_ACTION) {\n        return REMOVE_QUEUE_KEY;\n    } else if (queue === UNION_ACTION) {\n        return UNION_QUEUE_KEY;\n    } else {\n        console$1.error('Invalid queue:', queue);\n    }\n};\n\nMixpanelPersistence.prototype._get_queue = function(queue) {\n    return this['props'][this._get_queue_key(queue)];\n};\nMixpanelPersistence.prototype._get_or_create_queue = function(queue, default_val) {\n    var key = this._get_queue_key(queue);\n    default_val = _.isUndefined(default_val) ? {} : default_val;\n\n    return this['props'][key] || (this['props'][key] = default_val);\n};\n\nMixpanelPersistence.prototype.set_event_timer = function(event_name, timestamp) {\n    var timers = this['props'][EVENT_TIMERS_KEY] || {};\n    timers[event_name] = timestamp;\n    this['props'][EVENT_TIMERS_KEY] = timers;\n    this.save();\n};\n\nMixpanelPersistence.prototype.remove_event_timer = function(event_name) {\n    var timers = this['props'][EVENT_TIMERS_KEY] || {};\n    var timestamp = timers[event_name];\n    if (!_.isUndefined(timestamp)) {\n        delete this['props'][EVENT_TIMERS_KEY][event_name];\n        this.save();\n    }\n    return timestamp;\n};\n\n/*\n * This file is a js implementation for a subset in eval_node.c\n */\n\n/*\n * Constants\n */\n// Metadata keys\n/** @const */   var OPERATOR_KEY                  = 'operator';\n/** @const */   var PROPERTY_KEY                  = 'property';\n/** @const */   var WINDOW_KEY                    = 'window';\n/** @const */   var UNIT_KEY                      = 'unit';\n/** @const */   var VALUE_KEY                     = 'value';\n/** @const */   var HOUR_KEY                      = 'hour';\n/** @const */   var DAY_KEY                       = 'day';\n/** @const */   var WEEK_KEY                      = 'week';\n/** @const */   var MONTH_KEY                     = 'month';\n\n// Operands\n/** @const */   var EVENT_PROPERTY         = 'event';\n/** @const */   var LITERAL_PROPERTY       = 'literal';\n\n// Binary Operators\n/** @const */   var AND_OPERATOR           = 'and';\n/** @const */   var OR_OPERATOR            = 'or';\n/** @const */   var IN_OPERATOR            = 'in';\n/** @const */   var NOT_IN_OPERATOR        = 'not in';\n/** @const */   var PLUS_OPERATOR          = '+';\n/** @const */   var MINUS_OPERATOR         = '-';\n/** @const */   var MUL_OPERATOR           = '*';\n/** @const */   var DIV_OPERATOR           = '/';\n/** @const */   var MOD_OPERATOR           = '%';\n/** @const */   var EQUALS_OPERATOR        = '==';\n/** @const */   var NOT_EQUALS_OPERATOR    = '!=';\n/** @const */   var GREATER_OPERATOR       = '>';\n/** @const */   var LESS_OPERATOR          = '<';\n/** @const */   var GREATER_EQUAL_OPERATOR = '>=';\n/** @const */   var LESS_EQUAL_OPERATOR    = '<=';\n\n// Typecast Operators\n/** @const */   var BOOLEAN_OPERATOR       = 'boolean';\n/** @const */   var DATETIME_OPERATOR      = 'datetime';\n/** @const */   var LIST_OPERATOR          = 'list';\n/** @const */   var NUMBER_OPERATOR        = 'number';\n/** @const */   var STRING_OPERATOR        = 'string';\n\n// Unary Operators\n/** @const */   var NOT_OPERATOR           = 'not';\n/** @const */   var DEFINED_OPERATOR       = 'defined';\n/** @const */   var NOT_DEFINED_OPERATOR   = 'not defined';\n\n// Special literals\n/** @const */   var NOW_LITERAL            = 'now';\n\n// Type cast functions\nfunction toNumber(value) {\n    if (value === null) {\n        return null;\n    }\n\n    switch (typeof(value)) {\n        case 'object':\n            if (_.isDate(value) && value.getTime() >= 0) {\n                return value.getTime();\n            }\n            return null;\n        case 'boolean':\n            return Number(value);\n        case 'number':\n            return value;\n        case 'string':\n            value = Number(value);\n            if (!isNaN(value)) {\n                return value;\n            }\n            return 0;\n    }\n    return null;\n}\n\nfunction evaluateNumber(op, properties) {\n    if (!op['operator'] || op['operator'] !== NUMBER_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid cast operator: number ' + op);\n    }\n\n    return toNumber(evaluateSelector(op['children'][0], properties));\n}\n\nfunction toBoolean(value) {\n    if (value === null) {\n        return false;\n    }\n\n    switch (typeof value) {\n        case 'boolean':\n            return value;\n        case 'number':\n            return value !== 0.0;\n        case 'string':\n            return value.length > 0;\n        case 'object':\n            if (_.isArray(value) && value.length > 0) {\n                return true;\n            }\n            if (_.isDate(value) && value.getTime() > 0) {\n                return true;\n            }\n            if (_.isObject(value) && !_.isEmptyObject(value)) {\n                return true;\n            }\n            return false;\n    }\n    return false;\n}\n\nfunction evaluateBoolean(op, properties) {\n    if (!op['operator'] || op['operator'] !== BOOLEAN_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid cast operator: boolean ' + op);\n    }\n\n    return toBoolean(evaluateSelector(op['children'][0], properties));\n}\n\nfunction evaluateDateTime(op, properties) {\n    if (!op['operator'] || op['operator'] !== DATETIME_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid cast operator: datetime ' + op);\n    }\n\n    var v = evaluateSelector(op['children'][0], properties);\n    if (v === null) {\n        return null;\n    }\n\n    switch (typeof(v)) {\n        case 'number':\n        case 'string':\n            var d = new Date(v);\n            if (isNaN(d.getTime())) {\n                return null;\n            }\n            return d;\n        case 'object':\n            if (_.isDate(v)) {\n                return v;\n            }\n    }\n\n    return null;\n}\n\nfunction evaluateList(op, properties) {\n    if (!op['operator'] || op['operator'] !== LIST_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid cast operator: list ' + op);\n    }\n\n    var v = evaluateSelector(op['children'][0], properties);\n    if (v === null) {\n        return null;\n    }\n\n    if (_.isArray(v)) {\n        return v;\n    }\n\n    return null;\n}\n\nfunction evaluateString(op, properties) {\n    if (!op['operator'] || op['operator'] !== STRING_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid cast operator: string ' + op);\n    }\n\n    var v = evaluateSelector(op['children'][0], properties);\n    switch (typeof(v)) {\n        case 'object':\n            if (_.isDate(v)) {\n                return v.toJSON();\n            }\n            return JSON.stringify(v);\n    }\n    return String(v);\n}\n\n// Operators\nfunction evaluateAnd(op, properties) {\n    if (!op['operator'] || op['operator'] !== AND_OPERATOR || !op['children'] || op['children'].length !== 2) {\n        throw ('Invalid operator: AND ' + op);\n    }\n\n    return toBoolean(evaluateSelector(op['children'][0], properties)) && toBoolean(evaluateSelector(op['children'][1], properties));\n}\n\nfunction evaluateOr(op, properties) {\n    if (!op['operator'] || op['operator'] !== OR_OPERATOR || !op['children'] || op['children'].length !== 2) {\n        throw ('Invalid operator: OR ' + op);\n    }\n\n    return toBoolean(evaluateSelector(op['children'][0], properties)) || toBoolean(evaluateSelector(op['children'][1], properties));\n}\n\nfunction evaluateIn(op, properties) {\n    if (!op['operator'] || [IN_OPERATOR, NOT_IN_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 2) {\n        throw ('Invalid operator: IN/NOT IN ' + op);\n    }\n    var leftValue = evaluateSelector(op['children'][0], properties);\n    var rightValue = evaluateSelector(op['children'][1], properties);\n\n    if (!_.isArray(rightValue) && !_.isString(rightValue)) {\n        throw ('Invalid operand for operator IN: invalid type' + rightValue);\n    }\n\n    var v = rightValue.indexOf(leftValue) > -1;\n    if (op['operator'] === NOT_IN_OPERATOR) {\n        return !v;\n    }\n    return v;\n}\n\nfunction evaluatePlus(op, properties) {\n    if (!op['operator'] || op['operator'] !== PLUS_OPERATOR || !op['children'] || op['children'].length < 2) {\n        throw ('Invalid operator: PLUS ' + op);\n    }\n    var l = evaluateSelector(op['children'][0], properties);\n    var r = evaluateSelector(op['children'][1], properties);\n\n    if (typeof l === 'number' && typeof r === 'number') {\n        return l + r;\n    }\n    if (typeof l === 'string' && typeof r === 'string') {\n        return l + r;\n    }\n    return null;\n}\n\nfunction evaluateArithmetic(op, properties) {\n    if (!op['operator'] || [MINUS_OPERATOR, MUL_OPERATOR, DIV_OPERATOR, MOD_OPERATOR].indexOf(op['operator']) === -1 ||\n        !op['children'] || op['children'].length < 2) {\n        throw ('Invalid arithmetic operator ' + op);\n    }\n\n    var l = evaluateSelector(op['children'][0], properties);\n    var r = evaluateSelector(op['children'][1], properties);\n\n    if (typeof l === 'number' && typeof r === 'number') {\n        switch (op['operator']) {\n            case MINUS_OPERATOR:\n                return l - r;\n            case MUL_OPERATOR:\n                return l * r;\n            case DIV_OPERATOR:\n                if (r !== 0) {\n                    return l / r;\n                }\n                return null;\n            case MOD_OPERATOR:\n                if (r === 0) {\n                    return null;\n                }\n                if (l === 0) {\n                    return 0;\n                }\n                if ((l < 0 && r > 0) || (l > 0 && r < 0)) {\n                    /* Mimic python modulo - result takes sign of the divisor\n                     * if one operand is negative. */\n                    return -(Math.floor(l / r) * r - l);\n                }\n                return l % r;\n            default:\n                throw('Unknown operator: ' + op['operator']);\n        }\n    }\n\n    return null;\n}\n\nfunction _isArrayEqual(l, r) {\n    if (l === r) return true;\n    if (l === null || r === null) return false;\n    if (l.length !== r.length) return false;\n\n    for (var i = 0; i < l.length; i++) {\n        if (l[i] !== r[i]) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nfunction _isEqual(l, r) {\n    if ( l === null && l === r ) {\n        return true;\n    }\n    if (typeof l === typeof r) {\n        switch (typeof l) {\n            case 'number':\n            case 'string':\n            case 'boolean':\n                return l === r;\n            case 'object':\n                if (_.isArray(l) && _.isArray(r)) {\n                    return _isArrayEqual(l, r);\n                }\n                if (_.isDate(l) && _.isDate(r)) {\n                    return l.getTime() === r.getTime();\n                }\n                if (_.isObject(l) && _.isObject(r)) {\n                    return JSON.stringify(l) === JSON.stringify(r);\n                }\n        }\n    }\n    return false;\n}\n\nfunction evaluateEquality(op, properties) {\n    if (!op['operator'] || [EQUALS_OPERATOR, NOT_EQUALS_OPERATOR].indexOf(op['operator']) === -1 || !op['children'] || op['children'].length !== 2) {\n        throw ('Invalid equality operator ' + op);\n    }\n\n    var v = _isEqual(evaluateSelector(op['children'][0], properties), evaluateSelector(op['children'][1], properties));\n\n    switch (op['operator']) {\n        case EQUALS_OPERATOR:\n            return v;\n        case NOT_EQUALS_OPERATOR:\n            return !v;\n    }\n}\n\nfunction evaluateComparison(op, properties) {\n    if (!op['operator'] ||\n        [GREATER_OPERATOR, GREATER_EQUAL_OPERATOR, LESS_OPERATOR, LESS_EQUAL_OPERATOR].indexOf(op['operator']) === -1 ||\n        !op['children'] || op['children'].length !== 2) {\n        throw ('Invalid comparison operator ' + op);\n    }\n    var l = evaluateSelector(op['children'][0], properties);\n    var r = evaluateSelector(op['children'][1], properties);\n\n    if (typeof(l) === typeof(r)) {\n        if (typeof(r) === 'number' || _.isDate(r)) {\n            l = toNumber(l);\n            r = toNumber(r);\n            switch (op['operator']) {\n                case GREATER_OPERATOR:\n                    return l > r;\n                case GREATER_EQUAL_OPERATOR:\n                    return l >= r;\n                case LESS_OPERATOR:\n                    return l < r;\n                case LESS_EQUAL_OPERATOR:\n                    return l <= r;\n            }\n        } else if (typeof(r) === 'string') {\n            var compare = l.localeCompare(r);\n            switch (op['operator']) {\n                case GREATER_OPERATOR:\n                    return compare > 0;\n                case GREATER_EQUAL_OPERATOR:\n                    return compare >= 0;\n                case LESS_OPERATOR:\n                    return compare < 0;\n                case LESS_EQUAL_OPERATOR:\n                    return compare <= 0;\n            }\n        }\n    }\n\n    return null;\n}\n\nfunction evaluateDefined(op, properties) {\n    if (!op['operator'] || [DEFINED_OPERATOR, NOT_DEFINED_OPERATOR].indexOf(op['operator']) === -1 ||\n        !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid defined/not defined operator: ' + op);\n    }\n\n    var b = evaluateSelector(op['children'][0], properties) !== null;\n    if (op['operator'] === NOT_DEFINED_OPERATOR) {\n        return !b;\n    }\n\n    return b;\n}\n\nfunction evaluateNot(op, properties) {\n    if (!op['operator'] || op['operator'] !== NOT_OPERATOR || !op['children'] || op['children'].length !== 1) {\n        throw ('Invalid not operator: ' + op);\n    }\n\n    var v = evaluateSelector(op['children'][0], properties);\n    if (v === null) {\n        return true;\n    }\n\n    if (typeof(v) === 'boolean') {\n        return !v;\n    }\n\n    return null;\n}\n\nfunction evaluateOperator(op, properties) {\n    if (!op['operator']) {\n        throw ('Invalid operator: operator key missing ' + op);\n    }\n\n    switch (op['operator']) {\n        case AND_OPERATOR:\n            return evaluateAnd(op, properties);\n        case OR_OPERATOR:\n            return evaluateOr(op, properties);\n        case IN_OPERATOR:\n        case NOT_IN_OPERATOR:\n            return evaluateIn(op, properties);\n        case PLUS_OPERATOR:\n            return evaluatePlus(op, properties);\n        case MINUS_OPERATOR:\n        case MUL_OPERATOR:\n        case DIV_OPERATOR:\n        case MOD_OPERATOR:\n            return evaluateArithmetic(op, properties);\n        case EQUALS_OPERATOR:\n        case NOT_EQUALS_OPERATOR:\n            return evaluateEquality(op, properties);\n        case GREATER_OPERATOR:\n        case LESS_OPERATOR:\n        case GREATER_EQUAL_OPERATOR:\n        case LESS_EQUAL_OPERATOR:\n            return evaluateComparison(op, properties);\n        case BOOLEAN_OPERATOR:\n            return evaluateBoolean(op, properties);\n        case DATETIME_OPERATOR:\n            return evaluateDateTime(op, properties);\n        case LIST_OPERATOR:\n            return evaluateList(op, properties);\n        case NUMBER_OPERATOR:\n            return evaluateNumber(op, properties);\n        case STRING_OPERATOR:\n            return evaluateString(op, properties);\n        case DEFINED_OPERATOR:\n        case NOT_DEFINED_OPERATOR:\n            return evaluateDefined(op, properties);\n        case NOT_OPERATOR:\n            return evaluateNot(op, properties);\n    }\n}\n\nfunction evaluateWindow(value) {\n    var win = value[WINDOW_KEY];\n    if (!win || !win[UNIT_KEY] || !win[VALUE_KEY]) {\n        throw('Invalid window: missing required keys ' + JSON.stringify(value));\n    }\n    var out = new Date();\n    switch (win[UNIT_KEY]) {\n        case HOUR_KEY:\n            out.setTime(out.getTime() + (win[VALUE_KEY]*-1*60*60*1000));\n            break;\n        case DAY_KEY:\n            out.setTime(out.getTime() + (win[VALUE_KEY]*-1*24*60*60*1000));\n            break;\n        case WEEK_KEY:\n            out.setTime(out.getTime() + (win[VALUE_KEY]*-1*7*24*60*60*1000));\n            break;\n        case MONTH_KEY:\n            out.setTime(out.getTime() + (win[VALUE_KEY]*-1*30*24*60*60*1000));\n            break;\n        default:\n            throw('Invalid unit: ' + win[UNIT_KEY]);\n    }\n\n    return out;\n}\n\nfunction evaluateOperand(op, properties) {\n    if (!op['property'] || !op['value']) {\n        throw('Invalid operand: missing required keys ' + op);\n    }\n    switch (op['property']) {\n        case EVENT_PROPERTY:\n            if (properties[op['value']] !== undefined) {\n                return properties[op['value']];\n            }\n            return null;\n        case LITERAL_PROPERTY:\n            if (op['value'] === NOW_LITERAL) {\n                return new Date();\n            }\n            if (typeof(op['value']) === 'object') {\n                return evaluateWindow(op['value']);\n            }\n            return op['value'];\n        default:\n            throw('Invalid operand: Invalid property type ' + op['property']);\n    }\n}\n\nfunction evaluateSelector(filters, properties) {\n    if (filters[PROPERTY_KEY]) {\n        return evaluateOperand(filters, properties);\n    }\n    if (filters[OPERATOR_KEY]) {\n        return evaluateOperator(filters, properties);\n    }\n}\n\n// Internal class for notification display\n\nvar MixpanelNotification = function(notif_data, mixpanel_instance) {\n    _.bind_instance_methods(this);\n\n    this.mixpanel          = mixpanel_instance;\n    this.persistence       = this.mixpanel['persistence'];\n    this.resource_protocol = this.mixpanel.get_config('inapp_protocol');\n    this.cdn_host          = this.mixpanel.get_config('cdn');\n\n    this.campaign_id = _.escapeHTML(notif_data['id']);\n    this.message_id  = _.escapeHTML(notif_data['message_id']);\n\n    this.body            = (_.escapeHTML(notif_data['body']) || '').replace(/\\n/g, '<br/>');\n    this.cta             = _.escapeHTML(notif_data['cta']) || 'Close';\n    this.notif_type      = _.escapeHTML(notif_data['type']) || 'takeover';\n    this.style           = _.escapeHTML(notif_data['style']) || 'light';\n    this.title           = _.escapeHTML(notif_data['title']) || '';\n    this.video_width     = MixpanelNotification.VIDEO_WIDTH;\n    this.video_height    = MixpanelNotification.VIDEO_HEIGHT;\n\n    this.display_triggers = notif_data['display_triggers'] || [];\n\n    // These fields are url-sanitized in the backend already.\n    this.dest_url        = notif_data['cta_url'] || null;\n    this.image_url       = notif_data['image_url'] || null;\n    this.thumb_image_url = notif_data['thumb_image_url'] || null;\n    this.video_url       = notif_data['video_url'] || null;\n\n    if (this.thumb_image_url && this.thumb_image_url.indexOf('//') === 0) {\n        this.thumb_image_url = this.thumb_image_url.replace('//', this.resource_protocol);\n    }\n\n    this.clickthrough = true;\n    if (!this.dest_url) {\n        this.dest_url = '#dismiss';\n        this.clickthrough = false;\n    }\n\n    this.mini = this.notif_type === 'mini';\n    if (!this.mini) {\n        this.notif_type = 'takeover';\n    }\n    this.notif_width = !this.mini ? MixpanelNotification.NOTIF_WIDTH : MixpanelNotification.NOTIF_WIDTH_MINI;\n\n    this._set_client_config();\n    this.imgs_to_preload = this._init_image_html();\n    this._init_video();\n};\n\nMixpanelNotification.ANIM_TIME         = 200;\nMixpanelNotification.MARKUP_PREFIX     = 'mixpanel-notification';\nMixpanelNotification.BG_OPACITY        = 0.6;\nMixpanelNotification.NOTIF_TOP         = 25;\nMixpanelNotification.NOTIF_START_TOP   = 200;\nMixpanelNotification.NOTIF_WIDTH       = 388;\nMixpanelNotification.NOTIF_WIDTH_MINI  = 420;\nMixpanelNotification.NOTIF_HEIGHT_MINI = 85;\nMixpanelNotification.THUMB_BORDER_SIZE = 5;\nMixpanelNotification.THUMB_IMG_SIZE    = 60;\nMixpanelNotification.THUMB_OFFSET      = Math.round(MixpanelNotification.THUMB_IMG_SIZE / 2);\nMixpanelNotification.VIDEO_WIDTH       = 595;\nMixpanelNotification.VIDEO_HEIGHT      = 334;\n\nMixpanelNotification.prototype.show = function() {\n    var self = this;\n    this._set_client_config();\n\n    // don't display until HTML body exists\n    if (!this.body_el) {\n        setTimeout(function() { self.show(); }, 300);\n        return;\n    }\n\n    this._init_styles();\n    this._init_notification_el();\n\n    // wait for any images to load before showing notification\n    this._preload_images(this._attach_and_animate);\n};\n\nMixpanelNotification.prototype.dismiss = _.safewrap(function() {\n    if (!this.marked_as_shown) {\n        // unexpected condition: user interacted with notif even though we didn't consider it\n        // visible (see _mark_as_shown()); send tracking signals to mark delivery\n        this._mark_delivery({'invisible': true});\n    }\n\n    var exiting_el = this.showing_video ? this._get_el('video') : this._get_notification_display_el();\n    if (this.use_transitions) {\n        this._remove_class('bg', 'visible');\n        this._add_class(exiting_el, 'exiting');\n        setTimeout(this._remove_notification_el, MixpanelNotification.ANIM_TIME);\n    } else {\n        var notif_attr, notif_start, notif_goal;\n        if (this.mini) {\n            notif_attr  = 'right';\n            notif_start = 20;\n            notif_goal  = -100;\n        } else {\n            notif_attr  = 'top';\n            notif_start = MixpanelNotification.NOTIF_TOP;\n            notif_goal  = MixpanelNotification.NOTIF_START_TOP + MixpanelNotification.NOTIF_TOP;\n        }\n        this._animate_els([\n            {\n                el:    this._get_el('bg'),\n                attr:  'opacity',\n                start: MixpanelNotification.BG_OPACITY,\n                goal:  0.0\n            },\n            {\n                el:    exiting_el,\n                attr:  'opacity',\n                start: 1.0,\n                goal:  0.0\n            },\n            {\n                el:    exiting_el,\n                attr:  notif_attr,\n                start: notif_start,\n                goal:  notif_goal\n            }\n        ], MixpanelNotification.ANIM_TIME, this._remove_notification_el);\n    }\n});\n\nMixpanelNotification.prototype._add_class = _.safewrap(function(el, class_name) {\n    class_name = MixpanelNotification.MARKUP_PREFIX + '-' + class_name;\n    if (typeof el === 'string') {\n        el = this._get_el(el);\n    }\n    if (!el.className) {\n        el.className = class_name;\n    } else if (!~(' ' + el.className + ' ').indexOf(' ' + class_name + ' ')) {\n        el.className += ' ' + class_name;\n    }\n});\nMixpanelNotification.prototype._remove_class = _.safewrap(function(el, class_name) {\n    class_name = MixpanelNotification.MARKUP_PREFIX + '-' + class_name;\n    if (typeof el === 'string') {\n        el = this._get_el(el);\n    }\n    if (el.className) {\n        el.className = (' ' + el.className + ' ')\n            .replace(' ' + class_name + ' ', '')\n            .replace(/^[\\s\\xA0]+/, '')\n            .replace(/[\\s\\xA0]+$/, '');\n    }\n});\n\nMixpanelNotification.prototype._animate_els = _.safewrap(function(anims, mss, done_cb, start_time) {\n    var self = this,\n        in_progress = false,\n        ai, anim,\n        cur_time = 1 * new Date(), time_diff;\n\n    start_time = start_time || cur_time;\n    time_diff = cur_time - start_time;\n\n    for (ai = 0; ai < anims.length; ai++) {\n        anim = anims[ai];\n        if (typeof anim.val === 'undefined') {\n            anim.val = anim.start;\n        }\n        if (anim.val !== anim.goal) {\n            in_progress = true;\n            var anim_diff = anim.goal - anim.start,\n                anim_dir = anim.goal >= anim.start ? 1 : -1;\n            anim.val = anim.start + anim_diff * time_diff / mss;\n            if (anim.attr !== 'opacity') {\n                anim.val = Math.round(anim.val);\n            }\n            if ((anim_dir > 0 && anim.val >= anim.goal) || (anim_dir < 0 && anim.val <= anim.goal)) {\n                anim.val = anim.goal;\n            }\n        }\n    }\n    if (!in_progress) {\n        if (done_cb) {\n            done_cb();\n        }\n        return;\n    }\n\n    for (ai = 0; ai < anims.length; ai++) {\n        anim = anims[ai];\n        if (anim.el) {\n            var suffix = anim.attr === 'opacity' ? '' : 'px';\n            anim.el.style[anim.attr] = String(anim.val) + suffix;\n        }\n    }\n    setTimeout(function() { self._animate_els(anims, mss, done_cb, start_time); }, 10);\n});\n\nMixpanelNotification.prototype._attach_and_animate = _.safewrap(function() {\n    var self = this;\n\n    // no possibility to double-display\n    if (this.shown || this._get_shown_campaigns()[this.campaign_id]) {\n        return;\n    }\n    this.shown = true;\n\n    this.body_el.appendChild(this.notification_el);\n    setTimeout(function() {\n        var notif_el = self._get_notification_display_el();\n        if (self.use_transitions) {\n            if (!self.mini) {\n                self._add_class('bg', 'visible');\n            }\n            self._add_class(notif_el, 'visible');\n            self._mark_as_shown();\n        } else {\n            var notif_attr, notif_start, notif_goal;\n            if (self.mini) {\n                notif_attr  = 'right';\n                notif_start = -100;\n                notif_goal  = 20;\n            } else {\n                notif_attr  = 'top';\n                notif_start = MixpanelNotification.NOTIF_START_TOP + MixpanelNotification.NOTIF_TOP;\n                notif_goal  = MixpanelNotification.NOTIF_TOP;\n            }\n            self._animate_els([\n                {\n                    el:    self._get_el('bg'),\n                    attr:  'opacity',\n                    start: 0.0,\n                    goal:  MixpanelNotification.BG_OPACITY\n                },\n                {\n                    el:    notif_el,\n                    attr:  'opacity',\n                    start: 0.0,\n                    goal:  1.0\n                },\n                {\n                    el:    notif_el,\n                    attr:  notif_attr,\n                    start: notif_start,\n                    goal:  notif_goal\n                }\n            ], MixpanelNotification.ANIM_TIME, self._mark_as_shown);\n        }\n    }, 100);\n    _.register_event(self._get_el('cancel'), 'click', function(e) {\n        e.preventDefault();\n        self.dismiss();\n    });\n    var click_el = self._get_el('button') ||\n                        self._get_el('mini-content');\n    _.register_event(click_el, 'click', function(e) {\n        e.preventDefault();\n        if (self.show_video) {\n            self._track_event('$campaign_open', {'$resource_type': 'video'});\n            self._switch_to_video();\n        } else {\n            self.dismiss();\n            if (self.clickthrough) {\n                var tracking_cb = null;\n                if (self.mixpanel.get_config('inapp_link_new_window')) {\n                    window.open(self.dest_url);\n                } else {\n                    tracking_cb = function() {\n                        window.location.href = self.dest_url;\n                    };\n                }\n                self._track_event('$campaign_open', {'$resource_type': 'link'}, tracking_cb);\n            }\n        }\n    });\n});\n\nMixpanelNotification.prototype._get_el = function(id) {\n    return document.getElementById(MixpanelNotification.MARKUP_PREFIX + '-' + id);\n};\n\nMixpanelNotification.prototype._get_notification_display_el = function() {\n    return this._get_el(this.notif_type);\n};\n\nMixpanelNotification.prototype._get_shown_campaigns = function() {\n    return this.persistence['props'][CAMPAIGN_IDS_KEY] || (this.persistence['props'][CAMPAIGN_IDS_KEY] = {});\n};\n\nMixpanelNotification.prototype._matches_event_data = _.safewrap(function(event_data) {\n    var event_name = event_data['event'] || '';\n    for (var i = 0; i < this.display_triggers.length; i++) {\n        var display_trigger = this.display_triggers[i];\n        var match_event = display_trigger['event'] || '';\n        if (match_event === '$any_event' || event_name === display_trigger['event']) {\n            if (display_trigger['selector'] && !_.isEmptyObject(display_trigger['selector'])) {\n                if (evaluateSelector(display_trigger['selector'], event_data['properties'])) {\n                    return true;\n                }\n            } else {\n                return true;\n            }\n        }\n    }\n    return false;\n});\n\n\nMixpanelNotification.prototype._browser_lte = function(browser, version) {\n    return this.browser_versions[browser] && this.browser_versions[browser] <= version;\n};\n\nMixpanelNotification.prototype._init_image_html = function() {\n    var imgs_to_preload = [];\n\n    if (!this.mini) {\n        if (this.image_url) {\n            imgs_to_preload.push(this.image_url);\n            this.img_html = '<img id=\"img\" src=\"' + this.image_url + '\"/>';\n        } else {\n            this.img_html = '';\n        }\n        if (this.thumb_image_url) {\n            imgs_to_preload.push(this.thumb_image_url);\n            this.thumb_img_html =\n                    '<div id=\"thumbborder-wrapper\"><div id=\"thumbborder\"></div></div>' +\n                    '<img id=\"thumbnail\"' +\n                        ' src=\"' + this.thumb_image_url + '\"' +\n                        ' width=\"' + MixpanelNotification.THUMB_IMG_SIZE + '\"' +\n                        ' height=\"' + MixpanelNotification.THUMB_IMG_SIZE + '\"' +\n                    '/>' +\n                    '<div id=\"thumbspacer\"></div>';\n        } else {\n            this.thumb_img_html = '';\n        }\n    } else {\n        this.thumb_image_url = this.thumb_image_url || (this.cdn_host + '/site_media/images/icons/notifications/mini-news-dark.png');\n        imgs_to_preload.push(this.thumb_image_url);\n    }\n\n    return imgs_to_preload;\n};\n\nMixpanelNotification.prototype._init_notification_el = function() {\n    var notification_html = '';\n    var video_src         = '';\n    var video_html        = '';\n    var cancel_html       = '<div id=\"cancel\">' +\n                                    '<div id=\"cancel-icon\"></div>' +\n                                '</div>';\n\n    this.notification_el = document.createElement('div');\n    this.notification_el.id = MixpanelNotification.MARKUP_PREFIX + '-wrapper';\n    if (!this.mini) {\n        // TAKEOVER notification\n        var close_html  = (this.clickthrough || this.show_video) ? '' : '<div id=\"button-close\"></div>',\n            play_html   = this.show_video ? '<div id=\"button-play\"></div>' : '';\n        if (this._browser_lte('ie', 7)) {\n            close_html = '';\n            play_html = '';\n        }\n        notification_html =\n                '<div id=\"takeover\">' +\n                    this.thumb_img_html +\n                    '<div id=\"mainbox\">' +\n                        cancel_html +\n                        '<div id=\"content\">' +\n                            this.img_html +\n                            '<div id=\"title\">' + this.title + '</div>' +\n                            '<div id=\"body\">' + this.body + '</div>' +\n                            '<div id=\"tagline\">' +\n                                '<a href=\"http://mixpanel.com?from=inapp\" target=\"_blank\">POWERED BY MIXPANEL</a>' +\n                            '</div>' +\n                        '</div>' +\n                        '<div id=\"button\">' +\n                            close_html +\n                            '<a id=\"button-link\" href=\"' + this.dest_url + '\">' + this.cta + '</a>' +\n                            play_html +\n                        '</div>' +\n                    '</div>' +\n                '</div>';\n    } else {\n        // MINI notification\n        notification_html =\n                '<div id=\"mini\">' +\n                    '<div id=\"mainbox\">' +\n                        cancel_html +\n                        '<div id=\"mini-content\">' +\n                            '<div id=\"mini-icon\">' +\n                                '<div id=\"mini-icon-img\"></div>' +\n                            '</div>' +\n                            '<div id=\"body\">' +\n                                '<div id=\"body-text\"><div>' + this.body + '</div></div>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n                    '<div id=\"mini-border\"></div>' +\n                '</div>';\n    }\n    if (this.youtube_video) {\n        video_src = this.resource_protocol + 'www.youtube.com/embed/' + this.youtube_video +\n                '?wmode=transparent&showinfo=0&modestbranding=0&rel=0&autoplay=1&loop=0&vq=hd1080';\n        if (this.yt_custom) {\n            video_src += '&enablejsapi=1&html5=1&controls=0';\n            video_html =\n                    '<div id=\"video-controls\">' +\n                        '<div id=\"video-progress\" class=\"video-progress-el\">' +\n                            '<div id=\"video-progress-total\" class=\"video-progress-el\"></div>' +\n                            '<div id=\"video-elapsed\" class=\"video-progress-el\"></div>' +\n                        '</div>' +\n                        '<div id=\"video-time\" class=\"video-progress-el\"></div>' +\n                    '</div>';\n        }\n    } else if (this.vimeo_video) {\n        video_src = this.resource_protocol + 'player.vimeo.com/video/' + this.vimeo_video + '?autoplay=1&title=0&byline=0&portrait=0';\n    }\n    if (this.show_video) {\n        this.video_iframe =\n                '<iframe id=\"' + MixpanelNotification.MARKUP_PREFIX + '-video-frame\" ' +\n                    'width=\"' + this.video_width + '\" height=\"' + this.video_height + '\" ' +\n                    ' src=\"' + video_src + '\"' +\n                    ' frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen=\"1\" scrolling=\"no\"' +\n                '></iframe>';\n        video_html =\n                '<div id=\"video-' + (this.flip_animate ? '' : 'no') + 'flip\">' +\n                    '<div id=\"video\">' +\n                        '<div id=\"video-holder\"></div>' +\n                        video_html +\n                    '</div>' +\n                '</div>';\n    }\n    var main_html = video_html + notification_html;\n    if (this.flip_animate) {\n        main_html =\n                (this.mini ? notification_html : '') +\n                '<div id=\"flipcontainer\"><div id=\"flipper\">' +\n                    (this.mini ? video_html : main_html) +\n                '</div></div>';\n    }\n\n    this.notification_el.innerHTML =\n        ('<div id=\"overlay\" class=\"' + this.notif_type + '\">' +\n            '<div id=\"campaignid-' + this.campaign_id + '\">' +\n                '<div id=\"bgwrapper\">' +\n                    '<div id=\"bg\"></div>' +\n                    main_html +\n                '</div>' +\n            '</div>' +\n        '</div>')\n            .replace(/class=\"/g, 'class=\"' + MixpanelNotification.MARKUP_PREFIX + '-')\n            .replace(/id=\"/g, 'id=\"' + MixpanelNotification.MARKUP_PREFIX + '-');\n};\n\nMixpanelNotification.prototype._init_styles = function() {\n    if (this.style === 'dark') {\n        this.style_vals = {\n            bg:             '#1d1f25',\n            bg_actions:     '#282b32',\n            bg_hover:       '#3a4147',\n            bg_light:       '#4a5157',\n            border_gray:    '#32353c',\n            cancel_opacity: '0.4',\n            mini_hover:     '#2a3137',\n            text_title:     '#fff',\n            text_main:      '#9498a3',\n            text_tagline:   '#464851',\n            text_hover:     '#ddd'\n        };\n    } else {\n        this.style_vals = {\n            bg:             '#fff',\n            bg_actions:     '#e7eaee',\n            bg_hover:       '#eceff3',\n            bg_light:       '#f5f5f5',\n            border_gray:    '#e4ecf2',\n            cancel_opacity: '1.0',\n            mini_hover:     '#fafafa',\n            text_title:     '#5c6578',\n            text_main:      '#8b949b',\n            text_tagline:   '#ced9e6',\n            text_hover:     '#7c8598'\n        };\n    }\n    var shadow = '0px 0px 35px 0px rgba(45, 49, 56, 0.7)',\n        video_shadow = shadow,\n        mini_shadow = shadow,\n        thumb_total_size = MixpanelNotification.THUMB_IMG_SIZE + MixpanelNotification.THUMB_BORDER_SIZE * 2,\n        anim_seconds = (MixpanelNotification.ANIM_TIME / 1000) + 's';\n    if (this.mini) {\n        shadow = 'none';\n    }\n\n    // don't display on small viewports\n    var notif_media_queries = {},\n        min_width = MixpanelNotification.NOTIF_WIDTH_MINI + 20;\n    notif_media_queries['@media only screen and (max-width: ' + (min_width - 1) + 'px)'] = {\n        '#overlay': {\n            'display': 'none'\n        }\n    };\n    var notif_styles = {\n        '.flipped': {\n            'transform': 'rotateY(180deg)'\n        },\n        '#overlay': {\n            'position': 'fixed',\n            'top': '0',\n            'left': '0',\n            'width': '100%',\n            'height': '100%',\n            'overflow': 'auto',\n            'text-align': 'center',\n            'z-index': '10000',\n            'font-family': '\"Helvetica\", \"Arial\", sans-serif',\n            '-webkit-font-smoothing': 'antialiased',\n            '-moz-osx-font-smoothing': 'grayscale'\n        },\n        '#overlay.mini': {\n            'height': '0',\n            'overflow': 'visible'\n        },\n        '#overlay a': {\n            'width': 'initial',\n            'padding': '0',\n            'text-decoration': 'none',\n            'text-transform': 'none',\n            'color': 'inherit'\n        },\n        '#bgwrapper': {\n            'position': 'relative',\n            'width': '100%',\n            'height': '100%'\n        },\n        '#bg': {\n            'position': 'fixed',\n            'top': '0',\n            'left': '0',\n            'width': '100%',\n            'height': '100%',\n            'min-width': this.doc_width * 4 + 'px',\n            'min-height': this.doc_height * 4 + 'px',\n            'background-color': 'black',\n            'opacity': '0.0',\n            '-ms-filter': 'progid:DXImageTransform.Microsoft.Alpha(Opacity=60)', // IE8\n            'filter': 'alpha(opacity=60)', // IE5-7\n            'transition': 'opacity ' + anim_seconds\n        },\n        '#bg.visible': {\n            'opacity': MixpanelNotification.BG_OPACITY\n        },\n        '.mini #bg': {\n            'width': '0',\n            'height': '0',\n            'min-width': '0'\n        },\n        '#flipcontainer': {\n            'perspective': '1000px',\n            'position': 'absolute',\n            'width': '100%'\n        },\n        '#flipper': {\n            'position': 'relative',\n            'transform-style': 'preserve-3d',\n            'transition': '0.3s'\n        },\n        '#takeover': {\n            'position': 'absolute',\n            'left': '50%',\n            'width': MixpanelNotification.NOTIF_WIDTH + 'px',\n            'margin-left': Math.round(-MixpanelNotification.NOTIF_WIDTH / 2) + 'px',\n            'backface-visibility': 'hidden',\n            'transform': 'rotateY(0deg)',\n            'opacity': '0.0',\n            'top': MixpanelNotification.NOTIF_START_TOP + 'px',\n            'transition': 'opacity ' + anim_seconds + ', top ' + anim_seconds\n        },\n        '#takeover.visible': {\n            'opacity': '1.0',\n            'top': MixpanelNotification.NOTIF_TOP + 'px'\n        },\n        '#takeover.exiting': {\n            'opacity': '0.0',\n            'top': MixpanelNotification.NOTIF_START_TOP + 'px'\n        },\n        '#thumbspacer': {\n            'height': MixpanelNotification.THUMB_OFFSET + 'px'\n        },\n        '#thumbborder-wrapper': {\n            'position': 'absolute',\n            'top': (-MixpanelNotification.THUMB_BORDER_SIZE) + 'px',\n            'left': (MixpanelNotification.NOTIF_WIDTH / 2 - MixpanelNotification.THUMB_OFFSET - MixpanelNotification.THUMB_BORDER_SIZE) + 'px',\n            'width': thumb_total_size + 'px',\n            'height': (thumb_total_size / 2) + 'px',\n            'overflow': 'hidden'\n        },\n        '#thumbborder': {\n            'position': 'absolute',\n            'width': thumb_total_size + 'px',\n            'height': thumb_total_size + 'px',\n            'border-radius': thumb_total_size + 'px',\n            'background-color': this.style_vals.bg_actions,\n            'opacity': '0.5'\n        },\n        '#thumbnail': {\n            'position': 'absolute',\n            'top': '0px',\n            'left': (MixpanelNotification.NOTIF_WIDTH / 2 - MixpanelNotification.THUMB_OFFSET) + 'px',\n            'width': MixpanelNotification.THUMB_IMG_SIZE + 'px',\n            'height': MixpanelNotification.THUMB_IMG_SIZE + 'px',\n            'overflow': 'hidden',\n            'z-index': '100',\n            'border-radius': MixpanelNotification.THUMB_IMG_SIZE + 'px'\n        },\n        '#mini': {\n            'position': 'absolute',\n            'right': '20px',\n            'top': MixpanelNotification.NOTIF_TOP + 'px',\n            'width': this.notif_width + 'px',\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI * 2 + 'px',\n            'margin-top': 20 - MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'backface-visibility': 'hidden',\n            'opacity': '0.0',\n            'transform': 'rotateX(90deg)',\n            'transition': 'opacity 0.3s, transform 0.3s, right 0.3s'\n        },\n        '#mini.visible': {\n            'opacity': '1.0',\n            'transform': 'rotateX(0deg)'\n        },\n        '#mini.exiting': {\n            'opacity': '0.0',\n            'right': '-150px'\n        },\n        '#mainbox': {\n            'border-radius': '4px',\n            'box-shadow': shadow,\n            'text-align': 'center',\n            'background-color': this.style_vals.bg,\n            'font-size': '14px',\n            'color': this.style_vals.text_main\n        },\n        '#mini #mainbox': {\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'margin-top': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'border-radius': '3px',\n            'transition': 'background-color ' + anim_seconds\n        },\n        '#mini-border': {\n            'height': (MixpanelNotification.NOTIF_HEIGHT_MINI + 6) + 'px',\n            'width': (MixpanelNotification.NOTIF_WIDTH_MINI + 6) + 'px',\n            'position': 'absolute',\n            'top': '-3px',\n            'left': '-3px',\n            'margin-top': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'border-radius': '6px',\n            'opacity': '0.25',\n            'background-color': '#fff',\n            'z-index': '-1',\n            'box-shadow': mini_shadow\n        },\n        '#mini-icon': {\n            'position': 'relative',\n            'display': 'inline-block',\n            'width': '75px',\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'border-radius': '3px 0 0 3px',\n            'background-color': this.style_vals.bg_actions,\n            'background': 'linear-gradient(135deg, ' + this.style_vals.bg_light + ' 0%, ' + this.style_vals.bg_actions + ' 100%)',\n            'transition': 'background-color ' + anim_seconds\n        },\n        '#mini:hover #mini-icon': {\n            'background-color': this.style_vals.mini_hover\n        },\n        '#mini:hover #mainbox': {\n            'background-color': this.style_vals.mini_hover\n        },\n        '#mini-icon-img': {\n            'position': 'absolute',\n            'background-image': 'url(' + this.thumb_image_url + ')',\n            'width': '48px',\n            'height': '48px',\n            'top': '20px',\n            'left': '12px'\n        },\n        '#content': {\n            'padding': '30px 20px 0px 20px'\n        },\n        '#mini-content': {\n            'text-align': 'left',\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'cursor': 'pointer'\n        },\n        '#img': {\n            'width': '328px',\n            'margin-top': '30px',\n            'border-radius': '5px'\n        },\n        '#title': {\n            'max-height': '600px',\n            'overflow': 'hidden',\n            'word-wrap': 'break-word',\n            'padding': '25px 0px 20px 0px',\n            'font-size': '19px',\n            'font-weight': 'bold',\n            'color': this.style_vals.text_title\n        },\n        '#body': {\n            'max-height': '600px',\n            'margin-bottom': '25px',\n            'overflow': 'hidden',\n            'word-wrap': 'break-word',\n            'line-height': '21px',\n            'font-size': '15px',\n            'font-weight': 'normal',\n            'text-align': 'left'\n        },\n        '#mini #body': {\n            'display': 'inline-block',\n            'max-width': '250px',\n            'margin': '0 0 0 30px',\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px',\n            'font-size': '16px',\n            'letter-spacing': '0.8px',\n            'color': this.style_vals.text_title\n        },\n        '#mini #body-text': {\n            'display': 'table',\n            'height': MixpanelNotification.NOTIF_HEIGHT_MINI + 'px'\n        },\n        '#mini #body-text div': {\n            'display': 'table-cell',\n            'vertical-align': 'middle'\n        },\n        '#tagline': {\n            'margin-bottom': '15px',\n            'font-size': '10px',\n            'font-weight': '600',\n            'letter-spacing': '0.8px',\n            'color': '#ccd7e0',\n            'text-align': 'left'\n        },\n        '#tagline a': {\n            'color': this.style_vals.text_tagline,\n            'transition': 'color ' + anim_seconds\n        },\n        '#tagline a:hover': {\n            'color': this.style_vals.text_hover\n        },\n        '#cancel': {\n            'position': 'absolute',\n            'right': '0',\n            'width': '8px',\n            'height': '8px',\n            'padding': '10px',\n            'border-radius': '20px',\n            'margin': '12px 12px 0 0',\n            'box-sizing': 'content-box',\n            'cursor': 'pointer',\n            'transition': 'background-color ' + anim_seconds\n        },\n        '#mini #cancel': {\n            'margin': '7px 7px 0 0'\n        },\n        '#cancel-icon': {\n            'width': '8px',\n            'height': '8px',\n            'overflow': 'hidden',\n            'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/cancel-x.png)',\n            'opacity': this.style_vals.cancel_opacity\n        },\n        '#cancel:hover': {\n            'background-color': this.style_vals.bg_hover\n        },\n        '#button': {\n            'display': 'block',\n            'height': '60px',\n            'line-height': '60px',\n            'text-align': 'center',\n            'background-color': this.style_vals.bg_actions,\n            'border-radius': '0 0 4px 4px',\n            'overflow': 'hidden',\n            'cursor': 'pointer',\n            'transition': 'background-color ' + anim_seconds\n        },\n        '#button-close': {\n            'display': 'inline-block',\n            'width': '9px',\n            'height': '60px',\n            'margin-right': '8px',\n            'vertical-align': 'top',\n            'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/close-x-' + this.style + '.png)',\n            'background-repeat': 'no-repeat',\n            'background-position': '0px 25px'\n        },\n        '#button-play': {\n            'display': 'inline-block',\n            'width': '30px',\n            'height': '60px',\n            'margin-left': '15px',\n            'background-image': 'url(' + this.cdn_host + '/site_media/images/icons/notifications/play-' + this.style + '-small.png)',\n            'background-repeat': 'no-repeat',\n            'background-position': '0px 15px'\n        },\n        'a#button-link': {\n            'display': 'inline-block',\n            'vertical-align': 'top',\n            'text-align': 'center',\n            'font-size': '17px',\n            'font-weight': 'bold',\n            'overflow': 'hidden',\n            'word-wrap': 'break-word',\n            'color': this.style_vals.text_title,\n            'transition': 'color ' + anim_seconds\n        },\n        '#button:hover': {\n            'background-color': this.style_vals.bg_hover,\n            'color': this.style_vals.text_hover\n        },\n        '#button:hover a': {\n            'color': this.style_vals.text_hover\n        },\n\n        '#video-noflip': {\n            'position': 'relative',\n            'top': (-this.video_height * 2) + 'px'\n        },\n        '#video-flip': {\n            'backface-visibility': 'hidden',\n            'transform': 'rotateY(180deg)'\n        },\n        '#video': {\n            'position': 'absolute',\n            'width': (this.video_width - 1) + 'px',\n            'height': this.video_height + 'px',\n            'top': MixpanelNotification.NOTIF_TOP + 'px',\n            'margin-top': '100px',\n            'left': '50%',\n            'margin-left': Math.round(-this.video_width / 2) + 'px',\n            'overflow': 'hidden',\n            'border-radius': '5px',\n            'box-shadow': video_shadow,\n            'transform': 'translateZ(1px)', // webkit rendering bug http://stackoverflow.com/questions/18167981/clickable-link-area-unexpectedly-smaller-after-css-transform\n            'transition': 'opacity ' + anim_seconds + ', top ' + anim_seconds\n        },\n        '#video.exiting': {\n            'opacity': '0.0',\n            'top': this.video_height + 'px'\n        },\n        '#video-holder': {\n            'position': 'absolute',\n            'width': (this.video_width - 1) + 'px',\n            'height': this.video_height + 'px',\n            'overflow': 'hidden',\n            'border-radius': '5px'\n        },\n        '#video-frame': {\n            'margin-left': '-1px',\n            'width': this.video_width + 'px'\n        },\n        '#video-controls': {\n            'opacity': '0',\n            'transition': 'opacity 0.5s'\n        },\n        '#video:hover #video-controls': {\n            'opacity': '1.0'\n        },\n        '#video .video-progress-el': {\n            'position': 'absolute',\n            'bottom': '0',\n            'height': '25px',\n            'border-radius': '0 0 0 5px'\n        },\n        '#video-progress': {\n            'width': '90%'\n        },\n        '#video-progress-total': {\n            'width': '100%',\n            'background-color': this.style_vals.bg,\n            'opacity': '0.7'\n        },\n        '#video-elapsed': {\n            'width': '0',\n            'background-color': '#6cb6f5',\n            'opacity': '0.9'\n        },\n        '#video #video-time': {\n            'width': '10%',\n            'right': '0',\n            'font-size': '11px',\n            'line-height': '25px',\n            'color': this.style_vals.text_main,\n            'background-color': '#666',\n            'border-radius': '0 0 5px 0'\n        }\n    };\n\n    // IE hacks\n    if (this._browser_lte('ie', 8)) {\n        _.extend(notif_styles, {\n            '* html #overlay': {\n                'position': 'absolute'\n            },\n            '* html #bg': {\n                'position': 'absolute'\n            },\n            'html, body': {\n                'height': '100%'\n            }\n        });\n    }\n    if (this._browser_lte('ie', 7)) {\n        _.extend(notif_styles, {\n            '#mini #body': {\n                'display': 'inline',\n                'zoom': '1',\n                'border': '1px solid ' + this.style_vals.bg_hover\n            },\n            '#mini #body-text': {\n                'padding': '20px'\n            },\n            '#mini #mini-icon': {\n                'display': 'none'\n            }\n        });\n    }\n\n    // add vendor-prefixed style rules\n    var VENDOR_STYLES = [\n            'backface-visibility', 'border-radius', 'box-shadow', 'opacity',\n            'perspective', 'transform', 'transform-style', 'transition'\n        ],\n        VENDOR_PREFIXES = ['khtml', 'moz', 'ms', 'o', 'webkit'];\n    for (var selector in notif_styles) {\n        for (var si = 0; si < VENDOR_STYLES.length; si++) {\n            var prop = VENDOR_STYLES[si];\n            if (prop in notif_styles[selector]) {\n                var val = notif_styles[selector][prop];\n                for (var pi = 0; pi < VENDOR_PREFIXES.length; pi++) {\n                    notif_styles[selector]['-' + VENDOR_PREFIXES[pi] + '-' + prop] = val;\n                }\n            }\n        }\n    }\n\n    var inject_styles = function(styles, media_queries) {\n        var create_style_text = function(style_defs) {\n            var st = '';\n            for (var selector in style_defs) {\n                var mp_selector = selector\n                    .replace(/#/g, '#' + MixpanelNotification.MARKUP_PREFIX + '-')\n                    .replace(/\\./g, '.' + MixpanelNotification.MARKUP_PREFIX + '-');\n                st += '\\n' + mp_selector + ' {';\n                var props = style_defs[selector];\n                for (var k in props) {\n                    st += k + ':' + props[k] + ';';\n                }\n                st += '}';\n            }\n            return st;\n        };\n        var create_media_query_text = function(mq_defs) {\n            var mqt = '';\n            for (var mq in mq_defs) {\n                mqt += '\\n' + mq + ' {' + create_style_text(mq_defs[mq]) + '\\n}';\n            }\n            return mqt;\n        };\n\n        var style_text = create_style_text(styles) + create_media_query_text(media_queries),\n            head_el = document.head || document.getElementsByTagName('head')[0] || document.documentElement,\n            style_el = document.createElement('style');\n        head_el.appendChild(style_el);\n        style_el.setAttribute('type', 'text/css');\n        if (style_el.styleSheet) { // IE\n            style_el.styleSheet.cssText = style_text;\n        } else {\n            style_el.textContent = style_text;\n        }\n    };\n    inject_styles(notif_styles, notif_media_queries);\n};\n\nMixpanelNotification.prototype._init_video = _.safewrap(function() {\n    if (!this.video_url) {\n        return;\n    }\n    var self = this;\n\n    // Youtube iframe API compatibility\n    self.yt_custom = 'postMessage' in window;\n\n    self.dest_url = self.video_url;\n    var youtube_match = self.video_url.match(\n            // http://stackoverflow.com/questions/2936467/parse-youtube-video-id-using-preg-match\n            /(?:youtube(?:-nocookie)?\\.com\\/(?:[^/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?/ ]{11})/i\n        ),\n        vimeo_match = self.video_url.match(\n            /vimeo\\.com\\/.*?(\\d+)/i\n        );\n    if (youtube_match) {\n        self.show_video = true;\n        self.youtube_video = youtube_match[1];\n\n        if (self.yt_custom) {\n            window['onYouTubeIframeAPIReady'] = function() {\n                if (self._get_el('video-frame')) {\n                    self._yt_video_ready();\n                }\n            };\n\n            // load Youtube iframe API; see https://developers.google.com/youtube/iframe_api_reference\n            var tag = document.createElement('script');\n            tag.src = self.resource_protocol + 'www.youtube.com/iframe_api';\n            var firstScriptTag = document.getElementsByTagName('script')[0];\n            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n        }\n    } else if (vimeo_match) {\n        self.show_video = true;\n        self.vimeo_video = vimeo_match[1];\n    }\n\n    // IE <= 7, FF <= 3: fall through to video link rather than embedded player\n    if (self._browser_lte('ie', 7) || self._browser_lte('firefox', 3)) {\n        self.show_video = false;\n        self.clickthrough = true;\n    }\n});\n\nMixpanelNotification.prototype._mark_as_shown = _.safewrap(function() {\n    // click on background to dismiss\n    var self = this;\n    _.register_event(self._get_el('bg'), 'click', function() {\n        self.dismiss();\n    });\n\n    var get_style = function(el, style_name) {\n        var styles = {};\n        if (document.defaultView && document.defaultView.getComputedStyle) {\n            styles = document.defaultView.getComputedStyle(el, null); // FF3 requires both args\n        } else if (el.currentStyle) { // IE\n            styles = el.currentStyle;\n        }\n        return styles[style_name];\n    };\n\n    if (this.campaign_id) {\n        var notif_el = this._get_el('overlay');\n        if (notif_el && get_style(notif_el, 'visibility') !== 'hidden' && get_style(notif_el, 'display') !== 'none') {\n            this._mark_delivery();\n        }\n    }\n});\n\nMixpanelNotification.prototype._mark_delivery = _.safewrap(function(extra_props) {\n    if (!this.marked_as_shown) {\n        this.marked_as_shown = true;\n\n        if (this.campaign_id) {\n            // mark notification shown (local cache)\n            this._get_shown_campaigns()[this.campaign_id] = 1 * new Date();\n            this.persistence.save();\n        }\n\n        // track delivery\n        this._track_event('$campaign_delivery', extra_props);\n\n        // mark notification shown (mixpanel property)\n        this.mixpanel['people']['append']({\n            '$campaigns': this.campaign_id,\n            '$notifications': {\n                'campaign_id': this.campaign_id,\n                'message_id':  this.message_id,\n                'type':        'web',\n                'time':        new Date()\n            }\n        });\n    }\n});\n\nMixpanelNotification.prototype._preload_images = function(all_loaded_cb) {\n    var self = this;\n    if (this.imgs_to_preload.length === 0) {\n        all_loaded_cb();\n        return;\n    }\n\n    var preloaded_imgs = 0;\n    var img_objs = [];\n    var onload = function() {\n        preloaded_imgs++;\n        if (preloaded_imgs === self.imgs_to_preload.length && all_loaded_cb) {\n            all_loaded_cb();\n            all_loaded_cb = null;\n        }\n    };\n    for (var i = 0; i < this.imgs_to_preload.length; i++) {\n        var img = new Image();\n        img.onload = onload;\n        img.src = this.imgs_to_preload[i];\n        if (img.complete) {\n            onload();\n        }\n        img_objs.push(img);\n    }\n\n    // IE6/7 doesn't fire onload reliably\n    if (this._browser_lte('ie', 7)) {\n        setTimeout(function() {\n            var imgs_loaded = true;\n            for (i = 0; i < img_objs.length; i++) {\n                if (!img_objs[i].complete) {\n                    imgs_loaded = false;\n                }\n            }\n            if (imgs_loaded && all_loaded_cb) {\n                all_loaded_cb();\n                all_loaded_cb = null;\n            }\n        }, 500);\n    }\n};\n\nMixpanelNotification.prototype._remove_notification_el = _.safewrap(function() {\n    window.clearInterval(this._video_progress_checker);\n    this.notification_el.style.visibility = 'hidden';\n    this.body_el.removeChild(this.notification_el);\n});\n\nMixpanelNotification.prototype._set_client_config = function() {\n    var get_browser_version = function(browser_ex) {\n        var match = navigator.userAgent.match(browser_ex);\n        return match && match[1];\n    };\n    this.browser_versions = {};\n    this.browser_versions['chrome']  = get_browser_version(/Chrome\\/(\\d+)/);\n    this.browser_versions['firefox'] = get_browser_version(/Firefox\\/(\\d+)/);\n    this.browser_versions['ie']      = get_browser_version(/MSIE (\\d+).+/);\n    if (!this.browser_versions['ie'] && !(window.ActiveXObject) && 'ActiveXObject' in window) {\n        this.browser_versions['ie'] = 11;\n    }\n\n    this.body_el = document.body || document.getElementsByTagName('body')[0];\n    if (this.body_el) {\n        this.doc_width = Math.max(\n            this.body_el.scrollWidth, document.documentElement.scrollWidth,\n            this.body_el.offsetWidth, document.documentElement.offsetWidth,\n            this.body_el.clientWidth, document.documentElement.clientWidth\n        );\n        this.doc_height = Math.max(\n            this.body_el.scrollHeight, document.documentElement.scrollHeight,\n            this.body_el.offsetHeight, document.documentElement.offsetHeight,\n            this.body_el.clientHeight, document.documentElement.clientHeight\n        );\n    }\n\n    // detect CSS compatibility\n    var ie_ver = this.browser_versions['ie'];\n    var sample_styles = document.createElement('div').style,\n        is_css_compatible = function(rule) {\n            if (rule in sample_styles) {\n                return true;\n            }\n            if (!ie_ver) {\n                rule = rule[0].toUpperCase() + rule.slice(1);\n                var props = ['O' + rule, 'Webkit' + rule, 'Moz' + rule];\n                for (var i = 0; i < props.length; i++) {\n                    if (props[i] in sample_styles) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        };\n    this.use_transitions = this.body_el &&\n        is_css_compatible('transition') &&\n        is_css_compatible('transform');\n    this.flip_animate = (this.browser_versions['chrome'] >= 33 || this.browser_versions['firefox'] >= 15) &&\n        this.body_el &&\n        is_css_compatible('backfaceVisibility') &&\n        is_css_compatible('perspective') &&\n        is_css_compatible('transform');\n};\n\nMixpanelNotification.prototype._switch_to_video = _.safewrap(function() {\n    var self = this,\n        anims = [\n            {\n                el:    self._get_notification_display_el(),\n                attr:  'opacity',\n                start: 1.0,\n                goal:  0.0\n            },\n            {\n                el:    self._get_notification_display_el(),\n                attr:  'top',\n                start: MixpanelNotification.NOTIF_TOP,\n                goal:  -500\n            },\n            {\n                el:    self._get_el('video-noflip'),\n                attr:  'opacity',\n                start: 0.0,\n                goal:  1.0\n            },\n            {\n                el:    self._get_el('video-noflip'),\n                attr:  'top',\n                start: -self.video_height * 2,\n                goal:  0\n            }\n        ];\n\n    if (self.mini) {\n        var bg = self._get_el('bg'),\n            overlay = self._get_el('overlay');\n        bg.style.width = '100%';\n        bg.style.height = '100%';\n        overlay.style.width = '100%';\n\n        self._add_class(self._get_notification_display_el(), 'exiting');\n        self._add_class(bg, 'visible');\n\n        anims.push({\n            el:    self._get_el('bg'),\n            attr:  'opacity',\n            start: 0.0,\n            goal:  MixpanelNotification.BG_OPACITY\n        });\n    }\n\n    var video_el = self._get_el('video-holder');\n    video_el.innerHTML = self.video_iframe;\n\n    var video_ready = function() {\n        if (window['YT'] && window['YT']['loaded']) {\n            self._yt_video_ready();\n        }\n        self.showing_video = true;\n        self._get_notification_display_el().style.visibility = 'hidden';\n    };\n    if (self.flip_animate) {\n        self._add_class('flipper', 'flipped');\n        setTimeout(video_ready, MixpanelNotification.ANIM_TIME);\n    } else {\n        self._animate_els(anims, MixpanelNotification.ANIM_TIME, video_ready);\n    }\n});\n\nMixpanelNotification.prototype._track_event = function(event_name, properties, cb) {\n    if (this.campaign_id) {\n        properties = properties || {};\n        properties = _.extend(properties, {\n            'campaign_id':     this.campaign_id,\n            'message_id':      this.message_id,\n            'message_type':    'web_inapp',\n            'message_subtype': this.notif_type\n        });\n        this.mixpanel['track'](event_name, properties, cb);\n    } else if (cb) {\n        cb.call();\n    }\n};\n\nMixpanelNotification.prototype._yt_video_ready = _.safewrap(function() {\n    var self = this;\n    if (self.video_inited) {\n        return;\n    }\n    self.video_inited = true;\n\n    var progress_bar  = self._get_el('video-elapsed'),\n        progress_time = self._get_el('video-time'),\n        progress_el   = self._get_el('video-progress');\n\n    new window['YT']['Player'](MixpanelNotification.MARKUP_PREFIX + '-video-frame', {\n        'events': {\n            'onReady': function(event) {\n                var ytplayer = event['target'],\n                    video_duration = ytplayer['getDuration'](),\n                    pad = function(i) {\n                        return ('00' + i).slice(-2);\n                    },\n                    update_video_time = function(current_time) {\n                        var secs = Math.round(video_duration - current_time),\n                            mins = Math.floor(secs / 60),\n                            hours = Math.floor(mins / 60);\n                        secs -= mins * 60;\n                        mins -= hours * 60;\n                        progress_time.innerHTML = '-' + (hours ? hours + ':' : '') + pad(mins) + ':' + pad(secs);\n                    };\n                update_video_time(0);\n                self._video_progress_checker = window.setInterval(function() {\n                    var current_time = ytplayer['getCurrentTime']();\n                    progress_bar.style.width = (current_time / video_duration * 100) + '%';\n                    update_video_time(current_time);\n                }, 250);\n                _.register_event(progress_el, 'click', function(e) {\n                    var clickx = Math.max(0, e.pageX - progress_el.getBoundingClientRect().left);\n                    ytplayer['seekTo'](video_duration * clickx / progress_el.clientWidth, true);\n                });\n            }\n        }\n    });\n});\n\n/**\n * Mixpanel People Object\n * @constructor\n */\nvar MixpanelPeople = function() {};\n\n_.extend(MixpanelPeople.prototype, apiActions);\n\nMixpanelPeople.prototype._init = function(mixpanel_instance) {\n    this._mixpanel = mixpanel_instance;\n};\n\n/*\n* Set properties on a user record.\n*\n* ### Usage:\n*\n*     mixpanel.people.set('gender', 'm');\n*\n*     // or set multiple properties at once\n*     mixpanel.people.set({\n*         'Company': 'Acme',\n*         'Plan': 'Premium',\n*         'Upgrade date': new Date()\n*     });\n*     // properties can be strings, integers, dates, or lists\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [to] A value to set on the given property name\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.set = addOptOutCheckMixpanelPeople(function(prop, to, callback) {\n    var data = this.set_action(prop, to);\n    if (_.isObject(prop)) {\n        callback = to;\n    }\n    // make sure that the referrer info has been updated and saved\n    if (this._get_config('save_referrer')) {\n        this._mixpanel['persistence'].update_referrer_info(document.referrer);\n    }\n\n    // update $set object with default people properties\n    data[SET_ACTION] = _.extend(\n        {},\n        _.info.people_properties(),\n        this._mixpanel['persistence'].get_referrer_info(),\n        data[SET_ACTION]\n    );\n    return this._send_request(data, callback);\n});\n\n/*\n* Set properties on a user record, only if they do not yet exist.\n* This will not overwrite previous people property values, unlike\n* people.set().\n*\n* ### Usage:\n*\n*     mixpanel.people.set_once('First Login Date', new Date());\n*\n*     // or set multiple properties at once\n*     mixpanel.people.set_once({\n*         'First Login Date': new Date(),\n*         'Starting Plan': 'Premium'\n*     });\n*\n*     // properties can be strings, integers or dates\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [to] A value to set on the given property name\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.set_once = addOptOutCheckMixpanelPeople(function(prop, to, callback) {\n    var data = this.set_once_action(prop, to);\n    if (_.isObject(prop)) {\n        callback = to;\n    }\n    return this._send_request(data, callback);\n});\n\n/*\n* Unset properties on a user record (permanently removes the properties and their values from a profile).\n*\n* ### Usage:\n*\n*     mixpanel.people.unset('gender');\n*\n*     // or unset multiple properties at once\n*     mixpanel.people.unset(['gender', 'Company']);\n*\n* @param {Array|String} prop If a string, this is the name of the property. If an array, this is a list of property names.\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.unset = addOptOutCheckMixpanelPeople(function(prop, callback) {\n    var data = this.unset_action(prop);\n    return this._send_request(data, callback);\n});\n\n/*\n* Increment/decrement numeric people analytics properties.\n*\n* ### Usage:\n*\n*     mixpanel.people.increment('page_views', 1);\n*\n*     // or, for convenience, if you're just incrementing a counter by\n*     // 1, you can simply do\n*     mixpanel.people.increment('page_views');\n*\n*     // to decrement a counter, pass a negative number\n*     mixpanel.people.increment('credits_left', -1);\n*\n*     // like mixpanel.people.set(), you can increment multiple\n*     // properties at once:\n*     mixpanel.people.increment({\n*         counter1: 1,\n*         counter2: 6\n*     });\n*\n* @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and numeric values.\n* @param {Number} [by] An amount to increment the given property\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.increment = addOptOutCheckMixpanelPeople(function(prop, by, callback) {\n    var data = {};\n    var $add = {};\n    if (_.isObject(prop)) {\n        _.each(prop, function(v, k) {\n            if (!this._is_reserved_property(k)) {\n                if (isNaN(parseFloat(v))) {\n                    console$1.error('Invalid increment value passed to mixpanel.people.increment - must be a number');\n                    return;\n                } else {\n                    $add[k] = v;\n                }\n            }\n        }, this);\n        callback = by;\n    } else {\n        // convenience: mixpanel.people.increment('property'); will\n        // increment 'property' by 1\n        if (_.isUndefined(by)) {\n            by = 1;\n        }\n        $add[prop] = by;\n    }\n    data[ADD_ACTION] = $add;\n\n    return this._send_request(data, callback);\n});\n\n/*\n* Append a value to a list-valued people analytics property.\n*\n* ### Usage:\n*\n*     // append a value to a list, creating it if needed\n*     mixpanel.people.append('pages_visited', 'homepage');\n*\n*     // like mixpanel.people.set(), you can append multiple\n*     // properties at once:\n*     mixpanel.people.append({\n*         list1: 'bob',\n*         list2: 123\n*     });\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] value An item to append to the list\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.append = addOptOutCheckMixpanelPeople(function(list_name, value, callback) {\n    if (_.isObject(list_name)) {\n        callback = value;\n    }\n    var data = this.append_action(list_name, value);\n    return this._send_request(data, callback);\n});\n\n/*\n* Remove a value from a list-valued people analytics property.\n*\n* ### Usage:\n*\n*     mixpanel.people.remove('School', 'UCB');\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] value Item to remove from the list\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.remove = addOptOutCheckMixpanelPeople(function(list_name, value, callback) {\n    if (_.isObject(list_name)) {\n        callback = value;\n    }\n    var data = this.remove_action(list_name, value);\n    return this._send_request(data, callback);\n});\n\n/*\n* Merge a given list with a list-valued people analytics property,\n* excluding duplicate values.\n*\n* ### Usage:\n*\n*     // merge a value to a list, creating it if needed\n*     mixpanel.people.union('pages_visited', 'homepage');\n*\n*     // like mixpanel.people.set(), you can append multiple\n*     // properties at once:\n*     mixpanel.people.union({\n*         list1: 'bob',\n*         list2: 123\n*     });\n*\n*     // like mixpanel.people.append(), you can append multiple\n*     // values to the same list:\n*     mixpanel.people.union({\n*         list1: ['bob', 'billy']\n*     });\n*\n* @param {Object|String} list_name If a string, this is the name of the property. If an object, this is an associative array of names and values.\n* @param {*} [value] Value / values to merge with the given property\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.union = addOptOutCheckMixpanelPeople(function(list_name, values, callback) {\n    if (_.isObject(list_name)) {\n        callback = values;\n    }\n    var data = this.union_action(list_name, values);\n    return this._send_request(data, callback);\n});\n\n/*\n* Record that you have charged the current user a certain amount\n* of money. Charges recorded with track_charge() will appear in the\n* Mixpanel revenue report.\n*\n* ### Usage:\n*\n*     // charge a user $50\n*     mixpanel.people.track_charge(50);\n*\n*     // charge a user $30.50 on the 2nd of january\n*     mixpanel.people.track_charge(30.50, {\n*         '$time': new Date('jan 1 2012')\n*     });\n*\n* @param {Number} amount The amount of money charged to the current user\n* @param {Object} [properties] An associative array of properties associated with the charge\n* @param {Function} [callback] If provided, the callback will be called when the server responds\n*/\nMixpanelPeople.prototype.track_charge = addOptOutCheckMixpanelPeople(function(amount, properties, callback) {\n    if (!_.isNumber(amount)) {\n        amount = parseFloat(amount);\n        if (isNaN(amount)) {\n            console$1.error('Invalid value passed to mixpanel.people.track_charge - must be a number');\n            return;\n        }\n    }\n\n    return this.append('$transactions', _.extend({\n        '$amount': amount\n    }, properties), callback);\n});\n\n/*\n* Permanently clear all revenue report transactions from the\n* current user's people analytics profile.\n*\n* ### Usage:\n*\n*     mixpanel.people.clear_charges();\n*\n* @param {Function} [callback] If provided, the callback will be called after tracking the event.\n*/\nMixpanelPeople.prototype.clear_charges = function(callback) {\n    return this.set('$transactions', [], callback);\n};\n\n/*\n* Permanently deletes the current people analytics profile from\n* Mixpanel (using the current distinct_id).\n*\n* ### Usage:\n*\n*     // remove the all data you have stored about the current user\n*     mixpanel.people.delete_user();\n*\n*/\nMixpanelPeople.prototype.delete_user = function() {\n    if (!this._identify_called()) {\n        console$1.error('mixpanel.people.delete_user() requires you to call identify() first');\n        return;\n    }\n    var data = {'$delete': this._mixpanel.get_distinct_id()};\n    return this._send_request(data);\n};\n\nMixpanelPeople.prototype.toString = function() {\n    return this._mixpanel.toString() + '.people';\n};\n\nMixpanelPeople.prototype._send_request = function(data, callback) {\n    data['$token'] = this._get_config('token');\n    data['$distinct_id'] = this._mixpanel.get_distinct_id();\n    var device_id = this._mixpanel.get_property('$device_id');\n    var user_id = this._mixpanel.get_property('$user_id');\n    var had_persisted_distinct_id = this._mixpanel.get_property('$had_persisted_distinct_id');\n    if (device_id) {\n        data['$device_id'] = device_id;\n    }\n    if (user_id) {\n        data['$user_id'] = user_id;\n    }\n    if (had_persisted_distinct_id) {\n        data['$had_persisted_distinct_id'] = had_persisted_distinct_id;\n    }\n\n    var date_encoded_data = _.encodeDates(data);\n    var truncated_data    = _.truncate(date_encoded_data, 255);\n    var json_data         = _.JSONEncode(date_encoded_data);\n    var encoded_data      = _.base64Encode(json_data);\n\n    if (!this._identify_called()) {\n        this._enqueue(data);\n        if (!_.isUndefined(callback)) {\n            if (this._get_config('verbose')) {\n                callback({status: -1, error: null});\n            } else {\n                callback(-1);\n            }\n        }\n        return truncated_data;\n    }\n\n    console$1.log('MIXPANEL PEOPLE REQUEST:');\n    console$1.log(truncated_data);\n\n    this._mixpanel._send_request(\n        this._get_config('api_host') + '/engage/',\n        {'data': encoded_data},\n        this._mixpanel._prepare_callback(callback, truncated_data)\n    );\n\n    return truncated_data;\n};\n\nMixpanelPeople.prototype._get_config = function(conf_var) {\n    return this._mixpanel.get_config(conf_var);\n};\n\nMixpanelPeople.prototype._identify_called = function() {\n    return this._mixpanel._flags.identify_called === true;\n};\n\n// Queue up engage operations if identify hasn't been called yet.\nMixpanelPeople.prototype._enqueue = function(data) {\n    if (SET_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(SET_ACTION, data);\n    } else if (SET_ONCE_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(SET_ONCE_ACTION, data);\n    } else if (UNSET_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(UNSET_ACTION, data);\n    } else if (ADD_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(ADD_ACTION, data);\n    } else if (APPEND_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(APPEND_ACTION, data);\n    } else if (REMOVE_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(REMOVE_ACTION, data);\n    } else if (UNION_ACTION in data) {\n        this._mixpanel['persistence']._add_to_people_queue(UNION_ACTION, data);\n    } else {\n        console$1.error('Invalid call to _enqueue():', data);\n    }\n};\n\nMixpanelPeople.prototype._flush_one_queue = function(action, action_method, callback, queue_to_params_fn) {\n    var _this = this;\n    var queued_data = _.extend({}, this._mixpanel['persistence']._get_queue(action));\n    var action_params = queued_data;\n\n    if (!_.isUndefined(queued_data) && _.isObject(queued_data) && !_.isEmptyObject(queued_data)) {\n        _this._mixpanel['persistence']._pop_from_people_queue(action, queued_data);\n        if (queue_to_params_fn) {\n            action_params = queue_to_params_fn(queued_data);\n        }\n        action_method.call(_this, action_params, function(response, data) {\n            // on bad response, we want to add it back to the queue\n            if (response === 0) {\n                _this._mixpanel['persistence']._add_to_people_queue(action, queued_data);\n            }\n            if (!_.isUndefined(callback)) {\n                callback(response, data);\n            }\n        });\n    }\n};\n\n// Flush queued engage operations - order does not matter,\n// and there are network level race conditions anyway\nMixpanelPeople.prototype._flush = function(\n    _set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback\n) {\n    var _this = this;\n    var $append_queue = this._mixpanel['persistence']._get_queue(APPEND_ACTION);\n    var $remove_queue = this._mixpanel['persistence']._get_queue(REMOVE_ACTION);\n\n    this._flush_one_queue(SET_ACTION, this.set, _set_callback);\n    this._flush_one_queue(SET_ONCE_ACTION, this.set_once, _set_once_callback);\n    this._flush_one_queue(UNSET_ACTION, this.unset, _unset_callback, function(queue) { return _.keys(queue); });\n    this._flush_one_queue(ADD_ACTION, this.increment, _add_callback);\n    this._flush_one_queue(UNION_ACTION, this.union, _union_callback);\n\n    // we have to fire off each $append individually since there is\n    // no concat method server side\n    if (!_.isUndefined($append_queue) && _.isArray($append_queue) && $append_queue.length) {\n        var $append_item;\n        var append_callback = function(response, data) {\n            if (response === 0) {\n                _this._mixpanel['persistence']._add_to_people_queue(APPEND_ACTION, $append_item);\n            }\n            if (!_.isUndefined(_append_callback)) {\n                _append_callback(response, data);\n            }\n        };\n        for (var i = $append_queue.length - 1; i >= 0; i--) {\n            $append_item = $append_queue.pop();\n            if (!_.isEmptyObject($append_item)) {\n                _this.append($append_item, append_callback);\n            }\n        }\n        // Save the shortened append queue\n        _this._mixpanel['persistence'].save();\n    }\n\n    // same for $remove\n    if (!_.isUndefined($remove_queue) && _.isArray($remove_queue) && $remove_queue.length) {\n        var $remove_item;\n        var remove_callback = function(response, data) {\n            if (response === 0) {\n                _this._mixpanel['persistence']._add_to_people_queue(REMOVE_ACTION, $remove_item);\n            }\n            if (!_.isUndefined(_remove_callback)) {\n                _remove_callback(response, data);\n            }\n        };\n        for (var j = $remove_queue.length - 1; j >= 0; j--) {\n            $remove_item = $remove_queue.pop();\n            if (!_.isEmptyObject($remove_item)) {\n                _this.remove($remove_item, remove_callback);\n            }\n        }\n        _this._mixpanel['persistence'].save();\n    }\n};\n\nMixpanelPeople.prototype._is_reserved_property = function(prop) {\n    return prop === '$distinct_id' || prop === '$token' || prop === '$device_id' || prop === '$user_id' || prop === '$had_persisted_distinct_id';\n};\n\n// MixpanelPeople Exports\nMixpanelPeople.prototype['set']           = MixpanelPeople.prototype.set;\nMixpanelPeople.prototype['set_once']      = MixpanelPeople.prototype.set_once;\nMixpanelPeople.prototype['unset']         = MixpanelPeople.prototype.unset;\nMixpanelPeople.prototype['increment']     = MixpanelPeople.prototype.increment;\nMixpanelPeople.prototype['append']        = MixpanelPeople.prototype.append;\nMixpanelPeople.prototype['remove']        = MixpanelPeople.prototype.remove;\nMixpanelPeople.prototype['union']         = MixpanelPeople.prototype.union;\nMixpanelPeople.prototype['track_charge']  = MixpanelPeople.prototype.track_charge;\nMixpanelPeople.prototype['clear_charges'] = MixpanelPeople.prototype.clear_charges;\nMixpanelPeople.prototype['delete_user']   = MixpanelPeople.prototype.delete_user;\nMixpanelPeople.prototype['toString']      = MixpanelPeople.prototype.toString;\n\n/*\n * Mixpanel JS Library\n *\n * Copyright 2012, Mixpanel, Inc. All Rights Reserved\n * http://mixpanel.com/\n *\n * Includes portions of Underscore.js\n * http://documentcloud.github.com/underscore/\n * (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n * Released under the MIT License.\n */\n\n// ==ClosureCompiler==\n// @compilation_level ADVANCED_OPTIMIZATIONS\n// @output_file_name mixpanel-2.8.min.js\n// ==/ClosureCompiler==\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x === public function\nthis._x === internal - only use within this file\nthis.__x === private - only use within the class\n\nGlobals should be all caps\n*/\n\nvar init_type;       // MODULE or SNIPPET loader\nvar mixpanel_master; // main mixpanel instance / object\nvar INIT_MODULE  = 0;\nvar INIT_SNIPPET = 1;\n\n/** @const */ var PRIMARY_INSTANCE_NAME = 'mixpanel';\n\n\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n// http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n// https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\nvar USE_XHR = (window$1.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest());\n\n// IE<10 does not support cross-origin XHR's but script tags\n// with defer won't block window.onload; ENQUEUE_REQUESTS\n// should only be true for Opera<12\nvar ENQUEUE_REQUESTS = !USE_XHR && (userAgent.indexOf('MSIE') === -1) && (userAgent.indexOf('Mozilla') === -1);\n\n/*\n * Module-level globals\n */\nvar DEFAULT_CONFIG = {\n    'api_host':                          'https://api-js.mixpanel.com',\n    'api_method':                        'POST',\n    'app_host':                          'https://mixpanel.com',\n    'autotrack':                         true,\n    'cdn':                               'https://cdn.mxpnl.com',\n    'cross_subdomain_cookie':            true,\n    'persistence':                       'cookie',\n    'persistence_name':                  '',\n    'cookie_name':                       '',\n    'loaded':                            function() {},\n    'store_google':                      true,\n    'save_referrer':                     true,\n    'test':                              false,\n    'verbose':                           false,\n    'img':                               false,\n    'track_pageview':                    true,\n    'debug':                             false,\n    'track_links_timeout':               300,\n    'cookie_expiration':                 365,\n    'upgrade':                           false,\n    'disable_persistence':               false,\n    'disable_cookie':                    false,\n    'secure_cookie':                     false,\n    'ip':                                true,\n    'opt_out_tracking_by_default':       false,\n    'opt_out_persistence_by_default':    false,\n    'opt_out_tracking_persistence_type': 'localStorage',\n    'opt_out_tracking_cookie_prefix':    null,\n    'property_blacklist':                [],\n    'xhr_headers':                       {}, // { header: value, header2: value }\n    'inapp_protocol':                    '//',\n    'inapp_link_new_window':             false\n};\n\nvar DOM_LOADED = false;\n\n/**\n * Mixpanel Library Object\n * @constructor\n */\nvar MixpanelLib = function() {};\n\n\n/**\n * create_mplib(token:string, config:object, name:string)\n *\n * This function is used by the init method of MixpanelLib objects\n * as well as the main initializer at the end of the JSLib (that\n * initializes document.mixpanel as well as any additional instances\n * declared before this file has loaded).\n */\nvar create_mplib = function(token, config, name) {\n    var instance,\n        target = (name === PRIMARY_INSTANCE_NAME) ? mixpanel_master : mixpanel_master[name];\n\n    if (target && init_type === INIT_MODULE) {\n        instance = target;\n    } else {\n        if (target && !_.isArray(target)) {\n            console$1.error('You have already initialized ' + name);\n            return;\n        }\n        instance = new MixpanelLib();\n    }\n\n    instance._cached_groups = {}; // cache groups in a pool\n    instance._user_decide_check_complete = false;\n    instance._events_tracked_before_user_decide_check_complete = [];\n\n    instance._init(token, config, name);\n\n    instance['people'] = new MixpanelPeople();\n    instance['people']._init(instance);\n\n    // if any instance on the page has debug = true, we set the\n    // global debug to be true\n    Config.DEBUG = Config.DEBUG || instance.get_config('debug');\n\n    instance['__autotrack_enabled'] = instance.get_config('autotrack');\n    if (instance.get_config('autotrack')) {\n        var num_buckets = 100;\n        var num_enabled_buckets = 100;\n        if (!autotrack.enabledForProject(instance.get_config('token'), num_buckets, num_enabled_buckets)) {\n            instance['__autotrack_enabled'] = false;\n            console$1.log('Not in active bucket: disabling Automatic Event Collection.');\n        } else if (!autotrack.isBrowserSupported()) {\n            instance['__autotrack_enabled'] = false;\n            console$1.log('Disabling Automatic Event Collection because this browser is not supported');\n        } else {\n            autotrack.init(instance);\n        }\n    }\n\n    // if target is not defined, we called init after the lib already\n    // loaded, so there won't be an array of things to execute\n    if (!_.isUndefined(target) && _.isArray(target)) {\n        // Crunch through the people queue first - we queue this data up &\n        // flush on identify, so it's better to do all these operations first\n        instance._execute_array.call(instance['people'], target['people']);\n        instance._execute_array(target);\n    }\n\n    return instance;\n};\n\n// Initialization methods\n\n/**\n * This function initializes a new instance of the Mixpanel tracking object.\n * All new instances are added to the main mixpanel object as sub properties (such as\n * mixpanel.library_name) and also returned by this function. To define a\n * second instance on the page, you would call:\n *\n *     mixpanel.init('new token', { your: 'config' }, 'library_name');\n *\n * and use it like so:\n *\n *     mixpanel.library_name.track(...);\n *\n * @param {String} token   Your Mixpanel API token\n * @param {Object} [config]  A dictionary of config options to override. <a href=\"https://github.com/mixpanel/mixpanel-js/blob/8b2e1f7b/src/mixpanel-core.js#L87-L110\">See a list of default config options</a>.\n * @param {String} [name]    The name for the new mixpanel instance that you want created\n */\nMixpanelLib.prototype.init = function (token, config, name) {\n    if (_.isUndefined(name)) {\n        console$1.error('You must name your new library: init(token, config, name)');\n        return;\n    }\n    if (name === PRIMARY_INSTANCE_NAME) {\n        console$1.error('You must initialize the main mixpanel object right after you include the Mixpanel js snippet');\n        return;\n    }\n\n    var instance = create_mplib(token, config, name);\n    mixpanel_master[name] = instance;\n    instance._loaded();\n\n    return instance;\n};\n\n// mixpanel._init(token:string, config:object, name:string)\n//\n// This function sets up the current instance of the mixpanel\n// library.  The difference between this method and the init(...)\n// method is this one initializes the actual instance, whereas the\n// init(...) method sets up a new library and calls _init on it.\n//\nMixpanelLib.prototype._init = function(token, config, name) {\n    this['__loaded'] = true;\n    this['config'] = {};\n    this['_triggered_notifs'] = [];\n\n    this.set_config(_.extend({}, DEFAULT_CONFIG, config, {\n        'name': name,\n        'token': token,\n        'callback_fn': ((name === PRIMARY_INSTANCE_NAME) ? name : PRIMARY_INSTANCE_NAME + '.' + name) + '._jsc'\n    }));\n\n    this['_jsc'] = function() {};\n\n    this.__dom_loaded_queue = [];\n    this.__request_queue = [];\n    this.__disabled_events = [];\n    this._flags = {\n        'disable_all_events': false,\n        'identify_called': false\n    };\n\n    this['persistence'] = this['cookie'] = new MixpanelPersistence(this['config']);\n    this._gdpr_init();\n\n    var uuid = _.UUID();\n    if (!this.get_distinct_id()) {\n        // There is no need to set the distinct id\n        // or the device id if something was already stored\n        // in the persitence\n        this.register_once({\n            'distinct_id': uuid,\n            '$device_id': uuid\n        }, '');\n    }\n};\n\n// Private methods\n\nMixpanelLib.prototype._loaded = function() {\n    this.get_config('loaded')(this);\n\n    // this happens after so a user can call identify/name_tag in\n    // the loaded callback\n    if (this.get_config('track_pageview')) {\n        this.track_pageview();\n    }\n};\n\nMixpanelLib.prototype._dom_loaded = function() {\n    _.each(this.__dom_loaded_queue, function(item) {\n        this._track_dom.apply(this, item);\n    }, this);\n\n    if (!this.has_opted_out_tracking()) {\n        _.each(this.__request_queue, function(item) {\n            this._send_request.apply(this, item);\n        }, this);\n    }\n\n    delete this.__dom_loaded_queue;\n    delete this.__request_queue;\n};\n\nMixpanelLib.prototype._track_dom = function(DomClass, args) {\n    if (this.get_config('img')) {\n        console$1.error('You can\\'t use DOM tracking functions with img = true.');\n        return false;\n    }\n\n    if (!DOM_LOADED) {\n        this.__dom_loaded_queue.push([DomClass, args]);\n        return false;\n    }\n\n    var dt = new DomClass().init(this);\n    return dt.track.apply(dt, args);\n};\n\n/**\n * _prepare_callback() should be called by callers of _send_request for use\n * as the callback argument.\n *\n * If there is no callback, this returns null.\n * If we are going to make XHR/XDR requests, this returns a function.\n * If we are going to use script tags, this returns a string to use as the\n * callback GET param.\n */\nMixpanelLib.prototype._prepare_callback = function(callback, data) {\n    if (_.isUndefined(callback)) {\n        return null;\n    }\n\n    if (USE_XHR) {\n        var callback_function = function(response) {\n            callback(response, data);\n        };\n        return callback_function;\n    } else {\n        // if the user gives us a callback, we store as a random\n        // property on this instances jsc function and update our\n        // callback string to reflect that.\n        var jsc = this['_jsc'];\n        var randomized_cb = '' + Math.floor(Math.random() * 100000000);\n        var callback_string = this.get_config('callback_fn') + '[' + randomized_cb + ']';\n        jsc[randomized_cb] = function(response) {\n            delete jsc[randomized_cb];\n            callback(response, data);\n        };\n        return callback_string;\n    }\n};\n\nMixpanelLib.prototype._send_request = function(url, data, options, callback) {\n    if (ENQUEUE_REQUESTS) {\n        this.__request_queue.push(arguments);\n        return;\n    }\n\n    var DEFAULT_OPTIONS = {method: this.get_config('api_method')};\n    var body_data = null;\n\n    if (!callback && (_.isFunction(options) || typeof options === 'string')) {\n        callback = options;\n        options = null;\n    }\n    options = _.extend(DEFAULT_OPTIONS, options || {});\n    if (!USE_XHR) {\n        options.method = 'GET';\n    }\n    var use_post = options.method === 'POST';\n\n    // needed to correctly format responses\n    var verbose_mode = this.get_config('verbose');\n    if (data['verbose']) { verbose_mode = true; }\n\n    if (this.get_config('test')) { data['test'] = 1; }\n    if (verbose_mode) { data['verbose'] = 1; }\n    if (this.get_config('img')) { data['img'] = 1; }\n    if (!USE_XHR) {\n        if (callback) {\n            data['callback'] = callback;\n        } else if (verbose_mode || this.get_config('test')) {\n            // Verbose output (from verbose mode, or an error in test mode) is a json blob,\n            // which by itself is not valid javascript. Without a callback, this verbose output will\n            // cause an error when returned via jsonp, so we force a no-op callback param.\n            // See the ECMA script spec: http://www.ecma-international.org/ecma-262/5.1/#sec-12.4\n            data['callback'] = '(function(){})';\n        }\n    }\n\n    data['ip'] = this.get_config('ip')?1:0;\n    data['_'] = new Date().getTime().toString();\n\n    if (use_post) {\n        body_data = 'data=' + data['data'];\n        delete data['data'];\n    }\n\n    url += '?' + _.HTTPBuildQuery(data);\n\n    if ('img' in data) {\n        var img = document$1.createElement('img');\n        img.src = url;\n        document$1.body.appendChild(img);\n    } else if (USE_XHR) {\n        try {\n            var req = new XMLHttpRequest();\n            req.open(options.method, url, true);\n\n            var headers = this.get_config('xhr_headers');\n            if (use_post) {\n                headers['Content-Type'] = 'application/x-www-form-urlencoded';\n            }\n            _.each(headers, function(headerValue, headerName) {\n                req.setRequestHeader(headerName, headerValue);\n            });\n\n            // send the mp_optout cookie\n            // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n            req.withCredentials = true;\n            req.onreadystatechange = function () {\n                if (req.readyState === 4) { // XMLHttpRequest.DONE == 4, except in safari 4\n                    if (req.status === 200) {\n                        if (callback) {\n                            if (verbose_mode) {\n                                var response;\n                                try {\n                                    response = _.JSONDecode(req.responseText);\n                                } catch (e) {\n                                    console$1.error(e);\n                                    return;\n                                }\n                                callback(response);\n                            } else {\n                                callback(Number(req.responseText));\n                            }\n                        }\n                    } else {\n                        var error = 'Bad HTTP status: ' + req.status + ' ' + req.statusText;\n                        console$1.error(error);\n                        if (callback) {\n                            if (verbose_mode) {\n                                callback({status: 0, error: error});\n                            } else {\n                                callback(0);\n                            }\n                        }\n                    }\n                }\n            };\n            req.send(body_data);\n        } catch (e) {\n            console$1.error(e);\n        }\n    } else {\n        var script = document$1.createElement('script');\n        script.type = 'text/javascript';\n        script.async = true;\n        script.defer = true;\n        script.src = url;\n        var s = document$1.getElementsByTagName('script')[0];\n        s.parentNode.insertBefore(script, s);\n    }\n};\n\n/**\n * _execute_array() deals with processing any mixpanel function\n * calls that were called before the Mixpanel library were loaded\n * (and are thus stored in an array so they can be called later)\n *\n * Note: we fire off all the mixpanel function calls && user defined\n * functions BEFORE we fire off mixpanel tracking calls. This is so\n * identify/register/set_config calls can properly modify early\n * tracking calls.\n *\n * @param {Array} array\n */\nMixpanelLib.prototype._execute_array = function(array) {\n    var fn_name, alias_calls = [], other_calls = [], tracking_calls = [];\n    _.each(array, function(item) {\n        if (item) {\n            fn_name = item[0];\n            if (_.isArray(fn_name)) {\n                tracking_calls.push(item); // chained call e.g. mixpanel.get_group().set()\n            } else if (typeof(item) === 'function') {\n                item.call(this);\n            } else if (_.isArray(item) && fn_name === 'alias') {\n                alias_calls.push(item);\n            } else if (_.isArray(item) && fn_name.indexOf('track') !== -1 && typeof(this[fn_name]) === 'function') {\n                tracking_calls.push(item);\n            } else {\n                other_calls.push(item);\n            }\n        }\n    }, this);\n\n    var execute = function(calls, context) {\n        _.each(calls, function(item) {\n            if (_.isArray(item[0])) {\n                // chained call\n                var caller = context;\n                _.each(item, function(call) {\n                    caller = caller[call[0]].apply(caller, call.slice(1));\n                });\n            } else {\n                this[item[0]].apply(this, item.slice(1));\n            }\n        }, context);\n    };\n\n    execute(alias_calls, this);\n    execute(other_calls, this);\n    execute(tracking_calls, this);\n};\n\n/**\n * push() keeps the standard async-array-push\n * behavior around after the lib is loaded.\n * This is only useful for external integrations that\n * do not wish to rely on our convenience methods\n * (created in the snippet).\n *\n * ### Usage:\n *     mixpanel.push(['register', { a: 'b' }]);\n *\n * @param {Array} item A [function_name, args...] array to be executed\n */\nMixpanelLib.prototype.push = function(item) {\n    this._execute_array([item]);\n};\n\n/**\n * Disable events on the Mixpanel object. If passed no arguments,\n * this function disables tracking of any event. If passed an\n * array of event names, those events will be disabled, but other\n * events will continue to be tracked.\n *\n * Note: this function does not stop other mixpanel functions from\n * firing, such as register() or people.set().\n *\n * @param {Array} [events] An array of event names to disable\n */\nMixpanelLib.prototype.disable = function(events) {\n    if (typeof(events) === 'undefined') {\n        this._flags.disable_all_events = true;\n    } else {\n        this.__disabled_events = this.__disabled_events.concat(events);\n    }\n};\n\n/**\n * Track an event. This is the most important and\n * frequently used Mixpanel function.\n *\n * ### Usage:\n *\n *     // track an event named 'Registered'\n *     mixpanel.track('Registered', {'Gender': 'Male', 'Age': 21});\n *\n * To track link clicks or form submissions, see track_links() or track_forms().\n *\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after tracking the event.\n */\nMixpanelLib.prototype.track = addOptOutCheckMixpanelLib(function(event_name, properties, callback) {\n    if (typeof(callback) !== 'function') {\n        callback = function() {};\n    }\n\n    if (_.isUndefined(event_name)) {\n        console$1.error('No event name provided to mixpanel.track');\n        return;\n    }\n\n    if (this._event_is_disabled(event_name)) {\n        callback(0);\n        return;\n    }\n\n    // set defaults\n    properties = properties || {};\n    properties['token'] = this.get_config('token');\n\n    // set $duration if time_event was previously called for this event\n    var start_timestamp = this['persistence'].remove_event_timer(event_name);\n    if (!_.isUndefined(start_timestamp)) {\n        var duration_in_ms = new Date().getTime() - start_timestamp;\n        properties['$duration'] = parseFloat((duration_in_ms / 1000).toFixed(3));\n    }\n\n    // update persistence\n    this['persistence'].update_search_keyword(document$1.referrer);\n\n    if (this.get_config('store_google')) { this['persistence'].update_campaign_params(); }\n    if (this.get_config('save_referrer')) { this['persistence'].update_referrer_info(document$1.referrer); }\n\n    // note: extend writes to the first object, so lets make sure we\n    // don't write to the persistence properties object and info\n    // properties object by passing in a new object\n\n    // update properties with pageview info and super-properties\n    properties = _.extend(\n        {},\n        _.info.properties(),\n        this['persistence'].properties(),\n        properties\n    );\n\n    var property_blacklist = this.get_config('property_blacklist');\n    if (_.isArray(property_blacklist)) {\n        _.each(property_blacklist, function(blacklisted_prop) {\n            delete properties[blacklisted_prop];\n        });\n    } else {\n        console$1.error('Invalid value for property_blacklist config: ' + property_blacklist);\n    }\n\n    var data = {\n        'event': event_name,\n        'properties': properties\n    };\n    var truncated_data = _.truncate(data, 255);\n    var json_data      = _.JSONEncode(truncated_data);\n    var encoded_data   = _.base64Encode(json_data);\n\n    console$1.log('MIXPANEL REQUEST:');\n    console$1.log(truncated_data);\n\n    this._send_request(\n        this.get_config('api_host') + '/track/',\n        { 'data': encoded_data },\n        this._prepare_callback(callback, truncated_data)\n    );\n\n    this._check_and_handle_triggered_notifications(data);\n\n    return truncated_data;\n});\n\n/**\n * Register the current user into one/many groups.\n *\n * ### Usage:\n *\n *      mixpanel.set_group('company', ['mixpanel', 'google']) // an array of IDs\n *      mixpanel.set_group('company', 'mixpanel')\n *      mixpanel.set_group('company', 128746312)\n *\n * @param {String} group_key Group key\n * @param {Array|String|Number} group_ids An array of group IDs, or a singular group ID\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n *\n */\nMixpanelLib.prototype.set_group = addOptOutCheckMixpanelLib(function(group_key, group_ids, callback) {\n    if (!_.isArray(group_ids)) {\n        group_ids = [group_ids];\n    }\n    var prop = {};\n    prop[group_key] = group_ids;\n    this.register(prop);\n    return this['people'].set(group_key, group_ids, callback);\n});\n\n/**\n * Add a new group for this user.\n *\n * ### Usage:\n *\n *      mixpanel.add_group('company', 'mixpanel')\n *\n * @param {String} group_key Group key\n * @param {*} group_id A valid Mixpanel property type\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\nMixpanelLib.prototype.add_group = addOptOutCheckMixpanelLib(function(group_key, group_id, callback) {\n    var old_values = this.get_property(group_key);\n    if (old_values === undefined) {\n        var prop = {};\n        prop[group_key] = [group_id];\n        this.register(prop);\n    } else {\n        if (old_values.indexOf(group_id) === -1) {\n            old_values.push(group_id);\n            this.register(prop);\n        }\n    }\n    return this['people'].union(group_key, group_id, callback);\n});\n\n/**\n * Remove a group from this user.\n *\n * ### Usage:\n *\n *      mixpanel.remove_group('company', 'mixpanel')\n *\n * @param {String} group_key Group key\n * @param {*} group_id A valid Mixpanel property type\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\nMixpanelLib.prototype.remove_group = addOptOutCheckMixpanelLib(function(group_key, group_id, callback) {\n    var old_value = this.get_property(group_key);\n    // if the value doesn't exist, the persistent store is unchanged\n    if (old_value !== undefined) {\n        var idx = old_value.indexOf(group_id);\n        if (idx > -1) {\n            old_value.splice(idx, 1);\n            this.register({group_key: old_value});\n        }\n        if (old_value.length === 0) {\n            this.unregister(group_key);\n        }\n    }\n    return this['people'].remove(group_key, group_id, callback);\n});\n\n/**\n * Track an event with specific groups.\n *\n * ### Usage:\n *\n *      mixpanel.track_with_groups('purchase', {'product': 'iphone'}, {'University': ['UCB', 'UCLA']})\n *\n * @param {String} event_name The name of the event (see `mixpanel.track()`)\n * @param {Object=} properties A set of properties to include with the event you're sending (see `mixpanel.track()`)\n * @param {Object=} groups An object mapping group name keys to one or more values\n * @param {Function} [callback] If provided, the callback will be called after tracking the event.\n */\nMixpanelLib.prototype.track_with_groups = addOptOutCheckMixpanelLib(function(event_name, properties, groups, callback) {\n    var tracking_props = _.extend({}, properties || {});\n    _.each(groups, function(v, k) {\n        if (v !== null && v !== undefined) {\n            tracking_props[k] = v;\n        }\n    });\n    return this.track(event_name, tracking_props, callback);\n});\n\nMixpanelLib.prototype._create_map_key = function (group_key, group_id) {\n    return group_key + '_' + JSON.stringify(group_id);\n};\n\nMixpanelLib.prototype._remove_group_from_cache = function (group_key, group_id) {\n    delete this._cached_groups[this._create_map_key(group_key, group_id)];\n};\n\n/**\n * Look up reference to a Mixpanel group\n *\n * ### Usage:\n *\n *       mixpanel.get_group(group_key, group_id)\n *\n * @param {String} group_key Group key\n * @param {Object} group_id A valid Mixpanel property type\n * @returns {Object} A MixpanelGroup identifier\n */\nMixpanelLib.prototype.get_group = function (group_key, group_id) {\n    var map_key = this._create_map_key(group_key, group_id);\n    var group = this._cached_groups[map_key];\n    if (group === undefined || group._group_key !== group_key || group._group_id !== group_id) {\n        group = new MixpanelGroup();\n        group._init(this, group_key, group_id);\n        this._cached_groups[map_key] = group;\n    }\n    return group;\n};\n\n/**\n * Track a page view event, which is currently ignored by the server.\n * This function is called by default on page load unless the\n * track_pageview configuration variable is false.\n *\n * @param {String} [page] The url of the page to record. If you don't include this, it defaults to the current url.\n * @api private\n */\nMixpanelLib.prototype.track_pageview = function(page) {\n    if (_.isUndefined(page)) {\n        page = document$1.location.href;\n    }\n    this.track('mp_page_view', _.info.pageviewInfo(page));\n};\n\n/**\n * Track clicks on a set of document elements. Selector must be a\n * valid query. Elements must exist on the page at the time track_links is called.\n *\n * ### Usage:\n *\n *     // track click for link id #nav\n *     mixpanel.track_links('#nav', 'Clicked Nav Link');\n *\n * ### Notes:\n *\n * This function will wait up to 300 ms for the Mixpanel\n * servers to respond. If they have not responded by that time\n * it will head to the link without ensuring that your event\n * has been tracked.  To configure this timeout please see the\n * set_config() documentation below.\n *\n * If you pass a function in as the properties argument, the\n * function will receive the DOMElement that triggered the\n * event as an argument.  You are expected to return an object\n * from the function; any properties defined on this object\n * will be sent to mixpanel as event properties.\n *\n * @type {Function}\n * @param {Object|String} query A valid DOM query, element or jQuery-esque list\n * @param {String} event_name The name of the event to track\n * @param {Object|Function} [properties] A properties object or function that returns a dictionary of properties when passed a DOMElement\n */\nMixpanelLib.prototype.track_links = function() {\n    return this._track_dom.call(this, LinkTracker, arguments);\n};\n\n/**\n * Track form submissions. Selector must be a valid query.\n *\n * ### Usage:\n *\n *     // track submission for form id 'register'\n *     mixpanel.track_forms('#register', 'Created Account');\n *\n * ### Notes:\n *\n * This function will wait up to 300 ms for the mixpanel\n * servers to respond, if they have not responded by that time\n * it will head to the link without ensuring that your event\n * has been tracked.  To configure this timeout please see the\n * set_config() documentation below.\n *\n * If you pass a function in as the properties argument, the\n * function will receive the DOMElement that triggered the\n * event as an argument.  You are expected to return an object\n * from the function; any properties defined on this object\n * will be sent to mixpanel as event properties.\n *\n * @type {Function}\n * @param {Object|String} query A valid DOM query, element or jQuery-esque list\n * @param {String} event_name The name of the event to track\n * @param {Object|Function} [properties] This can be a set of properties, or a function that returns a set of properties after being passed a DOMElement\n */\nMixpanelLib.prototype.track_forms = function() {\n    return this._track_dom.call(this, FormTracker, arguments);\n};\n\n/**\n * Time an event by including the time between this call and a\n * later 'track' call for the same event in the properties sent\n * with the event.\n *\n * ### Usage:\n *\n *     // time an event named 'Registered'\n *     mixpanel.time_event('Registered');\n *     mixpanel.track('Registered', {'Gender': 'Male', 'Age': 21});\n *\n * When called for a particular event name, the next track call for that event\n * name will include the elapsed time between the 'time_event' and 'track'\n * calls. This value is stored as seconds in the '$duration' property.\n *\n * @param {String} event_name The name of the event.\n */\nMixpanelLib.prototype.time_event = function(event_name) {\n    if (_.isUndefined(event_name)) {\n        console$1.error('No event name provided to mixpanel.time_event');\n        return;\n    }\n\n    if (this._event_is_disabled(event_name)) {\n        return;\n    }\n\n    this['persistence'].set_event_timer(event_name,  new Date().getTime());\n};\n\n/**\n * Register a set of super properties, which are included with all\n * events. This will overwrite previous super property values.\n *\n * ### Usage:\n *\n *     // register 'Gender' as a super property\n *     mixpanel.register({'Gender': 'Female'});\n *\n *     // register several super properties when a user signs up\n *     mixpanel.register({\n *         'Email': 'jdoe@example.com',\n *         'Account Type': 'Free'\n *     });\n *\n * @param {Object} properties An associative array of properties to store about the user\n * @param {Number} [days] How many days since the user's last visit to store the super properties\n */\nMixpanelLib.prototype.register = function(props, days) {\n    this['persistence'].register(props, days);\n};\n\n/**\n * Register a set of super properties only once. This will not\n * overwrite previous super property values, unlike register().\n *\n * ### Usage:\n *\n *     // register a super property for the first time only\n *     mixpanel.register_once({\n *         'First Login Date': new Date().toISOString()\n *     });\n *\n * ### Notes:\n *\n * If default_value is specified, current super properties\n * with that value will be overwritten.\n *\n * @param {Object} properties An associative array of properties to store about the user\n * @param {*} [default_value] Value to override if already set in super properties (ex: 'False') Default: 'None'\n * @param {Number} [days] How many days since the users last visit to store the super properties\n */\nMixpanelLib.prototype.register_once = function(props, default_value, days) {\n    this['persistence'].register_once(props, default_value, days);\n};\n\n/**\n * Delete a super property stored with the current user.\n *\n * @param {String} property The name of the super property to remove\n */\nMixpanelLib.prototype.unregister = function(property) {\n    this['persistence'].unregister(property);\n};\n\nMixpanelLib.prototype._register_single = function(prop, value) {\n    var props = {};\n    props[prop] = value;\n    this.register(props);\n};\n\n/**\n * Identify a user with a unique ID instead of a Mixpanel\n * randomly generated distinct_id. If the method is never called,\n * then unique visitors will be identified by a UUID generated\n * the first time they visit the site.\n *\n * ### Notes:\n *\n * You can call this function to overwrite a previously set\n * unique ID for the current user. Mixpanel cannot translate\n * between IDs at this time, so when you change a user's ID\n * they will appear to be a new user.\n *\n * When used alone, mixpanel.identify will change the user's\n * distinct_id to the unique ID provided. When used in tandem\n * with mixpanel.alias, it will allow you to identify based on\n * unique ID and map that back to the original, anonymous\n * distinct_id given to the user upon her first arrival to your\n * site (thus connecting anonymous pre-signup activity to\n * post-signup activity). Though the two work together, do not\n * call identify() at the same time as alias(). Calling the two\n * at the same time can cause a race condition, so it is best\n * practice to call identify on the original, anonymous ID\n * right after you've aliased it.\n * <a href=\"https://mixpanel.com/help/questions/articles/how-should-i-handle-my-user-identity-with-the-mixpanel-javascript-library\">Learn more about how mixpanel.identify and mixpanel.alias can be used</a>.\n *\n * @param {String} [unique_id] A string that uniquely identifies a user. If not provided, the distinct_id currently in the persistent store (cookie or localStorage) will be used.\n */\nMixpanelLib.prototype.identify = function(\n    new_distinct_id, _set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback\n) {\n    // Optional Parameters\n    //  _set_callback:function  A callback to be run if and when the People set queue is flushed\n    //  _add_callback:function  A callback to be run if and when the People add queue is flushed\n    //  _append_callback:function  A callback to be run if and when the People append queue is flushed\n    //  _set_once_callback:function  A callback to be run if and when the People set_once queue is flushed\n    //  _union_callback:function  A callback to be run if and when the People union queue is flushed\n    //  _unset_callback:function  A callback to be run if and when the People unset queue is flushed\n\n    var previous_distinct_id = this.get_distinct_id();\n    this.register({'$user_id': new_distinct_id});\n\n    if (!this.get_property('$device_id')) {\n        // The persisted distinct id might not actually be a device id at all\n        // it might be a distinct id of the user from before\n        var device_id = previous_distinct_id;\n        this.register_once({\n            '$had_persisted_distinct_id': true,\n            '$device_id': device_id\n        }, '');\n    }\n\n    // identify only changes the distinct id if it doesn't match either the existing or the alias;\n    // if it's new, blow away the alias as well.\n    if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {\n        this.unregister(ALIAS_ID_KEY);\n        this.register({'distinct_id': new_distinct_id});\n    }\n    this._check_and_handle_notifications(this.get_distinct_id());\n    this._flags.identify_called = true;\n    // Flush any queued up people requests\n    this['people']._flush(_set_callback, _add_callback, _append_callback, _set_once_callback, _union_callback, _unset_callback, _remove_callback);\n\n    // send an $identify event any time the distinct_id is changing - logic on the server\n    // will determine whether or not to do anything with it.\n    if (new_distinct_id !== previous_distinct_id) {\n        this.track('$identify', { 'distinct_id': new_distinct_id, '$anon_distinct_id': previous_distinct_id });\n    }\n};\n\n/**\n * Clears super properties and generates a new random distinct_id for this instance.\n * Useful for clearing data when a user logs out.\n */\nMixpanelLib.prototype.reset = function() {\n    this['persistence'].clear();\n    this._flags.identify_called = false;\n    var uuid = _.UUID();\n    this.register_once({\n        'distinct_id': uuid,\n        '$device_id': uuid\n    }, '');\n};\n\n/**\n * Returns the current distinct id of the user. This is either the id automatically\n * generated by the library or the id that has been passed by a call to identify().\n *\n * ### Notes:\n *\n * get_distinct_id() can only be called after the Mixpanel library has finished loading.\n * init() has a loaded function available to handle this automatically. For example:\n *\n *     // set distinct_id after the mixpanel library has loaded\n *     mixpanel.init('YOUR PROJECT TOKEN', {\n *         loaded: function(mixpanel) {\n *             distinct_id = mixpanel.get_distinct_id();\n *         }\n *     });\n */\nMixpanelLib.prototype.get_distinct_id = function() {\n    return this.get_property('distinct_id');\n};\n\n/**\n * Create an alias, which Mixpanel will use to link two distinct_ids going forward (not retroactively).\n * Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n * following is a valid scenario:\n *\n *     mixpanel.alias('new_id', 'existing_id');\n *     ...\n *     mixpanel.alias('newer_id', 'new_id');\n *\n * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n *\n * ### Notes:\n *\n * The best practice is to call alias() when a unique ID is first created for a user\n * (e.g., when a user first registers for an account and provides an email address).\n * alias() should never be called more than once for a given user, except to\n * chain a newer ID to a previously new ID, as described above.\n *\n * @param {String} alias A unique identifier that you want to use for this user in the future.\n * @param {String} [original] The current identifier being used for this user.\n */\nMixpanelLib.prototype.alias = function(alias, original) {\n    // If the $people_distinct_id key exists in persistence, there has been a previous\n    // mixpanel.people.identify() call made for this user. It is VERY BAD to make an alias with\n    // this ID, as it will duplicate users.\n    if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n        console$1.critical('Attempting to create alias for existing People user - aborting.');\n        return -2;\n    }\n\n    var _this = this;\n    if (_.isUndefined(original)) {\n        original = this.get_distinct_id();\n    }\n    if (alias !== original) {\n        this._register_single(ALIAS_ID_KEY, alias);\n        return this.track('$create_alias', { 'alias': alias, 'distinct_id': original }, function() {\n            // Flush the people queue\n            _this.identify(alias);\n        });\n    } else {\n        console$1.error('alias matches current distinct_id - skipping api call.');\n        this.identify(alias);\n        return -1;\n    }\n};\n\n/**\n * Provide a string to recognize the user by. The string passed to\n * this method will appear in the Mixpanel Streams product rather\n * than an automatically generated name. Name tags do not have to\n * be unique.\n *\n * This value will only be included in Streams data.\n *\n * @param {String} name_tag A human readable name for the user\n * @api private\n */\nMixpanelLib.prototype.name_tag = function(name_tag) {\n    this._register_single('mp_name_tag', name_tag);\n};\n\n/**\n * Update the configuration of a mixpanel library instance.\n *\n * The default config is:\n *\n *     {\n *       // super properties cookie expiration (in days)\n *       cookie_expiration: 365\n *\n *       // super properties span subdomains\n *       cross_subdomain_cookie: true\n *\n *       // debug mode\n *       debug: false\n *\n *       // if this is true, the mixpanel cookie or localStorage entry\n *       // will be deleted, and no user persistence will take place\n *       disable_persistence: false\n *\n *       // if this is true, Mixpanel will automatically determine\n *       // City, Region and Country data using the IP address of\n *       //the client\n *       ip: true\n *\n *       // opt users out of tracking by this Mixpanel instance by default\n *       opt_out_tracking_by_default: false\n *\n *       // opt users out of browser data storage by this Mixpanel instance by default\n *       opt_out_persistence_by_default: false\n *\n *       // persistence mechanism used by opt-in/opt-out methods - cookie\n *       // or localStorage - falls back to cookie if localStorage is unavailable\n *       opt_out_tracking_persistence_type: 'localStorage'\n *\n *       // customize the name of cookie/localStorage set by opt-in/opt-out methods\n *       opt_out_tracking_cookie_prefix: null\n *\n *       // type of persistent store for super properties (cookie/\n *       // localStorage) if set to 'localStorage', any existing\n *       // mixpanel cookie value with the same persistence_name\n *       // will be transferred to localStorage and deleted\n *       persistence: 'cookie'\n *\n *       // name for super properties persistent store\n *       persistence_name: ''\n *\n *       // names of properties/superproperties which should never\n *       // be sent with track() calls\n *       property_blacklist: []\n *\n *       // if this is true, mixpanel cookies will be marked as\n *       // secure, meaning they will only be transmitted over https\n *       secure_cookie: false\n *\n *       // the amount of time track_links will\n *       // wait for Mixpanel's servers to respond\n *       track_links_timeout: 300\n *\n *       // should we track a page view on page load\n *       track_pageview: true\n *\n *       // if you set upgrade to be true, the library will check for\n *       // a cookie from our old js library and import super\n *       // properties from it, then the old cookie is deleted\n *       // The upgrade config option only works in the initialization,\n *       // so make sure you set it when you create the library.\n *       upgrade: false\n *\n *       // extra HTTP request headers to set for each API request, in\n *       // the format {'Header-Name': value}\n *       xhr_headers: {}\n *\n *       // protocol for fetching in-app message resources, e.g.\n *       // 'https://' or 'http://'; defaults to '//' (which defers to the\n *       // current page's protocol)\n *       inapp_protocol: '//'\n *\n *       // whether to open in-app message link in new tab/window\n *       inapp_link_new_window: false\n *     }\n *\n *\n * @param {Object} config A dictionary of new configuration values to update\n */\nMixpanelLib.prototype.set_config = function(config) {\n    if (_.isObject(config)) {\n        _.extend(this['config'], config);\n\n        if (!this.get_config('persistence_name')) {\n            this['config']['persistence_name'] = this['config']['cookie_name'];\n        }\n        if (!this.get_config('disable_persistence')) {\n            this['config']['disable_persistence'] = this['config']['disable_cookie'];\n        }\n\n        if (this['persistence']) {\n            this['persistence'].update_config(this['config']);\n        }\n        Config.DEBUG = Config.DEBUG || this.get_config('debug');\n    }\n};\n\n/**\n * returns the current config object for the library.\n */\nMixpanelLib.prototype.get_config = function(prop_name) {\n    return this['config'][prop_name];\n};\n\n/**\n * Returns the value of the super property named property_name. If no such\n * property is set, get_property() will return the undefined value.\n *\n * ### Notes:\n *\n * get_property() can only be called after the Mixpanel library has finished loading.\n * init() has a loaded function available to handle this automatically. For example:\n *\n *     // grab value for 'user_id' after the mixpanel library has loaded\n *     mixpanel.init('YOUR PROJECT TOKEN', {\n *         loaded: function(mixpanel) {\n *             user_id = mixpanel.get_property('user_id');\n *         }\n *     });\n *\n * @param {String} property_name The name of the super property you want to retrieve\n */\nMixpanelLib.prototype.get_property = function(property_name) {\n    return this['persistence']['props'][property_name];\n};\n\nMixpanelLib.prototype.toString = function() {\n    var name = this.get_config('name');\n    if (name !== PRIMARY_INSTANCE_NAME) {\n        name = PRIMARY_INSTANCE_NAME + '.' + name;\n    }\n    return name;\n};\n\nMixpanelLib.prototype._event_is_disabled = function(event_name) {\n    return _.isBlockedUA(userAgent) ||\n        this._flags.disable_all_events ||\n        _.include(this.__disabled_events, event_name);\n};\n\nMixpanelLib.prototype._check_and_handle_triggered_notifications = addOptOutCheckMixpanelLib(function(event_data) {\n    if (!this._user_decide_check_complete) {\n        this._events_tracked_before_user_decide_check_complete.push(event_data);\n    } else {\n        var arr = this['_triggered_notifs'];\n        for (var i = 0; i < arr.length; i++) {\n            var notif = new MixpanelNotification(arr[i], this);\n            if (notif._matches_event_data(event_data)) {\n                this._show_notification(arr[i]);\n                return;\n            }\n        }\n    }\n});\n\nMixpanelLib.prototype._check_and_handle_notifications = addOptOutCheckMixpanelLib(function(distinct_id) {\n    if (\n        !distinct_id ||\n        this._flags.identify_called ||\n        this.get_config('disable_notifications')\n    ) {\n        return;\n    }\n\n    console$1.log('MIXPANEL NOTIFICATION CHECK');\n\n    var data = {\n        'verbose':     true,\n        'version':     '3',\n        'lib':         'web',\n        'token':       this.get_config('token'),\n        'distinct_id': distinct_id\n    };\n    this._send_request(\n        this.get_config('api_host') + '/decide/',\n        data,\n        {method: 'GET'},\n        this._prepare_callback(_.bind(function(result) {\n            if (result['notifications'] && result['notifications'].length > 0) {\n                this['_triggered_notifs'] = [];\n                var notifications = [];\n                _.each(result['notifications'], function(notif) {\n                    (notif['display_triggers'] && notif['display_triggers'].length > 0 ? this['_triggered_notifs'] : notifications).push(notif);\n                }, this);\n                if (notifications.length > 0) {\n                    this._show_notification.call(this, notifications[0]);\n                }\n            }\n            this._handle_user_decide_check_complete();\n        }, this))\n    );\n});\n\nMixpanelLib.prototype._handle_user_decide_check_complete = function() {\n    this._user_decide_check_complete = true;\n\n    // check notifications against events that were tracked before decide call completed\n    var events = this._events_tracked_before_user_decide_check_complete;\n    while (events.length > 0) {\n        var data = events.shift(); // replay in the same order they came in\n        this._check_and_handle_triggered_notifications(data);\n    }\n};\n\nMixpanelLib.prototype._show_notification = function(notif_data) {\n    var notification = new MixpanelNotification(notif_data, this);\n    notification.show();\n};\n\n// perform some housekeeping around GDPR opt-in/out state\nMixpanelLib.prototype._gdpr_init = function() {\n    var is_localStorage_requested = this.get_config('opt_out_tracking_persistence_type') === 'localStorage';\n\n    // try to convert opt-in/out cookies to localStorage if possible\n    if (is_localStorage_requested && _.localStorage.is_supported()) {\n        if (!this.has_opted_in_tracking() && this.has_opted_in_tracking({'persistence_type': 'cookie'})) {\n            this.opt_in_tracking({'enable_persistence': false});\n        }\n        if (!this.has_opted_out_tracking() && this.has_opted_out_tracking({'persistence_type': 'cookie'})) {\n            this.opt_out_tracking({'clear_persistence': false});\n        }\n        this.clear_opt_in_out_tracking({\n            'persistence_type': 'cookie',\n            'enable_persistence': false\n        });\n    }\n\n    // check whether the user has already opted out - if so, clear & disable persistence\n    if (this.has_opted_out_tracking()) {\n        this._gdpr_update_persistence({'clear_persistence': true});\n\n    // check whether we should opt out by default\n    // note: we don't clear persistence here by default since opt-out default state is often\n    //       used as an initial state while GDPR information is being collected\n    } else if (!this.has_opted_in_tracking() && (\n        this.get_config('opt_out_tracking_by_default') || _.cookie.get('mp_optout')\n    )) {\n        _.cookie.remove('mp_optout');\n        this.opt_out_tracking({\n            'clear_persistence': this.get_config('opt_out_persistence_by_default')\n        });\n    }\n};\n\n/**\n * Enable or disable persistence based on options\n * only enable/disable if persistence is not already in this state\n * @param {boolean} [options.clear_persistence] If true, will delete all data stored by the sdk in persistence and disable it\n * @param {boolean} [options.enable_persistence] If true, will re-enable sdk persistence\n */\nMixpanelLib.prototype._gdpr_update_persistence = function(options) {\n    var disabled;\n    if (options && options['clear_persistence']) {\n        disabled = true;\n    } else if (options && options['enable_persistence']) {\n        disabled = false;\n    } else {\n        return;\n    }\n\n    if (!this.get_config('disable_persistence') && this['persistence'].disabled !== disabled) {\n        this['persistence'].set_disabled(disabled);\n    }\n};\n\n// call a base gdpr function after constructing the appropriate token and options args\nMixpanelLib.prototype._gdpr_call_func = function(func, options) {\n    options = _.extend({\n        'track': _.bind(this.track, this),\n        'persistence_type': this.get_config('opt_out_tracking_persistence_type'),\n        'cookie_prefix': this.get_config('opt_out_tracking_cookie_prefix'),\n        'cookie_expiration': this.get_config('cookie_expiration'),\n        'cross_subdomain_cookie': this.get_config('cross_subdomain_cookie'),\n        'secure_cookie': this.get_config('secure_cookie')\n    }, options);\n\n    // check if localStorage can be used for recording opt out status, fall back to cookie if not\n    if (!_.localStorage.is_supported()) {\n        options['persistence_type'] = 'cookie';\n    }\n\n    return func(this.get_config('token'), {\n        track: options['track'],\n        trackEventName: options['track_event_name'],\n        trackProperties: options['track_properties'],\n        persistenceType: options['persistence_type'],\n        persistencePrefix: options['cookie_prefix'],\n        cookieExpiration: options['cookie_expiration'],\n        crossSubdomainCookie: options['cross_subdomain_cookie'],\n        secureCookie: options['secure_cookie']\n    });\n};\n\n/**\n * Opt the user in to data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // opt user in\n *     mixpanel.opt_in_tracking();\n *\n *     // opt user in with specific event name, properties, cookie configuration\n *     mixpanel.opt_in_tracking({\n *         track_event_name: 'User opted in',\n *         track_event_properties: {\n *             'Email': 'jdoe@example.com'\n *         },\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {function} [options.track] Function used for tracking a Mixpanel event to record the opt-in action (default is this Mixpanel instance's track method)\n * @param {string} [options.track_event_name=$opt_in] Event name to be used for tracking the opt-in action\n * @param {Object} [options.track_properties] Set of properties to be tracked along with the opt-in action\n * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\nMixpanelLib.prototype.opt_in_tracking = function(options) {\n    options = _.extend({\n        'enable_persistence': true\n    }, options);\n\n    this._gdpr_call_func(optIn, options);\n    this._gdpr_update_persistence(options);\n};\n\n/**\n * Opt the user out of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // opt user out\n *     mixpanel.opt_out_tracking();\n *\n *     // opt user out with different cookie configuration from Mixpanel instance\n *     mixpanel.opt_out_tracking({\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {boolean} [options.delete_user=true] If true, will delete the currently identified user's profile and clear all charges after opting the user out\n * @param {boolean} [options.clear_persistence=true] If true, will delete all data stored by the sdk in persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\nMixpanelLib.prototype.opt_out_tracking = function(options) {\n    options = _.extend({\n        'clear_persistence': true,\n        'delete_user': true\n    }, options);\n\n    // delete use and clear charges since these methods may be disabled by opt-out\n    if (options['delete_user'] && this['people'] && this['people']._identify_called()) {\n        this['people'].delete_user();\n        this['people'].clear_charges();\n    }\n\n    this._gdpr_call_func(optOut, options);\n    this._gdpr_update_persistence(options);\n};\n\n/**\n * Check whether the user has opted in to data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     var has_opted_in = mixpanel.has_opted_in_tracking();\n *     // use has_opted_in value\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} current opt-in status\n */\nMixpanelLib.prototype.has_opted_in_tracking = function(options) {\n    return this._gdpr_call_func(hasOptedIn, options);\n};\n\n/**\n * Check whether the user has opted out of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     var has_opted_out = mixpanel.has_opted_out_tracking();\n *     // use has_opted_out value\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} current opt-out status\n */\nMixpanelLib.prototype.has_opted_out_tracking = function(options) {\n    return this._gdpr_call_func(hasOptedOut, options);\n};\n\n/**\n * Clear the user's opt in/out status of data tracking and cookies/localstorage for this Mixpanel instance\n *\n * ### Usage\n *\n *     // clear user's opt-in/out status\n *     mixpanel.clear_opt_in_out_tracking();\n *\n *     // clear user's opt-in/out status with specific cookie configuration - should match\n *     // configuration used when opt_in_tracking/opt_out_tracking methods were called.\n *     mixpanel.clear_opt_in_out_tracking({\n *         cookie_expiration: 30,\n *         secure_cookie: true\n *     });\n *\n * @param {Object} [options] A dictionary of config options to override\n * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n * @param {string} [options.cookie_prefix=__mp_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this Mixpanel instance's config)\n * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this Mixpanel instance's config)\n */\nMixpanelLib.prototype.clear_opt_in_out_tracking = function(options) {\n    options = _.extend({\n        'enable_persistence': true\n    }, options);\n\n    this._gdpr_call_func(clearOptInOut, options);\n    this._gdpr_update_persistence(options);\n};\n\n// EXPORTS (for closure compiler)\n\n// MixpanelLib Exports\nMixpanelLib.prototype['init']                               = MixpanelLib.prototype.init;\nMixpanelLib.prototype['reset']                              = MixpanelLib.prototype.reset;\nMixpanelLib.prototype['disable']                            = MixpanelLib.prototype.disable;\nMixpanelLib.prototype['time_event']                         = MixpanelLib.prototype.time_event;\nMixpanelLib.prototype['track']                              = MixpanelLib.prototype.track;\nMixpanelLib.prototype['track_links']                        = MixpanelLib.prototype.track_links;\nMixpanelLib.prototype['track_forms']                        = MixpanelLib.prototype.track_forms;\nMixpanelLib.prototype['track_pageview']                     = MixpanelLib.prototype.track_pageview;\nMixpanelLib.prototype['register']                           = MixpanelLib.prototype.register;\nMixpanelLib.prototype['register_once']                      = MixpanelLib.prototype.register_once;\nMixpanelLib.prototype['unregister']                         = MixpanelLib.prototype.unregister;\nMixpanelLib.prototype['identify']                           = MixpanelLib.prototype.identify;\nMixpanelLib.prototype['alias']                              = MixpanelLib.prototype.alias;\nMixpanelLib.prototype['name_tag']                           = MixpanelLib.prototype.name_tag;\nMixpanelLib.prototype['set_config']                         = MixpanelLib.prototype.set_config;\nMixpanelLib.prototype['get_config']                         = MixpanelLib.prototype.get_config;\nMixpanelLib.prototype['get_property']                       = MixpanelLib.prototype.get_property;\nMixpanelLib.prototype['get_distinct_id']                    = MixpanelLib.prototype.get_distinct_id;\nMixpanelLib.prototype['toString']                           = MixpanelLib.prototype.toString;\nMixpanelLib.prototype['_check_and_handle_notifications']    = MixpanelLib.prototype._check_and_handle_notifications;\nMixpanelLib.prototype['_handle_user_decide_check_complete'] = MixpanelLib.prototype._handle_user_decide_check_complete;\nMixpanelLib.prototype['_show_notification']                 = MixpanelLib.prototype._show_notification;\nMixpanelLib.prototype['opt_out_tracking']                   = MixpanelLib.prototype.opt_out_tracking;\nMixpanelLib.prototype['opt_in_tracking']                    = MixpanelLib.prototype.opt_in_tracking;\nMixpanelLib.prototype['has_opted_out_tracking']             = MixpanelLib.prototype.has_opted_out_tracking;\nMixpanelLib.prototype['has_opted_in_tracking']              = MixpanelLib.prototype.has_opted_in_tracking;\nMixpanelLib.prototype['clear_opt_in_out_tracking']          = MixpanelLib.prototype.clear_opt_in_out_tracking;\nMixpanelLib.prototype['get_group']                          = MixpanelLib.prototype.get_group;\nMixpanelLib.prototype['set_group']                          = MixpanelLib.prototype.set_group;\nMixpanelLib.prototype['add_group']                          = MixpanelLib.prototype.add_group;\nMixpanelLib.prototype['remove_group']                       = MixpanelLib.prototype.remove_group;\nMixpanelLib.prototype['track_with_groups']                  = MixpanelLib.prototype.track_with_groups;\n\n// MixpanelPersistence Exports\nMixpanelPersistence.prototype['properties']            = MixpanelPersistence.prototype.properties;\nMixpanelPersistence.prototype['update_search_keyword'] = MixpanelPersistence.prototype.update_search_keyword;\nMixpanelPersistence.prototype['update_referrer_info']  = MixpanelPersistence.prototype.update_referrer_info;\nMixpanelPersistence.prototype['get_cross_subdomain']   = MixpanelPersistence.prototype.get_cross_subdomain;\nMixpanelPersistence.prototype['clear']                 = MixpanelPersistence.prototype.clear;\n\n_.safewrap_class(MixpanelLib, ['identify', '_check_and_handle_notifications', '_show_notification']);\n\n\nvar instances = {};\nvar extend_mp = function() {\n    // add all the sub mixpanel instances\n    _.each(instances, function(instance, name) {\n        if (name !== PRIMARY_INSTANCE_NAME) { mixpanel_master[name] = instance; }\n    });\n\n    // add private functions as _\n    mixpanel_master['_'] = _;\n};\n\nvar override_mp_init_func = function() {\n    // we override the snippets init function to handle the case where a\n    // user initializes the mixpanel library after the script loads & runs\n    mixpanel_master['init'] = function(token, config, name) {\n        if (name) {\n            // initialize a sub library\n            if (!mixpanel_master[name]) {\n                mixpanel_master[name] = instances[name] = create_mplib(token, config, name);\n                mixpanel_master[name]._loaded();\n            }\n            return mixpanel_master[name];\n        } else {\n            var instance = mixpanel_master;\n\n            if (instances[PRIMARY_INSTANCE_NAME]) {\n                // main mixpanel lib already initialized\n                instance = instances[PRIMARY_INSTANCE_NAME];\n            } else if (token) {\n                // intialize the main mixpanel lib\n                instance = create_mplib(token, config, PRIMARY_INSTANCE_NAME);\n                instance._loaded();\n                instances[PRIMARY_INSTANCE_NAME] = instance;\n            }\n\n            mixpanel_master = instance;\n            if (init_type === INIT_SNIPPET) {\n                window$1[PRIMARY_INSTANCE_NAME] = mixpanel_master;\n            }\n            extend_mp();\n        }\n    };\n};\n\nvar add_dom_loaded_handler = function() {\n    // Cross browser DOM Loaded support\n    function dom_loaded_handler() {\n        // function flag since we only want to execute this once\n        if (dom_loaded_handler.done) { return; }\n        dom_loaded_handler.done = true;\n\n        DOM_LOADED = true;\n        ENQUEUE_REQUESTS = false;\n\n        _.each(instances, function(inst) {\n            inst._dom_loaded();\n        });\n    }\n\n    function do_scroll_check() {\n        try {\n            document$1.documentElement.doScroll('left');\n        } catch(e) {\n            setTimeout(do_scroll_check, 1);\n            return;\n        }\n\n        dom_loaded_handler();\n    }\n\n    if (document$1.addEventListener) {\n        if (document$1.readyState === 'complete') {\n            // safari 4 can fire the DOMContentLoaded event before loading all\n            // external JS (including this file). you will see some copypasta\n            // on the internet that checks for 'complete' and 'loaded', but\n            // 'loaded' is an IE thing\n            dom_loaded_handler();\n        } else {\n            document$1.addEventListener('DOMContentLoaded', dom_loaded_handler, false);\n        }\n    } else if (document$1.attachEvent) {\n        // IE\n        document$1.attachEvent('onreadystatechange', dom_loaded_handler);\n\n        // check to make sure we arn't in a frame\n        var toplevel = false;\n        try {\n            toplevel = window$1.frameElement === null;\n        } catch(e) {\n            // noop\n        }\n\n        if (document$1.documentElement.doScroll && toplevel) {\n            do_scroll_check();\n        }\n    }\n\n    // fallback handler, always will work\n    _.register_event(window$1, 'load', dom_loaded_handler, true);\n};\n\nfunction init_as_module() {\n    init_type = INIT_MODULE;\n    mixpanel_master = new MixpanelLib();\n\n    override_mp_init_func();\n    mixpanel_master['init']();\n    add_dom_loaded_handler();\n\n    return mixpanel_master;\n}\n\nvar mixpanel = init_as_module();\n\nmodule.exports = mixpanel;"]},"metadata":{},"sourceType":"script"}