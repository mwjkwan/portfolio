{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = dataReducer;\n\nvar _assign2 = _interopRequireDefault(require(\"lodash/fp/assign\"));\n\nvar _setWith2 = _interopRequireDefault(require(\"lodash/fp/setWith\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _constants = require(\"../constants\");\n\nvar _reducers = require(\"../utils/reducers\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar CLEAR_DATA = _constants.actionTypes.CLEAR_DATA,\n    GET_SUCCESS = _constants.actionTypes.GET_SUCCESS,\n    LISTENER_RESPONSE = _constants.actionTypes.LISTENER_RESPONSE,\n    LISTENER_ERROR = _constants.actionTypes.LISTENER_ERROR,\n    DELETE_SUCCESS = _constants.actionTypes.DELETE_SUCCESS,\n    DOCUMENT_ADDED = _constants.actionTypes.DOCUMENT_ADDED,\n    DOCUMENT_MODIFIED = _constants.actionTypes.DOCUMENT_MODIFIED,\n    DOCUMENT_REMOVED = _constants.actionTypes.DOCUMENT_REMOVED;\n\nfunction dataReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case GET_SUCCESS:\n    case LISTENER_RESPONSE:\n      var meta = action.meta,\n          payload = action.payload;\n\n      if (!payload || payload.data === undefined) {\n        return state;\n      }\n\n      var getDocName = function getDocName(data) {\n        return data.subcollections ? getDocName(data.subcollections.slice(-1)[0]) : data.doc;\n      };\n\n      var docName = getDocName(meta);\n      var data = docName ? (0, _get2.default)(payload.data, docName) : payload.data;\n      var previousData = (0, _get2.default)(state, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta));\n\n      if (!previousData || meta.subcollections) {\n        return (0, _setWith2.default)(Object, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta), data, state);\n      }\n\n      var mergedData = (0, _assign2.default)(previousData, data);\n      return (0, _setWith2.default)(Object, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta), mergedData, state);\n\n    case DOCUMENT_MODIFIED:\n    case DOCUMENT_ADDED:\n      return (0, _setWith2.default)(Object, (0, _reducers.pathFromMeta)(action.meta), action.payload.data, state);\n\n    case DOCUMENT_REMOVED:\n    case DELETE_SUCCESS:\n      var removePath = (0, _reducers.pathFromMeta)(action.meta);\n      var cleanedState = (0, _setWith2.default)(Object, removePath, null, state);\n\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, cleanedState);\n      }\n\n      return cleanedState;\n\n    case CLEAR_DATA:\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, {});\n      }\n\n      return {};\n\n    case LISTENER_ERROR:\n      var nextState = (0, _setWith2.default)(Object, (0, _reducers.pathFromMeta)(action.meta), null, state);\n\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, nextState);\n      }\n\n      var existingState = (0, _get2.default)(state, (0, _reducers.pathFromMeta)(action.meta));\n\n      if (existingState) {\n        return state;\n      }\n\n      return nextState;\n\n    default:\n      return state;\n  }\n}","map":{"version":3,"sources":["/Users/melissa/datamatch/node_modules/redux-firestore/es/reducers/dataReducer.js"],"names":["Object","defineProperty","exports","value","default","dataReducer","_assign2","_interopRequireDefault","require","_setWith2","_get2","_constants","_reducers","obj","__esModule","CLEAR_DATA","actionTypes","GET_SUCCESS","LISTENER_RESPONSE","LISTENER_ERROR","DELETE_SUCCESS","DOCUMENT_ADDED","DOCUMENT_MODIFIED","DOCUMENT_REMOVED","state","arguments","length","undefined","action","type","meta","payload","data","getDocName","subcollections","slice","doc","docName","previousData","storeAs","pathFromMeta","mergedData","removePath","cleanedState","preserve","preserveValuesFromState","nextState","existingState"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = dataReducer;\n\nvar _assign2 = _interopRequireDefault(require(\"lodash/fp/assign\"));\n\nvar _setWith2 = _interopRequireDefault(require(\"lodash/fp/setWith\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _constants = require(\"../constants\");\n\nvar _reducers = require(\"../utils/reducers\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar CLEAR_DATA = _constants.actionTypes.CLEAR_DATA,\n    GET_SUCCESS = _constants.actionTypes.GET_SUCCESS,\n    LISTENER_RESPONSE = _constants.actionTypes.LISTENER_RESPONSE,\n    LISTENER_ERROR = _constants.actionTypes.LISTENER_ERROR,\n    DELETE_SUCCESS = _constants.actionTypes.DELETE_SUCCESS,\n    DOCUMENT_ADDED = _constants.actionTypes.DOCUMENT_ADDED,\n    DOCUMENT_MODIFIED = _constants.actionTypes.DOCUMENT_MODIFIED,\n    DOCUMENT_REMOVED = _constants.actionTypes.DOCUMENT_REMOVED;\n\nfunction dataReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case GET_SUCCESS:\n    case LISTENER_RESPONSE:\n      var meta = action.meta,\n          payload = action.payload;\n\n      if (!payload || payload.data === undefined) {\n        return state;\n      }\n\n      var getDocName = function getDocName(data) {\n        return data.subcollections ? getDocName(data.subcollections.slice(-1)[0]) : data.doc;\n      };\n\n      var docName = getDocName(meta);\n      var data = docName ? (0, _get2.default)(payload.data, docName) : payload.data;\n      var previousData = (0, _get2.default)(state, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta));\n\n      if (!previousData || meta.subcollections) {\n        return (0, _setWith2.default)(Object, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta), data, state);\n      }\n\n      var mergedData = (0, _assign2.default)(previousData, data);\n      return (0, _setWith2.default)(Object, meta.storeAs ? [meta.storeAs] : (0, _reducers.pathFromMeta)(meta), mergedData, state);\n\n    case DOCUMENT_MODIFIED:\n    case DOCUMENT_ADDED:\n      return (0, _setWith2.default)(Object, (0, _reducers.pathFromMeta)(action.meta), action.payload.data, state);\n\n    case DOCUMENT_REMOVED:\n    case DELETE_SUCCESS:\n      var removePath = (0, _reducers.pathFromMeta)(action.meta);\n      var cleanedState = (0, _setWith2.default)(Object, removePath, null, state);\n\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, cleanedState);\n      }\n\n      return cleanedState;\n\n    case CLEAR_DATA:\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, {});\n      }\n\n      return {};\n\n    case LISTENER_ERROR:\n      var nextState = (0, _setWith2.default)(Object, (0, _reducers.pathFromMeta)(action.meta), null, state);\n\n      if (action.preserve && action.preserve.data) {\n        return (0, _reducers.preserveValuesFromState)(state, action.preserve.data, nextState);\n      }\n\n      var existingState = (0, _get2.default)(state, (0, _reducers.pathFromMeta)(action.meta));\n\n      if (existingState) {\n        return state;\n      }\n\n      return nextState;\n\n    default:\n      return state;\n  }\n}"]},"metadata":{},"sourceType":"script"}